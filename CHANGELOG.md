<!-- @formatter:off -->
<!-- noinspection -->
<!-- Prevents auto format, for JetBrains IDE File > Settings > Editor > Code Style (Formatter Tab) > Turn formatter on/off with markers in code comments  -->

<!-- This file is automatically generate by logchange tool 🌳 🪓 => 🪵 -->
<!-- Visit https://github.com/logchange/logchange and leave a star 🌟 -->
<!-- !!! ⚠️ DO NOT MODIFY THIS FILE, YOUR CHANGES WILL BE LOST ⚠️ !!! -->


This file lists Solr's raw release notes with details of every change to Solr. Most people will find the solr-upgrade-notes.adoc file more approachable. [https://github.com/apache/solr/blob/main/solr/solr-ref-guide/modules/upgrade-notes/pages/solr-upgrade-notes.adoc](https://github.com/apache/solr/blob/main/solr/solr-ref-guide/modules/upgrade-notes/pages/solr-upgrade-notes.adoc)


[9.9.0] - 2025-07-24
--------------------

### Added (9 changes)

- Certificate based authentication plugin now has richer flexible cert principal resolution. [SOLR-17309](https://issues.apache.org/jira/browse/SOLR-17309) (Lamine Idjeraoui) (Eric Pugh)
- Support terminating a search early based on maxHitsAllowed per shard. [SOLR-17447](https://issues.apache.org/jira/browse/SOLR-17447) (Siju Varghese) (Houston Putman) (David Smiley) (Gus Heck)
- Add RawTFSimilarityFactory class. [SOLR-17626](https://issues.apache.org/jira/browse/SOLR-17626) (Christine Poerschke)
- Added update request processor to encode text to vector at indexing time through external LLM services. [SOLR-17632](https://issues.apache.org/jira/browse/SOLR-17632) (Alessandro Benedetti)
- New 'skipLeaderRecovery' replica property allows PULL replicas with existing indexes to immediately become ACTIVE [SOLR-17656](https://issues.apache.org/jira/browse/SOLR-17656) (hossman)
- ReRank queries can now return the originalScore (original score) in addition to the re-ranked score. [SOLR-17678](https://issues.apache.org/jira/browse/SOLR-17678) (Siju Varghese) (Houston Putman)
- Added a FuzzyQParser to enable all FuzzyQuery customizations. [SOLR-17714](https://issues.apache.org/jira/browse/SOLR-17714) (Houston Putman) (Siju Varghese)
- Added linear function support for RankField via RankQParserPlugin. [SOLR-17749](https://issues.apache.org/jira/browse/SOLR-17749) (Christine Poerschke)
- New ExpressionValueSourceParser that allows custom function queries / VSPs to be defined in a subset of JavaScript, pre-compiled, and that which can access the score and fields. It's powered by the Lucene Expressions module. [SOLR-5707](https://issues.apache.org/jira/browse/SOLR-5707) (hossman) (David Smiley) (Ryan Ernst) (Kevin Risden)

### Changed (21 changes)

- v2 APIs now obey the "Accept" request header for content-negotiation if 'wt' is unspecified. JSON is still used as a default when neither 'Accept' or 'wt' are specified. [SOLR-10998](https://issues.apache.org/jira/browse/SOLR-10998) (Jason Gerlowski)
- The v2 API now has parity with the v1 "COLSTATUS" and "segments" APIs, which can be used to fetch detailed information about specific collections or cores. Collection information can be fetched by a call to `GET /api/collections/collectionName`, and core information with a call to `GET /api/cores/coreName/segments`. [SOLR-15751](https://issues.apache.org/jira/browse/SOLR-15751) (Jason Gerlowski)
- All v2 configset APIs have been moved to the slightly different path: `/api/configsets`, to better align with the design of other v2 APIs. SolrJ now offers (experimental) SolrRequest implementations for all v2 configset APIs in `org.apache.solr.client.solrj.request.ConfigsetsApi`. [SOLR-16396](https://issues.apache.org/jira/browse/SOLR-16396) (Jason Gerlowski)
- Add PKI Auth Caching for both generation of the PKI Auth Tokens and validation of received tokens. The default PKI Auth validity TTL has been increased from 5 seconds to 10 seconds. [SOLR-16951](https://issues.apache.org/jira/browse/SOLR-16951) (Houston Putman)
- edismax MatchAllDocsQuery (*:*) Optimization [SOLR-17130](https://issues.apache.org/jira/browse/SOLR-17130) (Kevin Risden)
- The polling interval for PULL and TLOG replicas can now be overridden using the `commitPollInterval` setting, which takes a String formatted as "HH:mm:ss" [SOLR-17187](https://issues.apache.org/jira/browse/SOLR-17187) (Torsten Koster) (Christine Poerschke) (Jason Gerlowski)
- Solr's filestore "get-file" API has been decomposed into several separate endpoints. Traditional file-fetching is now available at `GET /api/cluster/filestore/files/some/path.txt` and metadata fetching (and directory listing) is now available at `GET /api/cluster/filestore/metadata/some/path.txt`. SolrJ now offers request and response bindings for these APIs in `org.apache.solr.client.solrj.request.FileStoreApi`. The older form of this endpoint (`GET /api/node/files`) is deprecated and is slated to be removed. [SOLR-17351](https://issues.apache.org/jira/browse/SOLR-17351) (Jason Gerlowski)
- Remove ZkController internal core supplier, for slightly faster reconnection after Zookeeper session loss. [SOLR-17578](https://issues.apache.org/jira/browse/SOLR-17578) (Pierre Salagnac)
- The CLUSTERSTATUS API will now stream each collection's status to the response, fetching and computing it on the fly. To avoid a backwards compatibility concern, this won't work for wt=javabin. [SOLR-17582](https://issues.apache.org/jira/browse/SOLR-17582) (Matthew Biscocho) (David Smiley)
- SolrJ CloudSolrClient configured with HTTP URLs will no longer eagerly connect to anything. [SOLR-17607](https://issues.apache.org/jira/browse/SOLR-17607) (David Smiley)
- Export metric timers via `wt=prometheus` as Prometheus summaries. [SOLR-17628](https://issues.apache.org/jira/browse/SOLR-17628) (Jude Muriithi) (Matthew Biscocho)
- Reduced memory usage in SolrJ getBeans() method when handling dynamic fields with wildcards. [SOLR-17669](https://issues.apache.org/jira/browse/SOLR-17669) (Martin Anzinger)
- Score-based return fields other than "score" can now be returned in distributed queries. [SOLR-17732](https://issues.apache.org/jira/browse/SOLR-17732) (Houston Putman)
- Solr now supports Jetty's Graceful Shutdown module (via SOLR_JETTY_GRACEFUL=true) to prevent client connections from being abruptly terminated on orderly shutdown [SOLR-17744](https://issues.apache.org/jira/browse/SOLR-17744) (hossman)
- Provide long form --jettyconfig option to go with -j in bin/solr scripts. [SOLR-17746](https://issues.apache.org/jira/browse/SOLR-17746) (Eric Pugh) (Rahul Goswami)
- S3 File downloads now handle connection issues more gracefully [SOLR-17750](https://issues.apache.org/jira/browse/SOLR-17750) (Houston Putman) (Mark Miller)
- Parallelize index fingerprint computation across segments via a dedicated thread pool [SOLR-17756](https://issues.apache.org/jira/browse/SOLR-17756) (Matthew Biscocho) (Luke Kot-Zaniewski)
- Speed up function queries in 'fl' param. [SOLR-17775](https://issues.apache.org/jira/browse/SOLR-17775) (Yura Korolov)
- SolrJ: If Http2SolrClient.Builder.withHttpClient is used, (and it's used more in 9.8, shifted from deprecated Apache HttpClient based clients), settings affecting HttpClient construction cannot be customized; an IllegalStateException will now be thrown if you try. The connection timeout cannot be customized, but idle & request timeouts can be. Callers (various places in Solr) no longer customize the connection timeout. [SOLR-17776](https://issues.apache.org/jira/browse/SOLR-17776) (David Smiley) (Luke Kot-Zaniewski)
- The HttpJdkSolrClient wasn't setting the connection timeout as per the builder configuration. [SOLR-17776](https://issues.apache.org/jira/browse/SOLR-17776) (David Smiley)
- Use TotalHitCountCollector to collect count when no rows needed [SOLR-17801](https://issues.apache.org/jira/browse/SOLR-17801) (Kevin Risden)

### Fixed (26 changes)

- Improving check in TextToVectorUpdateProcessorFactory, which breaks update for new dynamic fields. [GITHUB#3426](https://github.com/apache/solr/pull/3426) (Renato Haeberli) (Alessandro Benedetti)
- Clean up shard metadata in ZooKeeper nodes after shard deletion is invoked. This makes sure Zookeeper nodes for leader election and terms are not left behind [SOLR-12831](https://issues.apache.org/jira/browse/SOLR-12831) (Andy Vuong) (Pierre Salagnac)
- SolrJ CloudSolrClient configured with Solr URLs can fail to request cluster state if its current live nodes list is stale. CloudSolrClient now retains the initial configured list of passed URLs as backup used for fetching cluster state when all live nodes have failed. [SOLR-17519](https://issues.apache.org/jira/browse/SOLR-17519) (Matthew Biscocho) (David Smiley) (Houston Putman)
- If SQLHandler failed to open the underlying stream (e.g. Solr returns an error; could be user/syntax problem), it needs to close the stream to cleanup resources but wasn't. [SOLR-17629](https://issues.apache.org/jira/browse/SOLR-17629) (David Smiley)
- Some CLI errors not logged when starting prometheus exporter [SOLR-17638](https://issues.apache.org/jira/browse/SOLR-17638) (Alex Deparvu)
- Core unload/deletion now preempts all forms of ongoing "recovery", rather than inadvertently waiting for completion in some cases. [SOLR-17692](https://issues.apache.org/jira/browse/SOLR-17692) (Jason Gerlowski)
- Fixed performance regression since 9.0 with "frange" queries embedded in other queries. May also affect some numeric range queries when the minimum is negative. [SOLR-17699](https://issues.apache.org/jira/browse/SOLR-17699) (David Smiley)
- Use Core Operation lock when unloading cores. This fixes errors that occur when a collection deletion and reload occur at the same time. [SOLR-17700](https://issues.apache.org/jira/browse/SOLR-17700) (Houston Putman)
- Fix race condition when checking distrib async cmd status [SOLR-17709](https://issues.apache.org/jira/browse/SOLR-17709) (Houston Putman)
- Remove total request timeout during recovery that was inadvertently added. [SOLR-17711](https://issues.apache.org/jira/browse/SOLR-17711) (Luke Kot-Zaniewski)
- Fix rare deadlock in CollectionProperties internals. [SOLR-17720](https://issues.apache.org/jira/browse/SOLR-17720) (Aparna Suresh) (Houston Putman)
- MoreLikeThis to support copy-fields [SOLR-17726](https://issues.apache.org/jira/browse/SOLR-17726) (Ilaria Petreti) (Alessandro Benedetti)
- When the V2 API is receiving raw files, it could sometimes skip the first byte. [SOLR-17740](https://issues.apache.org/jira/browse/SOLR-17740) (David Smiley)
- Cancel leader election was being skipped on core container shutdown due to incorrect zkClient check [SOLR-17745](https://issues.apache.org/jira/browse/SOLR-17745) (Matthew Biscocho) (Luke Kot-Zaniewski)
- Fix rare bug in overseer main loop in case of high load, that may cause the overseer be fully stuck until server restart. [SOLR-17754](https://issues.apache.org/jira/browse/SOLR-17754) (Pierre Salagnac)
- The NumFieldLimitingUpdateRequestProcessor's "warnOnly" mode has been fixed, and now processes documents even when the limit has been exceeded. [SOLR-17758](https://issues.apache.org/jira/browse/SOLR-17758) (Jason Gerlowski) (Rahul Goswami)
- Global circuit breakers can no longer trigger ConcurrentModificationException's on Solr startup [SOLR-17761](https://issues.apache.org/jira/browse/SOLR-17761) (Jason Gerlowski)
- Use S3 RetryStrategy instead of RetryPolicy. This fixes the error caused by using the "Adaptive" retry mode. [SOLR-17769](https://issues.apache.org/jira/browse/SOLR-17769) (Houston Putman)
- Fix a very minor memory leak in metrics reporting code when a core is deleted. [SOLR-17777](https://issues.apache.org/jira/browse/SOLR-17777) (Pierre Salagnac)
- Allow the -j or --jettyconfig option to start with a dash (-). [SOLR-17790](https://issues.apache.org/jira/browse/SOLR-17790) (Houston Putman)
- Fix deadlocks in ParallelHttpShardHandler, re-implement synchronization in HttpShardHandler [SOLR-17792](https://issues.apache.org/jira/browse/SOLR-17792) (Houston Putman)
- Security Manager should handle symlink on /tmp [SOLR-17800](https://issues.apache.org/jira/browse/SOLR-17800) (Kevin Risden)
- Exception in TransactionLog constructor deletes the file and does not block subsequent updates. [SOLR-17805](https://issues.apache.org/jira/browse/SOLR-17805) (Bruno Roustant)
- Disable http2 request cancellation for Jetty 10, the cancellation can bleed across to other requests. [SOLR-17819](https://issues.apache.org/jira/browse/SOLR-17819) (Houston Putman)
- Fix various methods of invoking "local" solr requests to re-use the same searcher as the original request. This notably fixes the use of spellcheck.maxCollationTries in firstSearcher warming queries to prevent deadlock [SOLR-5386](https://issues.apache.org/jira/browse/SOLR-5386) (hossman)
- Passing additional arguments to solr.cmd using "--jvm-opts" (formerly "-a") in conjunction with "-e" (examples like 'techproducts') wouldn't reflect on Windows [SOLR-7962](https://issues.apache.org/jira/browse/SOLR-7962) (Rahul Goswami) (Eric Pugh)

### Dependency Upgrades (6 changes)

- Update apache.zookeeper to v3.9.3 [PR#3061](https://github.com/apache/solr/pull/3061) (solrbot)
- chore(deps): update apache.kafka to v3.9.0 [PR#3078](https://github.com/apache/solr/pull/3078) (solrbot)
- Update amazon.awssdk to v2.31.77 [PR#3228](https://github.com/apache/solr/pull/3228) (solrbot)
- Update mockito to v5.16.1 [PR#3234](https://github.com/apache/solr/pull/3234) (solrbot)
- Upgrade Lucene to 9.12.2. [SOLR-17795](https://issues.apache.org/jira/browse/SOLR-17795) (Pierre Salagnac) (Christine Poerschke) (Houston Putman)
- Upgrade forbiddenapis to 3.9. (Uwe Schindler)

### Other (19 changes)

- Improve reliablity of NpmTasks finding needed files/commands. [GITHUB#2680](https://github.com/apache/solr/pull/2680) (Tyler Bertrand) (Eric Pugh)
- SolrTestCase now supports @LogLevel annotations (as SolrTestCaseJ4 has). Added LogLevelTestRule for encapsulation and reuse. [GITHUB#2869](https://github.com/apache/solr/pull/2869) (David Smiley)
- Most remaining usages of Apache HttpClient in Solr switched to Jetty HttpClient (HTTP 2). [SOLR-16503](https://issues.apache.org/jira/browse/SOLR-16503) (Sanjay Dutt) (David Smiley)
- Deprecate UpdateRequest.getXml(). Usage of XMLRequestWriter is now preferred. [SOLR-17518](https://issues.apache.org/jira/browse/SOLR-17518) (Pierre Salagnac)
- Remove unused code and other refactorings in ReplicationHandler and tests. Removed unused public LOCAL_ACTIVITY_DURING_REPLICATION variable. [SOLR-17579](https://issues.apache.org/jira/browse/SOLR-17579) (Eric Pugh)
- Introduce new test variant of waitForState(), that does not wait on live node changes when we're only interested in the collection state. [SOLR-17581](https://issues.apache.org/jira/browse/SOLR-17581) (Pierre Salagnac)
- Prevent error log entry on solr server due to initial HEAD request from HttpJdkSolrClient. [SOLR-17589](https://issues.apache.org/jira/browse/SOLR-17589) (Paul Blanchaert) (James Dyer)
- SolrJ's User-Agent header now uses the version of SolrJ. There's a corresponding HttpSolrCall.getUserAgentSolrVersion to parse it. [SOLR-17611](https://issues.apache.org/jira/browse/SOLR-17611) (David Smiley)
- SimpleOrderedMap (a NamedList) now implements java.util.Map. [SOLR-17623](https://issues.apache.org/jira/browse/SOLR-17623) (Renato Haeberli) (David Smiley)
- Replaced NamedList.findRecursive usages with _get, which can do Map traversal, and thus makes it easier to transition intermediate NamedLists to Maps. [SOLR-17625](https://issues.apache.org/jira/browse/SOLR-17625) (Gaurav Tuli)
- Added a node-wide CloudSolrClient to ZkController, and accessible via SolrCloudManager too. Uses Jetty HttpClient. Deprecated CloudSolrClient.getSolrClientCache. Redirected some callers. [SOLR-17630](https://issues.apache.org/jira/browse/SOLR-17630) (David Smiley)
- javabin format: provide option to decode maps as SimpleOrderedMap (a NamedList & Map) instead of LinkedHashMap. Intended to aid in 10.x compatibility. Enable via sys prop: solr.solrj.javabin.readMapAsNamedList=true [SOLR-17635](https://issues.apache.org/jira/browse/SOLR-17635) (Renato Haeberli) (David Smiley)
- multiThreaded=true: changed queue implementation from unlimited to 1000 max, after which the caller thread will execute. [SOLR-17648](https://issues.apache.org/jira/browse/SOLR-17648) (David Smiley)
- Add System.exit() in forbidden APIs, and make sure CLI unit tests never call it. [SOLR-17651](https://issues.apache.org/jira/browse/SOLR-17651) (Pierre Salagnac)
- Simplify zombie server logic in LBSolrClient [SOLR-17667](https://issues.apache.org/jira/browse/SOLR-17667) (Houston Putman)
- Replication and backup have their DirectoryFactory.DirContext so the directory they use is unwrapped when copying files. [SOLR-17671](https://issues.apache.org/jira/browse/SOLR-17671) (Bruno Roustant) (David Smiley)
- Handle interrupted exception in SolrCores.waitAddPendingCoreOps. [SOLR-17716](https://issues.apache.org/jira/browse/SOLR-17716) (Bruno Roustant)
- Deprecated 'addHttpRequestToContext', removed in 10. [SOLR-17741](https://issues.apache.org/jira/browse/SOLR-17741) (David Smiley)
- Fix native access warning when using MemorySegmentIndexInput [SOLR-17803](https://issues.apache.org/jira/browse/SOLR-17803) (Kevin Risden)


[9.8.1] - 2025-03-11
--------------------

### Fixed (9 changes)

- If multiple query param keys are sent that only vary by case, they were wrongly merged when doing distributed search (sharded collections). This could likely occur for fielded parameters such as f.CASE_SENSITIVE_FIELD.facet.limit=50. [SOLR-17221](https://issues.apache.org/jira/browse/SOLR-17221) (Yue Yu) (David Smiley)
- Metrics: wt=prometheus fix for non-compliant exposition format containing duplicate TYPE lines. [SOLR-17587](https://issues.apache.org/jira/browse/SOLR-17587) (Matthew Biscocho) (David Smiley)
- LBHttp2SolrClient can fail to complete async requests in certain error scenarios. This can cause the HttpShardHandler to indefinitely wait on a completed response that will never come. [SOLR-17637](https://issues.apache.org/jira/browse/SOLR-17637) (Houston Putman)
- Fixes collection creation failure when using a replica placement plugin with basic auth. SolrCloudManager now directly uses HttpSolrClientProvider's client, resolving missing auth listeners. [SOLR-17644](https://issues.apache.org/jira/browse/SOLR-17644) (Sanjay Dutt) (David Smiley)
- Fix a regression of faceting on multi-valued EnumFieldType, introduced by an earlier 9.x version. [SOLR-17649](https://issues.apache.org/jira/browse/SOLR-17649) (Thomas Wöckinger) (David Smiley)
- Fix a bug that could cause long leader elections to leave PULL replicas in DOWN state forever. [SOLR-17652](https://issues.apache.org/jira/browse/SOLR-17652) (hossman)
- Fix unnecessary memory allocation caused by a large reRankDocs param. [SOLR-17670](https://issues.apache.org/jira/browse/SOLR-17670) (JiaBao Gao)
- Disable multi-threaded search execution by default at the node-level. Users can still opt-in by providing a "indexSearcherExecutorThreads" &gt; 0. [SOLR-17673](https://issues.apache.org/jira/browse/SOLR-17673) (Houston Putman) (Varun Thacker) (David Smiley) (Luke Kot-Zaniewski)
- Before attempting a delete by query ("DBQ"), Solr now checks whether the provided query can be run using a Lucene IndexSearcher, and aborts the operation with a '400' error if it cannot. [SOLR-17677](https://issues.apache.org/jira/browse/SOLR-17677) (Jason Gerlowski)


[9.8.0] - 2025-01-23
--------------------

### Added (3 changes)

- The Solr Cross-DC Project has graduated from the sandbox repository. It will now be released as a fully supported Solr feature. This feature closes SIP-13: Cross Data Center Replication. [SOLR-17065](https://issues.apache.org/jira/browse/SOLR-17065) (Mark Miller) (Anshum Gupta) (Andrzej Bialecki) (Jason Gerlowski) (Houston Putman)
- Implement `memAllowed` parameter to limit per-thread memory allocations during request processing. [SOLR-17150](https://issues.apache.org/jira/browse/SOLR-17150) (Andrzej Bialecki) (Gus Heck)
- Added knn_text_to_vector query parser to encode text to vector at query time through external LLM services. [SOLR-17525](https://issues.apache.org/jira/browse/SOLR-17525) (Alessandro Benedetti)

### Changed (21 changes)

- Solrj CloudSolrClient with Solr URLs had serious performance regressions (since the beginning?) in which its collection state cache was not being used, resulting in many extra requests to Solr for cluster information. [SOLR-14985](https://issues.apache.org/jira/browse/SOLR-14985) (Aparna Suresh) (shalin) (David Smiley)
- v2 "cluster prop" APIs have been updated to be more REST-ful. Cluster prop creation/update are now available at `PUT /api/cluster/properties/somePropName`. Deletion is now available at `DELETE /api/cluster/properties/somePropName`. New APIs for listing-all and fetching-single cluster props are also now available at `GET /api/cluster/properties` and `GET /api/cluster/properties/somePropName`, respectively. [SOLR-16390](https://issues.apache.org/jira/browse/SOLR-16390) (Carlos Ugarte) (Jason Gerlowski)
- Replication "fetch file" API now has a v2 equivalent, available at `GET /api/cores/coreName/replication/files/fileName` [SOLR-16470](https://issues.apache.org/jira/browse/SOLR-16470) (Matthew Biscocho) (Jason Gerlowski)
- The VersionBucket indexing lock mechanism was replaced with something just as fast yet that which consumes almost no memory, saving 1MB of memory per SolrCore. [SOLR-17102](https://issues.apache.org/jira/browse/SOLR-17102) (David Smiley)
- Users using query limits (timeAllowed, cpuTimeAllowed) for whom partial results are uninteresting may set partialResults=false. This parameter has been enhanced to reduce time spent processing partial results and omit partialResults from the response. Since this is requested behavior, no exception is thrown and the partialResults response header will always exist if the result was short circuited. [SOLR-17158](https://issues.apache.org/jira/browse/SOLR-17158) (Gus Heck) (Andrzej Bialecki) (hossman)
- Deprecate snapshotscli.sh in favour of bin/solr snapshot sub commands. Now able to manage Snapshots from the CLI. HDFS module specific snapshot script now ships as part of that module in the modules/hdfs/bin directory. [SOLR-17180](https://issues.apache.org/jira/browse/SOLR-17180) (Eric Pugh)
- Deprecate SolrRequest `setBasePath` and `getBasePath` methods. SolrJ users wishing to temporarily override an HTTP client's base URL may use `Http2SolrClient.requestWithBaseUrl` instead. [SOLR-17256](https://issues.apache.org/jira/browse/SOLR-17256) (Jason Gerlowski) (Sanjay Dutt) (David Smiley)
- Make CLUSTERSTATUS request configurable to improve performance by allowing retrieval of specific information, reducing unnecessary data fetching. Enhanced CloudSolrClient's HTTP ClusterStateProvider to use it, and to scale to more collections better as well. [SOLR-17381](https://issues.apache.org/jira/browse/SOLR-17381) (Aparna Suresh) (David Smiley)
- Resolved overlapping arguments in the Solr CLI. Removed duplicative but differing arguments, consolidated use of short form arguments -v to not have differing meanings based on tool. Provide deprecation warning in command line when deprecated arguments are used. [SOLR-17383](https://issues.apache.org/jira/browse/SOLR-17383) (Eric Pugh) (Christos Malliaridis)
- EmbeddedSolrServer now considers the ResponseParser [SOLR-17390](https://issues.apache.org/jira/browse/SOLR-17390) (David Smiley)
- Reduce thread contention in ZkStateReader.getCollectionProperties(). [SOLR-17396](https://issues.apache.org/jira/browse/SOLR-17396) (Aparna Suresh) (David Smiley) (Paul McArthur)
- SkipExistingDocumentsProcessor now functions correctly with child documents. [SOLR-17397](https://issues.apache.org/jira/browse/SOLR-17397) (Tim Owens) (Eric Pugh)
- COLSTATUS command was fetching details remotely from replicas when this information wasn't asked for. [SOLR-17408](https://issues.apache.org/jira/browse/SOLR-17408) (Mathieu Marie)
- When searching with multiThreaded=true, the internal tasks may now block instead of enqueuing with a risk of rejection. Solr will use less resources under stress but to get the most of your machine, you may want to increase the thread pool. [SOLR-17414](https://issues.apache.org/jira/browse/SOLR-17414) (David Smiley)
- An alternate ShardHandlerFactory is now available, ParallelHttpShardHandlerFactory, which may help reduce distributed-search latency in collections with many shards, especially when PKI is used between nodes. [SOLR-17419](https://issues.apache.org/jira/browse/SOLR-17419) (Jason Gerlowski)
- Improve system metrics collection by skipping unreadable MXBean properties, making /admin/info/system calls faster [SOLR-17441](https://issues.apache.org/jira/browse/SOLR-17441) (Haythem Khiri)
- Leverage waitForState() instead of busy waiting in CREATE, MIGRATE, REINDEXCOLLECTION, MOVEREPLICA commands, and in some tests. [SOLR-17453](https://issues.apache.org/jira/browse/SOLR-17453) (Pierre Salagnac)
- Introduce -y short option to bin/solr start --no-prompt option. Aligns with bin/solr package tool. [SOLR-17528](https://issues.apache.org/jira/browse/SOLR-17528) (Eric Pugh)
- Suppress printing out of password to console when using auth CLI command. [SOLR-17554](https://issues.apache.org/jira/browse/SOLR-17554) (Christos Malliaridis) (Eric Pugh)
- Switched from HTTP1 to HTTP2 in SolrCloudManager via HttpClient change from Apache to Jetty. [SOLR-17592](https://issues.apache.org/jira/browse/SOLR-17592) (Sanjay Dutt) (David Smiley)
- Optimize PostTool to call just optimize when both commit and optimize requested. [SOLR-3913](https://issues.apache.org/jira/browse/SOLR-3913) (Eric Pugh)

### Fixed (16 changes)

- Splitting shards now routes child-docs with their _root_ field when available so they maintain parent relationship. [SOLR-11191](https://issues.apache.org/jira/browse/SOLR-11191) (Zack Kendall)
- Uploading a configset with a symbolic link produces a IOException. Now a error message to user generated instead. [SOLR-12429](https://issues.apache.org/jira/browse/SOLR-12429) (Eric Pugh)
- Clarify when a bin/solr create needs to be run on the same server as Solr. [SOLR-16254](https://issues.apache.org/jira/browse/SOLR-16254) (Eric Pugh)
- Remove log4j-jul jar and use slf4j bridge for JUL to prevent exception from being logged when remote JMX is enabled [SOLR-16976](https://issues.apache.org/jira/browse/SOLR-16976) (Shawn Heisey) (Stephen Zhou) (Eric Pugh) (Christine Poerschke) (David Smiley)
- fix replication problem on follower restart [SOLR-17306](https://issues.apache.org/jira/browse/SOLR-17306) (Martin Anzinger and Peter Kroiss) (Eric Pugh)
- Fix race condition where Zookeeper session could be re-established by multiple threads concurrently in case of frequent session expirations. [SOLR-17405](https://issues.apache.org/jira/browse/SOLR-17405) (Pierre Salagnac)
- Fixed UpdateLog replay bug that shared thread-unsafe SolrQueryRequest objects across threads [SOLR-17413](https://issues.apache.org/jira/browse/SOLR-17413) (Jason Gerlowski) (David Smiley) (Houston Putman)
- Fixed ExportHandler bug that silently suppressed errors and returned partial results in some situations [SOLR-17416](https://issues.apache.org/jira/browse/SOLR-17416) (hossman)
- Fixed a rare case where overseer was stuck after a failure when changing overseer to honor the node role for preferred overseer. [SOLR-17421](https://issues.apache.org/jira/browse/SOLR-17421) (Pierre Salagnac)
- Fixed Http2SolrClient bug in that 'requestAsync' triggered NPE when using a shared Jetty client [SOLR-17464](https://issues.apache.org/jira/browse/SOLR-17464) (Jason Gerlowski) (James Dyer)
- Clean up error message in PostTool when you attempt to post to a basic auth secured Solr. [SOLR-17529](https://issues.apache.org/jira/browse/SOLR-17529) (Eric Pugh)
- Fix AllowListUrlChecker when liveNodes changes. Remove ClusterState.getHostAllowList [SOLR-17574](https://issues.apache.org/jira/browse/SOLR-17574) (Bruno Roustant) (David Smiley)
- Fixed broken backwards compatibility with the legacy "langid.whitelist" config in Solr Langid. [SOLR-17575](https://issues.apache.org/jira/browse/SOLR-17575) (Jan Høydahl) (Alexander Zagniotov)
- Print zkcli.sh deprecation msg to stderr, which fixes Solr Operator upload of security.json to zookeeper [SOLR-17586](https://issues.apache.org/jira/browse/SOLR-17586) (Jan Høydahl)
- Fix two issues in Solr CLI that prevent Solr from starting with the techproducts example and from correctly parsing arguments on Windows that start with -D and have multiple values separated by "," or spaces. [SOLR-17595](https://issues.apache.org/jira/browse/SOLR-17595) (Christos Malliaridis)
- bin/solr stop/start/restart should complain about missing value for options that expect a value. [SOLR-6962](https://issues.apache.org/jira/browse/SOLR-6962) (Eric Pugh) (Rahul Goswami)

### Dependency Upgrades (6 changes)

- chore(deps): update dependency com.github.spotbugs:spotbugs-annotations to v4.8.6 [PR#2129](https://github.com/apache/solr/pull/2129) (solrbot)
- Update org.glassfish.hk2*:* to v3.1.1 [PR#2268](https://github.com/apache/solr/pull/2268) (solrbot)
- Update org.glassfish.jersey*:* to v3.1.9 [PR#2396](https://github.com/apache/solr/pull/2396) (solrbot)
- Update dependency commons-cli:commons-cli to v1.9.0 [PR#2650](https://github.com/apache/solr/pull/2650) (solrbot)
- chore(deps): update io.netty:* to v4.1.114.final [PR#2702](https://github.com/apache/solr/pull/2702) (solrbot)
- Update dependency com.fasterxml.jackson:jackson-bom to v2.18.0 [PR#2769](https://github.com/apache/solr/pull/2769) (solrbot)

### Other (15 changes)

- Introduce unit testing for AssertTool. [SOLR-11318](https://issues.apache.org/jira/browse/SOLR-11318) (Eric Pugh) (Jason Gerlowski)
- NamedList: deprecating methods: forEachEntry, forEachKey, abortableForEachKey, abortableForEach, asMap (no-arg only), get(key, default). Added getOrDefault. Deprecated the SimpleMap interface as well as the entirety of the SolrJ package org.apache.solr.cluster.api, which wasn't used except for SimpleMap. [SOLR-14680](https://issues.apache.org/jira/browse/SOLR-14680) (David Smiley)
- "&lt;lib/&gt;" tags in solrconfig.xml are now quietly ignored by default unless explicitly enabled with the `SOLR_CONFIG_LIB_ENABLED=true` enviroment variable (or corresponding sysprop). These tags are now considered deprecated and will be removed in Solr 10. [SOLR-16781](https://issues.apache.org/jira/browse/SOLR-16781) 
- Fix Gradle build sometimes gives spurious "unreferenced license file" warnings. [SOLR-17142](https://issues.apache.org/jira/browse/SOLR-17142) (Uwe Schindler)
- Remove Deprecated URL and replace it with URI in Preparation for Java 21 [SOLR-17321](https://issues.apache.org/jira/browse/SOLR-17321) (Sanjay Dutt) (David Smiley) (Uwe Schindler)
- Move Zk Arg parsing into Java Code from bin/solr scripts. [SOLR-17359](https://issues.apache.org/jira/browse/SOLR-17359) (Eric Pugh) (Rahul Goswami)
- Replace the use of the deprecated java.util.Locale constructor with Locale Builder API. [SOLR-17399](https://issues.apache.org/jira/browse/SOLR-17399) (Sanjay Dutt)
- Fixed inadvertent suppression of exceptions in the background tasks across the codebase. For certain tasks that were scheduled via ExecutorService#submit, the results of the task execution were never examined which led to the suppression of exceptions. [SOLR-17448](https://issues.apache.org/jira/browse/SOLR-17448) (Andrey Bozhko)
- Document deprecation status of language specific writer types (wt=python,ruby,php,phps). [SOLR-17494](https://issues.apache.org/jira/browse/SOLR-17494) (Eric Pugh)
- CoreContainer calls UpdateHandler.commit when closing a read-only core [SOLR-17504](https://issues.apache.org/jira/browse/SOLR-17504) (Bruno Roustant)
- Introduce ClusterState.getCollectionNames, a convenience method [SOLR-17534](https://issues.apache.org/jira/browse/SOLR-17534) (David Smiley)
- Introduce ClusterState.collectionStream to replace getCollectionStates, getCollectionsMap, and forEachCollection, which are now deprecated. [SOLR-17535](https://issues.apache.org/jira/browse/SOLR-17535) (David Smiley)
- Upgrade to Gradle 8.10 [SOLR-17545](https://issues.apache.org/jira/browse/SOLR-17545) (Houston Putman)
- "home" and "data" directories used by Solr examples have been updated to align with documented best practices. [SOLR-17556](https://issues.apache.org/jira/browse/SOLR-17556) (Eric Pugh) (Houston Putman)
- Remove "solr.indexfetcher.sotimeout" system property that was for optimizing replication tests. It was disabled, but not removed. [SOLR-17577](https://issues.apache.org/jira/browse/SOLR-17577) (Eric Pugh)


[9.7.0] - 2024-09-09
--------------------

### Added (8 changes)

- Add support for docValues to solr.BinaryField. [SOLR-10255](https://issues.apache.org/jira/browse/SOLR-10255) (Alexey Serba) (Mikhail Khludnev) (David Smiley)
- Introduce output of Prometheus metrics directly from Solr. [SOLR-10654](https://issues.apache.org/jira/browse/SOLR-10654) (Matthew Biscocho) (David Smiley)
- Opt-in multithreaded search execution [SOLR-13350](https://issues.apache.org/jira/browse/SOLR-13350) [SOLR-17298](https://issues.apache.org/jira/browse/SOLR-17298) (Ishan Chattopadhyaya) (Mark Miller) (Christine Poerschke) (David Smiley) (noble) (Gus Heck)
- Put an UpdateRequestProcessor-enforced soft-limit on the number of fields allowed in a core. The `NumFieldLimitingUpdateRequestProcessorFactory` limit may be adjusted by raising the factory's `maxFields` setting, toggled in and out of "warning-only" mode using the `warnOnly` setting, or disabled entirely by removing it solrconfig.xml. The limit is set at 1000 fields in the "_default" configset, but left in warning-only mode. [SOLR-17192](https://issues.apache.org/jira/browse/SOLR-17192) (David Smiley) (Eric Pugh) (Jason Gerlowski)
- Configsets now include a `minPrefixQueryTermLength` setting, which instructs Solr to reject prefix queries whose prefixes are "too short". This can be used as one line of defense against "runaway wildcard queries" consuming too many resources. The setting is disabled ('-1') in the default configset but can be overridden with a property ('solr.query.minPrefixLength'). Users may also override their collection-wide setting for individual queries by providing a `minPrefixQueryTermLength` local-param. [SOLR-17195](https://issues.apache.org/jira/browse/SOLR-17195) (Jason Gerlowski) (David Smiley)
- Prometheus Exporter: now scrapes metrics at a fixed rate instead of delay. [SOLR-17276](https://issues.apache.org/jira/browse/SOLR-17276) (Rafał Harabień)
- Circuit breakers may now be configured in a "soft" or "warnOnly" mode in order to more easily test out new thresholds. Soft breakers will log out a message on each relevant request when tripped, but will not otherwise impact or short circuit the requests. [SOLR-17277](https://issues.apache.org/jira/browse/SOLR-17277) (Jason Gerlowski)
- New "vectorSimilarity" QParser for matching documents mased on a minimum vector similarity threshold. [SOLR-17335](https://issues.apache.org/jira/browse/SOLR-17335) (hossman)

### Changed (22 changes)

- The Solr schema version has been increased to 1.7. Since schema version 1.7, all fields/fieldTypes that support docValues will have them enabled by default. This behavior can be reverted by setting 'docValues' parameter for a field or a field type to false, the default for schema versions 1.6 and below. [SOLR-10808](https://issues.apache.org/jira/browse/SOLR-10808) (Houston Putman)
- Add linkconfig, cluster, and updateacls as commands to SolrCLI. Allow bin/solr commands to have parity with zkcli.sh commands. [SOLR-14115](https://issues.apache.org/jira/browse/SOLR-14115) (Eric Pugh)
- Make using debugger in Solr easier by avoiding NPE in ExternalPaths.determineSourceHome. [SOLR-15591](https://issues.apache.org/jira/browse/SOLR-15591) (@charlygrappa) (Eric Pugh)
- Introduce tabbed sections again in the Ref Guide. [SOLR-16198](https://issues.apache.org/jira/browse/SOLR-16198) (Christos Malliaridis) (Eric Pugh)
- Update Solr to use new Lucene 9.5 storedFields() API. This removes the use of ThreadLocal for stored field state, reducing heap usage especially for high-core-count, high-field-count, high-thread-count cases [SOLR-16677](https://issues.apache.org/jira/browse/SOLR-16677) (Vinayak Hegde) (Christine Poerschke) (Kevin Risden) (David Smiley) (Michael Gibney)
- Adopt Linux standard pattern of -- for long option commands, and make all commands "kebab" formatting. I.e -zkHost is now -zk-host. The old parameters such as -zkHost continue to be supported in the 9.x line of Solr. -u is now used to specify user credentials everywhere, this only impacts the bin/solr assert commands "same user" check which has -u as the short form of --same-user. [SOLR-16824](https://issues.apache.org/jira/browse/SOLR-16824) (Eric Pugh) (janhoy) (Jason Gerlowski) (Christos Malliaridis)
- use -solrUrl to derive the zk host connection for bin/solr zk subcommands [SOLR-16921](https://issues.apache.org/jira/browse/SOLR-16921) (Eric Pugh)
- Do not return spurious tags when fetching metrics from a Solr node to another. [SOLR-17099](https://issues.apache.org/jira/browse/SOLR-17099) (Pierre Salagnac)
- Give security manager explicit read access to sharedLib [SOLR-17109](https://issues.apache.org/jira/browse/SOLR-17109) (Tomás Fernández Löbbe) (Eric Pugh)
- Enable Prometheus exporter to communicate with SSL protected Solr. [SOLR-17137](https://issues.apache.org/jira/browse/SOLR-17137) (Eivind Bergstøl) (Eric Pugh)
- Core Admin "async" request status tracking is no longer capped at 100; it's 10k. Statuses are now removed 5 minutes after the read of a completed/failed status. Helps collection async backup/restore and other operations scale to 100+ shards. [SOLR-17160](https://issues.apache.org/jira/browse/SOLR-17160) (Pierre Salagnac) (David Smiley)
- Both Minimize Cores and the Affinity replica placement strategies would over-gather cluster metrics. AttributeFetcherImpl was improved accordingly. [SOLR-17257](https://issues.apache.org/jira/browse/SOLR-17257) (Yohann Callea)
- Prevent the "Coordinator node" feature from registering synthetic cores in ZooKeeper [SOLR-17269](https://issues.apache.org/jira/browse/SOLR-17269) [SOLR-17386](https://issues.apache.org/jira/browse/SOLR-17386) (ellaeln) (Patson Luk) (David Smiley) (Christine Poerschke)
- Allow JSON atomic updates to use multiple modifiers or a modifier like 'set' as a field name if child docs are not enabled. [SOLR-17274](https://issues.apache.org/jira/browse/SOLR-17274) (Calvin Smith) (David Smiley)
- Http2SolrClient.Builder.withHttpClient now copies HttpListenerFactory (e.g. for auth, metrics, traces, etc.) [SOLR-17300](https://issues.apache.org/jira/browse/SOLR-17300) (Sanjay Dutt) (David Smiley)
- When not set, loadOnStartup defaults to true, which is the default choice for a core. [SOLR-17330](https://issues.apache.org/jira/browse/SOLR-17330) (Pierre Salagnac) (Eric Pugh)
- OrderedNodePlacementPlugin will give an even more optimal replica placements during ReplicaMigration commands [SOLR-17331](https://issues.apache.org/jira/browse/SOLR-17331) (Houston Putman) (Yohann Callea)
- Add cache on top of system metrics BeanInfos to make calls to /admin/info/system faster [SOLR-17340](https://issues.apache.org/jira/browse/SOLR-17340) (Pierre Salagnac)
- Synchronise stopwords from snowball with those in Lucene [SOLR-17346](https://issues.apache.org/jira/browse/SOLR-17346) (Alastair Porter) (Houston Putman)
- SolrDocumentFetcher should always skip lazy field loading overhead if documentCache==null [SOLR-17349](https://issues.apache.org/jira/browse/SOLR-17349) (Michael Gibney)
- Streamline ConfigSet modification logic. [SOLR-17418](https://issues.apache.org/jira/browse/SOLR-17418) (Houston Putman) (Liu Huajin)
- Avoid exposing Solr's IP in the Location header. [SOLR-17434](https://issues.apache.org/jira/browse/SOLR-17434) (David Smiley)

### Fixed (18 changes)

- PR-2475: Fixed node listing bug in Admin UI when different hostnames start with the same front part. [PR#2475](https://github.com/apache/solr/pull/2475) (@hgdharold) (Eric Pugh)
- subqueries should respect basic auth. [SOLR-12813](https://issues.apache.org/jira/browse/SOLR-12813) (Rudy Seitz) (Eric Pugh)
- Properly construct V2 base urls instead of replacing substring "/solr" with "/api" [SOLR-16659](https://issues.apache.org/jira/browse/SOLR-16659) (Andrey Bozhko) (Eric Pugh)
- Restore ability to configure tlog directory. Changes largely focus on UpdateLog and HdfsUpdateLog. There is no anticipated change in existing behavior, other than that the `dir` parameter to the `&lt;updateLog&gt;` element in `solrconfig.xml`, which has long been silently ignored, will now be respected [SOLR-16962](https://issues.apache.org/jira/browse/SOLR-16962) (Michael Gibney) (David Smiley)
- Simplify CoreContainerProvider initialization and JettySolrRunner. Avoid deadlock/hang. [SOLR-17118](https://issues.apache.org/jira/browse/SOLR-17118) (David Smiley)
- 'WWW-Authenticate' headers missing in MultiAuthPlugin [SOLR-17247](https://issues.apache.org/jira/browse/SOLR-17247) (Lamine Idjeraoui) (Eric Pugh)
- Fix bugs in SolrParams.toLocalParamsString() [SOLR-17255](https://issues.apache.org/jira/browse/SOLR-17255) (hossman)
- Respect PKG_VERSIONS constraints in params.json when loading the schema plugins [SOLR-17304](https://issues.apache.org/jira/browse/SOLR-17304) (Andrey Bozhko)
- Fixed "next step" example urls generated by bin/solr create commands to use the newly created collection/core name. [SOLR-17315](https://issues.apache.org/jira/browse/SOLR-17315) (Eric Pugh)
- v2 APIs no longer return the incorrect content-type when 'wt=json' specified [SOLR-17317](https://issues.apache.org/jira/browse/SOLR-17317) (Jason Gerlowski)
- Generated v2 'SolrRequest' implementations now all serialize to the correct response type [SOLR-17326](https://issues.apache.org/jira/browse/SOLR-17326) (Christos Malliaridis) (Jason Gerlowski)
- Rate-limiting feature: fix live-update of config [SOLR-17333](https://issues.apache.org/jira/browse/SOLR-17333) (Michael Gibney)
- Display all custom distributed stages in debug output. [SOLR-17337](https://issues.apache.org/jira/browse/SOLR-17337) (Torsten Bøgh Köster) (Christine Poerschke)
- Restore the use of -params option to PostTool. [SOLR-17367](https://issues.apache.org/jira/browse/SOLR-17367) (Bostoi) (Eric Pugh)
- Fix "flags" usage in FunctionQParser that caused some issues in vectorSimilarity() with BYTE vector constants [SOLR-17369](https://issues.apache.org/jira/browse/SOLR-17369) (hossman)
- Fixed performance regression of misconfigured threadpools from SOLR-16879 (Solr 9.4). Shard splits and concurrent/large collection backup/restore performance was serial. UpdateLog replay was a little suboptimal in thread usage too. [SOLR-17391](https://issues.apache.org/jira/browse/SOLR-17391) [SOLR-16879](https://issues.apache.org/jira/browse/SOLR-16879) (Pierre Salagnac) (Hakan Özler) (David Smiley)
- Detect and handle non-200 HTTP status codes for requests made by IndexFetcher [SOLR-17394](https://issues.apache.org/jira/browse/SOLR-17394) (Jason Gerlowski)
- Remove unnecessary code in PKIAuthPlugin and HttpSolrCall [SOLR-17417](https://issues.apache.org/jira/browse/SOLR-17417) (Houston Putman) (janhoy) (Liu Huajin)

### Dependency Upgrades (1 change)

- Upgrade Lucene to 9.11.1 [SOLR-17325](https://issues.apache.org/jira/browse/SOLR-17325) (hossman)

### Other (10 changes)

- Refactor preparePutOrPost method in HttpJdkSolrClient [GITHUB#2454](https://github.com/apache/solr/pull/2454) (Andy Webb)
- QueryResult refactoring so that it's only returned from SolrIndexSearcher instead of being provided to it. Deprecated APIs in 9x; should be removed later. [PR#2524](https://github.com/apache/solr/pull/2524) (David Smiley)
- Refactor bin/solr and bin/solr.cmd commands integration with AuthTool, DeleteTool, and PackageTool to delegate arg parsing to Java code. Removed limitation of PackageTool only being executed on an active Solr node. [SOLR-15831](https://issues.apache.org/jira/browse/SOLR-15831) (Eric Pugh)
- Use Jetty HTTP2 for index replication and other "recovery" operations [SOLR-16505](https://issues.apache.org/jira/browse/SOLR-16505) (Sanjay Dutt) (David Smiley)
- Include cyclonedx SBOMs with maven artifacts [SOLR-16796](https://issues.apache.org/jira/browse/SOLR-16796) (Arnout Engelen) (Houston Putman) (Kevin Risden)
- Update Solr Exporter for Prometheus cli to use commons-cli instead of argparse4j. [SOLR-16996](https://issues.apache.org/jira/browse/SOLR-16996) (Christos Malliaridis) (Eric Pugh)
- Refactor ZK related SolrCli tools to separate SolrZkClient and CloudSolrClient instantiation/usage [SOLR-17248](https://issues.apache.org/jira/browse/SOLR-17248) (Lamine Idjeraoui) (Eric Pugh)
- Use Jetty HTTP2 for SyncStrategy and PeerSyncWithLeader for "recovery" operations [SOLR-17290](https://issues.apache.org/jira/browse/SOLR-17290) (Sanjay Dutt) (David Smiley)
- Once again allow rank queries to use custom TopDocsCollectors that operate on types that extend ScoreDocs (covariant generic types) broken in Solr 9.0. [SOLR-17322](https://issues.apache.org/jira/browse/SOLR-17322) (Stephen Woods) (Christine Poerschke)
- EnvUtils: Removed "env" methods, as they were problematic. Code should almost never refer to env vars. [SOLR-17347](https://issues.apache.org/jira/browse/SOLR-17347) (David Smiley)


[9.6.1] - 2024-05-29
--------------------

### Fixed (6 changes)

- Actually mark all replicas down at startup and truly wait for them. This includes replicas that might not exist anymore locally. [SOLR-17049](https://issues.apache.org/jira/browse/SOLR-17049) (Houston Putman) (Vincent Primault)
- Remove unintended timeout of 60 seconds for core loading. [SOLR-17261](https://issues.apache.org/jira/browse/SOLR-17261) (Houston Putman)
- Fix 'Illegal character in query' exception in HttpJdkSolrClient [SOLR-17263](https://issues.apache.org/jira/browse/SOLR-17263) (Andy Webb)
- SolrJ ZkClientClusterStateProvider, revert SOLR-17153 for perf regression when aliases are used. [SOLR-17275](https://issues.apache.org/jira/browse/SOLR-17275) [SOLR-17153](https://issues.apache.org/jira/browse/SOLR-17153) (Aparna Suresh)
- Remove (broken) singlePass attempt when reRankScale + debug is used, and fix underlying NPE. [SOLR-17296](https://issues.apache.org/jira/browse/SOLR-17296) (hossman)
- Use the system file separator instead of an explicit '/' in CachingDirectoryFactory [SOLR-17307](https://issues.apache.org/jira/browse/SOLR-17307) (Houston Putman) (hossman)

### Dependency Upgrades (1 change)

- Update dependency org.apache.commons:commons-compress to v1.26.1 [PR#2308](https://github.com/apache/solr/pull/2308) (solrbot)


[9.6.0] - 2024-04-27
--------------------

### Added (4 changes)

- A new cluster singleton plugin to automatically remove inactive shards. [SOLR-16403](https://issues.apache.org/jira/browse/SOLR-16403) (Paul McArthur) (David Smiley)
- Admin UI - Make it optional to sort list of commandline args [SOLR-16466](https://issues.apache.org/jira/browse/SOLR-16466) (Shawn Heisey) (Vincenzo D'Amore) (Christine Poerschke)
- Implement 'cpuAllowed' query parameter to limit the maximum CPU usage by a running query. [SOLR-17141](https://issues.apache.org/jira/browse/SOLR-17141) (Andrzej Bialecki) (Gus Heck) (David Smiley)
- Add a new SolrJ client using the JDK’s built-in Http Client. [SOLR-599](https://issues.apache.org/jira/browse/SOLR-599) (James Dyer)

### Changed (16 changes)

- Scale to 10K+ collections better in ZkStateReader.refreshCollectionsList [GITHUB#2217](https://github.com/apache/solr/pull/2217) (David Smiley)
- Add a CompletableFuture based asynchronous API to Http2SolrClient, HttpJdkSolrClient and LBHttp2SolrClient. The previous asynchronous API is deprecated. [SOLR-14763](https://issues.apache.org/jira/browse/SOLR-14763) (Rishi Sankar) (James Dyer)
- Throw a exception when issuing a streaming expression and all cores are down instead of returning 0 documents. [SOLR-16138](https://issues.apache.org/jira/browse/SOLR-16138) (Antoine Bursaux) (Eric Pugh)
- Add Collection creation time to CLUSTERSTATUS and COLSTATUS API responses [SOLR-16699](https://issues.apache.org/jira/browse/SOLR-16699) (Julien Pilourdault) (Paul McArthur) (David Smiley)
- KnnQParser's "Pre-Filtering" behavior is now controlable via local params [SOLR-16858](https://issues.apache.org/jira/browse/SOLR-16858) (hossman)
- Expose the term count in /admin/segments handler if fieldInfo=true. [SOLR-17038](https://issues.apache.org/jira/browse/SOLR-17038) (Rahul Goswami) (David Smiley and Christine Poerschke)
- Add 'distrib.statsCache' parameter to disable distributed stats requests at query time. [SOLR-17058](https://issues.apache.org/jira/browse/SOLR-17058) (Wei Wang) (Mikhail Khludnev)
- When registering or updating a ConfigurablePlugin through the `/cluster/plugin` API, config validation exceptions are now propagated to the callers. [SOLR-17119](https://issues.apache.org/jira/browse/SOLR-17119) (Yohann Callea)
- Close searcherExecutor thread per core after 1 minute [SOLR-17144](https://issues.apache.org/jira/browse/SOLR-17144) (Pierre Salagnac) (Christine Poerschke)
- The INSTALLSHARDDATA API now includes a 'requestid' field when run asynchronously [SOLR-17145](https://issues.apache.org/jira/browse/SOLR-17145) (Jason Gerlowski)
- Add DelegatingBackupRepository and alternative checksum verification [SOLR-17146](https://issues.apache.org/jira/browse/SOLR-17146) (Bruno Roustant)
- bin/solr post now has proper unit testing. Users can specify a --dry-run option to simulate posting documents without sending them to Solr. [SOLR-17159](https://issues.apache.org/jira/browse/SOLR-17159) (Eric Pugh)
- Add 2 arg variant of vectorSimilarity() function [SOLR-17164](https://issues.apache.org/jira/browse/SOLR-17164) (Sanjay Dutt) (hossman)
- Add QueryLimits termination to the existing heavy SearchComponent-s. This allows query limits (e.g. timeAllowed, cpuAllowed) to terminate expensive operations within components if limits are exceeded. [SOLR-17172](https://issues.apache.org/jira/browse/SOLR-17172) (Andrzej Bialecki)
- REPLACENODE now supports the source node not being live [SOLR-17204](https://issues.apache.org/jira/browse/SOLR-17204) (Vincent Primault)
- New SolrJ JDK client supports Async [SOLR-17211](https://issues.apache.org/jira/browse/SOLR-17211) (James Dyer)

### Fixed (20 changes)

- Avoid NullPointerException in SolrJ client due to missing EnvToSyspropMappings.properties file [PR#2320](https://github.com/apache/solr/pull/2320) (janhoy)
- Fix race condition in singleton-per-collection StateWatcher creation [SOLR-11535](https://issues.apache.org/jira/browse/SOLR-11535) (Michael Gibney)
- Queries with shards.info and shards.tolerant can yield multiple null keys in place of shard names [SOLR-14892](https://issues.apache.org/jira/browse/SOLR-14892) (Mathieu Marie) (David Smiley)
- Reorder nested directory deletions to avoid logging spurious NoSuchFileException [SOLR-16866](https://issues.apache.org/jira/browse/SOLR-16866) (Michael Gibney)
- Add QueryLimits support to Learning To Rank rescoring. [SOLR-17018](https://issues.apache.org/jira/browse/SOLR-17018) (Alessandro Benedetti)
- Fixed JacksonJsonWriter to properly quote uuid values in json query response [SOLR-17110](https://issues.apache.org/jira/browse/SOLR-17110) (Andrey Bozhko) (Eric Pugh)
- Correct how `/replication?command=details` describes errors in backup operations. [SOLR-17113](https://issues.apache.org/jira/browse/SOLR-17113) (Przemyslaw Ciezkowski) (Christine Poerschke and Jason Gerlowski)
- Fixing Config API overlay property enabling or disabling the cache [SOLR-17148](https://issues.apache.org/jira/browse/SOLR-17148) (Sanjay Dutt) (hossman) (Eric Pugh)
- Better alignment of Admin UI graph [SOLR-17152](https://issues.apache.org/jira/browse/SOLR-17152) (janhoy)
- CloudSolrClient could fail a request immediately following a collection creation. Required double-checking the collection doesn’t exist. [SOLR-17153](https://issues.apache.org/jira/browse/SOLR-17153) (Aparna Suresh) (David Smiley)
- Fix log history V2 API serialization [SOLR-17176](https://issues.apache.org/jira/browse/SOLR-17176) (Michael Gibney)
- Streaming query breaks if token contains backtick [SOLR-17186](https://issues.apache.org/jira/browse/SOLR-17186) (Rahul Goswami) (Eric Pugh)
- Fix CloudHttp2SolrClient doesn't preserve the passed httpClient to Http2ClusterStateProvider when using the internalClientBuilder [SOLR-17194](https://issues.apache.org/jira/browse/SOLR-17194) (Eric Pugh) (Lamine Idjeraoui) (Houston Putman) (Anshum Gupta)
- Fix getting fieldType by its name in FileBasedSpellChecker [SOLR-17197](https://issues.apache.org/jira/browse/SOLR-17197) (Andrey Bozhko) (Eric Pugh)
- AffinityPlacementFactory can fail if Shard leadership changes occur while it is collecting metrics. [SOLR-17198](https://issues.apache.org/jira/browse/SOLR-17198) (Paul McArthur)
- Fix false positive race condition in `/health?requireHealthyCores=true` during core loading [SOLR-17200](https://issues.apache.org/jira/browse/SOLR-17200) (hossman)
- Eliminate the possibility of a -1 status code for SolrCloud update requests that are distributed. [SOLR-17206](https://issues.apache.org/jira/browse/SOLR-17206) (Paul McArthur)
- Fix NullPointerException in QueryComponent [SOLR-17209](https://issues.apache.org/jira/browse/SOLR-17209) (Vincent Primault) (Eric Pugh)
- Fix spurious warnings about solr url format in Solr CLI when users aren't providing a deprecated solr url. [SOLR-17213](https://issues.apache.org/jira/browse/SOLR-17213) (Eric Pugh)
- Fix indexFetcher logging to include MDC details [SOLR-17218](https://issues.apache.org/jira/browse/SOLR-17218) (hossman)

### Dependency Upgrades (3 changes)

- Update commons-cli to 1.7 [GITHUB#2408](https://github.com/apache/solr/pull/2408) (Eric Pugh)
- Upgrade Lucene to 9.10.0 [SOLR-17157](https://issues.apache.org/jira/browse/SOLR-17157) (hossman) (Christine Poerschke)
- Update forbiddenapis to 3.7 [SOLR-17214](https://issues.apache.org/jira/browse/SOLR-17214) (hossman)

### Other (8 changes)

- Update FileBasedSpellChecker and IndexBasedSpellChecker to accept accuracy parameter as float; deprecate `breakSugestionTieBreaker` parameter in favor of `breakSuggestionTieBreaker` in WordBreakSolrSpellChecker [SOLR-12089](https://issues.apache.org/jira/browse/SOLR-12089) (Andrey Bozhko) (Eric Pugh)
- GenericSolrRequest now has a `setRequiresCollection` setter that allows it to specify whether it should make use of the client-level default collection/core. [SOLR-17066](https://issues.apache.org/jira/browse/SOLR-17066) (Jason Gerlowski)
- Cut over System.getProperty to EnvUtils.getProperty [SOLR-17126](https://issues.apache.org/jira/browse/SOLR-17126) (janhoy)
- Replace org.apache.solr.util.LongSet with hppc LongHashSet [SOLR-17190](https://issues.apache.org/jira/browse/SOLR-17190) (Michael Gibney)
- Http2SolrClient and friends no longer marked as @lucene.experimental. Krb5HttpClientBuilder and PreemptiveBasicAuthClientBuilderFactory no longer deprecated [SOLR-17201](https://issues.apache.org/jira/browse/SOLR-17201) (janhoy)
- Simplify verbose MatcherAssert.assertThat usage in tests [SOLR-17217](https://issues.apache.org/jira/browse/SOLR-17217) (hossman)
- QueryResponseWriterUtil.NonFlushingStream should support bulk write methods [SOLR-17222](https://issues.apache.org/jira/browse/SOLR-17222) (Michael Gibney)
- PropertiesOutputStream is renamed IndexOutputOutputStream and overrides write(byte[], int, int). [SOLR-17232](https://issues.apache.org/jira/browse/SOLR-17232) (Bruno Roustant)


[9.5.0] - 2024-02-12
--------------------

### Added (4 changes)

- When using TLS, Solr can now auto-reload the keystore and truststore without the need to restart the process. This is enabled by default when running with TLS and can be disabled or configured in solr.in.sh [SOLR-16743](https://issues.apache.org/jira/browse/SOLR-16743) (Houston Putman) (Tomás Fernández Löbbe)
- Circuit Breakers can now be configured globally [SOLR-16974](https://issues.apache.org/jira/browse/SOLR-16974) (janhoy) (Christine Poerschke)
- Log CPU time per request via solr.log.cputime [SOLR-16986](https://issues.apache.org/jira/browse/SOLR-16986) (Gilles Bellaton) (David Smiley)
- Collection creation & adding replicas: User-defined properties are persisted to state.json and applied to new replicas, available for use as property substitution in configuration files. [SOLR-17006](https://issues.apache.org/jira/browse/SOLR-17006) (Vincent Primault)

### Changed (26 changes)

- Include the external file name in the log instead of the hard-coded value in FileFloatSource.java. [PR#2186](https://github.com/apache/solr/pull/2186) (Hamzeh Aldmour) (Uwe Schindler)
- Add support for mm (min should match) parameter to bool query parser [SOLR-13748](https://issues.apache.org/jira/browse/SOLR-13748) (Andrey Bozhko)
- Unified use of system properties and environment variables [SOLR-15960](https://issues.apache.org/jira/browse/SOLR-15960) (janhoy)
- Swap core v2 endpoints have been updated to be more REST-ful. SWAP is now available at `POST /api/cores/coreName/swap` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- The MERGEINDEXES v2 endpoint has been updated to be more REST-ful. MERGEINDEXES is now available at `POST /api/cores/coreName/merge-indices` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- The rename-core v2 endpoint has been updated to be more REST-ful. RENAME is now available at `POST /api/cores/coreName/rename` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- The v2 endpoint to request the status of asynchronous CoreAdmin commands has been updated to be more REST-ful. Now available at `GET /api/node/commands/someRequestId` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- Ensure core load failures are always logged. [SOLR-16577](https://issues.apache.org/jira/browse/SOLR-16577) (Haythem Khiri) (David Smiley)
- Fail when parsing an invalid custom permission definition from security.json [SOLR-16907](https://issues.apache.org/jira/browse/SOLR-16907) (janhoy) (Uwe Schindler)
- RESTORECORE now sets the UpdateLog to ACTIVE state instead of requiring a separate REQUESTAPPLYUPDATES call in Collection restore. [SOLR-16924](https://issues.apache.org/jira/browse/SOLR-16924) (Julia Maimone) (David Smiley)
- Extend Solr client tracing coverage to both Jetty Client and Apache HttpClient [SOLR-16943](https://issues.apache.org/jira/browse/SOLR-16943) (Alex Deparvu) (David Smiley)
- Make the internal CoreSorter implementation configurable in solr.xml [SOLR-16959](https://issues.apache.org/jira/browse/SOLR-16959) (Vincent Primault)
- Add tracing spans to internal collection commands [SOLR-17011](https://issues.apache.org/jira/browse/SOLR-17011) (Alex Deparvu)
- Add trace id to jetty thread names to improve debuggability via stack traces [SOLR-17035](https://issues.apache.org/jira/browse/SOLR-17035) (Alex Deparvu)
- UpdateLog lazy creates VersionBucket large array, and VersionBucket do not keep the highest version anymore. This optimization reduces the memory usage, specially when the SolrCore is not used for indexing [SOLR-17036](https://issues.apache.org/jira/browse/SOLR-17036) (Bruno Roustant)
- Make CommitTracker currentTlogSize lazy [SOLR-17041](https://issues.apache.org/jira/browse/SOLR-17041) (Alex Deparvu)
- SchemaCodecFactory is now the implicit default codec factory. [SOLR-17046](https://issues.apache.org/jira/browse/SOLR-17046) (hossman)
- Use compact JSON for Learning to Rank (LTR) feature and model storage. [SOLR-17050](https://issues.apache.org/jira/browse/SOLR-17050) (Florin Babes) (Christine Poerschke) (Alessandro Benedetti)
- Distributed search with shards.tolerant: if all shards fail, fail the request [SOLR-17053](https://issues.apache.org/jira/browse/SOLR-17053) (Aparna Suresh) (David Smiley)
- Do not retain log param references in LogWatcher [SOLR-17063](https://issues.apache.org/jira/browse/SOLR-17063) (Michael Gibney)
- SolrClient builders now allow users to specify a "default" collection or core using the `withDefaultCollection` method. Use of the Builder methods is preferable to including the collection in the base URL accepted by certain client implementations. [SOLR-17066](https://issues.apache.org/jira/browse/SOLR-17066) (Jason Gerlowski)
- bin/solr post CLI use of options is now aligned closely with bin/post CLI tool, and is consistently referenced throughout the Ref Guide and source code, and is used through out our tests. The bin/post tool remains and has been tested to work. [SOLR-17068](https://issues.apache.org/jira/browse/SOLR-17068) (Eric Pugh)
- Allow to declare replica placement plugins in solr.xml [SOLR-17079](https://issues.apache.org/jira/browse/SOLR-17079) (Vincent Primault)
- LBSolrClient (used by CloudSolrClient) now returns the count of core tracked as not live AKA zombies instead of the full list of cores. This list is potentially as long as the number of cores. When there are many cores, this leads to high CPU and memory usage. [SOLR-17084](https://issues.apache.org/jira/browse/SOLR-17084) (Gilles Bellaton) (David Smiley)
- Close objects contained inside an ObjectCache. [SOLR-17094](https://issues.apache.org/jira/browse/SOLR-17094) (Vincent Primault)
- solr.xml now supports declaring clusterSingleton plugins [SOLR-17096](https://issues.apache.org/jira/browse/SOLR-17096) (Paul McArthur) (David Smiley)

### Fixed (11 changes)

- When there's a UUIDField in the schema and atomic update touches another field the error occurs when leader updates replica [SOLR-10653](https://issues.apache.org/jira/browse/SOLR-10653) (Mikhail Khludnev)
- In distributed i.e. multi-shard cloud mode returned dense vector 'fl' fields are now a list of numbers instead of strings. [SOLR-16952](https://issues.apache.org/jira/browse/SOLR-16952) (Qais Qadri) (Christine Poerschke)
- DenseVectorField w/ vectorDimension &gt; 1024 now work automatically with _default configset, due to implicit use of SchemaCodecFactory. [SOLR-17045](https://issues.apache.org/jira/browse/SOLR-17045) (hossman)
- Fixed not correctly escaped quote in bin/solr script [SOLR-17074](https://issues.apache.org/jira/browse/SOLR-17074) (Dominique Béjean) (Vincenzo D'Amore)
- The v2 "delete alias" API no longer errantly returns a 405 status code [SOLR-17090](https://issues.apache.org/jira/browse/SOLR-17090) (Jason Gerlowski)
- Collection restore API command now returns "requestid" when executed asynchronously like other APIs [SOLR-17093](https://issues.apache.org/jira/browse/SOLR-17093) (Tomás Fernández Löbbe)
- bin/solr script doesn't do ps properly on some systems. [SOLR-17112](https://issues.apache.org/jira/browse/SOLR-17112) (Vincenzo D'Amore) (Eric Pugh)
- The INSTALLSHARDDATA "collection-admin" API now reports errors correctly when run asynchronously. [SOLR-17116](https://issues.apache.org/jira/browse/SOLR-17116) (Jason Gerlowski)
- Fix NullPointerException in UpdateLog.applyOlderUpdates that can occur if there are multiple partial updates of the same document in separate requests using commitWithin. [SOLR-17120](https://issues.apache.org/jira/browse/SOLR-17120) (Calvin Smith) (Christine Poerschke)
- Fix SchemaCodecFactory to get PostingsFormat and DocValues from field. [SOLR-17121](https://issues.apache.org/jira/browse/SOLR-17121) (Bruno Roustant) (David Smiley)
- Backups on collections with too many shards fail due to restrictive Executor queue size [SOLR-17149](https://issues.apache.org/jira/browse/SOLR-17149) (Pierre Salagnac) (Jason Gerlowski)

### Dependency Upgrades (25 changes)

- Update dependency com.google.cloud:google-cloud-bom to v0.204.0 [PR#1745](https://github.com/apache/solr/pull/1745) (solrbot)
- Update org.apache.zookeeper:* to v3.9.1 [PR#1989](https://github.com/apache/solr/pull/1989) (solrbot)
- Update dependency org.semver4j:semver4j to v5.2.2 [PR#2008](https://github.com/apache/solr/pull/2008) (solrbot)
- Update dependency io.opentelemetry:opentelemetry-bom to v1.31.0 [PR#2009](https://github.com/apache/solr/pull/2009) (solrbot)
- Update dependency org.immutables:value-annotations to v2.10.0 [PR#2010](https://github.com/apache/solr/pull/2010) (solrbot)
- Update dependency com.google.guava:guava to v32.1.3-jre [PR#2014](https://github.com/apache/solr/pull/2014) (solrbot)
- Update dependency org.codehaus.woodstox:stax2-api to v4.2.2 [PR#2015](https://github.com/apache/solr/pull/2015) (solrbot)
- Update dependency io.swagger.core.v3:swagger-annotations to v2.2.17 [PR#2032](https://github.com/apache/solr/pull/2032) (solrbot)
- Update io.dropwizard.metrics:* to v4.2.21 [PR#2033](https://github.com/apache/solr/pull/2033) (solrbot)
- Update dependency com.github.spotbugs:spotbugs-annotations to v4.8.0 [PR#2034](https://github.com/apache/solr/pull/2034) (solrbot)
- Update dependency com.google.errorprone:error_prone_annotations to v2.23.0 [PR#2035](https://github.com/apache/solr/pull/2035) (solrbot)
- Update io.grpc:grpc-* to v1.59.0 [PR#2036](https://github.com/apache/solr/pull/2036) (solrbot)
- Update org.apache.logging.log4j:* to v2.21.0 [PR#2037](https://github.com/apache/solr/pull/2037) (solrbot)
- Update dependency commons-cli:commons-cli to v1.6.0 [PR#2048](https://github.com/apache/solr/pull/2048) (solrbot)
- Update org.mockito:mockito* from v5.5.0 to v5.8.0 [PR#2055](https://github.com/apache/solr/pull/2055) (solrbot)
- Update dependency com.fasterxml.jackson:jackson-bom to v2.16.1 [PR#2135](https://github.com/apache/solr/pull/2135) (solrbot)
- Update dependency org.apache.commons:commons-compress to v1.25.0 [PR#2138](https://github.com/apache/solr/pull/2138) (solrbot)
- Update dependency org.apache.commons:commons-lang3 to v3.14.0 [PR#2139](https://github.com/apache/solr/pull/2139) (solrbot)
- Update io.netty:* to v4.1.104.Final [PR#2159](https://github.com/apache/solr/pull/2159) (solrbot)
- Update org.eclipse.jetty*:* to v10.0.19 [PR#2165](https://github.com/apache/solr/pull/2165) (solrbot)
- Update org.slf4j:* to v2.0.10 [PR#2174](https://github.com/apache/solr/pull/2174) (solrbot)
- Update Apache Hadoop to 3.3.6 and Apache Curator to 5.5.0 [SOLR-17012](https://issues.apache.org/jira/browse/SOLR-17012) (Kevin Risden)
- Upgrade to Gradle 8.4 [SOLR-17026](https://issues.apache.org/jira/browse/SOLR-17026) (Kevin Risden)
- Upgrade Jersey to 3.1.5 [SOLR-17089](https://issues.apache.org/jira/browse/SOLR-17089) (Jason Gerlowski)
- Upgrade Lucene to 9.9.2 [SOLR-17097](https://issues.apache.org/jira/browse/SOLR-17097) (Nazerke Seidan) (Christine Poerschke) (Pierre Salagnac)

### Other (6 changes)

- Solr now produces an OpenAPI Specification artifact on releases ("solr-openapi-x.y.z.json") that covers Solr's v2 APIs. [SOLR-16880](https://issues.apache.org/jira/browse/SOLR-16880) (Jason Gerlowski) (Houston Putman)
- Remove support for the long-defunct "collectionDefaults" clusterprops key [SOLR-17024](https://issues.apache.org/jira/browse/SOLR-17024) (Jason Gerlowski)
- Deprecate the V2RequestSupport interface, and the associated `setUseV2` and `setUseBinaryV2` SolrRequest methods. SolrJ users looking to make use of v2 APIs in their applications can use the SolrRequest implementations dedicated to that purpose. [SOLR-17042](https://issues.apache.org/jira/browse/SOLR-17042) (Jason Gerlowski)
- package CLI tool prints error JSONPath [SOLR-17072](https://issues.apache.org/jira/browse/SOLR-17072) (Mikhail Khludnev)
- The `train_and_upload_demo_model.py` script referenced in LTR documentation now uses Python3 [SOLR-17078](https://issues.apache.org/jira/browse/SOLR-17078) (Jason Gerlowski)
- dev tools script cloud.sh became broken after changes in 9.3 added a new -slim.tgz file it was not expecting cloud.sh has been updated to ignore the -slim.tgz version of the tarball. [SOLR-17091](https://issues.apache.org/jira/browse/SOLR-17091) 


[9.4.1] - 2024-01-18
--------------------

### Fixed (6 changes)

- Properly initialize schema plugins loaded by SPI name [SOLR-16203](https://issues.apache.org/jira/browse/SOLR-16203) (janhoy) (hossman) (Uwe Schindler)
- Entropy calculation in bin/solr script fails in Docker due to missing 'bc' cmd [SOLR-17039](https://issues.apache.org/jira/browse/SOLR-17039) (janhoy)
- JSON Query regression: If "query" is specified with a String (not JSON structure), "defType" should parse it. Since 9.4 defType was ignored. [SOLR-17057](https://issues.apache.org/jira/browse/SOLR-17057) (David Smiley)
- CoreContainer#create may deadlock with concurrent requests for metrics [SOLR-17060](https://issues.apache.org/jira/browse/SOLR-17060) (Alex Deparvu) (David Smiley)
- ZK Credentials and ACLs are no longer sent to all ZK Servers when using Streaming Expressions. They will only be used when sent to the default ZK Host. [SOLR-17098](https://issues.apache.org/jira/browse/SOLR-17098) (Houston Putman) (Jan Høydahl) (David Smiley) (Gus Heck) (Qing Xu)
- Allow '/' characters in the text managed by Managed Resources API. [SOLR-6853](https://issues.apache.org/jira/browse/SOLR-6853) (Nikita Rusetskii) (Eric Pugh)

### Dependency Upgrades (22 changes)

- Update dependency com.google.cloud:google-cloud-bom to v0.204.0 [PR#1745](https://github.com/apache/solr/pull/1745) (solrbot)
- Update org.apache.zookeeper:* to v3.9.1 [PR#1989](https://github.com/apache/solr/pull/1989) (solrbot)
- Update dependency org.semver4j:semver4j to v5.2.2 [PR#2008](https://github.com/apache/solr/pull/2008) (solrbot)
- Update dependency io.opentelemetry:opentelemetry-bom to v1.31.0 [PR#2009](https://github.com/apache/solr/pull/2009) (solrbot)
- Update dependency org.immutables:value-annotations to v2.10.0 [PR#2010](https://github.com/apache/solr/pull/2010) (solrbot)
- Update dependency com.google.guava:guava to v32.1.3-jre [PR#2014](https://github.com/apache/solr/pull/2014) (solrbot)
- Update dependency org.codehaus.woodstox:stax2-api to v4.2.2 [PR#2015](https://github.com/apache/solr/pull/2015) (solrbot)
- Update dependency com.fasterxml.jackson:jackson-bom to v2.15.3 [PR#2031](https://github.com/apache/solr/pull/2031) (solrbot)
- Update dependency io.swagger.core.v3:swagger-annotations to v2.2.17 [PR#2032](https://github.com/apache/solr/pull/2032) (solrbot)
- Update io.dropwizard.metrics:* to v4.2.21 [PR#2033](https://github.com/apache/solr/pull/2033) (solrbot)
- Update dependency com.github.spotbugs:spotbugs-annotations to v4.8.0 [PR#2034](https://github.com/apache/solr/pull/2034) (solrbot)
- Update dependency com.google.errorprone:error_prone_annotations to v2.23.0 [PR#2035](https://github.com/apache/solr/pull/2035) (solrbot)
- Update io.grpc:grpc-* to v1.59.0 [PR#2036](https://github.com/apache/solr/pull/2036) (solrbot)
- Update org.apache.logging.log4j:* to v2.21.0 [PR#2037](https://github.com/apache/solr/pull/2037) (solrbot)
- Update dependency commons-cli:commons-cli to v1.6.0 [PR#2048](https://github.com/apache/solr/pull/2048) (solrbot)
- Update dependency com.fasterxml.jackson:jackson-bom to v2.16.1 [PR#2135](https://github.com/apache/solr/pull/2135) (solrbot)
- Update dependency org.apache.commons:commons-compress to v1.25.0 [PR#2138](https://github.com/apache/solr/pull/2138) (solrbot)
- Update dependency org.apache.commons:commons-lang3 to v3.14.0 [PR#2139](https://github.com/apache/solr/pull/2139) (solrbot)
- Update io.netty:* to v4.1.104.Final [PR#2159](https://github.com/apache/solr/pull/2159) (solrbot)
- Update org.eclipse.jetty*:* to v10.0.19 [PR#2165](https://github.com/apache/solr/pull/2165) (solrbot)
- Update org.slf4j:* to v2.0.10 [PR#2174](https://github.com/apache/solr/pull/2174) (solrbot)
- Update Apache Hadoop to 3.3.6 and Apache Curator to 5.5.0 [SOLR-17012](https://issues.apache.org/jira/browse/SOLR-17012) [PR#1743](https://github.com/apache/solr/pull/1743) (solrbot)

### Other (1 change)

- Restrict certain file types from being uploaded to or downloaded from Config Sets [SOLR-16949](https://issues.apache.org/jira/browse/SOLR-16949) (janhoy) (Houston Putman)


[9.4.0] - 2023-10-14
--------------------

### Added (6 changes)

- A new Circuit breaker for percentage of CPU utilization is added. The former "CPU" circuit breaker is now more correctly named LoadAverageCircuitBreaker as it trips on system load average which is not a percentage. Users of legacy CircuitBreakerManager are not affected by this change. [SOLR-15056](https://issues.apache.org/jira/browse/SOLR-15056) (Walter Underwood) (janhoy) (Christine Poerschke) (Atri Sharma)
- Convert "rid" functionality into a default Tracer [SOLR-15367](https://issues.apache.org/jira/browse/SOLR-15367) (Alex Deparvu) (David Smiley)
- bin/auth creates reasonable roles and permissions for security: 'search', 'index', 'admin', and 'superadmin' and assigns user superadmin role. [SOLR-15771](https://issues.apache.org/jira/browse/SOLR-15771) (Eric Pugh) (janhoy)
- Add support for node-level caches [SOLR-16654](https://issues.apache.org/jira/browse/SOLR-16654) (Michael Gibney)
- Backups now allow metadata to be added as key-values [SOLR-16852](https://issues.apache.org/jira/browse/SOLR-16852) (Tomás Fernández Löbbe)
- Make Circuit Breakers available for Update Requests [SOLR-16954](https://issues.apache.org/jira/browse/SOLR-16954) (janhoy) (Christine Poerschke) (Pierre Salagnac)

### Changed (29 changes)

- When SolrCloud shard leaders change while indexing updates arrive, Solr could fail and return a HTTP 503 status. Switched to 510 so that CloudSolrClient will auto-retry it and probably succeed. [SOLR-11685](https://issues.apache.org/jira/browse/SOLR-11685) (David Smiley) (Alex Deparvu)
- Make zkClientTimeout consistent and based on a system property. The default values are stored in a single place referenced everywhere and they are based on system properties [SOLR-14667](https://issues.apache.org/jira/browse/SOLR-14667) (Alex Deparvu)
- Suppress stack traces in query response [SOLR-14886](https://issues.apache.org/jira/browse/SOLR-14886) (Isabelle Giguere) (Alex Deparvu)
- The Learning To Rank FieldValueFeature now uses DocValues when docValues=true and stored=true are combined. [SOLR-15440](https://issues.apache.org/jira/browse/SOLR-15440) (Christine Poerschke) (Tom Gilke)
- Make Circuit breakers individually pluggable [SOLR-15474](https://issues.apache.org/jira/browse/SOLR-15474) (Atri Sharma) (Christine Poerschke) (janhoy)
- reduce memory usage of ContentWriter based requests in Http2SolrClient [SOLR-16265](https://issues.apache.org/jira/browse/SOLR-16265) (Alex Deparvu) (Kevin Risden) (David Smiley)
- `/solr/coreName/replication?command=backup` now has a v2 equivalent, available at `/api/cores/coreName/replication/backups` [SOLR-16461](https://issues.apache.org/jira/browse/SOLR-16461) (Sanjay Dutt) (Jason Gerlowski) (Alex Deparvu)
- `/admin/cores?action=backupcore` now has a v2 equivalent, available at `GET /api/cores/coreName/backups` [SOLR-16490](https://issues.apache.org/jira/browse/SOLR-16490) (Sanjay Dutt) (Jason Gerlowski)
- The semi-internal `/admin/cores?action=restorecore` API now has a v2 equivalent, available at `POST /api/cores/coreName/restore {...}` [SOLR-16490](https://issues.apache.org/jira/browse/SOLR-16490) (Sayanti Dey) (Jason Gerlowski)
- Solr now offers `SolrRequest` implementations for a subset of its v2 APIs. These implementations are experimental and should be used with caution, but may be preferable to their v1 counterparts in some circumstances as they are generated and more likely to remain up-to-date with future API changes. [SOLR-16825](https://issues.apache.org/jira/browse/SOLR-16825) (Jason Gerlowski) (David Smiley) (Houston Putman)
- BinaryResponseWriter should not attempt cast to Utf8CharSequence [SOLR-16845](https://issues.apache.org/jira/browse/SOLR-16845) (Alex Deparvu) (Houston Putman)
- v2 APIs are now able to access any applicable solrconfig.xml "requestHandler" configuration. [SOLR-16847](https://issues.apache.org/jira/browse/SOLR-16847) (Alex Deparvu) (Jason Gerlowski)
- Limit the number of concurrent expensive core admin operations by running them in a dedicated thread pool. Backup, Restore and Split are expensive operations. [SOLR-16879](https://issues.apache.org/jira/browse/SOLR-16879) (Pierre Salagnac) (David Smiley)
- Postlogs tool for indexing Solr logs in Solr now supported on Windows by converting it to a Solr CLI command: `bin/solr postlogs`. `bin/postlogs` script marked deprected. [SOLR-16883](https://issues.apache.org/jira/browse/SOLR-16883) (Eric Pugh) (Will White)
- Add support of OAuth 2.0/OIDC 'code with PKCE' flow [SOLR-16896](https://issues.apache.org/jira/browse/SOLR-16896) [SOLR-16897](https://issues.apache.org/jira/browse/SOLR-16897) (Lamine Idjeraoui) (janhoy) (Kevin Risden) (Anshum Gupta)
- The embedded Zookeeper's bind host can now be overridden, but still defaults to "127.0.0.1". This is useful when using the ZkCli on a remote Solr using the embedded ZK, or Solr running in a Docker container. The SOLR_ZK_EMBEDDED_HOST envVar or -Dsolr.zk.embedded.host sysProp control this bind address. [SOLR-16926](https://issues.apache.org/jira/browse/SOLR-16926) (Houston Putman)
- Allow SolrClientCache clients to use Jetty HTTP2 clients [SOLR-16927](https://issues.apache.org/jira/browse/SOLR-16927) (Alex Deparvu) (David Smiley)
- Auto configure tracer without a &lt;tracerConfig&gt; tag in solr.xml [SOLR-16938](https://issues.apache.org/jira/browse/SOLR-16938) (Alex Deparvu)
- Users can pass Java system properties to the SolrCLI via the SOLR_TOOL_OPTS environment variable. [SOLR-16940](https://issues.apache.org/jira/browse/SOLR-16940) (Houston Putman)
- The SolrCLI now uses a smarter default for the Solr URL if none is provided, using the same envVars used when running Solr. [SOLR-16941](https://issues.apache.org/jira/browse/SOLR-16941) (Houston Putman)
- SimpleTracer propagation for manual transaction ids [SOLR-16950](https://issues.apache.org/jira/browse/SOLR-16950) 
- Make the internal CoresLocator implementation configurable in solr.xml [SOLR-16959](https://issues.apache.org/jira/browse/SOLR-16959) (Vincent Primault) (David Smiley)
- The solr.jetty.ssl.sniHostCheck option now defaults to the value of SOLR_SSL_CHECK_PEER_NAME, if it is provided. This will enable client and server hostName check settings to be governed by the same environment variable. If users want separate client/server settings, they can manually override the solr.jetty.ssl.sniHostCheck option in SOLR_OPTS. [SOLR-16964](https://issues.apache.org/jira/browse/SOLR-16964) (Houston Putman)
- Some ConfigSet operations formerly required that solrconfig.xml exist but should not have because the name of the file is configurable when creating cores / collections. [SOLR-16967](https://issues.apache.org/jira/browse/SOLR-16967) (David Smiley)
- The MemoryCircuitBreaker now uses average heap usage over the last 30 seconds [SOLR-16968](https://issues.apache.org/jira/browse/SOLR-16968) (janhoy) (Christine Poerschke)
- SOLR_OPTS is now able to override options set by the Solr control scripts, "bin/solr" and "bin/solr.cmd". [SOLR-16970](https://issues.apache.org/jira/browse/SOLR-16970) (Houston Putman)
- Trip Circuit Breakers only for external requests [SOLR-16982](https://issues.apache.org/jira/browse/SOLR-16982) (janhoy) (Christine Poerschke)
- Optimize and consolidate reuse of DocValues iterators for value retrieval [SOLR-16989](https://issues.apache.org/jira/browse/SOLR-16989) (Michael Gibney)
- ZkStateReader waitForState should check clusterState before using watchers [SOLR-17004](https://issues.apache.org/jira/browse/SOLR-17004) (Kevin Risden)

### Fixed (34 changes)

- Allow looking up Solr Package repo when that URL references a raw repository.json hosted on Github when the file is JSON but the mimetype used is text/plain. [PR#1826](https://github.com/apache/solr/pull/1826) (Eric Pugh)
- Fix the admin UI green core-size graph on nodes screen [PR#1963](https://github.com/apache/solr/pull/1963) (janhoy)
- SlowRequest logging is no longer disabled if SolrCore logger set to ERROR [SOLR-16044](https://issues.apache.org/jira/browse/SOLR-16044) (janhoy) (hossman)
- Atomic update on boolean fields doesn't reflect when value starts with "1", "t" or "T" [SOLR-16360](https://issues.apache.org/jira/browse/SOLR-16360) (Rahul Goswami) (Justin Sweeney) (David Smiley)
- asyncId must not have '/'; enforce this. Enhance ZK cleanup to process directories instead of fail. [SOLR-16415](https://issues.apache.org/jira/browse/SOLR-16415) (David Smiley) (Paul McArthur)
- Fixing the entropy warning threshold using scaling based on poolsize [SOLR-16644](https://issues.apache.org/jira/browse/SOLR-16644) (Raghavan Muthuregunathan)
- Fix race condition on PRS enabled collection deletion [SOLR-16701](https://issues.apache.org/jira/browse/SOLR-16701) (Patson Luk)
- Missing Proxy support for Http2SolrClient [SOLR-16859](https://issues.apache.org/jira/browse/SOLR-16859) (Alex Deparvu)
- Don't commit multi-part uploads that have been aborted [SOLR-16886](https://issues.apache.org/jira/browse/SOLR-16886) (Tomás Fernández Löbbe) (Houston Putman)
- Rate Limiter should stop processing on 429 [SOLR-16889](https://issues.apache.org/jira/browse/SOLR-16889) (Alex Deparvu) (David Smiley)
- CoreAdminOp are statically registered in CoreAdminHandler, preventing more than one Solr instance in the same JVM [SOLR-16899](https://issues.apache.org/jira/browse/SOLR-16899) (Vincent Primault) (Alex Deparvu)
- Allow access to specified "solr.allowPaths" in Security Manager [SOLR-16905](https://issues.apache.org/jira/browse/SOLR-16905) (daylicron) (Houston Putman)
- Correctly capture REPLICATION metrics in Prometheus config [SOLR-16906](https://issues.apache.org/jira/browse/SOLR-16906) (Daisuke Aritomo) (Houston Putman)
- Use of the JSON Query DSL should ignore the defType parameter [SOLR-16916](https://issues.apache.org/jira/browse/SOLR-16916) (Christina Chortaria) (Max Kadel) (Ryan Laddusaw) (Jane Sandberg) (David Smiley)
- Scripts wrongly prohibit embedded zookeeper when solr port is between 55535 and 64535 [SOLR-16922](https://issues.apache.org/jira/browse/SOLR-16922) (Tiziano Degaetano) (Colvin Cowie)
- Fix indentation for JacksonJsonWriter [SOLR-16925](https://issues.apache.org/jira/browse/SOLR-16925) (Houston Putman)
- SolrStream propagates undecoded error message [SOLR-16929](https://issues.apache.org/jira/browse/SOLR-16929) (Alex Deparvu)
- ReRankScaler explain breaks with debug=true and in distributed mode [SOLR-16931](https://issues.apache.org/jira/browse/SOLR-16931) (Joel Bernstein)
- Include the full query response when using the API tool, and fix serialization issues for SolrDocumentList. [SOLR-16933](https://issues.apache.org/jira/browse/SOLR-16933) (Houston Putman)
- Allow Solr to read client (javax.net.ssl.*) trustStores and keyStores via SecurityManager. [SOLR-16934](https://issues.apache.org/jira/browse/SOLR-16934) (Houston Putman)
- V2 API /api/node/health should be governed by "health" permission, not "config-read" [SOLR-16944](https://issues.apache.org/jira/browse/SOLR-16944) (janhoy)
- Updated Cluster Singleton plugins are stopped correctly when the Overseer is closed. [SOLR-16946](https://issues.apache.org/jira/browse/SOLR-16946) (Paul McArthur)
- Tracing v2 apis breaks SecurityConfHandler [SOLR-16955](https://issues.apache.org/jira/browse/SOLR-16955) (Alex Deparvu) (David Smiley)
- Fix spurious warning about LATEST luceneMatchVersion [SOLR-16958](https://issues.apache.org/jira/browse/SOLR-16958) (Colvin Cowie)
- The "solr.jetty.ssl.verifyClientHostName" sysProp and "SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION" envVar have been fixed, and the setting once again tells the server to check the originating client hostname against the client certificate when doing mTLS. [SOLR-16963](https://issues.apache.org/jira/browse/SOLR-16963) (Houston Putman) (Tomás Fernández Löbbe)
- RealTimeGet with Composite router throws NPE [SOLR-16971](https://issues.apache.org/jira/browse/SOLR-16971) (Alex Deparvu)
- fix REMOTE_JMX_OPTS to delayed expansion [SOLR-16973](https://issues.apache.org/jira/browse/SOLR-16973) (Tiziano Degaetano) (Colvin Cowie)
- Connect to SOLR standalone with basic authentication [SOLR-16980](https://issues.apache.org/jira/browse/SOLR-16980) (Alex Deparvu)
- Fixed a bug that could cause some usages of SolrStream to fail to close InputStreams from the server. Also fixed the usage of ObjectReleaseTracker in SolrTestCaseJ4 to catch these kinds of bugs [SOLR-16983](https://issues.apache.org/jira/browse/SOLR-16983) (hossman)
- Concurrent requests failing JWT authentication in Admin UI intermittently [SOLR-16991](https://issues.apache.org/jira/browse/SOLR-16991) (Lamine Idjeraoui) (janhoy)
- Non-reproducible StreamingTest failures -- suggests CloudSolrStream concurency race condition [SOLR-16992](https://issues.apache.org/jira/browse/SOLR-16992) (Alex Deparvu) (hossman)
- OTEL configurator NPE when SOLR_HOST not set [SOLR-16997](https://issues.apache.org/jira/browse/SOLR-16997) (janhoy)
- json.wrf parameter ignored in JacksonJsonWriter [SOLR-17009](https://issues.apache.org/jira/browse/SOLR-17009) (Alex Deparvu)
- ZkCli should create subpaths when necessary [SOLR-17019](https://issues.apache.org/jira/browse/SOLR-17019) (Houston Putman)

### Dependency Upgrades (4 changes)

- Update io.opentelemetry to 1.29.0 [PR#1846](https://github.com/apache/solr/pull/1846) (Alex Deparvu)
- Update forbiddenapis to 3.6 to support Java 21/22 and commons-io up to 2.14.0 [PR#1971](https://github.com/apache/solr/pull/1971) (Uwe Schindler)
- Update org.eclipse.jetty to 10.0.17 [PR#2001](https://github.com/apache/solr/pull/2001) (Alex Deparvu)
- Upgrade Lucene to 9.8.0 [SOLR-16985](https://issues.apache.org/jira/browse/SOLR-16985) (Alex Deparvu) (Christine Poerschke)

### Other (10 changes)

- Fix typos in org.apache.solr.core package [PR#1629](https://github.com/apache/solr/pull/1629) (Andrey Bozhko) (Marcus Eagan)
- new SolrJettyTestRule for tests needing HTTP or Jetty. [SOLR-16623](https://issues.apache.org/jira/browse/SOLR-16623) (David Smiley) (Joshua Ouma)
- Remove dependencies on methods defined in the SimplePostTool from Solr core and solrj modules. [SOLR-16803](https://issues.apache.org/jira/browse/SOLR-16803) 
- Eliminate special case code in Solr CLI by introducing explicit VersionTool.java. [SOLR-16842](https://issues.apache.org/jira/browse/SOLR-16842) (Eric Pugh) (Will White)
- The default auto-soft-commit time has been set to 3 seconds. Previously, auto-soft-commit was disabled by default. [SOLR-16856](https://issues.apache.org/jira/browse/SOLR-16856) (Houston Putman)
- Lower the AffinityPlacementPlugin's default minimalFreeDiskGB to 5 GB [SOLR-16915](https://issues.apache.org/jira/browse/SOLR-16915) (Houston Putman)
- Tests should sometimes run with a Tracer (not no-op) [SOLR-16960](https://issues.apache.org/jira/browse/SOLR-16960) (Alex Deparvu)
- Be case insensitive when parsing booleans from text [SOLR-16978](https://issues.apache.org/jira/browse/SOLR-16978) (Tomás Fernández Löbbe)
- BATS integration tests now start solr instances on a randomly selected port [SOLR-16979](https://issues.apache.org/jira/browse/SOLR-16979) (janhoy)
- Implement Windows version of bin/post via implementing bin/solr post command that works on Windows and Unix. Deprecate bin/post. [SOLR-6994](https://issues.apache.org/jira/browse/SOLR-6994) (Eric Pugh) (Will White)


[9.3.0] - 2023-07-21
--------------------

### Upgrade Notes (1 change)

- Add property to control the deletion of unknown cores. The default setting is to not delete unknown cores. This is a change to behaviour introduced in Solr 7.3.1 by SOLR-12066. To continue using the previous behaviour, Solr can be started with the system property `solr.deleteUnknownCores` set to `true`. [SOLR-13396](https://issues.apache.org/jira/browse/SOLR-13396) [SOLR-12066](https://issues.apache.org/jira/browse/SOLR-12066) (Colvin Cowie) (janhoy)

### Added (14 changes)

- Introduced support for byte vector encoding in DenseVectorField and KnnQParser [SOLR-16674](https://issues.apache.org/jira/browse/SOLR-16674) (Elia Porciani) (Alessandro Benedetti)
- Added function queries for dense vector similarity. [SOLR-16675](https://issues.apache.org/jira/browse/SOLR-16675) (Elia Porciani) (Alessandro Benedetti)
- Solr now provides an "Install Shard" API that allows users who have built (per-shard) indices offline to import them into SolrCloud shards. The API is available at `POST /api/collections/collName/shards/shardName/install` (v2), or at `GET /solr/admin/collections?action=INSTALLSHARDDATA` (v1). [SOLR-16697](https://issues.apache.org/jira/browse/SOLR-16697) (Jason Gerlowski)
- {!join} can join collections with multiple shards on both sides. [SOLR-16717](https://issues.apache.org/jira/browse/SOLR-16717) (Mikhail Khludnev)
- AffinityPlacementFactory now supports spreading replicas across domains within the availability zone and optionally fail the request if more than a configurable number of replicas need to be placed in a single domain. [SOLR-16719](https://issues.apache.org/jira/browse/SOLR-16719) (Houston Putman) (Tomás Fernández Löbbe)
- Produce a slim Solr binary and docker image, without the Prometheus Exporter and Solr Modules. [SOLR-16742](https://issues.apache.org/jira/browse/SOLR-16742) (Houston Putman)
- Solr now provides a BalanceReplicas API at `POST /api/cluster/replicas/balance` (v2), to spread replicas across a given set of nodes. No v1 API is available. [SOLR-16806](https://issues.apache.org/jira/browse/SOLR-16806) (Houston Putman) (Tomás Fernández Löbbe) (Jason Gerlowski) (Radu Gheorghe)
- Support CBOR format for update/query [SOLR-16812](https://issues.apache.org/jira/browse/SOLR-16812) (noble)
- Add min/max scaling to the reranker [SOLR-16827](https://issues.apache.org/jira/browse/SOLR-16827) (Joel Bernstein)
- Introduced support for high dimensional vectors [SOLR-16836](https://issues.apache.org/jira/browse/SOLR-16836) (Alessandro Benedetti)
- Introducing AffinityPlacementFactory.withCollectionShards to collocate corresponding shards of two collections. eg primaryColl.shard1 will be placed to the node where secondaryColl.shard1 resides, etc. [SOLR-16837](https://issues.apache.org/jira/browse/SOLR-16837) (Mikhail Khludnev)
- Added new parameter `backupConfigset` to collection Backup to optionally skip backing up configsets. [SOLR-16844](https://issues.apache.org/jira/browse/SOLR-16844) (Tomás Fernández Löbbe)
- Solr now provides a MigrateReplicas API at `POST /api/cluster/replicas/migrate` (v2), to move replicas off of a given set of nodes. This extends the functionality of the existing ReplaceNode API. [SOLR-16855](https://issues.apache.org/jira/browse/SOLR-16855) (Houston Putman)
- Solr Javadocs now have searching enabled. [SOLR-16884](https://issues.apache.org/jira/browse/SOLR-16884) (Mike Drob) (Houston Putman)

### Changed (44 changes)

- Introduce Builder setter for defaultCollection on cloud SolrClients. Deprecated direct setter setDefaultCollection on cloud SolrClients. [SOLR-10466](https://issues.apache.org/jira/browse/SOLR-10466) (Eric Pugh) (David Smiley)
- When querying with the `_route_` or `shards.preference` parameter and if there are multiple replicas for a collection on the receiving node, there was sometimes an extra HTTP hop or the non-intended replica may receive the request. SolrJ will now form the URL directly to the intended replica of the collection (and not the collection itself). [SOLR-14630](https://issues.apache.org/jira/browse/SOLR-14630) (Pierre Salagnac) (Ivan Djurasevic) (Jason Baik)
- Security: Converted enableRemoteStreaming and enableStreamBody solrconfig options into system properties and env vars. Attempts to set them the old way are no-op and log a warning. [SOLR-14853](https://issues.apache.org/jira/browse/SOLR-14853) (David Smiley) (janhoy) (Ishan Chattopadhyaya)
- Throw an error message if the feature store doesn't exist. [SOLR-15493](https://issues.apache.org/jira/browse/SOLR-15493) (Ilaria Petreti) (Alessandro Benedetti)
- Solr's collection-level "snapshot" APIs now have v2 equivalents. Snapshots can be created at `POST /api/collections/collName/snapshots/snapshotName`, listed at `GET /api/collections/collName/snapshots`, and deleted at `DELETE /api/collections/collName/snapshots/snapshotName`. [SOLR-15737](https://issues.apache.org/jira/browse/SOLR-15737) (John Durham) (Jason Gerlowski)
- XML update allows &lt;doc&gt; &lt;doc name="child"&gt; ... &lt;/doc&gt; &lt;/doc&gt;. [SOLR-16183](https://issues.apache.org/jira/browse/SOLR-16183) (Vinayak Hegde) (Mikhail Khludnev)
- Improve the performance of the Prometheus Metric Exporter scraping metrics [SOLR-16273](https://issues.apache.org/jira/browse/SOLR-16273) (Matthew Biscocho) (David Smiley & Christine Poerschke)
- Solr's v2 "create collection" API has been tweaked slightly to be more intuitive. It remains available under `POST /api/collections`, but the top level "create" command-name key has been removed. [SOLR-16391](https://issues.apache.org/jira/browse/SOLR-16391) (Jason Gerlowski)
- The path of the v2 "collprop" API has been tweaked slightly to be more intuitive. Endpoints are now available under the `PUT` and `DELETE` verbs at `/api/collections/collName/properties/propName` depending on whether the property is being upserted or deleted. [SOLR-16391](https://issues.apache.org/jira/browse/SOLR-16391) (Jason Gerlowski)
- The v2 "add-replica" API has been tweaked to be more intuitive, by removing the top-level command specifier and changing the path. The v2 functionality can now be accessed at: `POST /api/collections/cName/shards/sName/replicas {...}` [SOLR-16392](https://issues.apache.org/jira/browse/SOLR-16392) (Jason Gerlowski)
- The v2 "create shard" API has been tweaked to be more intuitive, by removing the top-level "create" command specifier. The rest of the API remains unchanged. [SOLR-16392](https://issues.apache.org/jira/browse/SOLR-16392) (Jason Gerlowski)
- The v2 deletereplica API has been tweaked to be more intuitive: single replicas deletion now uses `DELETE /api/collections/cName/shards/sName/replicas/rName`, deletion of multiple relicas in a single shard uses `DELETE /api/collections/cName/shards/sName/replicas?count=123`, and deletion of multiple replicas from all shards now uses `PUT /api/collections/cName/scale {"count": 123"}` [SOLR-16392](https://issues.apache.org/jira/browse/SOLR-16392) (Jason Gerlowski)
- Solr's v2 "aliasprop" CRUD APIs have been tweaked slightly to be more intuitive. Alias property modification is now available at `PUT /api/aliases/aliasName/properties` (for bulk modification) and `PUT /api/aliases/aliasName/properties/propName` (for single property updates). Additionally new APIs have been added for listing properties (`GET /api/aliases/aliasName/properties`), fetching single property values (`GET /api/aliases/aliasName/properties/propName`), and property deletion (`DELETE /api/aliases/aliasName/properties/propName`). [SOLR-16393](https://issues.apache.org/jira/browse/SOLR-16393) (Alex Deparvu) (Jason Gerlowski)
- The path of the v2 "delete alias" API has been tweaked slightly to be more intuitive, and is now available at `DELETE /api/aliases/aliasName`. [SOLR-16393](https://issues.apache.org/jira/browse/SOLR-16393) (Jason Gerlowski)
- The v2 "create alias" API has been tweaked to be more intuitive. The format of the request body has changed slightly: the "create-alias" command specifier has been removed, the "name" field for individual routers has been renamed to "type", and the routers themselves are now always grouped into a list. Additionally the v2 API has moved to the new path `POST /api/aliases`. [SOLR-16393](https://issues.apache.org/jira/browse/SOLR-16393) (Jason Gerlowski)
- The path of the v2 "collection backup" API has been tweaked slightly to be more intuitive, and is now available at `POST /api/collections/backups/backupName/versions`. [SOLR-16394](https://issues.apache.org/jira/browse/SOLR-16394) (Jason Gerlowski)
- The v2 "restore" API has been tweaked to be more intuitive. The top-level "restore-collection" command specifier has been removed, and the API now lives at the new path `POST /api/backups/backupName/restore`. [SOLR-16394](https://issues.apache.org/jira/browse/SOLR-16394) (Jason Gerlowski)
- The v2 list and delete (collection) backup APIs have been tweaked to be more intuitive: backup listing now uses `GET /api/backups/bName/versions`, backup deletion by ID now uses `DELETE /api/backups/bName/versions/1`, backup deletion by recency now uses `DELETE /api/backups/bName/versions?retainLatest=3`, and index-file "garbage collection" now uses `PUT /api/backups/backupName/purgeUnused` [SOLR-16394](https://issues.apache.org/jira/browse/SOLR-16394) (Jason Gerlowski)
- Reload core v2 endpoints have been updated to be more REST-ful. RELOAD is now available at `POST /api/cores/coreName/reload` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- Unload core v2 endpoints have been updated to be more REST-ful. UNLOAD is now available at `POST /api/cores/coreName/unload` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Sanjay Dutt) (Jason Gerlowski)
- Several v2 "command" APIs have been tweaked to be more intuitive. "FORCELEADER" is now available at `POST /api/collections/cName/shards/sName/force-leader`, "RELOAD" is now available at `POST /api/collections/cName/reload`, "SYNCSHARD" is now available at `POST /api/collections/cName/shards/sName/sync-shard`, and "RENAME" is now available at `POST /api/collections/cName/rename`. [SOLR-16398](https://issues.apache.org/jira/browse/SOLR-16398) (Jason Gerlowski)
- The v2 "balance-shard-unique" API has been tweaked to be more intuitive, by removing the top-level command specifier from the request body, and changing the path. The v2 functionality can now be accessed at: `POST /api/collections/cName/balance-shard-unique {...}` [SOLR-16398](https://issues.apache.org/jira/browse/SOLR-16398) (Jason Gerlowski)
- Solr's v2 "logging" APIs have been tweaked slightly to be more intuitive. The single v2 endpoint that existing previously (GET /api/node/logging) has been split into several different APIs. Logger levels can be fetched or modified at `GET /api/node/logging/levels` and `PUT /api/node/logging/levels`, respectively. Log messages can be returned from a "listener" at `GET /api/node/logging/messages`. And the threshold for the log "listener" can be modified with `PUT /api/node/logging/messages/threshold`. [SOLR-16458](https://issues.apache.org/jira/browse/SOLR-16458) (Jason Gerlowski) (Calvince Otieno)
- `/coreName/replication?command=filelist` now has a v2 equivalent, available at `GET /api/cores/coreName/replication/files?generation=123` [SOLR-16470](https://issues.apache.org/jira/browse/SOLR-16470) (Matthew Biscocho) (Jason Gerlowski)
- `/coreName/replication?commit=indexversion` now has a v2 equivalent, available at `GET /api/cores/coreName/replication/indexversion` [SOLR-16470](https://issues.apache.org/jira/browse/SOLR-16470) (Matthew Biscocho) (Jason Gerlowski)
- Convert CLI tools to use Jetty HTTP 2 client. [SOLR-16504](https://issues.apache.org/jira/browse/SOLR-16504) (Bence Szabo) (Eric Pugh)
- Add support of SolrClassLoader to SolrZkClient [SOLR-16687](https://issues.apache.org/jira/browse/SOLR-16687) (Lamine Idjeraoui) (Jason Gerlowski & Houston Putman)
- Allow setting the a CookieStore implementation in Http2SolrClient. When Cookies are not needed, this can be set to `org.eclipse.jetty.util.HttpCookieStore.Empty`, which avoids some of the processing that happens in the default `java.net.InMemoryCookieStore`. Solr can also be started with the system property `solr.http.disableCookies` set to `true`, so that the internal clients that Solr uses to communicate between nodes use `HttpCookieStore.Empty`. [SOLR-16692](https://issues.apache.org/jira/browse/SOLR-16692) (Tomás Fernández Löbbe)
- For query timeAllowed, switch from ExitableDirectoryReader to TimeLimitingBulkScorer [SOLR-16693](https://issues.apache.org/jira/browse/SOLR-16693) (David Smiley)
- Shortcut Http2SolrClient mimeType check for default response parse [SOLR-16694](https://issues.apache.org/jira/browse/SOLR-16694) (Tomás Fernández Löbbe) (Alex Deparvu)
- Extract SolrCLI tool implementations into their own classes and reorganize CLI related classes into new org.apache.solr.cli package. [SOLR-16711](https://issues.apache.org/jira/browse/SOLR-16711) (Eric Pugh)
- The Official Solr Dockerfile has been cleaned up. The SOLR_DOWNLOAD_SERVER arg is now the only way to specify where to download Solr from. If the url includes "apache.org", then GPG checks will be computed, otherwise the GPG checks will be skipped. [SOLR-16748](https://issues.apache.org/jira/browse/SOLR-16748) (Houston Putman)
- Docker: Leave out optional apt packages, slightly reducing image size and lowering attack surface [SOLR-16752](https://issues.apache.org/jira/browse/SOLR-16752) (Quang-Cuong Bui)
- Introducing logAll parameter in the feature logger [SOLR-16759](https://issues.apache.org/jira/browse/SOLR-16759) (Anna Ruggero) (Alessandro Benedetti)
- Clarify that ExportTool exports documents in JSON with Lines format, not standard JSON. Add explicit -compress option for gzipping output. Add ability to specific a directory for output along with a specific file when using -out. [SOLR-16764](https://issues.apache.org/jira/browse/SOLR-16764) (Eric Pugh)
- Remove -usage as option from bin/solr, and ensure both -help and -h work. [SOLR-16766](https://issues.apache.org/jira/browse/SOLR-16766) (Bence Szabo) (Eric Pugh)
- bin/solr export tool now supports JSON export format as well as the existing JSON With Lines format. [SOLR-16782](https://issues.apache.org/jira/browse/SOLR-16782) (Eric Pugh)
- The included PlacementPlugins (Random, Simple, MinimizeCores and Affinity) now all implement the OrderedNodePlacementPlugin, which provides the implementation for computePlacements() and computeBalancing(). Each implementing PlacementPlugin provides a way of weighting Solr Nodes, and the OrderedNodePlacement plugin then uses the weights to decide the optimal strategy for placing new replicas or balancing existing replicas. [SOLR-16806](https://issues.apache.org/jira/browse/SOLR-16806) (Houston Putman) (Tomás Fernández Löbbe) (Jason Gerlowski) (Radu Gheorghe)
- Update node metrics while making affinityPlacement selections. Therefore selections can be made given the expected cluster information after the previous selections are implemented. [SOLR-16816](https://issues.apache.org/jira/browse/SOLR-16816) (Houston Putman)
- Align allowed collection names and the validation of them in the CreateCollectionAPI and the PackageTool. [SOLR-16820](https://issues.apache.org/jira/browse/SOLR-16820) (Will White) (Eric Pugh)
- Use IndexOrDocValuesQuery for PointFields on Set queries. This improves the performance in some scenarios when the set query is combined with other selective queries. [SOLR-16846](https://issues.apache.org/jira/browse/SOLR-16846) (Tomás Fernández Löbbe) (Alex Deparvu)
- Enable Incubating Java Panama Vector APIs when using Java 20 or 21. When run using compatible hardware, Vector search will see considerable speed up. [SOLR-16869](https://issues.apache.org/jira/browse/SOLR-16869) (Houston Putman) (Uwe Schindler)
- Use Log4J JUL manager when starting Java. This is necessary for Lucene logs to be included with Solr logs. [SOLR-16878](https://issues.apache.org/jira/browse/SOLR-16878) (Houston Putman) (Uwe Schindler)
- Internal shard requests no longer include the wasteful shard.url param. [shard] transformer now defaults to returning only the shard id (based on luceneMatchVersion), but can be configured to return the legacy list of replicas. [SOLR-9378](https://issues.apache.org/jira/browse/SOLR-9378) (hossman)

### Fixed (27 changes)

- Fix setting client scoped socket and connect timeouts when using HttpSolrClient.Builder.withHttpClient() method. [SOLR-13605](https://issues.apache.org/jira/browse/SOLR-13605) (Eric Pugh) (Alex Deparvu)
- Fix default solr-exporter-config.xml metrics with incorrect time unit conversions. [SOLR-15083](https://issues.apache.org/jira/browse/SOLR-15083) (Matthew Biscocho) (janhoy)
- Fix solr scripts running on IBM i [SOLR-16619](https://issues.apache.org/jira/browse/SOLR-16619) (Jesse Gorzinski) (Eric Pugh)
- Fix Http2SolrClient's exception message when serverBaseUrl is null [SOLR-16638](https://issues.apache.org/jira/browse/SOLR-16638) (Alex Deparvu) (Kevin Risden)
- Http2SolrClient should not use Apache Http client classes [SOLR-16723](https://issues.apache.org/jira/browse/SOLR-16723) (Kevin Risden)
- Http2SolrClient needs to inherit all properties when initialized with another http2 client [SOLR-16737](https://issues.apache.org/jira/browse/SOLR-16737) (Alex Deparvu) (Tomás Fernández Löbbe)
- PRS state is now always updated at the end of a splitShard. [SOLR-16753](https://issues.apache.org/jira/browse/SOLR-16753) (Houston Putman) (hossman)
- bin/solr package tool supports -h and -help command like other tools. [SOLR-16760](https://issues.apache.org/jira/browse/SOLR-16760) (Eric Pugh)
- bin/solr export tool limit property was off by 1. Now limit results exported to the exact number. [SOLR-16765](https://issues.apache.org/jira/browse/SOLR-16765) (Eric Pugh)
- Fixed behavior and handling of 'unset' logging levels in /admin/info/logging API and related Admin UI [SOLR-16771](https://issues.apache.org/jira/browse/SOLR-16771) (hossman)
- UI: Cloud&gt;Nodes screen - fix display of cores with non-standard shard names [SOLR-16773](https://issues.apache.org/jira/browse/SOLR-16773) (janhoy) (hossman)
- Schema Designer now correctly manages trust of the ConfigSets it is managing. [SOLR-16777](https://issues.apache.org/jira/browse/SOLR-16777) (Ishan Chattopadhyaya) (Skay) (Houston Putman)
- Fixed race condition deleting empty `clusterstate.json` file that could prevent Solr 9 instances from starting with a NoNodeException [SOLR-16783](https://issues.apache.org/jira/browse/SOLR-16783) (Tomás Fernández Löbbe)
- Fixed Admin UI dashboard "Security" panel to show the right information regarding authentication [SOLR-16789](https://issues.apache.org/jira/browse/SOLR-16789) (Tomás Fernández Löbbe)
- Reset the thread's contextClassloader after loading the CoreContainer [SOLR-16801](https://issues.apache.org/jira/browse/SOLR-16801) (Thomas Wöckinger) (Houston Putman)
- DenseVectorField breaks catch-all copyFields [SOLR-16807](https://issues.apache.org/jira/browse/SOLR-16807) (Joel Bernstein)
- Stop publishing environment variables via the Metrics API [SOLR-16808](https://issues.apache.org/jira/browse/SOLR-16808) (Houston Putman)
- The configuration for hiding sensitive sysProp information has been joined under `-Dsolr.hiddenSysProps` and `SOLR_HIDDEN_SYS_PROPS`. [SOLR-16809](https://issues.apache.org/jira/browse/SOLR-16809) (Houston Putman) (David Smiley)
- /update/json/docs?echo and mapUniqueKeyOnly params doesn't work [SOLR-16811](https://issues.apache.org/jira/browse/SOLR-16811) (Mikhail Khludnev)
- Fixed bin/solr healthcheck command returning cluster status details. Removed SolrCloudTool class that is no longer used. [SOLR-16831](https://issues.apache.org/jira/browse/SOLR-16831) (Eric Pugh)
- Flaky DeleteReplicaTest.raceConditionOnDeleteAndRegisterReplica [SOLR-16848](https://issues.apache.org/jira/browse/SOLR-16848) (Alex Deparvu) (Paul McArthur)
- Coordinator ZkStateReader's watch is not removed upon collection deletion [SOLR-16860](https://issues.apache.org/jira/browse/SOLR-16860) (Patson Luk)
- Coordinator node does not have the correct collection/core in MDCLoggingContext [SOLR-16861](https://issues.apache.org/jira/browse/SOLR-16861) (Patson Luk)
- BackupManager now allows ConfigSet "files" to be empty, which previously caused NPEs. [SOLR-16877](https://issues.apache.org/jira/browse/SOLR-16877) (Paul Blanchaert) (Houston Putman)
- DocCollection, Slice and Replica now write to Json and write to Maps identically. [SOLR-16891](https://issues.apache.org/jira/browse/SOLR-16891) (Houston Putman) (Tomás Fernández Löbbe)
- Internal update requests should fail back to the client in some edge cases for shard splits. Use HTTP status 510 so the client can retry the operation. [SOLR-7609](https://issues.apache.org/jira/browse/SOLR-7609) (Alex Deparvu) (David Smiley) (Tomás Fernández Löbbe)
- NPE in QueryResultKey when running clustering search query in some cases. [SOLR-9775](https://issues.apache.org/jira/browse/SOLR-9775) (Roman Kagan) (Christine Poerschke) (Eric Pugh)

### Dependency Upgrades (26 changes)

- Update dependency org.semver4j:semver4j to v4.3.0 [PR#1451](https://github.com/apache/solr/pull/1451) (solrbot)
- Update Jetty to 10.0.14, slf4j to 2.0.7, io.dropwizard.metrics to v4.2.18 [PR#1472](https://github.com/apache/solr/pull/1472) (solrbot)
- Update org.apache.calcite to v1.34.0 [PR#1473](https://github.com/apache/solr/pull/1473) (solrbot)
- Update dependency org.apache.commons:commons-compress to v1.23.0 [PR#1493](https://github.com/apache/solr/pull/1493) (solrbot)
- Upgrade forbiddenapis to 3.5 [PR#1494](https://github.com/apache/solr/pull/1494) (Uwe Schindler)
- Update org.apache.hadoop:* to v3.3.5 [PR#1515](https://github.com/apache/solr/pull/1515) (solrbot)
- Update dependency org.hsqldb:hsqldb to v2.7.1 [PR#1521](https://github.com/apache/solr/pull/1521) (solrbot)
- Update dependency com.jayway.jsonpath:json-path to v2.8.0 [PR#1529](https://github.com/apache/solr/pull/1529) (solrbot)
- Update dependency org.apache.commons:commons-configuration2 to v2.9.0 [PR#1530](https://github.com/apache/solr/pull/1530) (solrbot)
- Update dependency joda-time:joda-time to v2.12.5 [PR#1532](https://github.com/apache/solr/pull/1532) (solrbot)
- Update dependency com.github.ben-manes.caffeine:caffeine to v3.1.6 [PR#1582](https://github.com/apache/solr/pull/1582) (solrbot)
- Update io.netty:* to v4.1.93.Final [PR#1584](https://github.com/apache/solr/pull/1584) (solrbot)
- Update dependency com.fasterxml.jackson:jackson-bom to v2.15.2 [PR#1599](https://github.com/apache/solr/pull/1599) (solrbot)
- Update dependency com.google.cloud:google-cloud-bom to v0.197.0 [PR#1606](https://github.com/apache/solr/pull/1606) (solrbot)
- Update dependency org.mockito:mockito-core to v5 [PR#1611](https://github.com/apache/solr/pull/1611) (solrbot)
- Update dependency org.carrot2:carrot2-core to v4.5.1 [PR#1641](https://github.com/apache/solr/pull/1641) (solrbot)
- Update io.dropwizard.metrics:* to v4.2.19 [PR#1685](https://github.com/apache/solr/pull/1685) (solrbot)
- Update dependency com.google.guava:guava to v32 [PR#1686](https://github.com/apache/solr/pull/1686) (solrbot)
- Update dependency biz.aQute.bnd:biz.aQute.bnd.annotation to v6.4.1 [PR#1712](https://github.com/apache/solr/pull/1712) (solrbot)
- Update dependency io.swagger.core.v3:swagger-annotations to v2.2.12 [PR#1713](https://github.com/apache/solr/pull/1713) (solrbot)
- Update dependency org.xerial.snappy:snappy-java to v1.1.10.1 [PR#1714](https://github.com/apache/solr/pull/1714) (solrbot)
- Update io.grpc:grpc-* to v1.56.0 [PR#1715](https://github.com/apache/solr/pull/1715) (solrbot)
- Update software.amazon.awssdk:* to v2.20.97 [PR#1744](https://github.com/apache/solr/pull/1744) (solrbot)
- Upgrade to Lucene 9.5.0 [SOLR-16642](https://issues.apache.org/jira/browse/SOLR-16642) (Vinayak Hegde) (David Smiley)
- upgrade Solr to use Lucene 9.6.0 [SOLR-16799](https://issues.apache.org/jira/browse/SOLR-16799) (Alex Deparvu) (Tomás Fernández Löbbe)
- Upgrade Lucene to 9.7.0 [SOLR-16853](https://issues.apache.org/jira/browse/SOLR-16853) (Alex Deparvu)

### Other (12 changes)

- Removed deprecated members from Tuple class [PR#1566](https://github.com/apache/solr/pull/1566) (janhoy)
- Remove deprecated constructor in MetricsMap [PR#1567](https://github.com/apache/solr/pull/1567) (janhoy)
- replace all SolrException.log usage in Solr to just call log.error(...) directly [SOLR-15703](https://issues.apache.org/jira/browse/SOLR-15703) (Kevin Risden)
- Change SplitShardCmd to not use NodeStateProvider [SOLR-16507](https://issues.apache.org/jira/browse/SOLR-16507) (Vinayak Hegde) (David Smiley)
- Use Solr Client Builders directly in unit tests instead of delegating to SolrTestCaseJ4. [SOLR-16604](https://issues.apache.org/jira/browse/SOLR-16604) (Eric Pugh) (David Smiley)
- Add simple search benchmark to benchmark module [SOLR-16704](https://issues.apache.org/jira/browse/SOLR-16704) (Tomás Fernández Löbbe)
- Update Solr's internal use of Solr Client Builders to use TimeUnit parameter for time specific builder methods. [SOLR-16709](https://issues.apache.org/jira/browse/SOLR-16709) (Eric Pugh)
- Replace Guava usages with pure Java [SOLR-16713](https://issues.apache.org/jira/browse/SOLR-16713) (Kevin Risden)
- Replace new HashMap(int) and new HashSet(int) with CollectionUtil.newHashMap / CollectionUtil.newHashSet [SOLR-16715](https://issues.apache.org/jira/browse/SOLR-16715) (Kevin Risden)
- Replace commons-io usages with pure Java [SOLR-16716](https://issues.apache.org/jira/browse/SOLR-16716) (Kevin Risden)
- Consolidate DelegatedSolrQueryRequest and DelegatingSolrQueryRequest [SOLR-16745](https://issues.apache.org/jira/browse/SOLR-16745) (Kevin Risden)
- Added QueryResponseWriter benchmarks [SOLR-16841](https://issues.apache.org/jira/browse/SOLR-16841) (Alex Deparvu) (Tomás Fernández Löbbe)


[9.2.1] - 2023-05-01
--------------------

### Fixed (9 changes)

- Fix KerberosPlugin module classloading when using the hadoop-auth module. Plugins in modules/packages that require the Thread contextClassLoader on startup should now work. [SOLR-16240](https://issues.apache.org/jira/browse/SOLR-16240) (Houston Putman)
- Http2SolrClient.processErrorsAndResponse uses wrong instance of ResponseParser [SOLR-16649](https://issues.apache.org/jira/browse/SOLR-16649) (Andrzej Białecki)
- Java version detection fails when `_JAVA_OPTIONS` is set [SOLR-16721](https://issues.apache.org/jira/browse/SOLR-16721) (janhoy) (Ruoyu Zhong) (Andy Webb)
- Fix Classloading Exception for inter-node requests when using SSL and HTTP2. All Jetty classes are able to be shared between the Jetty server and webApp now. [SOLR-16728](https://issues.apache.org/jira/browse/SOLR-16728) (Houston Putman)
- Fix NPE in SystemInfoHandler for inter-node requests that would cause the Nodes page not to load. SystemInfoHandler no longer populates the username, roles and permissions in inter-node requests. [SOLR-16730](https://issues.apache.org/jira/browse/SOLR-16730) (Tomás Fernández Löbbe)
- Use the right cluster property for displaying if TLS is enabled [SOLR-16731](https://issues.apache.org/jira/browse/SOLR-16731) (Tomás Fernández Löbbe)
- SOLR_DATA_HOME is only honored in verbode mode [SOLR-16734](https://issues.apache.org/jira/browse/SOLR-16734) (Kevin Risden)
- CLUSTERSTATUS API returns wrong value for state ,leader for PRS collections [SOLR-16741](https://issues.apache.org/jira/browse/SOLR-16741) (noble)
- bin/solr's '-noprompt' option no longer works for examples [SOLR-16755](https://issues.apache.org/jira/browse/SOLR-16755) (hossman) (janhoy) (Houston Putman)

### Other (2 changes)

- Allow custom configuration of Jetty's SecureRequestCustomizer [SOLR-16735](https://issues.apache.org/jira/browse/SOLR-16735) (Tomás Fernández Löbbe)
- The Solr source release can now be built/checked using gradle. The solr-ref-guide tasks will not be included by default if the root directory is not a github repository. [SOLR-16747](https://issues.apache.org/jira/browse/SOLR-16747) (Houston Putman)


[9.2.0] - 2023-03-24
--------------------

### Added (9 changes)

- Admin UI - Expose all highlighting parameters in the Query UI [SOLR-16409](https://issues.apache.org/jira/browse/SOLR-16409) (Jeanie Lam) (Eric Pugh)
- Add Request timeout to Http2SolrClient [SOLR-16435](https://issues.apache.org/jira/browse/SOLR-16435) (Tomás Fernández Löbbe)
- QueryElevationComponent now supports fq exclusions [SOLR-16496](https://issues.apache.org/jira/browse/SOLR-16496) (Rudi Seitz) (David Smiley)
- Added --enable-preview for JDK 19 to enable MemorySegment support in MMapDirectory [SOLR-16500](https://issues.apache.org/jira/browse/SOLR-16500) (Kevin Risden)
- New OpenTelemetry (OTEL) module with OTLP/gRPC trace exporter. See ref.guide. [SOLR-16532](https://issues.apache.org/jira/browse/SOLR-16532) (janhoy) (David Smiley)
- Learning To Rank - Added support for null feature values in multiple additive trees models [SOLR-16596](https://issues.apache.org/jira/browse/SOLR-16596) (Anna Ruggero) (Alessandro Benedetti)
- Ability to compress state.json in Zookeeper [SOLR-16608](https://issues.apache.org/jira/browse/SOLR-16608) (Justin Sweeney) (noble)
- Add reRankOperator=multiply/replace options to rerank query parser [SOLR-16643](https://issues.apache.org/jira/browse/SOLR-16643) (Andy Webb) (Christine Poerschke) (Mikhail Khludnev)
- New function query operator isnan to verify if value is NaN [SOLR-16646](https://issues.apache.org/jira/browse/SOLR-16646) (Gabriel Magno) (Kevin Risden)

### Changed (41 changes)

- Introduce Builder setter withTheseParamNamesInTheUrl for queryParams, renaming them to urlParamNames to clarify they are parameter names, not the values. Deprecated direct setter setQueryParams and addQueryParams on SolrClients. [SOLR-10452](https://issues.apache.org/jira/browse/SOLR-10452) (Eric Pugh) (David Smiley) (Alex Deparvu)
- Introduce Builder setter for aliveCheckInterval on load balanced SolrClients. Deprecated direct setter setAliveCheckInterval on SolrClients. [SOLR-10461](https://issues.apache.org/jira/browse/SOLR-10461) (Eric Pugh) (David Smiley) (Alex Deparvu)
- Introduce Builder setter for pollQueueTime on ConcurrentUpdateHttp2SolrClient. Deprecated direct setter setPollQueueTime on ConcurrentUpdateHttp2SolrClient. [SOLR-10462](https://issues.apache.org/jira/browse/SOLR-10462) (Eric Pugh)
- Introduce Builder setter for retryExpiryTime on cloud SolrClients. Deprecated direct setter setRetryExpiryTime on cloud SolrClients. [SOLR-10463](https://issues.apache.org/jira/browse/SOLR-10463) (Eric Pugh)
- Introduce Builder setter for collectionCacheTtl on cloud SolrClients. Deprecated direct setter setCollectionCacheTTL on cloud SolrClients. [SOLR-10464](https://issues.apache.org/jira/browse/SOLR-10464) (Eric Pugh) (David Smiley)
- Introduce Builder setter for parallelCacheRefreshes on cloud SolrClients. Deprecated direct setter setParallelCacheRefreshes on cloud SolrClients. [SOLR-10470](https://issues.apache.org/jira/browse/SOLR-10470) (Eric Pugh) (David Smiley) (Alex Deparvu)
- A v2 equivalent of the `/admin/collections?action= REPLACE` command is now available at `POST /api/cluster/nodes/nodeName/replace`. [SOLR-11028](https://issues.apache.org/jira/browse/SOLR-11028) (Joshua Ouma) (Jason Gerlowski)
- A v2 equivalent of the `/admin/collections?action=DELETENODE` command is now available at `POST /api/cluster/nodes/nodeName/clear`. [SOLR-11029](https://issues.apache.org/jira/browse/SOLR-11029) (Bence Szabo) (Jason Gerlowski)
- Deprecate ContentStream in favour of RequestWriter.ContentWriter. [SOLR-11657](https://issues.apache.org/jira/browse/SOLR-11657) (Joshua Ouma) (Eric Pugh)
- Document the SystemInfoHandler in the Ref Guide. [SOLR-13626](https://issues.apache.org/jira/browse/SOLR-13626) (Tony Cook) (Eric Pugh)
- A v2 equivalent of the RENAME command is now available at `POST /api/collections/collName/rename`. [SOLR-15479](https://issues.apache.org/jira/browse/SOLR-15479) (Anakhe Ajayi) (Jason Gerlowski)
- Allow thread metrics to be cached [SOLR-15616](https://issues.apache.org/jira/browse/SOLR-15616) (Ishan Chattopadhyaya) (ab)
- queries to missing collection are slow [SOLR-15732](https://issues.apache.org/jira/browse/SOLR-15732) (noble)
- A v2 equivalent of CLUSTERSTATUS command is now available at `GET /api/cluster`. Collection listing, previously at this path, can still be accessed at `GET /api/collections`. [SOLR-15748](https://issues.apache.org/jira/browse/SOLR-15748) (Joshua Ouma) (Jason Gerlowski)
- More visible security warnings in Admin UI [SOLR-15772](https://issues.apache.org/jira/browse/SOLR-15772) (janhoy)
- FileSystemConfigSetService: implement the abstraction completely. It could be useful for putting ConfigSets on a shared file system. [SOLR-15787](https://issues.apache.org/jira/browse/SOLR-15787) (Nazerke Seidan) (David Smiley)
- Certain Jetty "server" jars (jetty-util, jetty-io, etc.) are no longer duplicated between server/lib and WEB-INF/lib. All shared jars now live in server/lib/ext. By default, Jetty does not allow these jars to be shared by the Jetty server and the web-app (Solr). In order to accomplish this, explicit exclusions have been added to server/contexts/solr-jetty-context.xml that allow these "server" jars to be shared. Solr Core also no longer contains the JettySolrRunner (now living in the testing framework), removing the need for Jetty Server dependencies in solr-core. [SOLR-16158](https://issues.apache.org/jira/browse/SOLR-16158) (Houston Putman)
- WARN when restoring backup if ConfigSet with same name already exists [SOLR-16302](https://issues.apache.org/jira/browse/SOLR-16302) (Albert Moser) (Kevin Risden)
- A number of v2 "replica" endpoints have been updated to be more REST-ful, and hopefully, intuitive. ADDREPLICAPROP is now `PUT /api/collections/$coll/shards/$shard/replicas/$rep/properties/$prop {"value": $val}` DELETEREPLICAPROP is now `DELETE /api/collections/$coll/shards/$shard/replicas/$rep/properties/$prop` [SOLR-16392](https://issues.apache.org/jira/browse/SOLR-16392) 
- The path of the v2 "list alias" API has been tweaked slightly to be more intuitive, and is now available at `GET /api/aliases`. It is also now possible to request information about a specific alias at `GET /api/aliases/&lt;aliasName&gt;`. [SOLR-16393](https://issues.apache.org/jira/browse/SOLR-16393) (Alex Deparvu) (Jason Gerlowski)
- /mlt now has a v2 API available at `GET /api/collections/collName/mlt` [SOLR-16397](https://issues.apache.org/jira/browse/SOLR-16397) (Ameer Albahem) (Jason Gerlowski)
- Introducing `{!mlt_content}foo bar` to cover existing `/mlt` handler functionality for SolrCloud. [SOLR-16420](https://issues.apache.org/jira/browse/SOLR-16420) (Mikhail Khludnev)
- IgnoreLargeDocumentProcessorFactory now supports a "permissive" mode, where it logs and skips offending documents but doesn't short-circuit the entire batch or return a 4xx error. This mode can be enabled by setting the `permissiveMode` boolean option to `true` in your solrconfig.xml's IgnoreLargeDocumentProcessorFactory declaration. [SOLR-16428](https://issues.apache.org/jira/browse/SOLR-16428) (Jason Gerlowski)
- v2 equivalents of the "Core Admin" `LISTSNAPSHOT`, `CREATESNAPSHOT`, and `DELETESNAPSHOT` commands are now available at `GET /api/cores/coreName/snapshots`, `POST /api/cores/coreName/snapshots/snapshotName`, and `DELETE /api/cores/coreName/snapshots/snapshotName`, respectively [SOLR-16462](https://issues.apache.org/jira/browse/SOLR-16462) (John Durham) (Jason Gerlowski)
- Make the default replica placement plugin configurable as system property on startup [SOLR-16475](https://issues.apache.org/jira/browse/SOLR-16475) (janhoy)
- Replication pooling is optimized based on hard and soft commit settings for a given collection [SOLR-16487](https://issues.apache.org/jira/browse/SOLR-16487) (Justin Sweeney)
- The paths of the v2 "ZooKeeper read" APIs have been tweaked slightly to be more intuitive. "get node data" is now available at `GET /api/cluster/zookeeper/data/&lt;path&gt;`, and "list node children" is now available at `GET /api/cluster/zookeeper/children/&lt;path&gt;` [SOLR-16488](https://issues.apache.org/jira/browse/SOLR-16488) (Jason Gerlowski) (Joshua Ouma)
- Remove synchronized access to cachedOrdMaps in SlowCompositeReaderWrapper [SOLR-16515](https://issues.apache.org/jira/browse/SOLR-16515) (Dennis Berger) (Torsten Bøgh Köster) (Marco Petris)
- SolrIndexSearcher - FilterCache intersections/andNot should not clone bitsets repeatedly [SOLR-16555](https://issues.apache.org/jira/browse/SOLR-16555) (Kevin Risden) (David Smiley)
- posting the same file to the package store should not throw an error [SOLR-16565](https://issues.apache.org/jira/browse/SOLR-16565) (noble)
- Standardize Builder method names on SolrClient's to use the with pattern, deprecating the use of set or bare property name. [SOLR-16590](https://issues.apache.org/jira/browse/SOLR-16590) (Eric Pugh)
- Standardize Builder methods handling of times to use require a TimeUnit to be passed in. Deprecated methods that do not specify a TimeUnit. [SOLR-16595](https://issues.apache.org/jira/browse/SOLR-16595) (Eric Pugh)
- Jersey 'ApplicationHandlers' are now shared by compatible cores where possible [SOLR-16615](https://issues.apache.org/jira/browse/SOLR-16615) (Jason Gerlowski) (Houston Putman)
- JWTAuthPlugin: Read trusted X509 certificates from multiple files [SOLR-16616](https://issues.apache.org/jira/browse/SOLR-16616) (janhoy)
- Admin UI Analysis page should include dynamic fields [SOLR-16618](https://issues.apache.org/jira/browse/SOLR-16618) (Alex Deparvu) (Eric Pugh)
- Resolve crypto keys file path in MiniSolrCloudCluster. This eliminates the need to set the system properties `pkiHandlerPublicKeyPath` and `pkiHandlerPrivateKeyPath` before starting MiniSolrCloudCluster when using the Solr test framework. [SOLR-16635](https://issues.apache.org/jira/browse/SOLR-16635) (Tomás Fernández Löbbe)
- The base docker image has been upgraded from Ubuntu 20 (Focal) to Ubuntu 22 (Jammy). [SOLR-16665](https://issues.apache.org/jira/browse/SOLR-16665) (Houston Putman)
- Avoiding commits on leader when recovering a non-leader replica and avoiding incorrectly replicating an empty core [SOLR-16689](https://issues.apache.org/jira/browse/SOLR-16689) (Justin Sweeney)
- SolrJ Cloud clients now correctly support isUpdatesToLeaders() being false. This behavior can also be configured per AbstractUpdateRequest instance. [SOLR-6312](https://issues.apache.org/jira/browse/SOLR-6312) (hossman)
- Java will now crash the Solr process on OOME and create a crash file that logs the cause. This capability is now also present on Windows. Before, with bin/solr but not bin/solr.cmd, Solr would execute a script that killed the Solr pid, leaving a very small time window where Solr would continue to execute in an unpredictable state. [SOLR-8803](https://issues.apache.org/jira/browse/SOLR-8803) (Shawn Heisey) (Kevin Risden)
- Introduce Builder setters for setters that exist on SolrClients for responseParser, requestWriter. Deprecated these SolrClient setters useMultiPartPost, and followRedirects. [SOLR-8975](https://issues.apache.org/jira/browse/SOLR-8975) (Eric Pugh) (David Smiley) (Kevin Risden)

### Fixed (33 changes)

- Fix followRedirect property on HttpSolrClient not set when using Builder pattern. [SOLR-10458](https://issues.apache.org/jira/browse/SOLR-10458) (Eric Pugh)
- Fix IntPointField hashing for HLL [SOLR-10918](https://issues.apache.org/jira/browse/SOLR-10918) (Houston Putman)
- Upgrade semver library to fix versioning constraint bugs in the PackageManager. [SOLR-15854](https://issues.apache.org/jira/browse/SOLR-15854) (Houston Putman) (Kevin Risden)
- UpdateXmlMessages duplicate data when data is removed and then added in the same message [SOLR-16160](https://issues.apache.org/jira/browse/SOLR-16160) (Alex Deparvu) (Kevin Risden)
- HEAD request for managed resource returns 500 Server Error [SOLR-16274](https://issues.apache.org/jira/browse/SOLR-16274) (Kevin Risden)
- Luke request fails for document with a binary field [SOLR-16293](https://issues.apache.org/jira/browse/SOLR-16293) (Kevin Risden)
- DirectUpdateHandler2 should not throw UnknownFormatConversionException [SOLR-16363](https://issues.apache.org/jira/browse/SOLR-16363) (Kevin Risden)
- Default for cloud mode was fixed to `{!mlt mindf=5}` to comply with Reference Guide [SOLR-16420](https://issues.apache.org/jira/browse/SOLR-16420) (Mikhail Khludnev)
- Fix "false positive" suggestions from DirectSolrSpellChecker when using maxQueryFrequency &gt; 1 in multi-shard collections [SOLR-16436](https://issues.apache.org/jira/browse/SOLR-16436) (hossman)
- Fix race condition in shard split when a sub-shard is put in recovery state. [SOLR-16473](https://issues.apache.org/jira/browse/SOLR-16473) (Andy Vuong) (Bruno Roustant)
- Collection RENAME api creates broken alias [SOLR-16477](https://issues.apache.org/jira/browse/SOLR-16477) (Alex Deparvu) (Kevin Risden)
- Fix IndexOutOfBounds in RecursiveNumericEvaluator [SOLR-16483](https://issues.apache.org/jira/browse/SOLR-16483) (Bendegúz Ács) (Kevin Risden)
- Jaegertracer module must include okhttp3 dependency [SOLR-16528](https://issues.apache.org/jira/browse/SOLR-16528) (janhoy)
- CPU percent calculation incorrect in admin UI cloud-&gt;nodes tab [SOLR-16605](https://issues.apache.org/jira/browse/SOLR-16605) (Shawn Heisey)
- NullPointerException occus when there are no segments in `{!collapse hint=top_fc}` [SOLR-16611](https://issues.apache.org/jira/browse/SOLR-16611) (Minami Takuya) (Mikhail Khludnev)
- CryptoKeys should handle RSA padding for OpenJ9 [SOLR-16613](https://issues.apache.org/jira/browse/SOLR-16613) (Kevin Risden)
- Admin UI fails to grant user permissions that have wildcard role [SOLR-16621](https://issues.apache.org/jira/browse/SOLR-16621) (janhoy)
- Ensure that InputStreams are closed after Xml parsing [SOLR-16628](https://issues.apache.org/jira/browse/SOLR-16628) (Michael Gibney) (David Smiley) (Kevin Risden)
- solr.allowUrls (former solr.shardsWhitelist) should treat hostnames in case insensitive way. [SOLR-16631](https://issues.apache.org/jira/browse/SOLR-16631) (Paul Blanchaert) (Eric Pugh)
- Fix jq parse error of solr-exporter metrics node_thread_pool_completed_total [SOLR-16639](https://issues.apache.org/jira/browse/SOLR-16639) (Naoto Minami)
- Fix circuit breaker examples in solrconfig.xml [SOLR-16647](https://issues.apache.org/jira/browse/SOLR-16647) (Colvin Cowie) (Kevin Risden)
- NullPointerException when excluding facets in More Like This Handler [SOLR-16648](https://issues.apache.org/jira/browse/SOLR-16648) (Mikhail Khludnev)
- sub-shard remains inactive after split for NRT+PULL collection [SOLR-16653](https://issues.apache.org/jira/browse/SOLR-16653) (Hitesh Khamesra) (noble)
- rid parameter missing from query logs [SOLR-16656](https://issues.apache.org/jira/browse/SOLR-16656) (Alex Deparvu)
- List of permissions returned to Admin UI is not complete [SOLR-16658](https://issues.apache.org/jira/browse/SOLR-16658) (janhoy)
- Use default to Java SSL for Http2SolrClient when none is provided [SOLR-16668](https://issues.apache.org/jira/browse/SOLR-16668) (Houston Putman)
- Http2SolrClient now defaults checkPeerName to True, as the documentation specified [SOLR-16669](https://issues.apache.org/jira/browse/SOLR-16669) (Houston Putman)
- Fix directory/file check in S3Repository [SOLR-16670](https://issues.apache.org/jira/browse/SOLR-16670) (Houston Putman) (Hakan Özler)
- Logs: Http2SolrClient.async() lacked MDC [SOLR-16676](https://issues.apache.org/jira/browse/SOLR-16676) (Alex Deparvu)
- Fix solr.jetty.ssl.verifyClientHostName logging [SOLR-16679](https://issues.apache.org/jira/browse/SOLR-16679) (Kevin Risden)
- MoreLikeThis Component fails with SyntaxError: Cannot parse if document terms contains symbols from query parser syntax [SOLR-16682](https://issues.apache.org/jira/browse/SOLR-16682) (Mikhail Khludnev)
- Using bin/solr to copy a file from ZK to local fails if the local filename does not have a path. [SOLR-16686](https://issues.apache.org/jira/browse/SOLR-16686) (Shawn Heisey)
- Fix start/stop wait time and RMI_PORT on Windows [SOLR-9698](https://issues.apache.org/jira/browse/SOLR-9698) (Colvin Cowie)

### Dependency Upgrades (38 changes)

- Upgrade forbiddenapis to 3.4 [PR#1052](https://github.com/apache/solr/pull/1052) (Uwe Schindler)
- Update dependency com.github.spotbugs:spotbugs-annotations to v4.7.3 [PR#1381](https://github.com/apache/solr/pull/1381) (solrbot)
- Update dependency com.lmax:disruptor to v3.4.4 [PR#1382](https://github.com/apache/solr/pull/1382) (solrbot)
- Update dependency io.swagger.core.v3:swagger-annotations to v2.2.8 [PR#1383](https://github.com/apache/solr/pull/1383) (solrbot)
- Update dependency net.thisptr:jackson-jq to v0.0.13 [PR#1387](https://github.com/apache/solr/pull/1387) (solrbot)
- Update dependency org.immutables:value-annotations to v2.9.3 [PR#1388](https://github.com/apache/solr/pull/1388) (solrbot)
- Update dependency org.xerial.snappy:snappy-java to v1.1.9.1 [PR#1390](https://github.com/apache/solr/pull/1390) (solrbot)
- Update io.dropwizard.metrics:* to v4.2.17 [PR#1391](https://github.com/apache/solr/pull/1391) (solrbot)
- Update org.apache.httpcomponents. httpclient v4.5.14, httpcore v4.4.16, httpmime v4.5.14 [PR#1393](https://github.com/apache/solr/pull/1393) (solrbot)
- Update org.apache.tika:* to v1.28.5 [PR#1394](https://github.com/apache/solr/pull/1394) (solrbot)
- Update org.apache.zookeeper:* to v3.8.1 [PR#1395](https://github.com/apache/solr/pull/1395) (solrbot)
- Update org.slf4j:* to v2.0.6 [PR#1396](https://github.com/apache/solr/pull/1396) (solrbot)
- Update dependency biz.aQute.bnd:biz.aQute.bnd.annotation to v6.4.0 [PR#1397](https://github.com/apache/solr/pull/1397) (solrbot)
- Update dependency com.fasterxml.woodstox:woodstox-core to v6.5.0 [PR#1398](https://github.com/apache/solr/pull/1398) (solrbot)
- Update dependency com.tdunning:t-digest to v3.3 [PR#1402](https://github.com/apache/solr/pull/1402) (solrbot)
- Update dependency commons-cli:commons-cli to v1.5.0 [PR#1403](https://github.com/apache/solr/pull/1403) (solrbot)
- Update dependency joda-time:joda-time to v2.12.2 [PR#1404](https://github.com/apache/solr/pull/1404) (solrbot)
- Update dependency net.sourceforge.argparse4j:argparse4j to v0.9.0 [PR#1406](https://github.com/apache/solr/pull/1406) (solrbot)
- Update dependency org.apache.commons:commons-compress to v1.22 [PR#1415](https://github.com/apache/solr/pull/1415) (solrbot)
- Update dependency org.bitbucket.b_c:jose4j to v0.9.3 [PR#1416](https://github.com/apache/solr/pull/1416) (solrbot)
- Update dependency org.openjdk.jmh:jmh-core to v1.36 [PR#1417](https://github.com/apache/solr/pull/1417) (solrbot)
- Update io.prometheus:* to v0.16.0 [PR#1419](https://github.com/apache/solr/pull/1419) (solrbot)
- Update org.apache.calcite:* to v1.33.0 and org.apache.calcite.avatica:* to v1.23.0 [PR#1420](https://github.com/apache/solr/pull/1420) (solrbot)
- Update org.apache.logging.log4j:* to v2.20.0 [PR#1421](https://github.com/apache/solr/pull/1421) (solrbot)
- Update dependency org.jctools:jctools-core to v4 [PR#1425](https://github.com/apache/solr/pull/1425) (solrbot)
- Upgrade to Jetty 10.x [SOLR-15955](https://issues.apache.org/jira/browse/SOLR-15955) (Mark Miller) (Kevin Risden)
- Upgrade the gradle wrapper to 7.6 [SOLR-16432](https://issues.apache.org/jira/browse/SOLR-16432) [SOLR-16508](https://issues.apache.org/jira/browse/SOLR-16508) (Shawn Heisey) (Kevin Risden)
- Upgrade to Lucene 9.4.2 [SOLR-16442](https://issues.apache.org/jira/browse/SOLR-16442) (Christine Poerschke)
- Upgrade semver4j to v4, fixes failures with some locales [SOLR-16467](https://issues.apache.org/jira/browse/SOLR-16467) [PR#1426](https://github.com/apache/solr/pull/1426) (Kevin Risden)
- Upgrade Bats to 1.8.0 [SOLR-16481](https://issues.apache.org/jira/browse/SOLR-16481) (Kevin Risden)
- Upgrade jaeger-client to 1.8.1 [SOLR-16529](https://issues.apache.org/jira/browse/SOLR-16529) (janhoy)
- Upgrade Carrot2 to 4.5.0 [SOLR-16545](https://issues.apache.org/jira/browse/SOLR-16545) (Dawid Weiss)
- Upgrade to Caffeine 3.1.5 [SOLR-16562](https://issues.apache.org/jira/browse/SOLR-16562) [PR#1433](https://github.com/apache/solr/pull/1433) (Kevin Risden)
- Upgrade to errorprone 2.18.0 [SOLR-16578](https://issues.apache.org/jira/browse/SOLR-16578) (Kevin Risden)
- Upgrade Jackson to 2.14.2 [SOLR-16579](https://issues.apache.org/jira/browse/SOLR-16579) [PR#1379](https://github.com/apache/solr/pull/1379) (Kevin Risden)
- Upgrade OWASP dependency check to 8.0.1 [SOLR-16625](https://issues.apache.org/jira/browse/SOLR-16625) (Kevin Risden)
- Upgrade to Netty v4.1.89.Final [SOLR-16626](https://issues.apache.org/jira/browse/SOLR-16626) [PR#1392](https://github.com/apache/solr/pull/1392) (Kevin Risden)
- Upgrade google-cloud-bom to v0.190.0, re2j to 1.7, and grpc to 1.53.0 [SOLR-16627](https://issues.apache.org/jira/browse/SOLR-16627) [PR#1399](https://github.com/apache/solr/pull/1399) [PR#1401](https://github.com/apache/solr/pull/1401) (Kevin Risden)

### Other (25 changes)

- Correct the initial capacity of the ZK operations to run in ShardLeaderElectionContextBase#runLeaderProcess [SOLR-13243](https://issues.apache.org/jira/browse/SOLR-13243) (Haythem Khiri)
- Warning about potentially old Solr version in Admin UI dashboard [SOLR-14336](https://issues.apache.org/jira/browse/SOLR-14336) (janhoy)
- Remove backcompat feature solr.useUnsafeOverseerResponse [SOLR-15718](https://issues.apache.org/jira/browse/SOLR-15718) (janhoy)
- Separate out a solrj-streaming module [SOLR-15733](https://issues.apache.org/jira/browse/SOLR-15733) (Joel Bernstein) (Kevin Risden)
- ConcurrentUpdateSolrClient should work with ManagedExecutorService [SOLR-15861](https://issues.apache.org/jira/browse/SOLR-15861) (Sammy Chu) (Kevin Risden)
- Dim 'Add Collection' and 'Create Alias' buttons when user lacks proper permissions [SOLR-15928](https://issues.apache.org/jira/browse/SOLR-15928) (janhoy)
- Deprecate loading of solr.xml from Zookeeper [SOLR-15959](https://issues.apache.org/jira/browse/SOLR-15959) (janhoy)
- Embedded ZK Server used for zkRun should advertise itself on specific bound interfaces instead of generically on localhost. [SOLR-16150](https://issues.apache.org/jira/browse/SOLR-16150) (Mike Drob)
- Remove commons-text dependency from solr-core [SOLR-16476](https://issues.apache.org/jira/browse/SOLR-16476) (Kevin Risden)
- Jaegertracer-Configurator is now deprecated. From v10.0 we'll only support OpenTelemetry [SOLR-16534](https://issues.apache.org/jira/browse/SOLR-16534) (janhoy)
- Eliminate the 'numShards' system property [SOLR-16541](https://issues.apache.org/jira/browse/SOLR-16541) (noble)
- Improve documentation on how to contribute to Solr [SOLR-16544](https://issues.apache.org/jira/browse/SOLR-16544) (Justin Sweeney)
- Add java system property to overseer queue size [SOLR-16569](https://issues.apache.org/jira/browse/SOLR-16569) (Nick Ginther) (noble)
- Introduce EmbeddedSolrServerTestRule, a JUnit 4 TestRule for Solr testing [SOLR-16573](https://issues.apache.org/jira/browse/SOLR-16573) (Joshua Ouma) (David Smiley)
- Demonstrate Dense Vectors and KNN as part of the Films example [SOLR-16574](https://issues.apache.org/jira/browse/SOLR-16574) (Gabriel Magno) (Eric Pugh)
- splitshard should honour createNodeSet [SOLR-16575](https://issues.apache.org/jira/browse/SOLR-16575) (noble)
- The "Transient Cores" feature is now deprecated. In solr.xml "&lt;transientCoreCacheFactory&gt;" no longer works; it wasn't documented either. Some internals were changed as well to simplify the standard case of having no transient cores. [SOLR-16591](https://issues.apache.org/jira/browse/SOLR-16591) (David Smiley)
- Remove Gradle Groovy version override [SOLR-16624](https://issues.apache.org/jira/browse/SOLR-16624) (Kevin Risden)
- Replace Solr thread safety annotations with JCIP. [SOLR-16629](https://issues.apache.org/jira/browse/SOLR-16629) (David Smiley)
- Add core name to periodic delete related log messages [SOLR-16632](https://issues.apache.org/jira/browse/SOLR-16632) (Bence Szabo) (Andras Salamon)
- Generate gradle.properties from gradlew, if absent [SOLR-16641](https://issues.apache.org/jira/browse/SOLR-16641) (Colvin Cowie)
- Deprecate analytics component [SOLR-16660](https://issues.apache.org/jira/browse/SOLR-16660) (janhoy)
- Simplify SolrCLI Healthcheck command's logic for obtaining a target collection [SOLR-16672](https://issues.apache.org/jira/browse/SOLR-16672) (Eric Pugh)
- Throw exception when attempting to replace uniqueKey via fl in distributed request, e.g. fl=old_id:id,id:new_id [SOLR-16681](https://issues.apache.org/jira/browse/SOLR-16681) (Mikhail Khludnev)
- Keep solr's opennlp-tools version in sync with Lucene [SOLR-16684](https://issues.apache.org/jira/browse/SOLR-16684) (janhoy)


[9.1.1] - 2023-01-25
--------------------

### Fixed (4 changes)

- Rare Deadlock in SlotAcc initialization [SOLR-16165](https://issues.apache.org/jira/browse/SOLR-16165) (Justin Sweeney) (noble)
- Fixed NPE when paginating MatchAllDocs with non-zero start offset, like q=*:*&start=10 [SOLR-16585](https://issues.apache.org/jira/browse/SOLR-16585) (Michael Gibney)
- Large fields with large=true can be truncated when using unicode values [SOLR-16589](https://issues.apache.org/jira/browse/SOLR-16589) (Kevin Risden)
- Replicas don't come up active after node restart [SOLR-16622](https://issues.apache.org/jira/browse/SOLR-16622) (noble) (Ishan Chattopadhyaya)

### Other (6 changes)

- Upgrade Jackson bom to 2.13.4.20221013 [SOLR-16443](https://issues.apache.org/jira/browse/SOLR-16443) (Kevin Risden)
- ConfigSets now have an overridable allow-list for filetypes. [SOLR-16480](https://issues.apache.org/jira/browse/SOLR-16480) (Houston Putman)
- Fixed problem with filtering and KNN search, especially when using post-filters [SOLR-16567](https://issues.apache.org/jira/browse/SOLR-16567) (Alessandro Benedetti)
- Upgrade woodstox-core to 6.4.0 [SOLR-16568](https://issues.apache.org/jira/browse/SOLR-16568) (Kira Traynor)
- Fixed problem with default knn algorithm [SOLR-16588](https://issues.apache.org/jira/browse/SOLR-16588) (Elia Porciani) (Alessandro Benedetti)
- Upgrade Protobuf to 3.21.12 [SOLR-16598](https://issues.apache.org/jira/browse/SOLR-16598) (David Smiley)


[9.1.0] - 2022-11-20
--------------------

### Added (10 changes)

- Add ability to specify replica types when creating collections in Admin UI. [SOLR-14319](https://issues.apache.org/jira/browse/SOLR-14319) (Richard Goodman) (Eric Pugh)
- Add ability to roll up core level metrics to be node level metrics for a RequestHandler via configuration. [SOLR-15007](https://issues.apache.org/jira/browse/SOLR-15007) (Justin Sweeney) (David Smiley)
- Dedicated query coordinator nodes in the solr cluster [SOLR-15715](https://issues.apache.org/jira/browse/SOLR-15715) (noble) (Hitesh Khamesra) (Ishan Chattopadhyaya)
- Admin UI support for managing Paramsets and using in Queries. [SOLR-15853](https://issues.apache.org/jira/browse/SOLR-15853) (Betul Ince) (Eric Pugh)
- Load jars in &lt;solr-install-dir&gt;/lib/ by default [SOLR-15921](https://issues.apache.org/jira/browse/SOLR-15921) (janhoy)
- Support add/update/delete field types in Admin UI Schema page. [SOLR-16005](https://issues.apache.org/jira/browse/SOLR-16005) (Ahmet Can Kepenek) (Eric Pugh)
- Support createNodeSet parameter when creating collections in Admin UI. [SOLR-16096](https://issues.apache.org/jira/browse/SOLR-16096) (Eric Pugh)
- Add hl.queryFieldPattern support, an advanced alternative to the hl.requireFieldMatch boolean flag. [SOLR-16111](https://issues.apache.org/jira/browse/SOLR-16111) (Christine Poerschke) (David Smiley)
- Introduced pre-filtering in KnnQParser [SOLR-16246](https://issues.apache.org/jira/browse/SOLR-16246) (Elia Porciani) (Alessandro Benedetti)
- CoreAdminHandler supports custom actions via solr.xml configuration. [SOLR-16282](https://issues.apache.org/jira/browse/SOLR-16282) (Artem Abeleshev) (Christine Poerschke)

### Changed (25 changes)

- Optimize DocList creation for sort-irrelevant cases. This issue also reworks the building and caching of liveDocs in SolrIndexSearcher, and refines/clarifies the effect of `useFilterForSortedQuery` [SOLR-14765](https://issues.apache.org/jira/browse/SOLR-14765) (Michael Gibney) (Mike Drob) (David Smiley)
- `DistributedZkUpdateProcessor` now issues commits to local shards and remote shards in parallel, halving the latency of synchronous commits [SOLR-15045](https://issues.apache.org/jira/browse/SOLR-15045) (Michael Gibney)
- Add Slack channel for community support to Admin UI footer, update links. [SOLR-15652](https://issues.apache.org/jira/browse/SOLR-15652) (Eric Pugh)
- CommitUpdateCommand and SplitIndexCommand can write user commit metadata. [SOLR-15986](https://issues.apache.org/jira/browse/SOLR-15986) (Bruno Roustant)
- Avoid redundant `FilterQuery` caching, e.g. via `filter($query)` syntax. [SOLR-16002](https://issues.apache.org/jira/browse/SOLR-16002) (Michael Gibney) (David Smiley)
- Optimise hl.fl expansion. [SOLR-16120](https://issues.apache.org/jira/browse/SOLR-16120) (Christine Poerschke) (David Smiley) (Mike Drob)
- Avoid loading all collections during node startup [SOLR-16146](https://issues.apache.org/jira/browse/SOLR-16146) (noble)
- Initialize the LogWatcher earlier in CoreContainer#load() [SOLR-16181](https://issues.apache.org/jira/browse/SOLR-16181) (janhoy)
- Add ZK credentials injectors support [SOLR-16192](https://issues.apache.org/jira/browse/SOLR-16192) (Lamine Idjeraoui with review by Anshum Gupta) (Jason Gerlowski) (Mike Drob and Houston Putman)
- Upgrade dependencies (Carrot2, HPPC) [SOLR-16225](https://issues.apache.org/jira/browse/SOLR-16225) (Dawid Weiss)
- JWT nested roles support [SOLR-16230](https://issues.apache.org/jira/browse/SOLR-16230) (Marco Descher) (janhoy)
- Improve ZkStateReader to avoid race condition between collectionWatches and watchedCollectionStates [SOLR-16257](https://issues.apache.org/jira/browse/SOLR-16257) (Patson Luk) (Houston Putman) (Mike Drob)
- Eliminate unneccessary byte[] copy in Http2SolrClient [SOLR-16266](https://issues.apache.org/jira/browse/SOLR-16266) (hossman)
- The Docker image now uses the Solr User ID instead of the User Name, helps with non-root checks [SOLR-16323](https://issues.apache.org/jira/browse/SOLR-16323) (Houston Putman)
- intern() strings in DocCollection to reduce memory footprint [SOLR-16328](https://issues.apache.org/jira/browse/SOLR-16328) (noble)
- avoid fetching solrconfig.xml & schema.xml for already cached schema and config [SOLR-16336](https://issues.apache.org/jira/browse/SOLR-16336) (noble)
- implement Zk metrics [SOLR-16337](https://issues.apache.org/jira/browse/SOLR-16337) (noble)
- Provide a cluster_id label for all metrics exposed by the Solr Prometheus Exporter, making it possible to filter Grafana board by cluster [SOLR-16340](https://issues.apache.org/jira/browse/SOLR-16340) (janhoy) (Houston Putman)
- Make SplitShardCmd#checkDiskSpace disableable through a system property. [SOLR-16353](https://issues.apache.org/jira/browse/SOLR-16353) (Haythem Khiri)
- mod() is now accurate for all integers, floats, doubles and longs upto 2^52 [SOLR-16361](https://issues.apache.org/jira/browse/SOLR-16361) (Dan Rosher) (Eric Pugh)
- Logs: Truncate field values in logs if a doc fails to index. [SOLR-16362](https://issues.apache.org/jira/browse/SOLR-16362) (Nazerke Seidan) (David Smiley)
- Prometheus Exporter: Use HTTP2 Solr clients. [SOLR-16404](https://issues.apache.org/jira/browse/SOLR-16404) (Houston Putman)
- The s3-repository module now supports AWS STS, and therefore Web Identity Tokens, by default. [SOLR-16429](https://issues.apache.org/jira/browse/SOLR-16429) (Josh Souza) (Houston Putman)
- Leader message should only be sent when there is more than one (NRT+Tlog) replica [SOLR-16445](https://issues.apache.org/jira/browse/SOLR-16445) (Hitesh Khamesra) (noble) (Ishan Chattopadhyaya)
- Enable warming queries to be managed using Config API [SOLR-9359](https://issues.apache.org/jira/browse/SOLR-9359) (Andy Webb) (Eric Pugh)

### Fixed (45 changes)

- Fix NPE during core close racing with index replication check. [SOLR-13044](https://issues.apache.org/jira/browse/SOLR-13044) (David Smiley) (hossman)
- Fix NPE in FieldLengthFeature with non-stored/missing fields [SOLR-13219](https://issues.apache.org/jira/browse/SOLR-13219) (Nick Veenhof) (Tomasz Elendt)
- Fix continuously growing TLOGs on TLOG replicas [SOLR-14679](https://issues.apache.org/jira/browse/SOLR-14679) (Viktor Molnár) (Houston Putman)
- Support a HEAD request for managed resources. [SOLR-15116](https://issues.apache.org/jira/browse/SOLR-15116) (Eric Pugh)
- Concurrent core reloads mess up commits when using Schema API [SOLR-15830](https://issues.apache.org/jira/browse/SOLR-15830) (Bence Szabo) (Andras Salamon)
- Skip repetitive parent znode creation on config set upload [SOLR-15918](https://issues.apache.org/jira/browse/SOLR-15918) (Mike Drob)
- Transient cores: don't evict a core when it's still being used. [SOLR-15964](https://issues.apache.org/jira/browse/SOLR-15964) (David Smiley)
- Fix empty columns in Cloud Node UI Screen when replica is in down state. [SOLR-16089](https://issues.apache.org/jira/browse/SOLR-16089) (hossman)
- Using Schema/Config API breaks the File-Upload of Config Set File [SOLR-16110](https://issues.apache.org/jira/browse/SOLR-16110) (Steffen Moldenhauer) (Kevin Risden)
- DefaultSolrHighlighter.doHighlighting to Query#rewrite multiple times if necessary. [SOLR-16112](https://issues.apache.org/jira/browse/SOLR-16112) (Christine Poerschke)
- Fix Admin UI's spatial parameter generation. [SOLR-16142](https://issues.apache.org/jira/browse/SOLR-16142) (Arsal Jalib) (Christine Poerschke)
- Fix very rare NPE in SolrCloud rejoinOverseerElection. [SOLR-16145](https://issues.apache.org/jira/browse/SOLR-16145) (David Smiley)
- Spellcheck NPE if invalid dictionary name is provided [SOLR-16168](https://issues.apache.org/jira/browse/SOLR-16168) (Kevin Risden)
- IndexBasedSpellChecker with empty spellcheck.q results in NegativeArraySizeException [SOLR-16169](https://issues.apache.org/jira/browse/SOLR-16169) (Kevin Risden)
- failOnVersionConflicts option not working for in-place updates [SOLR-16218](https://issues.apache.org/jira/browse/SOLR-16218) (Lamine Idjeraoui)
- ICUCollationField protected field IllegalAccessException from different classloader [SOLR-16219](https://issues.apache.org/jira/browse/SOLR-16219) (Michael Gibney)
- Http2SolrClient aborts requests on exception [SOLR-16229](https://issues.apache.org/jira/browse/SOLR-16229) (Daniel Rabus) (Tomás Fernández Löbbe)
- Fix EnvVar usage in bin/solr [SOLR-16232](https://issues.apache.org/jira/browse/SOLR-16232) (Houston Putman)
- Fix JettyConfig.builder(JettyConfig) to correctly copy all attributes [SOLR-16241](https://issues.apache.org/jira/browse/SOLR-16241) (hossman)
- Missing newline at the end of solr.in.sh breaks the installer. [SOLR-16259](https://issues.apache.org/jira/browse/SOLR-16259) (John Gately) (Shawn Heisey)
- Fix debugQuery clicking on the Query UI does not show the debug.explain.structured option. [SOLR-16316](https://issues.apache.org/jira/browse/SOLR-16316) (Shiming Li) (Eric Pugh)
- Handle MDC snapshot being null [SOLR-16343](https://issues.apache.org/jira/browse/SOLR-16343) (Dee Moore) (Kevin Risden)
- PlacementPlugin throws NPE for PRS collections [SOLR-16344](https://issues.apache.org/jira/browse/SOLR-16344) (noble)
- CaffeineCache ramBytes incorrect accounting on updates and deletes [SOLR-16357](https://issues.apache.org/jira/browse/SOLR-16357) (Alex Deparvu)
- ExportWriter fails with max values for fields [SOLR-16399](https://issues.apache.org/jira/browse/SOLR-16399) (Kevin Risden)
- Take SOLR_MODULES, configured by solr.in.sh, into account. [SOLR-16406](https://issues.apache.org/jira/browse/SOLR-16406) (Thomas Wöckinger) (janhoy)
- Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup [SOLR-16412](https://issues.apache.org/jira/browse/SOLR-16412) (Patson Luk) (noble)
- Race condition in PRS state updates [SOLR-16414](https://issues.apache.org/jira/browse/SOLR-16414) (noble) (Justin Sweeney) (Patson Luk) (Hitesh Khamesra) (Ishan Chattopadhyaya)
- OverseerPrioritizer now runs after all handlers are registered, and retries on failures. [SOLR-16416](https://issues.apache.org/jira/browse/SOLR-16416) (Houston Putman)
- NPE if facet query hits timeout or exception [SOLR-16417](https://issues.apache.org/jira/browse/SOLR-16417) (Kevin Risden)
- Introduce SolrResponseUtil to handle NPE during query timeout or exception when parsing SolrResponse [SOLR-16418](https://issues.apache.org/jira/browse/SOLR-16418) (Kevin Risden)
- LBHttp2SolrClient (and therefore CloudHttp2SolrClient) now respect requestWriter, responseParser and queryParam changes [SOLR-16426](https://issues.apache.org/jira/browse/SOLR-16426) (Houston Putman)
- Security Manager prevents Solr SQL from working [SOLR-16433](https://issues.apache.org/jira/browse/SOLR-16433) (Kevin Risden)
- Cloud Node does not have Core, the admin UI cannot be displayed properly. [SOLR-16439](https://issues.apache.org/jira/browse/SOLR-16439) (Shiming Li)
- RefreshCollectionMessage in PRS should update Overseer's ZkStateWriter [SOLR-16440](https://issues.apache.org/jira/browse/SOLR-16440) (noble) (Ishan Chattopadhyaya)
- Overseer doesn't handle PRS and non-PRS messages properly [SOLR-16453](https://issues.apache.org/jira/browse/SOLR-16453) (Justin Sweeney) (Hitesh Khamesra)
- solr.data.home should not be set to empty string in bin/solr [SOLR-16457](https://issues.apache.org/jira/browse/SOLR-16457) (Kevin Risden)
- ClusterState.copyWith is inconsistent [SOLR-16460](https://issues.apache.org/jira/browse/SOLR-16460) (noble)
- Workaround for serious crash on JDK17+ due to JIT on caffeinecache [SOLR-16463](https://issues.apache.org/jira/browse/SOLR-16463) (janhoy) (Uwe Schindler)
- removing a replica should delete the PRS entry from the hostnode and not from overseer [SOLR-16478](https://issues.apache.org/jira/browse/SOLR-16478) (Patson Luk) (noble)
- Fix NPE in ShardHandlerFactory when running in Standalone mode [SOLR-16485](https://issues.apache.org/jira/browse/SOLR-16485) (Houston Putman)
- Multiple CopyField should not limit to first maxChars [SOLR-16502](https://issues.apache.org/jira/browse/SOLR-16502) (Fredrik Rodland) (Kevin Risden)
- RuleBasedAuthorizationPluginBase NPE [SOLR-16527](https://issues.apache.org/jira/browse/SOLR-16527) (Alex Deparvu)
- MoreLikeThisHandler to support facets [SOLR-7883](https://issues.apache.org/jira/browse/SOLR-7883) (Mikhail Khludnev)
- Fix explanation of select() streaming expression that uses replace() operation [SOLR-9661](https://issues.apache.org/jira/browse/SOLR-9661) (Ahmet Can Kepenek) (Eric Pugh)

### Other (43 changes)

- SolrJ: Split ZooKeeper based dependencies off to a solr-solrj-zookeeper module / dependency. [SOLR-15342](https://issues.apache.org/jira/browse/SOLR-15342) (David Smiley) (Haythem Khiri)
- Admin UI is now aware of logged-in user's permissions and can adapt accordingly [SOLR-15776](https://issues.apache.org/jira/browse/SOLR-15776) (janhoy)
- Remove deprecated showItems configuration value from solrconfig.xml files [SOLR-15886](https://issues.apache.org/jira/browse/SOLR-15886) (Andy Lester) (Eric Pugh)
- Remove &lt;jmx/&gt; from all unit test solrconfig.xml files. [SOLR-15897](https://issues.apache.org/jira/browse/SOLR-15897) (Eric Pugh)
- Cue users in 404 message that Solr is running and the url is incorrect. [SOLR-15923](https://issues.apache.org/jira/browse/SOLR-15923) (Eric Pugh) (Mike Drob) (Shawn Heisey)
- Upgrade to errorprone 2.11.0 [SOLR-16050](https://issues.apache.org/jira/browse/SOLR-16050) (Kevin Risden)
- Upgrade scriptDepVersions [SOLR-16053](https://issues.apache.org/jira/browse/SOLR-16053) (Kevin Risden)
- SolrZooKeeper has been removed in favor of using ZooKeeper directly. [SOLR-16114](https://issues.apache.org/jira/browse/SOLR-16114) (Mike Drob)
- Upgrade Apache Tika to 1.28.4 [SOLR-16141](https://issues.apache.org/jira/browse/SOLR-16141) (janhoy)
- Event listeners submit through core container executor service instead of separate thread [SOLR-16154](https://issues.apache.org/jira/browse/SOLR-16154) (Mike Drob) (Kevin Risden)
- Http2SolrClient should make sure to shutdown the executor [SOLR-16190](https://issues.apache.org/jira/browse/SOLR-16190) (Kevin Risden)
- Validate that installed ps utility supports -p flag, so that we do not inadvertantly stop the wrong process. [SOLR-16191](https://issues.apache.org/jira/browse/SOLR-16191) (Mike Drob) (Michael Gibney)
- Change Lucene dependency to Lucene 9.1.0 [SOLR-16204](https://issues.apache.org/jira/browse/SOLR-16204) (Elia Porciani) (Alessandro Benedetti)
- Rolling restart will no longer trigger as much PKI Plugin error logging. [SOLR-16209](https://issues.apache.org/jira/browse/SOLR-16209) (Mike Drob) (Tomás Fernández Löbbe)
- Upgrade Jackson to 2.13.3 [SOLR-16213](https://issues.apache.org/jira/browse/SOLR-16213) (janhoy)
- Fix ref-guide links across the codebase [SOLR-16231](https://issues.apache.org/jira/browse/SOLR-16231) (Houston Putman)
- Make DenseVectorField codec agnostic [SOLR-16245](https://issues.apache.org/jira/browse/SOLR-16245) (Elia Porciani) (Alessandro Benedetti)
- Gradle no longer uses "errorprone" by default [SOLR-16258](https://issues.apache.org/jira/browse/SOLR-16258) (Dawid Weiss) (Uwe Schindler) (hossman)
- Set versions for all Antora build tools [SOLR-16264](https://issues.apache.org/jira/browse/SOLR-16264) (Houston Putman)
- XmlConfigFile and QueryElevationComponent now use SafeXMLParsing. [SOLR-16296](https://issues.apache.org/jira/browse/SOLR-16296) (Haythem Khiri)
- Clean the javadocs directory before building [SOLR-16298](https://issues.apache.org/jira/browse/SOLR-16298) (Houston Putman) (Mike Drob) (Uwe Schindler)
- Ref-guide examples are no longer symlinked from SolrJ, they live in the ref-guide module [SOLR-16299](https://issues.apache.org/jira/browse/SOLR-16299) (Houston Putman)
- Change Lucene dependency to Lucene 9.3.0 [SOLR-16303](https://issues.apache.org/jira/browse/SOLR-16303) (Mike Drob)
- No more @Slow annotation for tests! [SOLR-16304](https://issues.apache.org/jira/browse/SOLR-16304) (Mike Drob)
- Upgrade commons-configuration2 to 2.8.0 and commons-text to 1.8 [SOLR-16324](https://issues.apache.org/jira/browse/SOLR-16324) (Kevin Risden)
- Migrate remaining managed-schema files to be managed-schema.xml. [SOLR-16331](https://issues.apache.org/jira/browse/SOLR-16331) (Eric Pugh)
- Upgrade Jetty to 9.4.48.v20220622 [SOLR-16332](https://issues.apache.org/jira/browse/SOLR-16332) (Chris Sabelstrom) (janhoy)
- Refined "no servers hosting shard" SolrException wording. [SOLR-16339](https://issues.apache.org/jira/browse/SOLR-16339) (Christine Poerschke)
- Upgrade Carrot2 to 4.4.3, upgrade randomizedtesting to 2.8.0. [SOLR-16351](https://issues.apache.org/jira/browse/SOLR-16351) (Dawid Weiss)
- Avoid XPath in parsing elevate.xml [SOLR-16369](https://issues.apache.org/jira/browse/SOLR-16369) (Haythem Khiri)
- Bump google-cloud-bom to 0.178.0 [SOLR-16402](https://issues.apache.org/jira/browse/SOLR-16402) (Kevin Risden)
- Upgrade Apache Calcite to 1.32.0 and Avatica to 1.22.0 [SOLR-16421](https://issues.apache.org/jira/browse/SOLR-16421) (Kevin Risden)
- Upgrade Apache Zookeeper to 3.8.0 [SOLR-16422](https://issues.apache.org/jira/browse/SOLR-16422) (Kevin Risden)
- Upgrade Apache Hadoop to 3.3.4 [SOLR-16423](https://issues.apache.org/jira/browse/SOLR-16423) (Kevin Risden)
- Upgrade Netty to 4.1.82.Final [SOLR-16424](https://issues.apache.org/jira/browse/SOLR-16424) (Kevin Risden)
- Proper handling on watcher registration failure in ZkStateReader#waitForState() [SOLR-16450](https://issues.apache.org/jira/browse/SOLR-16450) (Hitesh Khamesra) (Ishan Chattopadhyaya)
- Don't fetch the PRS states while registering the collection watch [SOLR-16451](https://issues.apache.org/jira/browse/SOLR-16451) (Hitesh Khamesra) (Ishan Chattopadhyaya)
- Do not update PRS states if local version is newer [SOLR-16452](https://issues.apache.org/jira/browse/SOLR-16452) (Hitesh Khamesra) (noble)
- Upgrade commons-text to 1.10.0 [SOLR-16464](https://issues.apache.org/jira/browse/SOLR-16464) (Kevin Risden)
- Add an internal envVar for passing options to bin/solr that will not be overriden by the user. [SOLR-16482](https://issues.apache.org/jira/browse/SOLR-16482) (Houston Putman)
- Pin the OS Variant for the default base image of the Dockerfile (to Ubuntu 20). [SOLR-16486](https://issues.apache.org/jira/browse/SOLR-16486) (Houston Putman) (janhoy) (Eva Müller)
- Consistency in how dynamic fields are defined in sample schema.xml files [SOLR-9529](https://issues.apache.org/jira/browse/SOLR-9529) (Eric Pugh) (Trey Grainger)
- Upgrade forbiddenapis to 3.3 (Uwe Schindler)


[9.0.0] - 2022-05-12
--------------------

### Added (17 changes)

- Rate Limiting in Solr [SOLR-13528](https://issues.apache.org/jira/browse/SOLR-13528) (Atri Sharma) (Mike Drob)
- Move Hadoop Authentication support to a new hadoop-auth module [SOLR-13989](https://issues.apache.org/jira/browse/SOLR-13989) (Kevin Risden)
- Introduce new Certificate Authentication Plugin to load Principal from certificate subject. [SOLR-14440](https://issues.apache.org/jira/browse/SOLR-14440) (Mike Drob)
- Autoscaling replacement using placement plugins [SOLR-14613](https://issues.apache.org/jira/browse/SOLR-14613) [SOLR-15019](https://issues.apache.org/jira/browse/SOLR-15019) (ilan) (ab) (noble)
- Provide a clean API for cluster-level event processing. Improve support for arbitrary container-level plugins. Add ClusterSingleton support for plugins that require only one active instance in the cluster. [SOLR-14749](https://issues.apache.org/jira/browse/SOLR-14749) (ab) (noble)
- Payload check query parser now supports inequalities. [SOLR-14787](https://issues.apache.org/jira/browse/SOLR-14787) (Kevin Watters) (Gus Heck)
- Re-implement 'withCollection'. This also adds the placement plugin support for rejecting replica / collection deletions that would violate placement constraints. [SOLR-15055](https://issues.apache.org/jira/browse/SOLR-15055) (ab) (ilan)
- Support for per-collection replica placement node sets, a.k.a "node type" placements. [SOLR-15130](https://issues.apache.org/jira/browse/SOLR-15130) (ab) (ilan)
- Implement Task Management Interface [SOLR-15164](https://issues.apache.org/jira/browse/SOLR-15164) (Atri Sharma) (with extensive review and perf testing by Anshum Gupta) (Mike Drob and Houston Putman)
- Support temporal graph queries with DAY and WEEKDAY windows [SOLR-15197](https://issues.apache.org/jira/browse/SOLR-15197) (Joel Bernstein)
- Report collection and shard "health" state in CLUSTERSTATUS response. [SOLR-15300](https://issues.apache.org/jira/browse/SOLR-15300) (ab) (janhoy)
- JWTAuthPlugin now supports separate config for what SSL certs to trust when talking to IdPs [SOLR-15423](https://issues.apache.org/jira/browse/SOLR-15423) (janhoy)
- Node roles framework, allowing restriction of certain nodes to certain tasks [SOLR-15694](https://issues.apache.org/jira/browse/SOLR-15694) (Ishan Chattopadhyaya) (noble)
- Introduce support for k nearest neighbors search [SOLR-15880](https://issues.apache.org/jira/browse/SOLR-15880) (Alessandro Benedetti) (Elia Porciani)
- Move SQL support to new sql module [SOLR-15904](https://issues.apache.org/jira/browse/SOLR-15904) (Kevin Risden)
- Official Solr modules (contribs) can now easily be added to shared class path by environment variable 'SOLR_MODULES' or system property 'solr.modules'. E.g: SOLR_MODULES=extracting,langid [SOLR-15914](https://issues.apache.org/jira/browse/SOLR-15914) (janhoy) (David Smiley) (Houston Putman)
- Simple UI for issuing SQL queries [SOLR-8138](https://issues.apache.org/jira/browse/SOLR-8138) (Michael Suzuki) (Eric Pugh)

### Changed (68 changes)

- MoreLikeThis MLT is biased for uncommon fields [LUCENE-8984](https://issues.apache.org/jira/browse/LUCENE-8984) (Andy Hind) (Anshum Gupta)
- Highlighting (hl.method=unified): When there are no highlights for a field, don't return the field in the response at all. [SOLR-10321](https://issues.apache.org/jira/browse/SOLR-10321) (David Smiley)
- Add short-name feature to RuleBasedAuthz plugin [SOLR-10814](https://issues.apache.org/jira/browse/SOLR-10814) (Mike Drob) (Hrishikesh Gadre)
- Migrate "managed-schema" file naming to "managed-schema.xml" file name, with a fallback to the legacy "managed-schema". [SOLR-10887](https://issues.apache.org/jira/browse/SOLR-10887) (Eric Pugh) (David Smiley)
- Every request handler in Solr now implements PermissionNameProvider to explicitly decide on what security permissions are required to access the handler [SOLR-11623](https://issues.apache.org/jira/browse/SOLR-11623) (janhoy) (Hrishikesh Gadre) (David Smiley)
- Use corrected sample formula for computing stdDev and variance in JSON aggregations [SOLR-11725](https://issues.apache.org/jira/browse/SOLR-11725) (hossman) (Munendra S N) (yonik)
- New Admin UI Query screen input boxes for JSON query and facet DSL [SOLR-11905](https://issues.apache.org/jira/browse/SOLR-11905) (janhoy)
- SolrJ and the server can now recognize some standard Java system properties like for an HTTP proxy. This is only for the Apache HttpClient based SolrJ communication, not Jetty. [SOLR-12848](https://issues.apache.org/jira/browse/SOLR-12848) (Shawn Heisey) (David Smiley)
- Added DocSet.iterator(LeafReaderContext) and some related changes that may add a minor performance boost to some cases (e.g. interval facets). Reduced need for Filter.java. [SOLR-14185](https://issues.apache.org/jira/browse/SOLR-14185) (Michael Gibney) (David Smiley)
- PKI Auth can bootstrap from existing key files instead of creating new keys on startup [SOLR-14223](https://issues.apache.org/jira/browse/SOLR-14223) (Mike Drob)
- SolrClient.getById() will escape comma separator within ids [SOLR-14387](https://issues.apache.org/jira/browse/SOLR-14387) (Markus Schuch) (Mike Drob)
- Metrics: Only SearchHandler and subclasses have "local" metrics now. It's now tracked as if it's another handler with a "[shard]" suffix, e.g. "/select[shard]". There are no longer ".distrib." named metrics; all metrics are assumed to be such except "[shard]". The default Prometheus exporter config splits that component to a new label named "internal". The sample Grafana dashboard now filters to include or exclude this. [SOLR-14401](https://issues.apache.org/jira/browse/SOLR-14401) (David Smiley)
- Faster sorting for the /export handler [SOLR-14608](https://issues.apache.org/jira/browse/SOLR-14608) (Joel Bernstein)
- Logs: Removed the "[corename]" prefix of some SolrCore logs that has become redundant with MDC. [SOLR-14686](https://issues.apache.org/jira/browse/SOLR-14686) (David Smiley)
- JWT authentication plugin only requires "sub" claim when principalClaim=sub. [SOLR-14799](https://issues.apache.org/jira/browse/SOLR-14799) (Erik Hatcher)
- Report solr.xml's coreRootDirectory property via System Settings API, when set [SOLR-14878](https://issues.apache.org/jira/browse/SOLR-14878) (Alexandre Rafalovitch)
- Support coreRootDirectory setting when creating new cores from command line in standalone mode [SOLR-14880](https://issues.apache.org/jira/browse/SOLR-14880) (Alexandre Rafalovitch)
- Add split parameter to timeseries Streaming Expression [SOLR-14916](https://issues.apache.org/jira/browse/SOLR-14916) (Joel Bernstein)
- Modernize and clean up search results clustering module. This issue upgrades the clustering module to the new Carrot2 4.x line, dropping several CVE-prone dependencies along the way. The parameters and configuration of the module extensions have changed. The documentation in Solr ref guide has been rewritten from scratch to be up to date. Clustering code has been rewritten from scratch to work properly regardless of the mode (standalone, distributed). The API has been stripped of ancient, unused, interfaces and simplified. [SOLR-14926](https://issues.apache.org/jira/browse/SOLR-14926) [SOLR-13506](https://issues.apache.org/jira/browse/SOLR-13506) (Dawid Weiss)
- Prometheus: Change default port of prometheus exporter to 8989 because it clashed with default embedded zookeeper port [SOLR-14972](https://issues.apache.org/jira/browse/SOLR-14972) (janhoy)
- /admin/logging handler will now propagate setLevel (log threshold) to all nodes when told to. The admin UI now tells it to. [SOLR-15011](https://issues.apache.org/jira/browse/SOLR-15011) (Nazerke Seidan) (David Smiley)
- When indexing nested docs via JSON, it is no longer necessary to provide child doc IDs. This was already working for XML & "javabin"/SolrJ. Previously, omitting the ID would be confused for a partial/atomic update. [SOLR-15044](https://issues.apache.org/jira/browse/SOLR-15044) (David Smiley)
- Make the ConfigSetService pluggable/configurable via &lt;string name="configSetService" /&gt; in solr.xml [SOLR-15100](https://issues.apache.org/jira/browse/SOLR-15100) (baisui)
- Admin UI: Collection selector drop down does not sort collections [SOLR-15153](https://issues.apache.org/jira/browse/SOLR-15153) (Edward Ribeiro)
- Don't encourage users to hack JSON response mimetype by documenting in examples how to specify wt=json use mimetype of text/plain. [SOLR-15161](https://issues.apache.org/jira/browse/SOLR-15161) (Eric Pugh)
- Various optimizations to the {!hash} QParser, typically used by the parallel() streaming expression. The hash algorithm changed. [SOLR-15185](https://issues.apache.org/jira/browse/SOLR-15185) (David Smiley)
- The old LegacyAssignStrategy has been refactored into the SimplePlacementPlugin. This is still the default placement policy for Solr. [SOLR-15209](https://issues.apache.org/jira/browse/SOLR-15209) (Houston Putman) (Ilan Ginzburg)
- Atomic updates: "add" now uses add-or-replace logic for child documents. They can also themselves be atomic updates. [SOLR-15213](https://issues.apache.org/jira/browse/SOLR-15213) (James Ashbourne) (Endika Posadas) (David Smiley)
- Replace DocSet.getTopFilter with DocSet.makeQuery. Create DocSetQuery which is a Query and DocSetProducer. [SOLR-15257](https://issues.apache.org/jira/browse/SOLR-15257) (Collins Abanda) (Mike Drob) (Tim Potter) (David Smiley) (Michael Gibney)
- The QueryElevationComponent now supports loading elevation file changes on commits. This doesn't work in SolrCloud (but may someday). QEC no longer supports a config file in the data dir. [SOLR-15274](https://issues.apache.org/jira/browse/SOLR-15274) (David Smiley)
- V2 API call to look up async request status restful style of "/cluster/command-status/1000" instead of "/cluster/command-status?requestid=1000". [SOLR-15276](https://issues.apache.org/jira/browse/SOLR-15276) (Eric Pugh)
- Add V2 equivalent to allow deleting async collection list of statuses. [SOLR-15278](https://issues.apache.org/jira/browse/SOLR-15278) (Eric Pugh)
- A brand new follower in the legacy mode should wait to replicate index before reporting healthy [SOLR-15286](https://issues.apache.org/jira/browse/SOLR-15286) (Pushkar Raste) (Anshum Gupta)
- Eliminate repetitive index size calculation for Solr metrics [SOLR-15301](https://issues.apache.org/jira/browse/SOLR-15301) (Andras Salamon)
- Fix typos in the code base [SOLR-15327](https://issues.apache.org/jira/browse/SOLR-15327) (Edward Ribeiro) (Eric Pugh)
- Improve HDFS Directory size calculation [SOLR-15329](https://issues.apache.org/jira/browse/SOLR-15329) (Andras Salamon) (Mike Drob)
- Rename shardsWhitelist and extract AllowListUrlChecker to use it more broadly. [SOLR-15340](https://issues.apache.org/jira/browse/SOLR-15340) (Bruno Roustant)
- Let core and collection dropdowns in Admin UI float wide to see entire core or collection name. [SOLR-15362](https://issues.apache.org/jira/browse/SOLR-15362) (Matthias Krepp) (Eric Pugh)
- Accept "Long" values for CollectionAdminRequest.CreateTimeRoutedAlias.setMaxFutureMs to support durations greater than ~ 25 days. [SOLR-15376](https://issues.apache.org/jira/browse/SOLR-15376) (Nahian-Al Hasan) (Gus Heck) (Christine Poerschke)
- Distributed Tracing request span operation names are now composed of a command/verb and a templated path. The collection or core name is now in the db.instance tag. [SOLR-15392](https://issues.apache.org/jira/browse/SOLR-15392) (David Smiley)
- Use ConfigSet API instead of Zookeeper data node to list out configsets available in Solr Admin UI. [SOLR-15414](https://issues.apache.org/jira/browse/SOLR-15414) (Nazerke Seidan) (Eric Pugh)
- ConfigSet API also checks for solrconfig.xml when checking the existence of a configset [SOLR-15421](https://issues.apache.org/jira/browse/SOLR-15421) (Andras Salamon) (David Smiley)
- Nested docs: [child limit=...] now defaults to -1 which is interpreted as unlimited. [SOLR-15427](https://issues.apache.org/jira/browse/SOLR-15427) (David Smiley)
- Update the content security policy in Jetty to allow image requests from local host and prevent security errors on the client side. [SOLR-15453](https://issues.apache.org/jira/browse/SOLR-15453) (MarcusSorealheis) (Houston Putman)
- Migrate the Ref Guide to be built with Antora, enabling many new features [SOLR-15556](https://issues.apache.org/jira/browse/SOLR-15556) (Cassandra Targett) (Houston Putman) (Mike Drob)
- Start CoreContainer via ServletContextListener [SOLR-15590](https://issues.apache.org/jira/browse/SOLR-15590) (Gus Heck)
- Add kerberos.name.rules.mechanism support to KerberosPlugin [SOLR-15617](https://issues.apache.org/jira/browse/SOLR-15617) (Kevin Risden)
- Logging MDC values no longer include a hardcoded prefix, allowing custom logging configurations access to the plain values. The default log4j2.xml PatternLayout has been updated to ensure the values are formatted with the existing prefixes. [SOLR-15630](https://issues.apache.org/jira/browse/SOLR-15630) (hossman)
- Choosing lucene defType in Solr Admin now is passed explicitly through UI, not relying on default solrconfig.xml behavior. [SOLR-15650](https://issues.apache.org/jira/browse/SOLR-15650) (Eric Pugh)
- A delete-by-id command is forwarded to all shards when using the CompositeId router with a router field and the route is missing from the command. [SOLR-15705](https://issues.apache.org/jira/browse/SOLR-15705) (Michael Kosten) (Christine Poerschke) (David Smiley) (Eric Pugh)
- Parse collection, shard, core, replica info from newSearcher events in postlogs tool [SOLR-15755](https://issues.apache.org/jira/browse/SOLR-15755) (Joel Bernstein)
- Custom node request handlers/endpoints that weren't in packages can now be located in JARs in solr-home/lib, not just WEB-INF/lib. [SOLR-15785](https://issues.apache.org/jira/browse/SOLR-15785) (Nazerke Seidan) (David Smiley)
- Add the "films" example to SolrCLI via -e films parameter. [SOLR-15786](https://issues.apache.org/jira/browse/SOLR-15786) (Eric Pugh)
- SearchHandler now includes the `rid` value in the Logging MDC for the duration of the request, allowing custom logging configurations to include it. [SOLR-15790](https://issues.apache.org/jira/browse/SOLR-15790) (hossman)
- Compute concurrent replica assignment requests together, using the shared context to better distribute replicas. [SOLR-15803](https://issues.apache.org/jira/browse/SOLR-15803) (Houston Putman)
- Improved Query Screen handling of raw query parameters. [SOLR-15824](https://issues.apache.org/jira/browse/SOLR-15824) (Betul Ince) (Tim Potter) (Eric Pugh)
- Films example readme needs updating, including useParams support for multiple algorithms. [SOLR-15834](https://issues.apache.org/jira/browse/SOLR-15834) (Eric Pugh)
- Backup responses now use a map to return information instead of a list [SOLR-15884](https://issues.apache.org/jira/browse/SOLR-15884) (Houston Putman) (Christine Poerschke)
- Remove &lt;jmx/&gt; from shipped solrconfig.xml. [SOLR-15887](https://issues.apache.org/jira/browse/SOLR-15887) (Eric Pugh)
- Add a limit to the Admin SQL panel if one is not included in the stmt [SOLR-15890](https://issues.apache.org/jira/browse/SOLR-15890) (Joel Bernstein)
- Use better signatures for the PKI Authentication plugin. [SOLR-15965](https://issues.apache.org/jira/browse/SOLR-15965) (Mike Drob)
- Add end time value to backup response, standardize backup response key names and date formats [SOLR-15982](https://issues.apache.org/jira/browse/SOLR-15982) (Artem Abeleshev) (Christine Poerschke) (Houston Putman)
- De-couple Http2SolrClient and ContentStreamBase from org.apache.http [SOLR-16088](https://issues.apache.org/jira/browse/SOLR-16088) (janhoy)
- Jetty threads' contextClassLoaders are set to the Solr core's resourceLoader's classLoader. This allows for custom plugins and Solr modules to rely on 3rd part dependencies that use the thread contextClassLoader. [SOLR-16131](https://issues.apache.org/jira/browse/SOLR-16131) (Houston Putman)
- SolrJ: remove Woodstox dependency. It was never truly required there. Software doing lots of XML processing can choose to add it or alternatives if they wish. [SOLR-2852](https://issues.apache.org/jira/browse/SOLR-2852) (David Smiley)
- Introduce support to identify Solr internal request types [SOLR-7683](https://issues.apache.org/jira/browse/SOLR-7683) (Atri Sharma) (Hrishikesh Gadre)
- Raw value DocTransformers (`[xml]`, `[json]`, `[geo w=GeoJSON]`) now work in a distributed/SolrCloud context [SOLR-9376](https://issues.apache.org/jira/browse/SOLR-9376) (Michael Gibney)
- Solr no longer requires a solr.xml to be present in $SOLR_HOME. If one is not found, Solr will load the one in $SOLR_TIP/server/solr/solr.xml. Solr also does not require a zoo.cfg in $SOLR_HOME if started with embedded zookeeper. [SOLR-9575](https://issues.apache.org/jira/browse/SOLR-9575) (janhoy)

### Fixed (31 changes)

- Solr UI Health Check enable/disable ping Button doesn't work [SOLR-10529](https://issues.apache.org/jira/browse/SOLR-10529) (Oscar Wang) (janhoy)
- Fix for a relatively hard to hit issue in OverseerTaskProcessor that could lead to out of order execution of Collection API tasks competing for a lock [SOLR-14546](https://issues.apache.org/jira/browse/SOLR-14546) (Ilan Ginzburg)
- Consistent overrequest across different facet methods for `sort:index` JSON Facet field [SOLR-14595](https://issues.apache.org/jira/browse/SOLR-14595) (Michael Gibney) (hossman)
- Removed many unused classes that accumulated over the years. [SOLR-14781](https://issues.apache.org/jira/browse/SOLR-14781) (Bence Szabo) (David Smiley)
- Allow readOnly parameter to be used with v2 modify collection command [SOLR-15162](https://issues.apache.org/jira/browse/SOLR-15162) (Eric Pugh)
- hl.fragAlignRatio now defaults to 0.33 to be faster and maybe looks nicer. [SOLR-15259](https://issues.apache.org/jira/browse/SOLR-15259) (David Smiley)
- Reduced spurious warn logging by AbstractSpatialPrefixTreeFieldType field properties [SOLR-15333](https://issues.apache.org/jira/browse/SOLR-15333) (Steffen Moldenhauer) (David Smiley) (Mike Drob)
- Return error response when failing auth in PKIAuthPlugin [SOLR-15334](https://issues.apache.org/jira/browse/SOLR-15334) (Mike Drob)
- Make HDFS handle little endian LUCENE-9047 [SOLR-15405](https://issues.apache.org/jira/browse/SOLR-15405) [LUCENE-9047](https://issues.apache.org/jira/browse/LUCENE-9047) (Kevin Risden)
- Always use -Xverbosegclog for OpenJ9. [SOLR-15410](https://issues.apache.org/jira/browse/SOLR-15410) (Colvin Cowie) (Eric Pugh)
- Edismax sow incorrectly affect mm parameter in multi field search [SOLR-15449](https://issues.apache.org/jira/browse/SOLR-15449) (Alessandro Benedetti) (Michael Gibney) (David Smiley)
- GCSBackupRepository no longer strictly requires a pointer to a service account JSON file, allowing users running within GCP to take advantage of it's "Workload Identity" and other role-based access feature. [SOLR-15501](https://issues.apache.org/jira/browse/SOLR-15501) (Jacek Kikiewicz) (Martin Stocker) (Jason Gerlowski)
- Don't wait for zombie processes to exit when stopping. [SOLR-15558](https://issues.apache.org/jira/browse/SOLR-15558) (Colvin Cowie)
- Fix collection creation race that assumes a local clusterstate when the collection has only just been created. [SOLR-15653](https://issues.apache.org/jira/browse/SOLR-15653) (Mark Miller)
- Prevent Logging MDC values from leaking between request threads, and set 'trace_id' in MDC as soon as it's available [SOLR-15783](https://issues.apache.org/jira/browse/SOLR-15783) (hossman)
- Async response for backups now correctly aggregates and returns information [SOLR-15842](https://issues.apache.org/jira/browse/SOLR-15842) (Houston Putman) (Artem Abeleshev) (Christine Poerschke)
- Fix the connection reset problem caused by the incorrect use of 4LW with \n when monitoring zooKeeper status [SOLR-15849](https://issues.apache.org/jira/browse/SOLR-15849) (Fa Ming)
- Let RealtimeGet component support negative filters [SOLR-15854](https://issues.apache.org/jira/browse/SOLR-15854) (Tomás Fernández Löbbe)
- Update Log4J to 2.17.1 [SOLR-15871](https://issues.apache.org/jira/browse/SOLR-15871) (weidongkl) (janhoy)
- Replace File with Path for many ZK operations [SOLR-15919](https://issues.apache.org/jira/browse/SOLR-15919) (Mike Drob)
- The Tagger's JSON response format now always uses an object/map to represent each tag instead of an array, which didn't make sense. [SOLR-15944](https://issues.apache.org/jira/browse/SOLR-15944) (David Smiley)
- Fix bug in PKIAuthenticationPlugin that can cause a request to fail with 401 Unauthorized instead of re-fetching expired remote keys from other nodes. [SOLR-15961](https://issues.apache.org/jira/browse/SOLR-15961) (Tomás Fernández Löbbe)
- Hide annoying WARN log from bin/solr zk command [SOLR-15968](https://issues.apache.org/jira/browse/SOLR-15968) (janhoy) (Mike Drob)
- Fix ClassCastException in UpdateLog$LogReplayer.doReplay. [SOLR-15983](https://issues.apache.org/jira/browse/SOLR-15983) (Christine Poerschke) (David Smiley)
- Force Calcite's Rel simplify config flag to false to avoid erasing filters that are meaningful to Solr, but look like nonsense to Calcite, such as AND'd filters on the same multi-valued field [SOLR-16009](https://issues.apache.org/jira/browse/SOLR-16009) (Timothy Potter) (Kiran Chitturi)
- UTF-8 parsing errors for parameters should cause a HTTP 400 status code, not 500 [SOLR-16019](https://issues.apache.org/jira/browse/SOLR-16019) (janhoy) (Matthias Pigulla)
- Enforce special character requirements on passwords with length less than 15 [SOLR-16022](https://issues.apache.org/jira/browse/SOLR-16022) (Timothy Potter)
- ShowFileHandler path parameter is now validated to be relative to instance conf dir in standalone mode [SOLR-16075](https://issues.apache.org/jira/browse/SOLR-16075) (janhoy)
- Better error message when JWT auth SIGNATURE_INVALID during token parsing [SOLR-16090](https://issues.apache.org/jira/browse/SOLR-16090) (janhoy)
- SolrConfig can miss updates from ZooKeeper when deleting and recreating file items [SOLR-16143](https://issues.apache.org/jira/browse/SOLR-16143) (Mike Drob)
- ConfigSet API returns error if untrusted user creates from _default configset [SOLR-16164](https://issues.apache.org/jira/browse/SOLR-16164) (Eric Pugh) (Kevin Risden)

### Removed (20 changes)

- Remove Filter, SolrFilter and SolrConstantScoreQuery. Filter no longer has a need to exist due to multiple JIRA issues, implemented by a number of issues. With Filter going away, there is no longer need for SolrConstantScoreQuery. [SOLR-12336](https://issues.apache.org/jira/browse/SOLR-12336) (Collins Abanda) (Mike Drob) (Tim Potter) (David Smiley) (Michael Gibney)
- Remove support for `autoReplicaFailoverWaitAfterExpiration`. [SOLR-12720](https://issues.apache.org/jira/browse/SOLR-12720) (marcussorealheis) (shalin)
- Remove /clusterstate.json support, including support for collections created with stateFormat=1, as well as support for Collection API MIGRATESTATEFORMAT action and support for the legacyCloud flag [SOLR-12823](https://issues.apache.org/jira/browse/SOLR-12823) (Ilan Ginzburg)
- Remove support for maxShardsPerNode. [SOLR-12847](https://issues.apache.org/jira/browse/SOLR-12847) (ab)
- Remove deprecated LegacyBM25SimilarityFactory class. [SOLR-13138](https://issues.apache.org/jira/browse/SOLR-13138) (Christine Poerschke) (janhoy)
- Remove support to read BlobRepository's max jar size from deprecated `runtme.lib.size` system property [SOLR-13893](https://issues.apache.org/jira/browse/SOLR-13893) (Erick Erickson) (Kesharee Nandan Vishwakarma) (Munendra S N)
- Remove deprecated min_rf references [SOLR-14034](https://issues.apache.org/jira/browse/SOLR-14034) (Tim Dillon)
- Remove deprecated preferLocalShards=true support in favour of the shards.preference=replica.location:local alternative. [SOLR-14035](https://issues.apache.org/jira/browse/SOLR-14035) (Alex Bulygin) (Christine Poerschke)
- SolrResourceLoader: remove deprecated methods and do other improvements. [SOLR-14197](https://issues.apache.org/jira/browse/SOLR-14197) (David Smiley)
- Remove ReplicaInfo. [SOLR-14244](https://issues.apache.org/jira/browse/SOLR-14244) (ab)
- Remove plugin loading from .system collection [SOLR-14654](https://issues.apache.org/jira/browse/SOLR-14654) (noble)
- Remove Data Import Handler (DIH), previously deprecated [SOLR-14783](https://issues.apache.org/jira/browse/SOLR-14783) (Alexandre Rafalovitch)
- Remove redundant deprecated "solr.solr.home" logic [SOLR-14934](https://issues.apache.org/jira/browse/SOLR-14934) (hossman)
- Remove the "spins" metrics - support for detection of spinning disks has been removed in LUCENE-9576. [SOLR-14944](https://issues.apache.org/jira/browse/SOLR-14944) [LUCENE-9576](https://issues.apache.org/jira/browse/LUCENE-9576) (ab)
- JWT Auth plugin: Remove deprecated parameter name jwkUrl in favour of jwksUrl for the JWK Url. [SOLR-15203](https://issues.apache.org/jira/browse/SOLR-15203) (Eric Pugh)
- Remove indexHeapUsageBytes info from /admin/segments and /admin/luke because it's no longer available in Lucene -- LUCENE-9387. [SOLR-15341](https://issues.apache.org/jira/browse/SOLR-15341) [LUCENE-9387](https://issues.apache.org/jira/browse/LUCENE-9387) (janhoy) (David Smiley)
- Remove metrics history collection (and MetricsHistoryHandler). [SOLR-15416](https://issues.apache.org/jira/browse/SOLR-15416) (ab)
- Remove deprecated methods, classes and constructors from solrj clients [SOLR-15608](https://issues.apache.org/jira/browse/SOLR-15608) (janhoy)
- Remove deprecated SolrException.ignorePatterns and related code [SOLR-15716](https://issues.apache.org/jira/browse/SOLR-15716) (hossman)
- The deprecated SolrjNamedThreadFactory has been removed. Use SolrNamedThreadFactory instead. [SOLR-9909](https://issues.apache.org/jira/browse/SOLR-9909) (Andras Salamon) (shalin)

### Other (124 changes)

- Support Gradle build, remove Ant support from trunk [LUCENE-9077](https://issues.apache.org/jira/browse/LUCENE-9077) [LUCENE-9433](https://issues.apache.org/jira/browse/LUCENE-9433) (Dawid Weiss) (Erick Erickson) (Uwe Schindler et.al.)
- Upgrade ICU4j to 62.2 and make regenerate work [LUCENE-9080](https://issues.apache.org/jira/browse/LUCENE-9080) (Erick Erickson)
- Upgrade Carrot2 to 3.16.2 [LUCENE-9092](https://issues.apache.org/jira/browse/LUCENE-9092) (Dawid Weiss)
- Upgrade HPPC to 0.8.2. [LUCENE-9391](https://issues.apache.org/jira/browse/LUCENE-9391) (Haoyu Zhai)
- Fail compilation on warnings, 9x gradle-only [LUCENE-9411](https://issues.apache.org/jira/browse/LUCENE-9411) (Erick Erickson) (Dawid Weiss)
- Consolidated CharStream and FastCharStream classes: these have been moved from each query parser package to org.apache.lucene.queryparser.charstream [LUCENE-9531](https://issues.apache.org/jira/browse/LUCENE-9531) (Dawid Weiss)
- Remove non-minified JavaScript from the webapp. [SOLR-10288](https://issues.apache.org/jira/browse/SOLR-10288) (Erik Hatcher) (marcussorealheis)
- ReplicationHandler should fetch index at fixed delay instead of fixed rate [SOLR-10370](https://issues.apache.org/jira/browse/SOLR-10370) (Cao Manh Dat)
- Move bin-test scripts to packaging project and create gradle task for running them. [SOLR-12228](https://issues.apache.org/jira/browse/SOLR-12228) (Mike Drob)
- Highlighting: hl.method=unified is the new default. [SOLR-12901](https://issues.apache.org/jira/browse/SOLR-12901) (David Smiley)
- Upgrade Collections.unModifiableSet to Set.of and Set.copyOf [SOLR-13655](https://issues.apache.org/jira/browse/SOLR-13655) (Atri Sharma) (Tomás Fernández Löbbe)
- Remove check for bare "var" declarations in validate-source-patterns [SOLR-13671](https://issues.apache.org/jira/browse/SOLR-13671) (Erick Erickson) (Alex Bulygin) (janhoy)
- SolrResourceLoader no longer caches bad results when asked for wrong type [SOLR-13797](https://issues.apache.org/jira/browse/SOLR-13797) (Mike Drob)
- Docker: Removed /var/solr initialization from the Dockerfile; depend on init_var_solr.sh instead. This leads to more consistent behavior no matter how /var/solr is mounted. * init_var_solr.sh is now invoked by docker-entrypoint.sh; not in a bunch of other places. * as before, you can set NO_INIT_VAR_SOLR=1 to short-circuit this. * init_var_solr.sh no longer echo's anything. For verbosity, set VERBOSE=yes. [SOLR-14001](https://issues.apache.org/jira/browse/SOLR-14001) (David Smiley)
- Return long value for unique and hll aggregations irrespective of shard count [SOLR-14012](https://issues.apache.org/jira/browse/SOLR-14012) (Munendra S N) (hossman)
- Introducing a system property that allows users to disable the Admin UI, which is enabled by default. If you have security concerns or other reasons to disable the Admin UI, you can modify `SOLR_ADMIN_UI_DISABLED` `solr.in.sh`/`solr.in.cmd` at start. [SOLR-14014](https://issues.apache.org/jira/browse/SOLR-14014) (marcussorealheis)
- Remove distrib=false from /terms handler's default parameters [SOLR-14036](https://issues.apache.org/jira/browse/SOLR-14036) (David Smiley) (Munendra S N)
- StatelessScriptUpdateProcessorFactory moved to it's own /module/scripting/ package instead of shipping as part of Solr due to security concerns. Renamed to ScriptUpdateProcessorFactory for simpler name. [SOLR-14067](https://issues.apache.org/jira/browse/SOLR-14067) (Eric Pugh)
- Jetty's RequestLog is enabled by default. If you don't want these logs, you can disable via SOLR_REQUESTLOG_ENABLED=false. [SOLR-14142](https://issues.apache.org/jira/browse/SOLR-14142) (rmuir) (janhoy)
- Non-cached filter queries are now pushed down to Lucene, possibly benefiting from TwoPhaseIterator, which can make a big difference for some queries. [SOLR-14166](https://issues.apache.org/jira/browse/SOLR-14166) (David Smiley)
- Remove HashDocSet; add DocSet.getBits() instead. DocSet is now strictly immutable and ascending order. It's now locked-down to external extension; only 2 impls exist. [SOLR-14256](https://issues.apache.org/jira/browse/SOLR-14256) (David Smiley)
- DocList no longer extends DocSet. [SOLR-14258](https://issues.apache.org/jira/browse/SOLR-14258) (David Smiley)
- Remove duplicate async id check meant for pre Solr 8 versions [SOLR-14271](https://issues.apache.org/jira/browse/SOLR-14271) (Anshum Gupta)
- Remove autoReplicaFailoverBadNodeExpiration and autoReplicaFailoverWorkLoopDelay for 9.0 as it was deprecated in 7.1 [SOLR-14272](https://issues.apache.org/jira/browse/SOLR-14272) (Anshum Gupta)
- Replace commons-codec Base64 with JDK11 Base64 [SOLR-14297](https://issues.apache.org/jira/browse/SOLR-14297) (Andras Salamon) (Houston Putman)
- AbstractFullDistribZkTestBase.waitForRecoveriesToFinish now takes a timeout and time unit instead of assuming that we are passed value in seconds. [SOLR-14322](https://issues.apache.org/jira/browse/SOLR-14322) (Mike Drob)
- SolrCloud: move the reference a collection has to a configSet in ZooKeeper from the collections/collectionName into its state.json. For many-collection clusters, this is an optimization when the cluster status is fetched. [SOLR-14341](https://issues.apache.org/jira/browse/SOLR-14341) (Nazerke Seidan) (David Smiley)
- Automatically set urlScheme to https when running secure solr with embedded zookeeper. (Mike Drob) Do not erroneously set solr.jetty.https.port system property when running in http mode [SOLR-14412](https://issues.apache.org/jira/browse/SOLR-14412) (Upendra Penegalapati)
- AuthenticationPlugin.authenticate accepts HttpServletRequest instead of ServletRequest. [SOLR-14420](https://issues.apache.org/jira/browse/SOLR-14420) (Mike Drob)
- Convert .txt files to properly formatted .md files. [SOLR-14429](https://issues.apache.org/jira/browse/SOLR-14429) (Tomoko Uchida) (Uwe Schindler)
- CDCR support removed [SOLR-14616](https://issues.apache.org/jira/browse/SOLR-14616) (Ishan Chattopadhyaya)
- Autoscaling framework removed [SOLR-14656](https://issues.apache.org/jira/browse/SOLR-14656) (Ishan Chattopadhyaya) (noble) (Ilan Ginzburg)
- Move HDFS support to a new HDFS module [SOLR-14660](https://issues.apache.org/jira/browse/SOLR-14660) (Istvan Farkas) (Kevin Risden)
- All references to "master" and "slave" replaced with "leader" and "follower" [SOLR-14702](https://issues.apache.org/jira/browse/SOLR-14702) (MarcusSorealheis) (Erick Erickson) (Tomás Fernández Löbbe)
- Migrate docker image creation from docker-solr repo to solr/docker. [SOLR-14789](https://issues.apache.org/jira/browse/SOLR-14789) (Houston Putman) (Martijn Koster) (Tim Potter) (David Smiley) (janhoy) (Mike Drob)
- Docker: Move Solr Docker image documentation to the ref guide. [SOLR-14790](https://issues.apache.org/jira/browse/SOLR-14790) (Houston Putman)
- Cleanup the documentation for Request Handlers and Search Components [SOLR-14829](https://issues.apache.org/jira/browse/SOLR-14829) (Alexandre Rafalovitch)
- Backup/Restore classes no longer take Optional method parameters and will accept nulls instead. [SOLR-14846](https://issues.apache.org/jira/browse/SOLR-14846) (Mike Drob)
- Add optional gradle property to run docker tests in parallel [SOLR-14857](https://issues.apache.org/jira/browse/SOLR-14857) (hossman) (Houston Putman)
- Add the server WEB-INF/lib directory to the classpath for the solr-exporter script. Will allow the script to work when the dist/solrj-lib jars are missing in the Docker image. [SOLR-14858](https://issues.apache.org/jira/browse/SOLR-14858) (Houston Putman)
- Clean up solr-extraction module to produce solr-extraction-* jar (instead of solr-cell-*). [SOLR-14912](https://issues.apache.org/jira/browse/SOLR-14912) (Dawid Weiss)
- Prometheus: Reduced dependencies from Solr server down to just SolrJ. Don't add WEB-INF/lib. * Can run via gradle, "gradlew run" * Has own log4j2.xml now * Was missing some dependencies in lib/; now has all except SolrJ & logging. [SOLR-14915](https://issues.apache.org/jira/browse/SOLR-14915) (David Smiley) (Houston Putman)
- Allow cluster state updates to be done in a distributed fashion without going through Overseer [SOLR-14928](https://issues.apache.org/jira/browse/SOLR-14928) (Ilan Ginzburg)
- Removed rule based replica placement [SOLR-14930](https://issues.apache.org/jira/browse/SOLR-14930) (noble)
- Docker: Ability to customize the FROM image when building. [SOLR-14949](https://issues.apache.org/jira/browse/SOLR-14949) (Houston Putman)
- Docker, Prometheus: Add Prometheus Exporter to docker PATH. Fix classpath issues. [SOLR-14957](https://issues.apache.org/jira/browse/SOLR-14957) (Houston Putman)
- Upgrade httpclient to 4.5.13 and httpcore to 4.4.13 [SOLR-15002](https://issues.apache.org/jira/browse/SOLR-15002) (Andras Salamon) (janhoy)
- Replica placement plugins should use container plugins API / configs. [SOLR-15016](https://issues.apache.org/jira/browse/SOLR-15016) (ab) (ilan)
- Atomic/partial updates to nested documents now _require_ the `\_root_` field to clearly show the document isn't a root document. Solr 8 would fallback on the `\_route_` param but no longer. [SOLR-15064](https://issues.apache.org/jira/browse/SOLR-15064) (David Smiley)
- Use JDK11 Base64 instead of own implementation [SOLR-15111](https://issues.apache.org/jira/browse/SOLR-15111) (Andras Salamon) (janhoy)
- Do not attempt to start Solr server when embedded ZK fails [SOLR-15113](https://issues.apache.org/jira/browse/SOLR-15113) (Mike Drob)
- Switch /v2/collections APIs over to the now-preferred annotated-POJO implementation approach [SOLR-15118](https://issues.apache.org/jira/browse/SOLR-15118) (Jason Gerlowski)
- Move XSLT (tr param) response writer and update request handler to scripting module. [SOLR-15121](https://issues.apache.org/jira/browse/SOLR-15121) (Eric Pugh) (David Smiley)
- Removed three core level admin API endpoints because they are already registered at the node level where they really belong: /admin/threads, /admin/properties, /admin/logging [SOLR-15124](https://issues.apache.org/jira/browse/SOLR-15124) (Nazerke Seidan) (David Smiley)
- Allow Collection API and Config Set API to be done in a distributed fashion without going through Overseer [SOLR-15146](https://issues.apache.org/jira/browse/SOLR-15146) (Ilan Ginzburg)
- SolrPaths.assertPathAllowed normalization problem [SOLR-15169](https://issues.apache.org/jira/browse/SOLR-15169) (Andras Salamon) (janhoy)
- userfiles dir will only be created in SolrCloud mode [SOLR-15222](https://issues.apache.org/jira/browse/SOLR-15222) (Mike Drob)
- SolrJ: The project is migrating away from the Apache HttpClient dependency in favor of Jetty's client (supporting HTTP/2), to occur over the 9x releases. We deprecated HttpSolrClient and friends in favor of Http2SolrClient and equivalents. For SolrCloud, the former CloudSolrClient was renamed CloudLegacySolrClient (deprecated), and instead BaseCloudSolrClient was renamed to CloudSolrClient and given a Builder for the Jetty based HTTP/2 client. [SOLR-15223](https://issues.apache.org/jira/browse/SOLR-15223) (janhoy) (David Smiley)
- Consolidate ConfigSet handling (C.R.U.D.) into ConfigSetService to allow for viable alternative implementations of where ConfigSets come from. [SOLR-15258](https://issues.apache.org/jira/browse/SOLR-15258) (Nazerke Seidan) (David Smiley)
- Fixed misleading error message in HdfsDirectoryFactory [SOLR-15280](https://issues.apache.org/jira/browse/SOLR-15280) (Andras Salamon) (janhoy)
- Overhaul distributed-tracing. Solr's "samplePercentage" is gone; tracing is either enabled and you always have trace IDs or it isn't, based on whether you configure a tracing plugin. Reporting of traces to a server like Zipkin is a configuration matter of the tracing plugin you use. The Jaeger plugin is now completely configurable via system properties or environment vars, not by values in solr.xml. [SOLR-15283](https://issues.apache.org/jira/browse/SOLR-15283) (David Smiley)
- SignatureUpdateProcessorFactory will fail to initialize if it is used in a SolrCloud cluster in a way that is known to be problematic with multiple replicas. [SOLR-15292](https://issues.apache.org/jira/browse/SOLR-15292) (hossman)
- Add missing IntelliJ IDEA entries to the .gitignore file [SOLR-15309](https://issues.apache.org/jira/browse/SOLR-15309) (Pushkar Raste) (Anshum Gupta)
- Solr releases now contain everything needed to build runnable docker images [SOLR-15322](https://issues.apache.org/jira/browse/SOLR-15322) (Houston Putman) (hossman)
- Docker: Solr has capability to build functionally-identical local and official Docker image. [SOLR-15335](https://issues.apache.org/jira/browse/SOLR-15335) (hossman) (Houston Putman)
- "mergeindexes" should not use UninvertingReader (FieldCache). [SOLR-15356](https://issues.apache.org/jira/browse/SOLR-15356) (David Smiley)
- UninvertDocValuesMergePolicy was removed because it's incompatible with Lucene 9. [SOLR-15356](https://issues.apache.org/jira/browse/SOLR-15356) (David Smiley) (Christine Poerschke)
- PackageStoreAPI will only be loaded in SolrCloud mode [SOLR-15369](https://issues.apache.org/jira/browse/SOLR-15369) (Mike Drob)
- Address many rawtypes warnings, resulting in several modified signatures in the public API. [SOLR-15385](https://issues.apache.org/jira/browse/SOLR-15385) [SOLR-15535](https://issues.apache.org/jira/browse/SOLR-15535) (Mike Drob) (David Smiley) (Christine Poerschke)
- Document the new NorwegianNormalizationFilter introduced in LUCENE-9929. [SOLR-15401](https://issues.apache.org/jira/browse/SOLR-15401) [LUCENE-9929](https://issues.apache.org/jira/browse/LUCENE-9929) (janhoy)
- Upgrade to Zookeeper 3.7.0 [SOLR-15409](https://issues.apache.org/jira/browse/SOLR-15409) (Mike Drob)
- Integrate the OpenJDK JMH micro benchmark framework for micro benchmarks and performance comparisons and investigation. [SOLR-15428](https://issues.apache.org/jira/browse/SOLR-15428) (Mark Miller)
- Upgrade jose4j library used for JWT authentication processing, to v0.7.7 [SOLR-15439](https://issues.apache.org/jira/browse/SOLR-15439) (janhoy)
- The binary distribution no longer contains test-framework jars [SOLR-15470](https://issues.apache.org/jira/browse/SOLR-15470) (janhoy)
- Rename lang id whitelist parameter to allowlist [SOLR-15471](https://issues.apache.org/jira/browse/SOLR-15471) (Mike Drob)
- Make Tuple copy constructor, clone and merge consistent w.r.t. markers (EOF, EXCEPTION), field names and labels. [SOLR-15480](https://issues.apache.org/jira/browse/SOLR-15480) (John Durham) (Mike Drob) (Christine Poerschke)
- Remove unnecessary no-op implementation of SolrCoreAware in ExpandComponent and TermVectorComponent. [SOLR-15517](https://issues.apache.org/jira/browse/SOLR-15517) (Christine Poerschke)
- Add an option to activate Gradle build cache, build task cleanups [SOLR-15603](https://issues.apache.org/jira/browse/SOLR-15603) (Alexis Tual) (Dawid Weiss)
- Rename (deprecated) Insanity.java to NumericHidingLeafReader.java adjusting callers to match. [SOLR-15606](https://issues.apache.org/jira/browse/SOLR-15606) (Christine Poerschke)
- Remove unnecessary https8 jetty module [SOLR-15612](https://issues.apache.org/jira/browse/SOLR-15612) (Houston Putman)
- Enforce error-prone checks to catch all URLEqualsHashCode violations and use java.net.URI instead [SOLR-15613](https://issues.apache.org/jira/browse/SOLR-15613) (Collins Abanda)
- Upgrade to Caffeine Cache 3.0.5 [SOLR-15632](https://issues.apache.org/jira/browse/SOLR-15632) (Mike Drob)
- Introduce Gradle parameter to skip ref-guide tasks [SOLR-15670](https://issues.apache.org/jira/browse/SOLR-15670) (Houston Putman) (Dawid Weiss)
- Fix parsing of -zkHost flag for the bin/solr commands [SOLR-15692](https://issues.apache.org/jira/browse/SOLR-15692) (janhoy)
- Removal of the (unused since 5.0) "updateHandler/indexWriter/closeWaitsForMerges" solrconfig.xml element. [SOLR-15699](https://issues.apache.org/jira/browse/SOLR-15699) (Christine Poerschke)
- Remove dead, unused log rotation code from SolrCLI [SOLR-15728](https://issues.apache.org/jira/browse/SOLR-15728) (janhoy)
- Forbid useDocValuesAsStored for ICUCollationField (warn for luceneMatchVersion &lt; 9.0.0). [SOLR-15777](https://issues.apache.org/jira/browse/SOLR-15777) (Michael Gibney)
- The v2 API is now treated as "experimental". It may change in backwards-incompatible ways in subsequent releases as it expands to cover additional functionality and prepares to supplant the v1 API. [SOLR-15780](https://issues.apache.org/jira/browse/SOLR-15780) (Jason Gerlowski)
- Remove SolrJ dependency on commons-io. [SOLR-15784](https://issues.apache.org/jira/browse/SOLR-15784) (Mike Drob)
- Remove remaining unused &lt;admin/&gt; clauses from solrconfigs. [SOLR-15791](https://issues.apache.org/jira/browse/SOLR-15791) (Eric Pugh)
- Pin http_parser.rb to specific version to allow Solr Ref Guide on Jekyll to run [SOLR-15793](https://issues.apache.org/jira/browse/SOLR-15793) (Eric Pugh)
- New LogListener class for tests to use to make assertions about what Log messages should or should not be produced by a test [SOLR-15807](https://issues.apache.org/jira/browse/SOLR-15807) (hossman)
- Get rid of blacklist/whitelist terminology JWTAuthPlugin parameter 'algWhitelist' is now 'algAllowlist' Environment variables SOLR_IP_WHITELIST and SOLR_IP_BLACKLIST are no longer supported, but replaced with SOLR_IP_ALLOWLIST and SOLR_IP_DENYLIST. [SOLR-15809](https://issues.apache.org/jira/browse/SOLR-15809) (janhoy)
- Add a new SolrVersion class to manage Solr's version independently from the Lucene version we consume [SOLR-15845](https://issues.apache.org/jira/browse/SOLR-15845) (janhoy)
- Update dev-tools/scripts for the 9.0 release, including releaseWizard [SOLR-15852](https://issues.apache.org/jira/browse/SOLR-15852) (janhoy)
- Make the gradle build ready for 9.0 release [SOLR-15867](https://issues.apache.org/jira/browse/SOLR-15867) (janhoy) (Houston Putman) (Dawid Weiss)
- The Solr Docker image uses the default file permissions from the tarball artifact [SOLR-15891](https://issues.apache.org/jira/browse/SOLR-15891) (Houston Putman) (janhoy)
- Move JWT Authentication plugin to module 'jwt-auth' [SOLR-15907](https://issues.apache.org/jira/browse/SOLR-15907) (janhoy)
- Upgrade guava to version 31.0.1-jre [SOLR-15912](https://issues.apache.org/jira/browse/SOLR-15912) (janhoy)
- Remove dist/ from the binary release. The solr-core and solrj jars will be included in the server WEB-INF/lib directory, and each individual module's jar will be included in its directory's lib/ folder. [SOLR-15916](https://issues.apache.org/jira/browse/SOLR-15916) (Houston Putman)
- "Contrib Modules" have been renamed to "Modules" and have been moved from "contrib/" to "modules/". [SOLR-15917](https://issues.apache.org/jira/browse/SOLR-15917) (Houston Putman)
- Remove lucene-libs from module packaging. The lucene libraries will be included in lib/ with all other dependencies. [SOLR-15924](https://issues.apache.org/jira/browse/SOLR-15924) (Houston Putman)
- CloseHook is now an interface with default method implementations instead of an abstract class. [SOLR-15934](https://issues.apache.org/jira/browse/SOLR-15934) (Mike Drob)
- Reduce unnecessary startup logging, such as SSL warnings when SSL not in use [SOLR-15936](https://issues.apache.org/jira/browse/SOLR-15936) (janhoy)
- Upgrade Hadoop to 3.3.1 [SOLR-15942](https://issues.apache.org/jira/browse/SOLR-15942) (Kevin Risden)
- Simplify HDFS cache to account for LUCENE-10366 / LUCENE-10376 [SOLR-15943](https://issues.apache.org/jira/browse/SOLR-15943) [LUCENE-10366](https://issues.apache.org/jira/browse/LUCENE-10366) [LUCENE-10376](https://issues.apache.org/jira/browse/LUCENE-10376) (Kevin Risden)
- Docker: the official image now uses Java 17 provided by Eclipse Temurin. Formerly it was Java 11 from OpenJDK. [SOLR-15949](https://issues.apache.org/jira/browse/SOLR-15949) (janhoy) (David Smiley)
- Create SOLR_HOME/filestore lazily on first use. Do not automatically create SOLR_HOME/userfiles [SOLR-15950](https://issues.apache.org/jira/browse/SOLR-15950) (janhoy)
- Remove unused LTRThreadModule.preClose CloseHook logic. [SOLR-15953](https://issues.apache.org/jira/browse/SOLR-15953) (Christine Poerschke)
- Move the Prometheus Exporter from "solr/modules/prometheus-exporter" to "solr/prometheus-exporter". [SOLR-15954](https://issues.apache.org/jira/browse/SOLR-15954) (Houston Putman)
- Add port and scraping information to Solr Prometheus startup logging. [SOLR-15957](https://issues.apache.org/jira/browse/SOLR-15957) (Houston Putman)
- Ensure all used dependencies are declared [SOLR-15984](https://issues.apache.org/jira/browse/SOLR-15984) (Kevin Risden)
- Upgrade slf4j to 1.7.35 and remove ant-compat/force-versions.gradle [SOLR-15987](https://issues.apache.org/jira/browse/SOLR-15987) (Kevin Risden)
- Upgrade to Tika 1.28.1 [SOLR-15989](https://issues.apache.org/jira/browse/SOLR-15989) (Kevin Risden)
- Use google-cloud-bom for gcs-repository dependencies [SOLR-15990](https://issues.apache.org/jira/browse/SOLR-15990) (Kevin Risden)
- analysis-extras module tests shouldn't rely on log4j dependency [SOLR-15991](https://issues.apache.org/jira/browse/SOLR-15991) (Kevin Risden)
- Globally forbid and exclude known bad dependencies [SOLR-15992](https://issues.apache.org/jira/browse/SOLR-15992) (Kevin Risden)
- Upgrade to Hadoop 3.3.2 [SOLR-16039](https://issues.apache.org/jira/browse/SOLR-16039) (Kevin Risden)
- Fix TestSolrCloudWithKerberosAlt.testBasics failure due to minikdc locale [SOLR-16042](https://issues.apache.org/jira/browse/SOLR-16042) (Kevin Risden)
- Fix HDFS tests - "Command processor" thread leak [SOLR-16043](https://issues.apache.org/jira/browse/SOLR-16043) (Mike Drob) (Kevin Risden)
- CloudSolrClient refactoring: Removed ZK specific methods [SOLR-16061](https://issues.apache.org/jira/browse/SOLR-16061) (Haythem Khiri) (David Smiley) (janhoy)
- Use PathUtils.deleteDirectory(path) to try to avoid commons-io IO-751 [SOLR-16074](https://issues.apache.org/jira/browse/SOLR-16074) (Houston Putman) (Mike Drob) (Kevin Risden)
- Add empty constructor for SolrInputDocument [SOLR-16101](https://issues.apache.org/jira/browse/SOLR-16101) (Anshum Gupta)
- Remove /terms configuration from solrconfig.xml, as implicit definition is up-to-par now [SOLR-9607](https://issues.apache.org/jira/browse/SOLR-9607) (Alexandre Rafalovitch)


[8.11.4] - 2024-09-24
---------------------

### Fixed (3 changes)

- Add netty-transport-classes-epoll dependency [SOLR-17168](https://issues.apache.org/jira/browse/SOLR-17168) (Colvin Cowie)
- Remove unnecessary code in PKIAuthPlugin and HttpSolrCall [SOLR-17417](https://issues.apache.org/jira/browse/SOLR-17417) (Houston Putman) (janhoy) (Liu Huajin)
- Streamline ConfigSet modification logic. [SOLR-17418](https://issues.apache.org/jira/browse/SOLR-17418) (Houston Putman) (Liu Huajin)


[8.11.3] - 2024-02-08
---------------------

### Added (1 change)

- 15715: Node roles and dedicated query coordinator nodes [SOLR-15694](https://issues.apache.org/jira/browse/SOLR-15694) (Hitesh Khamesra) (Ishan Chattopadhyaya) (noble)

### Changed (2 changes)

- SolrIndexSearcher - FilterCache intersections/andNot should not clone bitsets repeatedly [SOLR-16555](https://issues.apache.org/jira/browse/SOLR-16555) (Kevin Risden) (David Smiley)
- ZkStateReader waitForState should check clusterState before using watchers [SOLR-17004](https://issues.apache.org/jira/browse/SOLR-17004) (Kevin Risden)

### Fixed (14 changes)

- Fix NPE in FieldLengthFeature with non-stored/missing fields [SOLR-13219](https://issues.apache.org/jira/browse/SOLR-13219) (Nick Veenhof) (Tomasz Elendt)
- Fix continuously growing TLOGs on TLOG replicas [SOLR-14679](https://issues.apache.org/jira/browse/SOLR-14679) (Viktor Molnár) (Houston Putman)
- Using Schema/Config API breaks the File-Upload of Config Set File [SOLR-16110](https://issues.apache.org/jira/browse/SOLR-16110) (Steffen Moldenhauer) (Kevin Risden)
- Rare Deadlock in SlotAcc initialization [SOLR-16165](https://issues.apache.org/jira/browse/SOLR-16165) (Justin Sweeney) (noble)
- HEAD request for managed resource returns 500 Server Error [SOLR-16274](https://issues.apache.org/jira/browse/SOLR-16274) (Kevin Risden)
- Luke request fails for document with a binary field [SOLR-16293](https://issues.apache.org/jira/browse/SOLR-16293) (Kevin Risden)
- Add AWS STS support in s3-repository [SOLR-16429](https://issues.apache.org/jira/browse/SOLR-16429) (Josh Souza) (Houston Putman and Kevin Risden)
- Don't fetch the PRS states while registering the collection watch [SOLR-16451](https://issues.apache.org/jira/browse/SOLR-16451) (Hitesh Khamesra) (Ishan Chattopadhyaya)
- Do not update PRS states if local version is newer [SOLR-16452](https://issues.apache.org/jira/browse/SOLR-16452) (Hitesh Khamesra) (noble)
- Collection RENAME api creates broken alias [SOLR-16477](https://issues.apache.org/jira/browse/SOLR-16477) (Alex Deparvu) (Kevin Risden)
- Schema Designer now correctly manages trust of the ConfigSets it is managing. [SOLR-16777](https://issues.apache.org/jira/browse/SOLR-16777) (Ishan Chattopadhyaya) (Skay) (Houston Putman)
- Add missing sysProps to redaction logic [SOLR-16984](https://issues.apache.org/jira/browse/SOLR-16984) (Houston Putman)
- ZK Credentials and ACLs are no longer sent to all ZK Servers when using Streaming Expressions. They will only be used when sent to the default ZK Host. [SOLR-17098](https://issues.apache.org/jira/browse/SOLR-17098) (Houston Putman) (Jan Høydahl) (David Smiley) (Gus Heck) (Qing Xu)
- Fix NullPointerException in UpdateLog.applyOlderUpdates that can occur if there are multiple partial updates of the same document in separate requests using commitWithin. [SOLR-17120](https://issues.apache.org/jira/browse/SOLR-17120) (Calvin Smith) (Christine Poerschke)

### Other (9 changes)

- Security: Converted enableRemoteStreaming and enableStreamBody solrconfig options into system properties and env vars. Attempts to set them the old way are no-op and log a warning. [SOLR-14853](https://issues.apache.org/jira/browse/SOLR-14853) (David Smiley) (janhoy) (Ishan Chattopadhyaya)
- Upgrade Apache Tika to 1.28.4 [SOLR-16141](https://issues.apache.org/jira/browse/SOLR-16141) (Kevin Risden)
- Upgrade commons-configuration2 to 2.8.0 and commons-text to 1.9 [SOLR-16324](https://issues.apache.org/jira/browse/SOLR-16324) (Kevin Risden)
- Upgrade Jetty to 9.4.48.v20220622 [SOLR-16332](https://issues.apache.org/jira/browse/SOLR-16332) (Kevin Risden)
- Upgrade Apache Calcite to 1.32.0 and Avatica to 1.22.0 [SOLR-16421](https://issues.apache.org/jira/browse/SOLR-16421) (Kevin Risden)
- Upgrade commons-text to 1.10.0 [SOLR-16464](https://issues.apache.org/jira/browse/SOLR-16464) (Kevin Risden)
- Upgrade to Netty 4.1.87.Final [SOLR-16626](https://issues.apache.org/jira/browse/SOLR-16626) [SOLR-16424](https://issues.apache.org/jira/browse/SOLR-16424) (Kevin Risden) (janhoy)
- Restrict certain file types from being uploaded to or downloaded from Config Sets [SOLR-16949](https://issues.apache.org/jira/browse/SOLR-16949) (janhoy) (Houston Putman)
- Upgrade Jetty to 9.4.53.v20231009 [SOLR-17025](https://issues.apache.org/jira/browse/SOLR-17025) (Kevin Risden)


[8.11.2] - 2022-06-17
---------------------

### Fixed (27 changes)

- Configuring a shardHandlerFactory on the /select requestHandler results in HTTP 401 when searching on alias in secured Solr. [SOLR-14569](https://issues.apache.org/jira/browse/SOLR-14569) (Isabelle Giguere) (Jason Gerlowski) (Anshum Gupta) (Mark Mark Miller)
- Support a HEAD request for managed resources. [SOLR-15116](https://issues.apache.org/jira/browse/SOLR-15116) (Eric Pugh)
- Don't wait for zombie processes to exit when stopping. [SOLR-15558](https://issues.apache.org/jira/browse/SOLR-15558) (Colvin Cowie)
- Don't use the UrlScheme singleton on the client-side to determine cluster's scheme, only get from ClusterState provider impl [SOLR-15587](https://issues.apache.org/jira/browse/SOLR-15587) (Timothy Potter)
- Fix the connection reset problem caused by the incorrect use of 4LW with \n when monitoring zooKeeper status [SOLR-15849](https://issues.apache.org/jira/browse/SOLR-15849) (Fa Ming)
- Let RealtimeGet component support negative filters [SOLR-15854](https://issues.apache.org/jira/browse/SOLR-15854) (Tomás Fernández Löbbe)
- Update Log4J to 2.17.1 [SOLR-15871](https://issues.apache.org/jira/browse/SOLR-15871) (weidongkl) (janhoy)
- Fix bug in PKIAuthenticationPlugin that can cause a request to fail with 401 Unauthorized instead of re-fetching expired remote keys from other nodes. [SOLR-15961](https://issues.apache.org/jira/browse/SOLR-15961) (Tomás Fernández Löbbe)
- Use better signatures for the PKI Authentication plugin. [SOLR-15965](https://issues.apache.org/jira/browse/SOLR-15965) (Mike Drob)
- Hide annoying WARN log from bin/solr zk command [SOLR-15968](https://issues.apache.org/jira/browse/SOLR-15968) (janhoy) (Mike Drob)
- Remove Calcite's ENUMERABLE_AGGREGATE_RULE as Solr only supports push-down for LogicalAggregate [SOLR-15974](https://issues.apache.org/jira/browse/SOLR-15974) (Timothy Potter) (Kiran Chitturi)
- Force Calcite's Rel simplify config flag to false to avoid erasing filters that are meaningful to Solr, but look like nonsense to Calcite, such as AND'd filters on the same multi-valued field [SOLR-16009](https://issues.apache.org/jira/browse/SOLR-16009) (Timothy Potter) (Kiran Chitturi)
- UTF-8 parsing errors for parameters should cause a HTTP 400 status code, not 500 [SOLR-16019](https://issues.apache.org/jira/browse/SOLR-16019) (janhoy) (Matthias Pigulla)
- Enforce special character requirements on passwords with length less than 15 [SOLR-16022](https://issues.apache.org/jira/browse/SOLR-16022) (Timothy Potter)
- ShowFileHandler path parameter is now validated to be relative to instance conf dir in standalone mode [SOLR-16075](https://issues.apache.org/jira/browse/SOLR-16075) (janhoy)
- Fix empty columns in Cloud Node UI Screen when replica is in down state. [SOLR-16089](https://issues.apache.org/jira/browse/SOLR-16089) (hossman)
- Upgrade JQuery to 3.5.1 in velocity contrib module [SOLR-16095](https://issues.apache.org/jira/browse/SOLR-16095) (Bence Szabo) (Jan Høydahl)
- SolrConfig can miss updates from ZooKeeper when deleting and recreating file items [SOLR-16143](https://issues.apache.org/jira/browse/SOLR-16143) (Mike Drob)
- Fix very rare NPE in SolrCloud rejoinOverseerElection. [SOLR-16145](https://issues.apache.org/jira/browse/SOLR-16145) (David Smiley)
- Spellcheck NPE if invalid dictionary name is provided [SOLR-16168](https://issues.apache.org/jira/browse/SOLR-16168) (Kevin Risden)
- Validate that installed ps utility supports -p flag, so that we do not inadvertantly stop the wrong process. [SOLR-16191](https://issues.apache.org/jira/browse/SOLR-16191) (Mike Drob) (Michael Gibney)
- Improve query syntax construction for SQL LIKE clause with phrases and wildcards [SOLR-16199](https://issues.apache.org/jira/browse/SOLR-16199) (Kiran Chitturi) (Aroop Ganguly) (Amrit Sarkar) (Timothy Potter)
- Rolling restart will no longer trigger as much PKI Plugin error logging. [SOLR-16209](https://issues.apache.org/jira/browse/SOLR-16209) (Mike Drob) (Tomás Fernández Löbbe)
- Upgrade Jackson to version 2.13.3 [SOLR-16213](https://issues.apache.org/jira/browse/SOLR-16213) (janhoy)
- Escape query characters in Solr SQL Array UDF functions [SOLR-16215](https://issues.apache.org/jira/browse/SOLR-16215) (Kiran Chitturi) (Timothy Potter)
- failOnVersionConflicts option not working for in-place updates [SOLR-16218](https://issues.apache.org/jira/browse/SOLR-16218) (Lamine Idjeraoui) (Houston Putman) (Anshum Gupta)
- Solr SQL query parsing fails on multiple LIKE clauses and multiple terms [SOLR-16227](https://issues.apache.org/jira/browse/SOLR-16227) (Kiran Chitturi) (David Smiley)


[8.11.1] - 2021-12-16
---------------------

### Fixed (19 changes)

- Reset index values on authorization rules after deleting by index [SOLR-13900](https://issues.apache.org/jira/browse/SOLR-13900) (Timothy Potter)
- Pass thru all command actions not explicitly handled by the bin/solr script, such as 'api', to the SolrCLI Java app [SOLR-15199](https://issues.apache.org/jira/browse/SOLR-15199) (Timothy Potter)
- Upgrade jaegertracing to 1.6.0 and libthrift to 0.14.1 [SOLR-15324](https://issues.apache.org/jira/browse/SOLR-15324) (wcmrnd1) (janhoy)
- Make HDFS handle little endian LUCENE-9047 [SOLR-15405](https://issues.apache.org/jira/browse/SOLR-15405) [LUCENE-9047](https://issues.apache.org/jira/browse/LUCENE-9047) (Kevin Risden)
- Don't close hooks twice when SolrRequestInfo is cleared twice; or /export with classic join closed fromCore if provided [SOLR-15635](https://issues.apache.org/jira/browse/SOLR-15635) (Mikhail Khludnev) (David Smiley)
- Set default permissions for the zookeeper endpoints so users won't need to configure custom permissions for these [SOLR-15768](https://issues.apache.org/jira/browse/SOLR-15768) (janhoy)
- Avoid weird off-by-one errors with Angular's 'chosen' select box directive for the security and schema-designer screens in Admin UI [SOLR-15774](https://issues.apache.org/jira/browse/SOLR-15774) (Timothy Potter)
- Switching a PRS collection from true -&gt; false -&gt; true results in INACTIVE replicas [SOLR-15794](https://issues.apache.org/jira/browse/SOLR-15794) (noble)
- Fix REPLACENODE to not use source node when choosing a target node for new replicas [SOLR-15795](https://issues.apache.org/jira/browse/SOLR-15795) (Houston Putman)
- Admin UI once again can show files in the Core/Collection -&gt; Files screen. Fixed regression from 8.11.0 [SOLR-15804](https://issues.apache.org/jira/browse/SOLR-15804) (Karl Stoney) (janhoy)
- Schema designer not handling `update.autoCreateFields` stored as a string (vs. boolean) in the config overlay [SOLR-15813](https://issues.apache.org/jira/browse/SOLR-15813) (Timothy Potter)
- Security UI 'hasPermission' check should check if the user has the "all" permission if the requested permission is not defined to match how the backend works [SOLR-15825](https://issues.apache.org/jira/browse/SOLR-15825) (Timothy Potter)
- ResourceLoader should better respect allowed paths [SOLR-15826](https://issues.apache.org/jira/browse/SOLR-15826) (janhoy)
- AuthTool (in SolrCLI) should include the config-read, collection-admin-read, core-admin-read, and all permissions in the initial security.json to avoid warnings in the security UI [SOLR-15828](https://issues.apache.org/jira/browse/SOLR-15828) (Timothy Potter)
- Clean-up after publish action in Schema Designer shouldn't fail if .system collection doesn't exist [SOLR-15832](https://issues.apache.org/jira/browse/SOLR-15832) (Timothy Potter)
- Enable exists queries on spatial types. [SOLR-15833](https://issues.apache.org/jira/browse/SOLR-15833) (Mike Drob) (Houston Putman)
- Update Log4J to 2.16 [SOLR-15843](https://issues.apache.org/jira/browse/SOLR-15843) (Mike Drob) (janhoy)
- Upgrade Velocity from v2.0 to v2.3 [SOLR-15844](https://issues.apache.org/jira/browse/SOLR-15844) (wcmrnd1) (janhoy)
- Fix NPE in pivot facets, add non-Analyzed query method in FieldType. [SOLR-8319](https://issues.apache.org/jira/browse/SOLR-8319) (Houston Putman) (Isabelle Giguere)


[8.11.0] - 2021-11-16
---------------------

### Added (4 changes)

- Add authn & authz plugins that supports multiple authentication schemes, such as Bearer and Basic [SOLR-12666](https://issues.apache.org/jira/browse/SOLR-12666) (Timothy Potter) (janhoy)
- SolrJ support for ConfigSet uploading [SOLR-15708](https://issues.apache.org/jira/browse/SOLR-15708) (ab) (hossman)
- Support editing Basic auth config from the security UI when using the MultiAuthPlugin [SOLR-15721](https://issues.apache.org/jira/browse/SOLR-15721) (Timothy Potter)
- opt-in support to create ZK chroot on startup [SOLR-7642](https://issues.apache.org/jira/browse/SOLR-7642) (Timothy Potter) (Shawn Heisey) (Mark Miller) (Tomas Eduardo Fernandez Lobbe) (Jan Høydahl) (Steve Molloy) (Isabelle Giguere) (David Eric Pugh) (Gus Heck) (Christine Poerschke) (Houston Putman)

### Changed (2 changes)

- Make include paths in bin/solr consistent [SOLR-15700](https://issues.apache.org/jira/browse/SOLR-15700) (turnertg) (janhoy) (Eric Pugh)
- Add the ability to set the AWS Profile per S3Repository [SOLR-15707](https://issues.apache.org/jira/browse/SOLR-15707) (Houston Putman)

### Fixed (9 changes)

- The "config-read" permission has been fixed to properly allow access to `/solr/admin/configs?action=LIST` [SOLR-15626](https://issues.apache.org/jira/browse/SOLR-15626) (Jon Senchyna) (Eric Pugh)
- The SolrException.log() helper method has been fixed to correctly passes the Throwable to the Logger w/o stringification [SOLR-15628](https://issues.apache.org/jira/browse/SOLR-15628) (hossman)
- Fix PeerSync failure due to RealTimeGetComponent returning duplicates. [SOLR-15676](https://issues.apache.org/jira/browse/SOLR-15676) (Ramsey Haddad) (Christine Poerschke) (David Smiley)
- Admin UI raises yellow warning even when only case of hostnames differ [SOLR-15691](https://issues.apache.org/jira/browse/SOLR-15691) (janhoy)
- Incremental backups no longer fail on collections that had previously seen a 'SPLITSHARD' operation. [SOLR-15696](https://issues.apache.org/jira/browse/SOLR-15696) (Jason Gerlowski)
- Fix S3Repository to follow BackupRepository.createDirectory() API contract [SOLR-15702](https://issues.apache.org/jira/browse/SOLR-15702) (Houston Putman)
- Incremental backup 'purges' no longer delete all index files(!) [SOLR-15706](https://issues.apache.org/jira/browse/SOLR-15706) (Jason Gerlowski)
- Delete Replica does not delete the Per replica state [SOLR-15722](https://issues.apache.org/jira/browse/SOLR-15722) (noble)
- MultiAuthPlugin should send non-AJAX anonymous requests to the plugin that allows anonymous requests [SOLR-15766](https://issues.apache.org/jira/browse/SOLR-15766) (Timothy Potter) (Eric Pugh)

### Other (4 changes)

- Upgrade forbiddenapis to version 3.2. [LUCENE-10104](https://issues.apache.org/jira/browse/LUCENE-10104) [SOLR-15631](https://issues.apache.org/jira/browse/SOLR-15631) (Uwe Schindler)
- Allow only known content types in ShowFileRequestHandler [SOLR-15678](https://issues.apache.org/jira/browse/SOLR-15678) (janhoy) (Gus Heck) (Mal Aware)
- Add ErrorLogMuter to test-framework, deprecating SolrException.ignorePatterns [SOLR-15697](https://issues.apache.org/jira/browse/SOLR-15697) (hossman)
- Remove JdbcStream from Lang [SOLR-15761](https://issues.apache.org/jira/browse/SOLR-15761) (Joel Bernstein)


[8.10.1] - 2021-10-18
---------------------

### Other (1 change)

- Upgrade the following dependencies with vulnerabilities. - jetty: 9.4.44.v20210927 - tika: 1.27 - commons-compress: 1.21 - netty: 4.1.68.Final - fasterxml.jackson: 2.12.3 - errorprone: 2.9.0 - gcp-client: 1.32.1 [SOLR-15677](https://issues.apache.org/jira/browse/SOLR-15677) (Houston Putman)


[8.10.0] - 2021-09-27
---------------------

### Added (5 changes)

- Allow backup/restoration to Amazon's S3 blobstore [SOLR-15089](https://issues.apache.org/jira/browse/SOLR-15089) (Andy Throgmorton) (Houston Putman) (Jason Gerlowski) (Pierre Salagnac) (Mike Drob)
- Add the countDist aggregation to the stats, facet and timeseries Streaming Expressions [SOLR-15208](https://issues.apache.org/jira/browse/SOLR-15208) (Joel Bernstein)
- Schema Designer UI [SOLR-15277](https://issues.apache.org/jira/browse/SOLR-15277) (Timothy Potter) (Kiran Chitturi)
- New shards.preference option for preferring replicas based on their leader status, i.e. `shards.preference=replica.leader:false` would prefer non-leader replicas. [SOLR-15472](https://issues.apache.org/jira/browse/SOLR-15472) (wei wang) (Timothy Potter)
- Security screen in Admin UI for managing users, roles, and permissions [SOLR-15527](https://issues.apache.org/jira/browse/SOLR-15527) (Timothy Potter)

### Changed (22 changes)

- Support "Accept-Encoding" header to enable response gzip compression [SOLR-11752](https://issues.apache.org/jira/browse/SOLR-11752) (Matthew Sporleder) (Houston Putman) (Shawn Heisey) (Jan Høydahl)
- Replace transient core cache LRU by Caffeine cache. [SOLR-15433](https://issues.apache.org/jira/browse/SOLR-15433) (Bruno Roustant)
- SolrSchema (for Parallel SQL) should use PKI principal for internal request to /admin/luke to get table metadata [SOLR-15451](https://issues.apache.org/jira/browse/SOLR-15451) (Timothy Potter)
- Get field type info from luke for custom fields instead of defaulting to String in Parallel SQL [SOLR-15456](https://issues.apache.org/jira/browse/SOLR-15456) (Timothy Potter)
- Implement LIKE, IS NOT NULL, IS NULL, and support wildcard * in equals string literal for Parallel SQL [SOLR-15460](https://issues.apache.org/jira/browse/SOLR-15460) (Timothy Potter) (Houston Putman)
- Upgrade Apache Calcite to 1.27.0. [SOLR-15461](https://issues.apache.org/jira/browse/SOLR-15461) (Mark Miller) (Timothy Potter)
- Implement COUNT and APPROX_COUNT_DISTINCT aggregation functions for Parallel SQL [SOLR-15475](https://issues.apache.org/jira/browse/SOLR-15475) (Timothy Potter)
- Implement OFFSET & FETCH for LIMIT SQL queries [SOLR-15489](https://issues.apache.org/jira/browse/SOLR-15489) (Timothy Potter)
- Reuse comparator objects in contrib/ltr rescorer classes. [SOLR-15496](https://issues.apache.org/jira/browse/SOLR-15496) (marcosfpr) (Christine Poerschke)
- StatsStream implement ParallelMetricsRollup to allow for tiered computation of SQL metrics over collection aliases backed by many collections, potentially with many shards in each [SOLR-15499](https://issues.apache.org/jira/browse/SOLR-15499) (Timothy Potter)
- Read ZK credentials from a file specified using a system property instead of exposing plain-text credentials as system properties [SOLR-15525](https://issues.apache.org/jira/browse/SOLR-15525) (Timothy Potter)
- ZkStateReader now supports connecting to 9.0 Solr Clouds [SOLR-15549](https://issues.apache.org/jira/browse/SOLR-15549) (Houston Putman)
- Identical filter queries will no longer race to record a filterCache entry. Allows for async cache computation instead of all queries contending for the same set of locks on the cache. Fixed a bug with ramBytes usage reporting on filterCache. Upgraded Caffeine Cache to 2.9.2 [SOLR-15555](https://issues.apache.org/jira/browse/SOLR-15555) (Mike Drob)
- Improve filtering expressions in /admin/metrics. [SOLR-15564](https://issues.apache.org/jira/browse/SOLR-15564) (ab)
- Include fields declared in the schema in table metadata (SQL) even if they are empty [SOLR-15570](https://issues.apache.org/jira/browse/SOLR-15570) (Timothy Potter)
- Improve the default Prometheus exporter config performance. [SOLR-15572](https://issues.apache.org/jira/browse/SOLR-15572) (ab)
- Allow filtering on ISO-8601 formatted timestamp literals in SQL WHERE clause [SOLR-15576](https://issues.apache.org/jira/browse/SOLR-15576) (Timothy Potter)
- Upgrade AWS SDK from v1 to v2 for S3 Repository [SOLR-15599](https://issues.apache.org/jira/browse/SOLR-15599) (Houston Putman)
- Explicitly indent results in Admin Query UI by default [SOLR-15607](https://issues.apache.org/jira/browse/SOLR-15607) (Olivia Falk) (Eric Pugh)
- Upgrade log4j to 2.14.1 [SOLR-15609](https://issues.apache.org/jira/browse/SOLR-15609) (hossman)
- log4j-layout-template-json is now included in solr server, allowing JSON formatted logs to be configurable. [SOLR-15610](https://issues.apache.org/jira/browse/SOLR-15610) (hossman)
- Project multi-valued fields in SQL query results [SOLR-9853](https://issues.apache.org/jira/browse/SOLR-9853) (Timothy Potter)

### Fixed (13 changes)

- Fix NPE when no grouping query specified [SOLR-13209](https://issues.apache.org/jira/browse/SOLR-13209) (Collins Abanda) (Mike Drob)
- SolrClient leaks connections on compressed responses if the response is malformed [SOLR-14457](https://issues.apache.org/jira/browse/SOLR-14457) (Houston Putman)
- Fix NPE in COLSTATUS for collections using implicit routing. [SOLR-14506](https://issues.apache.org/jira/browse/SOLR-14506) (Austin Weidler) (ab)
- Fix NPE in QueryComponent.mergeIds when using timeAllowed and sorting [SOLR-14758](https://issues.apache.org/jira/browse/SOLR-14758) (Bram Van Dam) (Uwe Schindler)
- Support async parameter in MODIFYCOLLECTION [SOLR-15311](https://issues.apache.org/jira/browse/SOLR-15311) (Nazerke Seidan) (Christine Poerschke) (David Smiley)
- Cross-collection join fixed to ignore documents that do not contain value in "from" field [SOLR-15482](https://issues.apache.org/jira/browse/SOLR-15482) (hossman)
- SignificantTerms streaming function should not fail on empty collections [SOLR-15531](https://issues.apache.org/jira/browse/SOLR-15531) (Benedikt Arnold) (Mike Drob)
- Propagate request level basic auth creds from the top-level async CollectionAdminRequest to internally used async requests, such as async status checking [SOLR-15575](https://issues.apache.org/jira/browse/SOLR-15575) (Timothy Potter)
- Allow for many values in a SQL IN clause; previously using more than 19 would result in the IN clause being ignored, now users are only limited by the `maxBooleanClauses` configured for a collection [SOLR-15579](https://issues.apache.org/jira/browse/SOLR-15579) (Timothy Potter)
- Partial results from shard queries needlessly discarded for queries without sort field [SOLR-15595](https://issues.apache.org/jira/browse/SOLR-15595) (Michael Kosten) (Mike Drob) (Eric Pugh)
- Download Config button in Schema Designer screen should not require user to re-login when already authenticated [SOLR-15620](https://issues.apache.org/jira/browse/SOLR-15620) (Timothy Potter)
- Fix NullPointerException if group.field grouping is used with rows=0 and timeAllowed. [SOLR-6156](https://issues.apache.org/jira/browse/SOLR-6156) (Modassar Ather) (Christine Poerschke)
- Fixed various problems in Solr and SolrJ that could cause deleteById commands with "_route_" information to processed by the wrong shard, and/or fail when forwarded to replicas from the shard leader. [SOLR-8889](https://issues.apache.org/jira/browse/SOLR-8889) (Dan Fox) (Yuki Yano) (hossman)

### Other (5 changes)

- During node shutdown pausing of updates and waiting for in-flight update requests to finish before closing cores is no longer SolrCloud specific. [SOLR-15486](https://issues.apache.org/jira/browse/SOLR-15486) (Christine Poerschke) (David Smiley)
- Clarify ref guide documentation about SQL queries with `SELECT *` requiring a `LIMIT` clause [SOLR-15566](https://issues.apache.org/jira/browse/SOLR-15566) (Timothy Potter)
- bin/solr auth utility should provide role bindings for `security-read` and `config-edit` by default to protect the security and schema designer screens in the Admin UI [SOLR-15573](https://issues.apache.org/jira/browse/SOLR-15573) (Timothy Potter)
- woodstox-core-asl:4.4.1 (org.codehaus) replaced with woodstox-core:6.2.4 (com.fasterxml) [SOLR-15599](https://issues.apache.org/jira/browse/SOLR-15599) (Houston Putman)
- index.html for Admin UI should send Solr version in the request for JavaScript files [SOLR-15621](https://issues.apache.org/jira/browse/SOLR-15621) (Timothy Potter)


[8.9.0] - 2021-06-16
--------------------

### Added (8 changes)

- In contrib/ltr FieldValueFeature support "stored=false docValues=true" a.k.a. pure DocValues fields. [SOLR-12697](https://issues.apache.org/jira/browse/SOLR-12697) (Stanislav Livotov) (Erick Erickson) (Tobias Kässmann) (Tom Gilke) (Christine Poerschke)
- ExpandComponent now supports an expand.nullGroup=true option [SOLR-14330](https://issues.apache.org/jira/browse/SOLR-14330) (hossman)
- SolrCloud backups can now be restored to compatible existing collections, instead of requiring a new collection for each restore. [SOLR-15087](https://issues.apache.org/jira/browse/SOLR-15087) (Jason Gerlowski) (shalin) (Cao Manh Dat)
- A new 'gcs-repository' contrib can be used to store and retrieve backups from Google Cloud Storage. [SOLR-15090](https://issues.apache.org/jira/browse/SOLR-15090) (Jason Gerlowski) (Shalin Mangar) (Cao Manh Dat)
- Add temporal graph query to the nodes Streaming Expression [SOLR-15132](https://issues.apache.org/jira/browse/SOLR-15132) (Joel Bernstein)
- New update.partial.requireInPlace=true option to prevent any partial document updates that can't be done In-Place [SOLR-15150](https://issues.apache.org/jira/browse/SOLR-15150) (hossman)
- Improved Grafana dashboard for Prometheus Exporter with new Solr Cluster row [SOLR-15365](https://issues.apache.org/jira/browse/SOLR-15365) (janhoy)
- Expose zookeeper status in the Prometheus exporter [SOLR-15397](https://issues.apache.org/jira/browse/SOLR-15397) (janhoy)

### Changed (19 changes)

- Add optional JAVA8_GC_LOG_FILE_OPTS for bin/solr. [SOLR-11233](https://issues.apache.org/jira/browse/SOLR-11233) (Pranav Murugappan) (Christine Poerschke)
- Backups are now done incrementally by default. Multiple backups can be stored at the same location, and each backup will only upload those files that are new since the last backup. [SOLR-13608](https://issues.apache.org/jira/browse/SOLR-13608) (Jason Gerlowski) (shalin) (Cao Manh Dat)
- Unhelpful message in RemoteExecutionException. [SOLR-14234](https://issues.apache.org/jira/browse/SOLR-14234) (ab)
- Add elevateOnlyDocsMatchingQuery and collectElevatedDocsWhenCollapsing parameters to query elevation. [SOLR-15038](https://issues.apache.org/jira/browse/SOLR-15038) (Dennis Berger) (Tobias Kässmann) (Bruno Roustant)
- ChildDocTransformerFactory uses perSegFilter cache [SOLR-15067](https://issues.apache.org/jira/browse/SOLR-15067) (Bence Szabo) (David Smiley)
- Block Collapse - Faster collapse code when groups are co-located via Block Join style nested doc indexing. Used by default when field=_root_, or explicitly requested for other fields via hint=block. [SOLR-15079](https://issues.apache.org/jira/browse/SOLR-15079) (Joel Bernstein) (hossman)
- Metrics for a core: add SolrCloud "isLeader" and "replicaState". [SOLR-15081](https://issues.apache.org/jira/browse/SOLR-15081) (David Smiley)
- Prevent EmbeddedSolrServer calling shutdown on a CoreContainer that was passed to it. [SOLR-15085](https://issues.apache.org/jira/browse/SOLR-15085) (Tim Owen) (Mike Drob)
- Add "list" and "delete" APIs for managing incremental backups [SOLR-15101](https://issues.apache.org/jira/browse/SOLR-15101) (Jason Gerlowski) (shalin) (Cao Manh Dat)
- Reduce duplicated core creation work [SOLR-15120](https://issues.apache.org/jira/browse/SOLR-15120) (Mike Drob) (Mark Miller)
- Revamp SolrCLI tool's help descriptions for all commands for consistency and clarity. [SOLR-15123](https://issues.apache.org/jira/browse/SOLR-15123) (Eric Pugh)
- Let Http2SolrClient pass Basic Auth credentials to all requests [SOLR-15154](https://issues.apache.org/jira/browse/SOLR-15154) (Tomás Fernández Löbbe)
- Let CloudHttp2SolrClient accept an external Http2SolrClient Builder [SOLR-15155](https://issues.apache.org/jira/browse/SOLR-15155) (Tomás Fernández Löbbe)
- [child] doc transformer's childFilter param no longer applies query syntax escaping. It was inconsistent with other Solr options. It did this escaping since 8.0 but not prior. [SOLR-15156](https://issues.apache.org/jira/browse/SOLR-15156) (David Smiley)
- Enhance hash method of JSON faceting to support EnumFieldType and perhaps some other/custom field types too. [SOLR-15191](https://issues.apache.org/jira/browse/SOLR-15191) (Thomas Wöckinger) (David Smiley)
- Allow Solr to make outbound non SSL calls to a JWT IDP via -Dsolr.auth.jwt.allowOutboundHttp=true property. [SOLR-15194](https://issues.apache.org/jira/browse/SOLR-15194) (Eric Pugh)
- Optimise contrib/ltr MultipleAdditiveTreesModel by changing recursion to loop in tree traversal. [SOLR-15315](https://issues.apache.org/jira/browse/SOLR-15315) (Suryakant Pandey) (Alessandro Benedetti) (Christine Poerschke)
- Avoid XPath in solrconfig.xml parsing [SOLR-15337](https://issues.apache.org/jira/browse/SOLR-15337) (noble)
- Pre-populating values into search parameters on the query page of solr admin [SOLR-6152](https://issues.apache.org/jira/browse/SOLR-6152) (jafurrer) (daniel6691)

### Fixed (14 changes)

- Mark ReplicationHandler's polling thread as a Solr server thread so the PKI Interceptor is activated to allow PULL replicas to replicate from security-enabled leaders [SOLR-11904](https://issues.apache.org/jira/browse/SOLR-11904) (Timothy Potter) (Torsten Bøgh Köster)
- Move "cursorMark" logic from QueryComponent to SearchHandler so it can work with things like QueryElevationComponent that modify the SortSpec in prepare(), as well as possible custom "search" components other then QueryComponent. [SOLR-11921](https://issues.apache.org/jira/browse/SOLR-11921) (hossman)
- Partial (AKA Atomic) updates could encounter "LazyField" instances in the document cache and not know hot to deal with them when writing the updated doc to the update log. [SOLR-13034](https://issues.apache.org/jira/browse/SOLR-13034) (David Smiley)
- Fix ExpandComponent behavior when expanding on numeric fields to differentiate '0' group from null group [SOLR-15078](https://issues.apache.org/jira/browse/SOLR-15078) (hossman)
- Better exception handling for LTR model creation errors [SOLR-15149](https://issues.apache.org/jira/browse/SOLR-15149) (Alessandro Benedetti) (Christine Poerschke)
- Fix JSON Faceting on EnumFieldType if allBuckets, numBuckets or missing is set. [SOLR-15191](https://issues.apache.org/jira/browse/SOLR-15191) (Thomas Wöckinger) (David Smiley)
- Fix for Invalid Reference to data.followers in Admin UI. [SOLR-15216](https://issues.apache.org/jira/browse/SOLR-15216) (Dean Pearce)
- Fix NullPointerException in StoredFieldsShardResponseProcessor that happened when a field name alias is used for the unique key field in searches with distributed result grouping. [SOLR-15273](https://issues.apache.org/jira/browse/SOLR-15273) (limingnihao) (Christine Poerschke)
- Solr Zookeeper status page shows green even when some Zookeepers are not serving requests [SOLR-15383](https://issues.apache.org/jira/browse/SOLR-15383) (janhoy)
- Zookeeper Status handler /admin/zookeeper/status not queryable from SolrJ [SOLR-15384](https://issues.apache.org/jira/browse/SOLR-15384) (janhoy)
- IndexFetcher should not issue a local commit for PULL replicas when leader's version is zero [SOLR-15399](https://issues.apache.org/jira/browse/SOLR-15399) (Timothy Potter)
- The V2 API threw errors for GET requests to collection handlers like /select. [SOLR-15418](https://issues.apache.org/jira/browse/SOLR-15418) (David Smiley)
- Solr replication UI wraps ETA time on top of next line [SOLR-15424](https://issues.apache.org/jira/browse/SOLR-15424) (janhoy)
- Fix JSON Faceting on EnumFieldType -- returned values should not be internal ordinals. [SOLR-15457](https://issues.apache.org/jira/browse/SOLR-15457) (Thomas Wöckinger) (David Smiley)

### Other (6 changes)

- Enable OOM Killer Script in Solr Foreground. Simplify getting heap dumps on OOM. [SOLR-14978](https://issues.apache.org/jira/browse/SOLR-14978) (Mike Drob) (Houston Putman)
- Deprecate CollectionAdminRequest.getV2Request(). [SOLR-15118](https://issues.apache.org/jira/browse/SOLR-15118) (Jason Gerlowski)
- An ERROR is logged if SignatureUpdateProcessorFactory is used in SolrCloud cluster in a way that is known to be problematic with multiple replicas. In 9.0 this situation will prevent collection initialization. [SOLR-15292](https://issues.apache.org/jira/browse/SOLR-15292) (hossman)
- Upgrade Jetty to 9.4.41.v20210516 [SOLR-15316](https://issues.apache.org/jira/browse/SOLR-15316) (janhoy) (Mike Drob)
- Improve IndexFetcher's exception logging upon replication errors. [SOLR-15377](https://issues.apache.org/jira/browse/SOLR-15377) (Torsten Bøgh Köster) (Christine Poerschke)
- Metrics history handler and metrics history collection (together with its specialized reporters) have been deprecated and will be removed in 9.0. [SOLR-15416](https://issues.apache.org/jira/browse/SOLR-15416) (ab)


[8.8.2] - 2021-04-12
--------------------

### Fixed (4 changes)

- Use shardsWhitelist in ReplicationHandler. [SOLR-15217](https://issues.apache.org/jira/browse/SOLR-15217) (Bruno Roustant)
- Set doAs param in ConfigurableInternodeAuthHadoopPlugin [SOLR-15233](https://issues.apache.org/jira/browse/SOLR-15233) (Geza Nagy) (Jason Gerlowski) (Mike Drob)
- Properly set ZK ACLs on /security.json [SOLR-15249](https://issues.apache.org/jira/browse/SOLR-15249) (Mike Drob)
- Hardening NODEDOWN event in PRS collections [SOLR-15288](https://issues.apache.org/jira/browse/SOLR-15288) (noble)


[8.8.1] - 2021-02-22
--------------------

### Fixed (5 changes)

- Fix bug that caused WAND optimization to be disabled in cases where the max score is requested (such as multi-shard requests in SolrCloud) [SOLR-15114](https://issues.apache.org/jira/browse/SOLR-15114) (Naoto Minami) (Tomás Fernández Löbbe)
- Admin UI display collections with perReplicaState=true in graph view [SOLR-15135](https://issues.apache.org/jira/browse/SOLR-15135) (Timothy Potter)
- Reduce excessive logging introduced with Per Replica States feature [SOLR-15136](https://issues.apache.org/jira/browse/SOLR-15136) (Ishan Chattopadhyaya)
- Collection creation for PerReplicaStates does not scale to large collections as well as regular collections [SOLR-15138](https://issues.apache.org/jira/browse/SOLR-15138) (Mike Drob) (Ilan Ginzburg) (noble) (Ishan Chattopadhyaya)
- System property to control whether base_url is stored in state.json to enable back-compat with older SolrJ versions. [SOLR-15145](https://issues.apache.org/jira/browse/SOLR-15145) (Timothy Potter)


[8.8.0] - 2021-02-01
--------------------

### Upgrade Notes (1 change)

- Internal logic for identifying 'Solr Home' has been refactored to make testing less error prone. Plugin developers using SolrPaths.locateSolrHome() or 'new SolrResourceLoader' should check deprecation warnings as existing some existing functionality will be removed in 9.0. See SOLR-14934 for more details. [SOLR-14934](https://issues.apache.org/jira/browse/SOLR-14934) 

### Added (3 changes)

- Add interleaving support in Learning To Rank. [SOLR-14560](https://issues.apache.org/jira/browse/SOLR-14560) (Alessandro Benedetti) (Christine Poerschke)
- Add v2 API for configSet upload, including single-file insertion. [SOLR-14907](https://issues.apache.org/jira/browse/SOLR-14907) (Houston Putman)
- Reducing overseer bottlenecks using per-replica states [SOLR-15052](https://issues.apache.org/jira/browse/SOLR-15052) (noble) (Ishan Chattopadhyaya)

### Changed (20 changes)

- Load all other SolrCore plugins from packages [SOLR-14155](https://issues.apache.org/jira/browse/SOLR-14155) (noble)
- Allow timeAllowed and cursorMark parameters together. [SOLR-14413](https://issues.apache.org/jira/browse/SOLR-14413) (John Gallagher) (Mike Drob)
- Metrics API should ensure consistent placeholders for missing values. [SOLR-14683](https://issues.apache.org/jira/browse/SOLR-14683) (ab)
- Refactor schema loading to not use XPath [SOLR-14827](https://issues.apache.org/jira/browse/SOLR-14827) (noble)
- Indexing nested documents is faster, especially under concurrent indexing load. In addition, Partial updates to nested documents and Realtime Get of child documents is now more reliable. [SOLR-14923](https://issues.apache.org/jira/browse/SOLR-14923) (David Smiley) (Thomas Wöckinger)
- The use case of atomic/partial updates to child documents no longer requires that _root_ be stored or have docValues, and no longer requires the _nest_path_ field. However it now requires that the client pass a _root_ field on these updates to point to the root ID. [SOLR-14923](https://issues.apache.org/jira/browse/SOLR-14923) (David Smiley)
- Reduce leader election time on node shutdown by removing election nodes before closing cores. [SOLR-14942](https://issues.apache.org/jira/browse/SOLR-14942) (Cao Manh Dat) (Mike Drob) (hossman) (shalin)
- Add env var options for the Prometheus Exporter bin scripts [SOLR-14955](https://issues.apache.org/jira/browse/SOLR-14955) (Houston Putman)
- metrics: Adds two metrics to the SolrCloud Overseer: solr_metrics_overseer_stateUpdateQueueSize and solr_metrics_overseer_collectionWorkQueueSize with corresponding entries in the Prometheus exporter's default/stock configuration. [SOLR-14965](https://issues.apache.org/jira/browse/SOLR-14965) (Saatchi Bhalla) (Megan Carey) (Andrzej Białecki) (David Smiley)
- Optimize CoreContainer.getAllCoreNames, getLoadedCoreNames and getCoreDescriptors. [SOLR-14975](https://issues.apache.org/jira/browse/SOLR-14975) (Bruno Roustant)
- ContainerPlugins should be configurable with custom objects [SOLR-14977](https://issues.apache.org/jira/browse/SOLR-14977) (noble) (ab)
- Reuse HttpSolrClient per node vs. one per Solr core when using CloudSolrStream [SOLR-14987](https://issues.apache.org/jira/browse/SOLR-14987) (Timothy Potter)
- Add interleaving algorithm parameter support in Learning To Rank [SOLR-15015](https://issues.apache.org/jira/browse/SOLR-15015) (Alessandro Benedetti)
- Automatically wrap a facet expression with a select / rollup / sort / plist when using a collection alias with multiple collections and count|sum|min|max|avg metrics. [SOLR-15036](https://issues.apache.org/jira/browse/SOLR-15036) (Timothy Potter)
- Improvements to postlogs timestamp handling [SOLR-15040](https://issues.apache.org/jira/browse/SOLR-15040) (Joel Bernstein)
- Optimize same-core, same-field joins in TopLevelJoinQuery [SOLR-15049](https://issues.apache.org/jira/browse/SOLR-15049) (Jason Gerlowski)
- Add panels to the default Grafana dashboard for query performance monitoring, includes updates to the Prometheus exporter to export query performance metrics, such as QPS and p95. [SOLR-15059](https://issues.apache.org/jira/browse/SOLR-15059) (Timothy Potter)
- /api/cluster/zk/ls should give the stat of the current node [SOLR-15062](https://issues.apache.org/jira/browse/SOLR-15062) (noble)
- [child]: the parentFilter parameter is now fully optional and perhaps obsolete. [SOLR-15069](https://issues.apache.org/jira/browse/SOLR-15069) (David Smiley)
- Make JSON Facets extendable [SOLR-8673](https://issues.apache.org/jira/browse/SOLR-8673) (Tim Owen) (Mikhail Khludnev)

### Fixed (28 changes)

- Return proper error code for bad input in case of inplace updates [SOLR-10860](https://issues.apache.org/jira/browse/SOLR-10860) (Tomas Eduardo Fernandez Lobbe) (Munendra S N)
- Don't persist base_url in ZK as the URL scheme is variable, compute from node_name instead when reading state back from ZK. [SOLR-12182](https://issues.apache.org/jira/browse/SOLR-12182) (Timothy Potter)
- Handle parsing of values for 'other', 'include', and 'excludeTags' in JSON facets when specified as comma-separated values with extra spaces [SOLR-12539](https://issues.apache.org/jira/browse/SOLR-12539) (hossman) (Munendra S N)
- Fix placeholder valuesource 'FIELDNAME' not working with de-referenced values in JSON aggregator parsing. [SOLR-12559](https://issues.apache.org/jira/browse/SOLR-12559) (hossman) (Munendra S N)
- Avoid picking 'stream' method in JSON facet when any of 'allBuckets', 'numBuckets', and 'missing' parameters are enabled [SOLR-14514](https://issues.apache.org/jira/browse/SOLR-14514) (hossman) (Munendra S N)
- Download speed was hard-coded in the "Replication" screen of the Solr Admin UI. [SOLR-14571](https://issues.apache.org/jira/browse/SOLR-14571) (Florin Babes) (Christine Poerschke)
- Http2SolrClient doesn't handle keystore type correctly [SOLR-14851](https://issues.apache.org/jira/browse/SOLR-14851) (Andras Salamon) (janhoy)
- Refactored duplicate "Solr Home" logic into a single place to eliminate risk of tests using divergent values for a single solr node. [SOLR-14934](https://issues.apache.org/jira/browse/SOLR-14934) (hossman)
- JSON range faceting to support cache=false parameter. [SOLR-14939](https://issues.apache.org/jira/browse/SOLR-14939) (Christine Poerschke) (Mike Drob)
- ReplicationHandler memory leak through SolrCore.closeHooks with unstable ZK connection. [SOLR-14940](https://issues.apache.org/jira/browse/SOLR-14940) (Anver Sotnikov) (Mike Drob)
- Fix responseHeader being returned in response when omitHeader=true and EmbeddedSolrServer is used as the client [SOLR-14946](https://issues.apache.org/jira/browse/SOLR-14946) (Munendra S N)
- Fix error in copyField regeneration when explicit source/destination is not present in schema but matches the dynamic rule. The copyFields are rebuilt with replace-field and replace-field-type, if required [SOLR-14950](https://issues.apache.org/jira/browse/SOLR-14950) (Andrew Shumway) (Munendra S N)
- Fix for deleting zookeeper nodes with same path length. Only the first zk-node was removed. [SOLR-14961](https://issues.apache.org/jira/browse/SOLR-14961) (Michael Aleythe) (Mike Drob)
- Prevent creating multiple cores with the same name which leads to instabilities (race condition) [SOLR-14969](https://issues.apache.org/jira/browse/SOLR-14969) (Erick Erickson) (Andreas Hubold)
- AtomicUpdate 'remove', 'add-distinct' operations now works on numeric, date fields in uncommitted docs [SOLR-14971](https://issues.apache.org/jira/browse/SOLR-14971) (Jason Gerlowski)
- Fix response returning original score instead of reranked score due to query and filter combining. [SOLR-14983](https://issues.apache.org/jira/browse/SOLR-14983) (Krishan Goyal) (Jason Baik) (Christine Poerschke)
- Unable to download zookeeper files of 1byte in size [SOLR-14993](https://issues.apache.org/jira/browse/SOLR-14993) (Erick Erickson) (Allen Sooredoo)
- Correctly propogate exceptions from DirectoryFactory.exists [SOLR-15009](https://issues.apache.org/jira/browse/SOLR-15009) (Mike Drob)
- Core lib directories were not being recognized unless the solrconfig included a &lt;lib&gt; directive. [SOLR-15017](https://issues.apache.org/jira/browse/SOLR-15017) (Thomas Mortagne)
- Fix preventing null being wrapped in a QueryValueSource subQuery. Such null queries can be caused by query text resulting in an empty token stream. [SOLR-15031](https://issues.apache.org/jira/browse/SOLR-15031) (Pieter van Boxtel) (Mike Drob)
- Check if SOLR_SSL_ENABLED strictly equal to true for setting solr.jetty.https.port [SOLR-15046](https://issues.apache.org/jira/browse/SOLR-15046) (Timothy Potter)
- Fix collapse parser behavior when collapsing on numeric fields to differentiate '0' group from null group [SOLR-15047](https://issues.apache.org/jira/browse/SOLR-15047) (hossman)
- Fixed collapse parser behavior when dealing with docs boosted by QueryElevationComponent that are in the null group to treat them consistently regardless of collapse field type or group head selector. [SOLR-15048](https://issues.apache.org/jira/browse/SOLR-15048) (hossman)
- Enforce node_name contains colon and port and find first underscore after colon to parse context when converting a node_name to a base URL. [SOLR-15058](https://issues.apache.org/jira/browse/SOLR-15058) (Timothy Potter) (Su Sasa)
- Fix NPE in SearchHandler when shards.info and no QueryComponent configured. [SOLR-15061](https://issues.apache.org/jira/browse/SOLR-15061) (Bruno Roustant)
- Suggester requests made with SolrJ can now use XMLResponseParser [SOLR-15070](https://issues.apache.org/jira/browse/SOLR-15070) (Jason Gerlowski)
- Fix ArrayIndexOutOfBoundsException in contrib/ltr SolrFeatureScorer. [SOLR-15071](https://issues.apache.org/jira/browse/SOLR-15071) (Florin Babes) (Ovidiu Mihalcea) (David Smiley) (Christine Poerschke)
- Fix ClassCastException in SystemInfoHandler.getSecurityInfo. [SOLR-15073](https://issues.apache.org/jira/browse/SOLR-15073) (Nikolay Ivanov) (Christine Poerschke)

### Other (8 changes)

- Upgrade Angular JS 1.7.9 to 1.8.0 [SOLR-14951](https://issues.apache.org/jira/browse/SOLR-14951) (Kevin Risden)
- Heavily edit reindexing.adoc [SOLR-14954](https://issues.apache.org/jira/browse/SOLR-14954) (Sameul García Martínez and Erick Erickson)
- Refactor zkHost config logic to make testing easier and reduce risk of incorrect value being used [SOLR-14958](https://issues.apache.org/jira/browse/SOLR-14958) (hossman)
- Removed search results clustering contrib from 8x (due to Carrot2 incompatibility with Java 1.8). [SOLR-14981](https://issues.apache.org/jira/browse/SOLR-14981) (Dawid Weiss)
- Update Jetty to 9.4.34 [SOLR-14995](https://issues.apache.org/jira/browse/SOLR-14995) (Mike Drob)
- New option for specifying the advertised Solr Port (hostPort). Still defaults to "jetty.port". [SOLR-14999](https://issues.apache.org/jira/browse/SOLR-14999) (Houston Putman)
- Thread dump using jattach if available and jstack is missing. [SOLR-15010](https://issues.apache.org/jira/browse/SOLR-15010) (Eric Pugh)
- Avoid unnecessary object retention in FacetRangeProcessor. [SOLR-15057](https://issues.apache.org/jira/browse/SOLR-15057) (Christine Poerschke)


[8.7.0] - 2020-11-03
--------------------

### Added (13 changes)

- ConfigSet handler now supports overrides on existing configsets. [SOLR-10391](https://issues.apache.org/jira/browse/SOLR-10391) (Tomás Fernández Löbbe)
- Avoid $SOLR_STOP_WAIT use during 'bin/solr start' if $SOLR_START_WAIT is supplied. [SOLR-11167](https://issues.apache.org/jira/browse/SOLR-11167) (Omar Abdelnabi) (Christine Poerschke)
- Add BooleanSimilarityFactory class. [SOLR-13751](https://issues.apache.org/jira/browse/SOLR-13751) (Andy Webb) (Christine Poerschke)
- Make schema components load from packages [SOLR-14151](https://issues.apache.org/jira/browse/SOLR-14151) (noble)
- Expose IWC.setMaxCommitMergeWaitMillis in Solr's index config. This is an expert config option that can be set when using a custom MergePolicy (doesn't have any effect on the default MP) [SOLR-14582](https://issues.apache.org/jira/browse/SOLR-14582) (Tomás Fernández Löbbe)
- Introduce Circuit Breaker Infrastructure and a JVM heap usage memory tracking circuit breaker implementation [SOLR-14588](https://issues.apache.org/jira/browse/SOLR-14588) (Atri Sharma)
- Add the ability to uninstall a package from with the Package CLI. [SOLR-14604](https://issues.apache.org/jira/browse/SOLR-14604) (MarcusSorealheis)
- CPU Utilization Based Circuit Breaker [SOLR-14615](https://issues.apache.org/jira/browse/SOLR-14615) (Atri Sharma)
- Introduce ability to delete .jar stored in the Package Store. [SOLR-14681](https://issues.apache.org/jira/browse/SOLR-14681) (MarcusSorealheis) (Mike Drob)
- Make SolrEventListeners load from packages [SOLR-14875](https://issues.apache.org/jira/browse/SOLR-14875) (noble)
- Support single file upload/overwrite in configSet API. [SOLR-14907](https://issues.apache.org/jira/browse/SOLR-14907) (Houston Putman)
- Add option to disable metrics collection. [SOLR-14914](https://issues.apache.org/jira/browse/SOLR-14914) (ab)
- Reducing overseer bottlenecks using per-replica states [SOLR-15052](https://issues.apache.org/jira/browse/SOLR-15052) (noble) (Ishan Chattopadhyaya)

### Changed (21 changes)

- Add support to stream data out using push APIs when wt=xml [SOLR-11262](https://issues.apache.org/jira/browse/SOLR-11262) (yonik) (Munendra S N)
- JSON Facet perf improvements to support "sweeping" collection of "relatedness()" [SOLR-13132](https://issues.apache.org/jira/browse/SOLR-13132) (hossman) (Michael Gibney)
- Prevent StringIndexOutOfBoundsException when parsing field names in SolrQueryParserBase [SOLR-13205](https://issues.apache.org/jira/browse/SOLR-13205) (pramodkumar9) (Jason Gerlowski)
- On deleting a collection, its config set will also be deleted iff it has been auto-created, and not used by any other collection [SOLR-13438](https://issues.apache.org/jira/browse/SOLR-13438) (Anderson Dorow)
- HttpShardHandler send requests in async [SOLR-14354](https://issues.apache.org/jira/browse/SOLR-14354) (Cao Manh Dat)
- Admin UI shows Angular placeholders on first load / refresh. [SOLR-14422](https://issues.apache.org/jira/browse/SOLR-14422) (Colvin Cowie) (Eric Pugh)
- Enhance gradle logging calls validation: eliminate getMessage() [SOLR-14523](https://issues.apache.org/jira/browse/SOLR-14523) (Andras Salamon) (Erick Erickson)
- Improve performance of ExportWriter. [SOLR-14537](https://issues.apache.org/jira/browse/SOLR-14537) (ab) (Joel Bernstein)
- Request ID's ('rid') are now added by default to distributed search requests, and can be used to correlate logs from the receiving coordinator node with those from downstream shard requests. This can be disabled by providing a disableRequestId=true request parameter. [SOLR-14566](https://issues.apache.org/jira/browse/SOLR-14566) (Jason Gerlowski)
- Do not use SolrCore as keys in a WeakHashMap [SOLR-14576](https://issues.apache.org/jira/browse/SOLR-14576) (noble)
- ReflectMapWriter to use MethodHandle instead of old reflection [SOLR-14610](https://issues.apache.org/jira/browse/SOLR-14610) (noble)
- ThreadDumpHandler has been enhanced to show lock ownership [SOLR-14635](https://issues.apache.org/jira/browse/SOLR-14635) (hossman)
- The MetricsHistoryHandler can more completely disable itself when you tell it to. Also, it now shuts down more thoroughly. [SOLR-14651](https://issues.apache.org/jira/browse/SOLR-14651) (David Smiley)
- SolrJ's CollectionAdminRequest.collectionStatus(collection) would internally get all collection statuses instead of just the specified collection. [SOLR-14658](https://issues.apache.org/jira/browse/SOLR-14658) (Andy Vuong)
- Metrics reporting should avoid creating objects. [SOLR-14691](https://issues.apache.org/jira/browse/SOLR-14691) (ab) (noble)
- Track timeAllowed from earlier in the request lifecycle. [SOLR-14722](https://issues.apache.org/jira/browse/SOLR-14722) (David Smiley)
- Precompute fingerprint during PeerSync in parallel with fetching fingerprint from replicas. [SOLR-14776](https://issues.apache.org/jira/browse/SOLR-14776) (Cao Manh Dat) (Mike Drob) (shalin)
- geodist: Support most (all?) spatial field types as an argument like LLPSF, SRPTFT, and others. [SOLR-14802](https://issues.apache.org/jira/browse/SOLR-14802) (Tom Edge) (Craig Wrigglesworth)
- Fix inefficient iterator pattern in JsonSchemaValidator. [SOLR-14819](https://issues.apache.org/jira/browse/SOLR-14819) (Thomas DuBuisson) (Bruno Roustant)
- Update commons-io version to 2.8.0 due to security vulnerability. [SOLR-14905](https://issues.apache.org/jira/browse/SOLR-14905) (Nazerke Seidan) (Bruno Roustant)
- Ability to add T and P type replica from admin UI [SOLR-14933](https://issues.apache.org/jira/browse/SOLR-14933) (Sayan Das) (Eric Pugh)

### Fixed (19 changes)

- TLOG replication doesn't work properly after rebalancing leaders. [SOLR-11656](https://issues.apache.org/jira/browse/SOLR-11656) (Yuki Yano via Erick Erickson)
- macro expansion of parameters could result in a StringIndexOutOfBoundsException. Also, params with macros will be processed more strictly by LTR FeatureWeight. [SOLR-13181](https://issues.apache.org/jira/browse/SOLR-13181) (David Smiley) (Cesar Rodriguez) (Christine Poerschke)
- Fix empty drop down for adding replica in Admin UI [SOLR-14483](https://issues.apache.org/jira/browse/SOLR-14483) (Sayan Das) (Eric Pugh)
- Use specified waitForZk value as connection timeout for zookeeper in SolrDispatcherFilter. Also, consume specified SOLR_WAIT_FOR_ZK in bin/solr.cmd [SOLR-14503](https://issues.apache.org/jira/browse/SOLR-14503) (Colvin Cowie) (Munendra S N)
- Fix NPE in JSON response writer(wt=json) with /get when writing non-stored, non-indexed docvalue field from an uncommitted document [SOLR-14516](https://issues.apache.org/jira/browse/SOLR-14516) (noble) (Ishan Chattopadhyaya) (Munendra S N)
- Fix listing of Files in a Directory on Solr Admin UI [SOLR-14549](https://issues.apache.org/jira/browse/SOLR-14549) (Kevin Risden)
- Improve error handling in IndexReader realted metrics that were causing scary ERROR logging if metrics were requested while Solr was in the process of closing/re-opening a new IndexReader. [SOLR-14657](https://issues.apache.org/jira/browse/SOLR-14657) (hossman)
- Improve DIH termination logic to close all DataSources, EntityProcessors [SOLR-14677](https://issues.apache.org/jira/browse/SOLR-14677) (Jason Gerlowski)
- Avoid NullPointerException in TupleStream.getShards() when streamContext is null. [SOLR-14700](https://issues.apache.org/jira/browse/SOLR-14700) (Mads Bondo Dydensborg) (Christine Poerschke) (Mike Drob)
- Fix edismax replacement of all whitespace characters with spaces [SOLR-14703](https://issues.apache.org/jira/browse/SOLR-14703) (Yuriy Koval) (Jason Gerlowski)
- Solr.cmd in windows loads the incorrect jetty module when using java&gt;=9 [SOLR-14714](https://issues.apache.org/jira/browse/SOLR-14714) (Endika Posadas via Erick Erickson)
- Fix incorrect auth/SSL startup logging [SOLR-14748](https://issues.apache.org/jira/browse/SOLR-14748) (Jason Gerlowski)
- Zookeeper Admin screen not working for old ZK versions [SOLR-14751](https://issues.apache.org/jira/browse/SOLR-14751) (janhoy)
- Fix error in Zookeeper status when Prometheus plugin is enabled in ZK [SOLR-14752](https://issues.apache.org/jira/browse/SOLR-14752) (Philipp Trulson) (janhoy)
- HealthCheckHandler is no longer an implicit SolrCore handler and can be configured from solr.xml [SOLR-14774](https://issues.apache.org/jira/browse/SOLR-14774) (Tomás Fernándex Löbbe)
- {!terms} docValuesTermsFilterTopLevel method now works with single-valued strings [SOLR-14821](https://issues.apache.org/jira/browse/SOLR-14821) (Anatolii Siuniaev) (Jason Gerlowski)
- ChildDocTransformer should have omitted deleted child documents. [SOLR-14869](https://issues.apache.org/jira/browse/SOLR-14869) (Bar Rotstein) (David Smiley)
- Some ReplicationHandler metrics are reported using incorrect types. [SOLR-14924](https://issues.apache.org/jira/browse/SOLR-14924) (ab)
- Fixed Grafana dashboard filters for collection, shard, replica and core [SOLR-14936](https://issues.apache.org/jira/browse/SOLR-14936) (janhoy)

### Other (15 changes)

- Update default Zookeeper session timeout to 30s in bin/solr and bin/solr.cmd [SOLR-10471](https://issues.apache.org/jira/browse/SOLR-10471) (Michael Braun) (Markus Jelsma) (Munendra S N)
- SolrCores.getNamesForCore is quite inefficient and blocks other core operations. NOTE: this experimental method has been removed [SOLR-10742](https://issues.apache.org/jira/browse/SOLR-10742) (Erick Erickson)
- Deprecate CloudSolrClient.setIdField, use information from Zookeeper [SOLR-11868](https://issues.apache.org/jira/browse/SOLR-11868) (Erick Erickson)
- Deprecated plugins/features are now logged once and with log category org.apache.solr.DEPRECATED [SOLR-12987](https://issues.apache.org/jira/browse/SOLR-12987) (David Smiley)
- Extract any non-gradle related patches (deprecations, URL fixes, etc.) from gradle effort. NOTE: this will be in several separate commits/pushes. [SOLR-13939](https://issues.apache.org/jira/browse/SOLR-13939) (Erick Erickson)
- Implement toString in Collapse filter so that proper parsed queries returned in debug response. Also, Deprecate unused constants NULL_COLLAPSE, NULL_IGNORE, NULL_EXPAND, HINT_MULTI_DOCVALUES in collapse parser. [SOLR-14333](https://issues.apache.org/jira/browse/SOLR-14333) (Guna Sekhar Dora Kovvuru) (Munendra S N) (Mike Drob)
- Comment SolrJ 'Utils' generic map functions [SOLR-14579](https://issues.apache.org/jira/browse/SOLR-14579) (Megan Carey and a lot of education from Uwe Schindler) (Erick Erickson)
- Upgrade Zookeeper to 3.6.1. NOTE: this required upgrading netty to 4.1.50 [SOLR-14592](https://issues.apache.org/jira/browse/SOLR-14592) (Erick Erickson)
- Update CloudSolrClient examples to remove deprecated method. [SOLR-14637](https://issues.apache.org/jira/browse/SOLR-14637) (Andras Salamon) (Eric Pugh)
- PeerSync, remove canHandleVersionRanges check [SOLR-14641](https://issues.apache.org/jira/browse/SOLR-14641) (Cao Manh Dat)
- Remove restlet as dependency for the ManagedResource API [SOLR-14659](https://issues.apache.org/jira/browse/SOLR-14659) (Timothy Potter) (noble)
- Update commons-collections to 4.4 and use it in Solr [SOLR-14676](https://issues.apache.org/jira/browse/SOLR-14676) (Erick Erickson)
- Rename @SolrSingleThreaded to @SolrThreadUnsafe, mark DistribPackageStore with the annotation [SOLR-14731](https://issues.apache.org/jira/browse/SOLR-14731) (marcussorealheis)
- Upgrade to zookeeper 3.6.2 [SOLR-14876](https://issues.apache.org/jira/browse/SOLR-14876) (odidev) (Erick Erickson)
- Use in-line tags for logger declarations in Gradle ValidateLogCalls that are non-standard, change //logok to //nowarn [SOLR-14910](https://issues.apache.org/jira/browse/SOLR-14910) (Erick Erickson)


[8.6.3] - 2020-10-07
--------------------

### Fixed (5 changes)

- Fix HTTP multipart POST to Solr -- a regression from 8.6.0. Many Jetty classes are not classpath-visible from the Solr webapp. [SOLR-14768](https://issues.apache.org/jira/browse/SOLR-14768) (David Smiley)
- Fix ExactStatsCache NullPointerException when shards.tolerant=true. [SOLR-14850](https://issues.apache.org/jira/browse/SOLR-14850) (Yevhen Tienkaiev) (ab)
- DateRangeField now throws errors when invalid field/fieldType options specified; no longer silently accepts incompatible option values [SOLR-14859](https://issues.apache.org/jira/browse/SOLR-14859) (Jason Gerlowski) (Chris Hostetter) (Munendra S N)
- Fix unlimited number of forwarding the request from one node to another node. [SOLR-14897](https://issues.apache.org/jira/browse/SOLR-14897) (hossman) (Munendra S N)
- Stop returning duplicate HTTP response headers when requests are forward to another node. [SOLR-14898](https://issues.apache.org/jira/browse/SOLR-14898) (hossman)


[8.6.2] - 2020-09-01
--------------------

### Fixed (2 changes)

- Copy ConfigSet root data from base ConfigSet when using CREATE command [SOLR-14663](https://issues.apache.org/jira/browse/SOLR-14663) (Andras Salamon) (Tomás Fernández Löbbe)
- Zookeeper Admin screen not working for old ZK versions [SOLR-14751](https://issues.apache.org/jira/browse/SOLR-14751) (janhoy)


[8.6.1] - 2020-08-13
--------------------

### Fixed (2 changes)

- Revert SOLR-12845 adding of default autoscaling cluster policy, due to performance issues. [SOLR-14665](https://issues.apache.org/jira/browse/SOLR-14665) [SOLR-14706](https://issues.apache.org/jira/browse/SOLR-14706) [SOLR-12845](https://issues.apache.org/jira/browse/SOLR-12845) (Ishan Chattopadhyaya) (Houston Putman) (Gus Heck) (ab)
- Parsing dynamic ZK config sometimes cause NuberFormatException [SOLR-14671](https://issues.apache.org/jira/browse/SOLR-14671) (janhoy)


[8.6.0] - 2020-07-15
--------------------

### Added (12 changes)

- ExternalRoleRuleBasedAuthorizationPlugin which gets user's roles from request [SOLR-12131](https://issues.apache.org/jira/browse/SOLR-12131) (janhoy)
- Join queries can now work cross-collection, even when sharded or when spanning nodes. [SOLR-13749](https://issues.apache.org/jira/browse/SOLR-13749) (Dan Fox) (Kevin Watters) (Gus Heck) (David Smiley)
- A read API at /api/cluster/zk/* to fetch raw ZK data and view contents of a ZK directory [SOLR-13942](https://issues.apache.org/jira/browse/SOLR-13942) (noble)
- HealthCheckHandler can now require that all cores are healthy before returning 'OK' To enable, add &requireHealthyCores=true to enable [SOLR-14210](https://issues.apache.org/jira/browse/SOLR-14210) (janhoy) (Houston Putman) (shalin)
- A new panel with security info in admin UI's dashboard [SOLR-14237](https://issues.apache.org/jira/browse/SOLR-14237) (Ishan Chattopadhyaya) (Moshe Bla)
- CoreContainer level custom requesthandlers [SOLR-14404](https://issues.apache.org/jira/browse/SOLR-14404) (noble)
- Add streaming expressions to /export handler. [SOLR-14470](https://issues.apache.org/jira/browse/SOLR-14470) (ab) (Joel Bernstein)
- Add percentiles and standard deviation aggregations to stats, facet and timeseries Streaming Expressions [SOLR-14476](https://issues.apache.org/jira/browse/SOLR-14476) (Joel Bernstein)
- Allow the diff Stream Evaluator to operate on the rows of a matrix [SOLR-14478](https://issues.apache.org/jira/browse/SOLR-14478) (Joel Bernstein)
- Add drill Streaming Expression for efficient and accurate high cardinality aggregation. [SOLR-14481](https://issues.apache.org/jira/browse/SOLR-14481) (Joel Bernstein)
- Add support for RankFields. RankFields allow the use of per-document scoring factors in a way that lets Solr skip over non-competitive documents when ranking. See SOLR-13289. [SOLR-14590](https://issues.apache.org/jira/browse/SOLR-14590) [SOLR-13289](https://issues.apache.org/jira/browse/SOLR-13289) (Tomás Fernández Löbbe) (Varun Thacker)
- Package manager support for cluster level plugins (see SOLR-14404) [SOLR-14599](https://issues.apache.org/jira/browse/SOLR-14599) [SOLR-14404](https://issues.apache.org/jira/browse/SOLR-14404) (Ishan Chattopadhyaya)

### Changed (29 changes)

- fail precommit on unparameterised log messages and examine for wasted work/objects [LUCENE-7788](https://issues.apache.org/jira/browse/LUCENE-7788) (Erick Erickson)
- hl.fl and tv.fl now parse field lists when they have both commas and spaces [SOLR-11334](https://issues.apache.org/jira/browse/SOLR-11334) (David Smiley) (Yasufumi Mizoguchi)
- Add a default autoscaling cluster policy. [SOLR-12845](https://issues.apache.org/jira/browse/SOLR-12845) (shalin) (varunthacker) (ab)
- Metrics will no longer write a (sometimes large) log message every minute. This can be re-enabled via log4j2.xml if desired, or other HttpSolrCall log messages may be quieted on a per handler basis. [SOLR-13286](https://issues.apache.org/jira/browse/SOLR-13286) (Gus Heck)
- When the "minExactCount" parameters is provided in queries and it's value is lower than the number of hits, Solr can speedup the query resolution by using the Block-Max WAND algorithm (see LUCENE-8135). When doing this, the value of matching documents in the response (numFound) will be an approximation. [SOLR-13289](https://issues.apache.org/jira/browse/SOLR-13289) [LUCENE-8135](https://issues.apache.org/jira/browse/LUCENE-8135) (Ishan Chattopadhyaya) (Munendra S N) (Tomás Fernández Löbbe) (David Smiley)
- ComputePlanAction now supports a collection selector of the form `collections: {policy: my_policy}` which can be used to select multiple collections that match collection property/value pairs. This is useful to maintain a whitelist of collections for which actions are taken without needing to hard code the collection names themselves. The collection hints are pushed down to the policy engine so operations for non-matching collections are not computed at all. [SOLR-13325](https://issues.apache.org/jira/browse/SOLR-13325) (ab) (shalin)
- Make SolrJ ConnectionSocketFactory pluggable via SocketFactoryRegistryProvider setting on HttpClientUtil [SOLR-14260](https://issues.apache.org/jira/browse/SOLR-14260) (Andy Throgmorton) (David Smiley)
- User defined "&lt;cache/&gt;" entries in solrconfig.xml now support enabled="true|false" just like core searcher caches. [SOLR-14307](https://issues.apache.org/jira/browse/SOLR-14307) (hossman)
- Remove unchecked type conversion warning in JavaBinCodec's readMapEntry's equals() method [SOLR-14316](https://issues.apache.org/jira/browse/SOLR-14316) (Aroop Ganguly) (Tomás Fernández Löbbe) (Noble Paul) (Anshum Gupta)
- Add support to choose collapse group to expand in ExpandComponent based on cost [SOLR-14329](https://issues.apache.org/jira/browse/SOLR-14329) (Munendra S N)
- Remove unnecessary configset verification checks when SolrCloud merely wants to know which configset a collection is using. Improves CLUSTERSTATUS times for massive clusters. [SOLR-14340](https://issues.apache.org/jira/browse/SOLR-14340) (Mathieu Marie) (David Smiley)
- Load cores in an order that makes collections available sooner and reduces leaderVoteWait timeouts in large SolrCloud clusters. [SOLR-14342](https://issues.apache.org/jira/browse/SOLR-14342) (David Smiley)
- LTR's SolrFeature "fq" now supports PostFilters (e.g. collapse). [SOLR-14364](https://issues.apache.org/jira/browse/SOLR-14364) (David Smiley)
- CollapsingQParser - Avoiding always allocate int[] and float[] with size equals to number of unique values. [SOLR-14365](https://issues.apache.org/jira/browse/SOLR-14365) (Cao Manh Dat)
- Optimize filter queries that match all docs. [SOLR-14376](https://issues.apache.org/jira/browse/SOLR-14376) (David Smiley)
- SolrRequestInfo now stacks internally when a new request is set/clear'ed. Also fixes SolrIndexSearcher.warm which should have re-instated previous SRI. [SOLR-14384](https://issues.apache.org/jira/browse/SOLR-14384) (Nazerke Seidan) (David Smiley)
- TaggerRequestHandler should not error on an empty index [SOLR-14396](https://issues.apache.org/jira/browse/SOLR-14396) (Trey Grainger)
- Handle shards.purpose in the postlogs tool [SOLR-14407](https://issues.apache.org/jira/browse/SOLR-14407) (Joel Bernstein)
- json.queries as well as other parameters might be referred via {"param":"ref"} in Query DSL [SOLR-14419](https://issues.apache.org/jira/browse/SOLR-14419) (Mikhail Khludnev)
- Move static SolrClientCache from StreamHandler to CoreContainer for wider reuse and better life-cycle management. [SOLR-14423](https://issues.apache.org/jira/browse/SOLR-14423) (ab)
- Metrics: SolrShardReporter's default metrics list now includes TLOG and UPDATE./update [SOLR-14433](https://issues.apache.org/jira/browse/SOLR-14433) (David Smiley)
- bin/solr and bin\solr.cmd invoke jstack &lt;SOLR_PID&gt; before forceful termination, if jstack is available. Also, bin\solr.cmd executes forceful termination even port is unbinded already [SOLR-14442](https://issues.apache.org/jira/browse/SOLR-14442) (Christine Poerschke) (Mikhail Khludnev)
- Autoscaling "cores" preference now retrieves the core count more efficiently, and counts all cores. [SOLR-14472](https://issues.apache.org/jira/browse/SOLR-14472) (David Smiley)
- Introducing {!bool excludeTags=...} for Query DSL. [SOLR-14539](https://issues.apache.org/jira/browse/SOLR-14539) (Mikhail Khludnev)
- Add BlockMax-WAND support to ReRank queries [SOLR-14552](https://issues.apache.org/jira/browse/SOLR-14552) (Tomás Fernández Löbbe)
- Add BlockMax-WAND support for queries where the score is requested [SOLR-14554](https://issues.apache.org/jira/browse/SOLR-14554) (Tomás Fernández Löbbe)
- CoreAdminAPI's parameters instanceDir and dataDir are now validated, and must be relative to either SOLR_HOME, SOLR_DATA_HOME or coreRootDir. Added new solr.xml config 'allowPaths', controlled by system property 'solr.allowPaths' that allows you to add other allowed paths when needed. [SOLR-14561](https://issues.apache.org/jira/browse/SOLR-14561) 
- Limit the HTTP security headers to "/solr" end point [SOLR-14634](https://issues.apache.org/jira/browse/SOLR-14634) (noble)
- Do not collect expand documents when expand.rows=0 [SOLR-8306](https://issues.apache.org/jira/browse/SOLR-8306) (Marshall Sanders) (Amelia Henderson)

### Fixed (33 changes)

- Return proper error when invalid parentFilter is passed in ChildDocTransformer [SOLR-13199](https://issues.apache.org/jira/browse/SOLR-13199) (Johannes Kloos) (Munendra S N) (David Smiley) (Mikhail Khludnev)
- Return 400 status code on invalid dynamic field for Edismax's user Fields [SOLR-13203](https://issues.apache.org/jira/browse/SOLR-13203) (Johannes Kloos) (mrsoong) (Munendra S N)
- IndexSizeTrigger aboveOp / belowOp properties not in valid properties. [SOLR-13264](https://issues.apache.org/jira/browse/SOLR-13264) (Christine Poerschke) (ab)
- Improve distributed locking around managed schema upgrade process. [SOLR-14128](https://issues.apache.org/jira/browse/SOLR-14128) (ab)
- Handle dotted fields in legacy Analytics Component [SOLR-14291](https://issues.apache.org/jira/browse/SOLR-14291) (Anatolii Siuniaev) (Mikhail Khludnev)
- Ensure Solr always includes the stacktrace for exceptions by using '-OmitStackTraceInFastThrow' [SOLR-14302](https://issues.apache.org/jira/browse/SOLR-14302) (hossman)
- HttpClusterStateProvider throws exception when only one node down. [SOLR-14317](https://issues.apache.org/jira/browse/SOLR-14317) (Lyle Wang) (Ishan Chattopadhyaya)
- Return proper error message when non-BinaryResponseParser is used in solrJ [SOLR-14345](https://issues.apache.org/jira/browse/SOLR-14345) (Munendra S N)
- Autoscaling placement wrong when concurrent replica placements are calculated. [SOLR-14347](https://issues.apache.org/jira/browse/SOLR-14347) (ab)
- PeerSync should not fail with SocketTimeoutException from hanging nodes [SOLR-14356](https://issues.apache.org/jira/browse/SOLR-14356) (Cao Manh Dat)
- Zk StatusHandler now parse dynamic zk server config if supported, fixing Admin UI Zookeeper Status screen in case dynamic reconfig host list differs from static zkHost string [SOLR-14371](https://issues.apache.org/jira/browse/SOLR-14371) (janhoy)
- Avoid creating new exceptions for every request made to MDCAwareThreadPoolExecutor by distributed search. This is a fix for incomplete optimization made by SOLR-11880 in Solr 7.4 which fixed distributed updates but not distributed search. [SOLR-14402](https://issues.apache.org/jira/browse/SOLR-14402) [SOLR-11880](https://issues.apache.org/jira/browse/SOLR-11880) (shalin)
- Existing violations allow bypassing policy rules when adding new replicas [SOLR-14409](https://issues.apache.org/jira/browse/SOLR-14409) (noble) (ab)
- New examples in solr.in.cmd in Solr 8.5 don't work as provided [SOLR-14421](https://issues.apache.org/jira/browse/SOLR-14421) (Colvin Cowie) (janhoy)
- SegmentsInfoRequestHandler does not release IndexWriter [SOLR-14431](https://issues.apache.org/jira/browse/SOLR-14431) (Tiziano Degaetano) (ab)
- Fix Content-Type header usage when a request is forwarded from Solr node to Solr node with compression enabled [SOLR-14456](https://issues.apache.org/jira/browse/SOLR-14456) (samuelgmartinez) (Houston Putman)
- Solr Admin ZkStatus page now works with ZK 3.6, without 'For input string: "null"' error [SOLR-14463](https://issues.apache.org/jira/browse/SOLR-14463) (janhoy) (Bernd Wahlen)
- Fix relatedness() stat in json.facets to no longer cause server errors (or nonsense results) when combined with allBuckets:true. [SOLR-14467](https://issues.apache.org/jira/browse/SOLR-14467) (Michael Gibney) (hossman)
- Fix incorrect 'relatedness()' calculations in json.facet 'terms' when 'prefix' option is used [SOLR-14477](https://issues.apache.org/jira/browse/SOLR-14477) (hossman)
- Intercepting internode requests in KerberosPlugin when HTTP/2 client is used [SOLR-14491](https://issues.apache.org/jira/browse/SOLR-14491) (Ishan Chattopadhyaya) (Moshe Bla)
- Fix ArrayIndexOutOfBoundsException in json.facet 'terms' when FacetFieldProcessorByHashDV is used with aggregations over multivalued numeric fields [SOLR-14492](https://issues.apache.org/jira/browse/SOLR-14492) (hossman)
- Upgrade to Caffeine 2.8.4, which fixes the cache poisoning issue. [SOLR-14498](https://issues.apache.org/jira/browse/SOLR-14498) (Jakub Zytka) (ab)
- ZkController LiveNodesListener has NullPointerException in startup race. [SOLR-14504](https://issues.apache.org/jira/browse/SOLR-14504) (Colvin Cowie) (ab)
- NPE in JsonTextWriter [SOLR-14516](https://issues.apache.org/jira/browse/SOLR-14516) (noble)
- Dont ignore 'mm' localparam on edismax queries using operators [SOLR-14517](https://issues.apache.org/jira/browse/SOLR-14517) (Yuriy Koval) (Jason Gerlowski)
- Fixed server errors from the json.facet allBuckets:true option when combined with refine:true [SOLR-14520](https://issues.apache.org/jira/browse/SOLR-14520) (Michael Gibney) (hossman)
- SolrCoreAware, ResourceLoaderAware should be honored for plugin loaded from packages [SOLR-14525](https://issues.apache.org/jira/browse/SOLR-14525) (noble)
- Fix duplicates issue in Atomic updates with add-distinct [SOLR-14550](https://issues.apache.org/jira/browse/SOLR-14550) (Thomas Corthals) (Munendra S N)
- Return 400 BAD REQUEST when field is missing on a Terms query parser request [SOLR-14577](https://issues.apache.org/jira/browse/SOLR-14577) (Tomás Fernández Löbbe)
- Correct SOLR_SSL_KEY_STORE and SOLR_SSL_TRUST_STORE example comments in solr.in.sh and solr.in.cmd files [SOLR-14584](https://issues.apache.org/jira/browse/SOLR-14584) (Aren Cambre) (Christine Poerschke)
- hl.fragsizeIsMinimum now defaults to true, thus fragments size like previous to Solr 8.5 and addresses a significant performance regression. [SOLR-14628](https://issues.apache.org/jira/browse/SOLR-14628) (David Smiley) (Michal Hlavac)
- /admin/luke was always showing 0 for indexHeapUsageBytes. It should work now. [SOLR-8394](https://issues.apache.org/jira/browse/SOLR-8394) (Steve Molloy) (Isabelle Giguere) (David Smiley)
- When removing zk node /security.json, security is now disabled gracefully [SOLR-9679](https://issues.apache.org/jira/browse/SOLR-9679) (janhoy)

### Other (56 changes)

- Fail complation on warnings, 9x gradle-only [LUCENE-9411](https://issues.apache.org/jira/browse/LUCENE-9411) (Erick Erickson) (Dawid Weiss)
- Improve error messages when unknown aggregations are specified in the request [SOLR-10157](https://issues.apache.org/jira/browse/SOLR-10157) (hossman) (Munendra S N)
- Visit Solr logging, it's too noisy. Note particularly that the messages for opening a new searcher have changed and include the autowarm time. [SOLR-11934](https://issues.apache.org/jira/browse/SOLR-11934) (Erick Erickson)
- SolrDispatchFilter expensive non-conditional debug line degrades performance [SOLR-12353](https://issues.apache.org/jira/browse/SOLR-12353) (Pascal Proulx) (Erick Erickson)
- Clean up any test failures resulting from defaulting to async logging [SOLR-13268](https://issues.apache.org/jira/browse/SOLR-13268) (Erick Erickson)
- Ensure explicit GCs are concurrent by adding '+ExplicitGCInvokesConcurrent'. [SOLR-13492](https://issues.apache.org/jira/browse/SOLR-13492) (Guna Sekhar Dora) (Shawn Heisey) (Munendra S N)
- Remove redundant defaults from ImplicitPlugins.json [SOLR-13842](https://issues.apache.org/jira/browse/SOLR-13842) (Munendra S N)
- HDFSSyncSliceTest and SyncSliceTest started failing frequently [SOLR-13886](https://issues.apache.org/jira/browse/SOLR-13886) (Kevin Risden)
- BlobRepository reads max jar size from `runtime.lib.size` system property. Old `runtme.lib.size` is Deprecated [SOLR-13893](https://issues.apache.org/jira/browse/SOLR-13893) (Erick Erickson) (Kesharee Nandan Vishwakarma) (Munendra S N)
- Remove redundant checks in SpellCheckCollator and add tests for spellcheck with collapse [SOLR-13944](https://issues.apache.org/jira/browse/SOLR-13944) (Stefan) (Munendra S N) (Tomas Eduardo Fernandez Lobbe)
- HDFS support is deprecated. It is scheduled to be removed as of 9.0. Please see JIRA for more details. [SOLR-14021](https://issues.apache.org/jira/browse/SOLR-14021) (Joel Bernstein) (Ishan Chattopadhyaya)
- Deprecate CDCR [SOLR-14022](https://issues.apache.org/jira/browse/SOLR-14022) (Joel Bernstein) (Ishan Chattopadhyaya)
- Data Import Handler is deprecated. It is scheduled to be removed as of 9.0 and a community supported package for the same may now be used instead. [SOLR-14066](https://issues.apache.org/jira/browse/SOLR-14066) (Ishan Chattopadhyaya) (janhoy)
- Major redesign of the Solr Reference Guide [SOLR-14173](https://issues.apache.org/jira/browse/SOLR-14173) (Cassandra Targett)
- SolrResourceLoader: marked many methods as deprecated, and in some cases rerouted exiting logic to avoid them. [SOLR-14197](https://issues.apache.org/jira/browse/SOLR-14197) (David Smiley)
- Fix or suppress 14 resource leak warnings in apache/solr/core [SOLR-14226](https://issues.apache.org/jira/browse/SOLR-14226) (Andras Salaman via Erick Erickson)
- Improve error reporting in SolrConfig [SOLR-14280](https://issues.apache.org/jira/browse/SOLR-14280) (Andras Salamon) (Jason Gerlowski)
- Update netty to 4.1.46 [SOLR-14296](https://issues.apache.org/jira/browse/SOLR-14296) (Andras Solaman) (Erick Erickson)
- Upgrade Zookeeper to 3.5.7 [SOLR-14312](https://issues.apache.org/jira/browse/SOLR-14312) (Erick Erickson)
- Hardened MDC logging; sometimes info was absent [SOLR-14351](https://issues.apache.org/jira/browse/SOLR-14351) (David Smiley)
- Upgrade Tika to 1.24 [SOLR-14367](https://issues.apache.org/jira/browse/SOLR-14367) (Mibo) (Erick Erickson)
- Update Jetty to 9.4.27 and dropwizard-metrics version to 4.1.5 [SOLR-14386](https://issues.apache.org/jira/browse/SOLR-14386) (Erick Erickson)
- Removed internal-ish ScoreFilter marker interface; only used by {!collapse}. Removed needless code in SolrIndexSearcher.getDocSet(List&lt;Query&gt;) (processes some filter queries). [SOLR-14391](https://issues.apache.org/jira/browse/SOLR-14391) (David Smiley)
- Fix or suppress warnings in solr/test-framework [SOLR-14455](https://issues.apache.org/jira/browse/SOLR-14455) (Erick Erickson)
- Replaced commons-fileupload dependency with using Jetty's facilities. [SOLR-14461](https://issues.apache.org/jira/browse/SOLR-14461) (David Smiley)
- Upgrade log4j2 to latest release (2.13.2) [SOLR-14466](https://issues.apache.org/jira/browse/SOLR-14466) (Erick Erickson)
- Fix remaining auxilliary class warnings in Solr [SOLR-14474](https://issues.apache.org/jira/browse/SOLR-14474) (Erick Erickson)
- Fix or suppress warnings in solr/cloud/api [SOLR-14480](https://issues.apache.org/jira/browse/SOLR-14480) (Erick Erickson)
- Fix or suppress warnings in solr/search/facet [SOLR-14482](https://issues.apache.org/jira/browse/SOLR-14482) (Erick Erickson)
- Fix or suppress 11 resource leak warnings in apache/solr/cloud [SOLR-14485](https://issues.apache.org/jira/browse/SOLR-14485) (Andras Salaman via Erick Erickson)
- Fix or suppress warnings in solr/search/function [SOLR-14495](https://issues.apache.org/jira/browse/SOLR-14495) (Erick Erickson)
- Fix or suppress warnings in solr/cloud/autoscaling/ [SOLR-14519](https://issues.apache.org/jira/browse/SOLR-14519) (Erick Erickson)
- fix or suppress warnings in apache/solr/core [SOLR-14526](https://issues.apache.org/jira/browse/SOLR-14526) (Erick Erickson)
- Fix or suppress warnings in solr/handler/admin [SOLR-14533](https://issues.apache.org/jira/browse/SOLR-14533) (Andras Salamon) (Erick Erickson)
- Fix or suppress warnings in apache/solr/handler/component [SOLR-14535](https://issues.apache.org/jira/browse/SOLR-14535) (Erick Erickson)
- Fix or suppress warnings in apache/solr/common [SOLR-14536](https://issues.apache.org/jira/browse/SOLR-14536) (Erick Erickson)
- Fix or suppress remaining warnings in apache/solr/handler [SOLR-14538](https://issues.apache.org/jira/browse/SOLR-14538) (Erick Erickson)
- Ensure classes that implement equals implement hashCode or suppress warnings [SOLR-14541](https://issues.apache.org/jira/browse/SOLR-14541) (gezapeti) (Ilan Ginsburg) (Erick Erickson)
- Fix or suppress warnings in solr/handler/dataimport [SOLR-14542](https://issues.apache.org/jira/browse/SOLR-14542) (Erick Erickson)
- Fix or suppress warnings in apache/solr/search [SOLR-14543](https://issues.apache.org/jira/browse/SOLR-14543) (Erick Erickson)
- Fix or suppress warnings in solr/client/solrj/io/eval [SOLR-14544](https://issues.apache.org/jira/browse/SOLR-14544) (Erick Erickson)
- Fix or suppress warnings in apache/solr/update [SOLR-14545](https://issues.apache.org/jira/browse/SOLR-14545) (Erick Erickson)
- Fix or suppress warnings in solr/client/solrj/io/stream [SOLR-14547](https://issues.apache.org/jira/browse/SOLR-14547) (Erick Erickson)
- Address warning: static member should be qualified by type name [SOLR-14548](https://issues.apache.org/jira/browse/SOLR-14548) (Mike Drob)
- Fix or suppress warnings in solrj/cloud/autoscaling [SOLR-14556](https://issues.apache.org/jira/browse/SOLR-14556) (Erick Erickson)
- Fix or suppress warnings in solr/core/src/java/org/apache/solr/util, response, cloud, security, schema, api [SOLR-14559](https://issues.apache.org/jira/browse/SOLR-14559) (Erick Erickson)
- Fix or suppress warnings in solr/contrib [SOLR-14563](https://issues.apache.org/jira/browse/SOLR-14563) (Erick Erickson)
- Fix or suppress remaining warnings in solr/core [SOLR-14564](https://issues.apache.org/jira/browse/SOLR-14564) (Erick Erickson)
- Fix or suppress warnings in solrj/impl and solrj/io/graph [SOLR-14565](https://issues.apache.org/jira/browse/SOLR-14565) (Erick Erickson)
- Fix or suppress remaining warnings in solrj [SOLR-14567](https://issues.apache.org/jira/browse/SOLR-14567) (Erick Erickson)
- Fix or suppress warnings in solrj/src/test [SOLR-14573](https://issues.apache.org/jira/browse/SOLR-14573) (Erick Erickson)
- Fix or suppress warnings in solr/core/src/test (parts 1 and 2) [SOLR-14574](https://issues.apache.org/jira/browse/SOLR-14574) (Erick Erickson)
- Remove IntelliJ //noinspection comments [SOLR-14589](https://issues.apache.org/jira/browse/SOLR-14589) (Erick Erickson)
- Upgrade Restlet to 2.4.3 [SOLR-14603](https://issues.apache.org/jira/browse/SOLR-14603) (marcussorealheis)
- Update commons-cli to 1.4 [SOLR-7880](https://issues.apache.org/jira/browse/SOLR-7880) (Erick Erickson)
- SolrjNamedThreadFactory is deprecated in favor of SolrNamedThreadFactory. DefaultSolrThreadFactory is removed from solr-core in favor of SolrNamedThreadFactory in solrj package and all solr-core classes now use SolrNamedThreadFactory. [SOLR-9909](https://issues.apache.org/jira/browse/SOLR-9909) (Andras Salamon) (shalin)


[8.5.2] - 2020-05-26
--------------------

### Fixed (2 changes)

- Fix Admin UI collection/core drop-downs placeholder text. Completes work started in SOLR-14359 [SOLR-14411](https://issues.apache.org/jira/browse/SOLR-14411) [SOLR-14359](https://issues.apache.org/jira/browse/SOLR-14359) (janhoy)
- Fix bug in shards.preference behavior, base replica selection strategy not applied to the last group of equivalent replicas. [SOLR-14471](https://issues.apache.org/jira/browse/SOLR-14471) (Michael Gibney) (Tomás Fernández Löbbe)


[8.5.1] - 2020-04-16
--------------------

### Fixed (1 change)

- Admin UI collection/core drop-downs had wrong placeholder text. Fixed by upgrading angular-chosen This fix was incomplete, see SOLR-14411 for the followup [SOLR-14359](https://issues.apache.org/jira/browse/SOLR-14359) [SOLR-14411](https://issues.apache.org/jira/browse/SOLR-14411) (janhoy)


[8.5.0] - 2020-03-24
--------------------

### Added (7 changes)

- Synonyms can be individually boosted by marking them with '|&lt;boost&gt;' in the synonyms file, and adding a DelimitedBoostTokenFilter to the analysis chain [SOLR-12238](https://issues.apache.org/jira/browse/SOLR-12238) (Alessandro Benedetti) (Alan Woodward)
- Introducing uniqueBlock({!v=type:parent}) aggregation [SOLR-12325](https://issues.apache.org/jira/browse/SOLR-12325) (Anatolii Siuniaev) (Mikhail Khludnev)
- Introducing json.queries in JSON Request API. Every property of this object holds one or many named Query DSL queries. It's optional and doesn't impact response without explicit referencing these queries by names [SOLR-12490](https://issues.apache.org/jira/browse/SOLR-12490) (Anatolii Siuniaev) (Mikhail Khludnev)
- New cross collection join filter (XCJF) [SOLR-13749](https://issues.apache.org/jira/browse/SOLR-13749) (Dan Fox) (Kevin Watters) (Gus Heck)
- Add postlogs command line tool for indexing Solr logs [SOLR-14130](https://issues.apache.org/jira/browse/SOLR-14130) (Joel Bernstein)
- Support backtick phrase queries in Streaming Expressions [SOLR-14139](https://issues.apache.org/jira/browse/SOLR-14139) (Joel Bernstein)
- New delete() Stream Decorator [SOLR-14241](https://issues.apache.org/jira/browse/SOLR-14241) (hossman)

### Changed (25 changes)

- The Unified highlighter has two new passage sizing parameters, hl.fragAlignRatio and hl.fragsizeIsMinimum, with defaults that aim to better center matches in fragments than previously. See the ref guide. Regardless of the settings, the passages may be sized differently than before. [LUCENE-9093](https://issues.apache.org/jira/browse/LUCENE-9093) (Nándor Mátravölgyi) (David Smiley)
- Add Support for DateRangeField in JSON Facet range [SOLR-10567](https://issues.apache.org/jira/browse/SOLR-10567) (Stephen Weiss) (Munendra S N)
- filter in BoolQParser and {"bool":{"filter":..}} in Query DSL are cached by default [SOLR-13808](https://issues.apache.org/jira/browse/SOLR-13808) (Mikhail Khludnev)
- Add "top-level" DV implementation for {!terms} queries. This approach tends to be more efficient for queries with very large numbers of terms. The new implementation is used by default for method=docValuesTermsFilter terms queries that are searching 500 or more terms. Users wishing to ignore this heuristic can choose the docValuesTermsFilterTopLevel or docValuesTermsFilterPerSegment methods directly. [SOLR-13890](https://issues.apache.org/jira/browse/SOLR-13890) (Jason Gerlowski) (Joel Bernstein) (David Smiley)
- New "top-level" docValues join implementation [SOLR-13892](https://issues.apache.org/jira/browse/SOLR-13892) (Jason Gerlowski) (Joel Bernstein)
- In GraphHandler, support &lt;expressible&gt; configuration and deprecate &lt;streamFunctions&gt; configuration. [SOLR-13965](https://issues.apache.org/jira/browse/SOLR-13965) (Eric Pugh) (Christine Poerschke)
- Java's SecurityManager sandbox can be enabled via environment variable, SOLR_SECURITY_MANAGER_ENABLED=true. [SOLR-13984](https://issues.apache.org/jira/browse/SOLR-13984) (rmuir)
- The shareSchema solr.xml option now supports SolrCloud. shareSchema is useful when you have many cores per node and large schemas. [SOLR-14040](https://issues.apache.org/jira/browse/SOLR-14040) (David Smiley)
- Fix varargs precommit warnings [SOLR-14042](https://issues.apache.org/jira/browse/SOLR-14042) (Andraas Salamon) (Jason Gerlowski)
- Replace Java serialization with Javabin in the Overseer queues [SOLR-14095](https://issues.apache.org/jira/browse/SOLR-14095) (Tomás Fernández Löbbe)
- Define JavaScript methods 'includes' and 'startsWith' to ensure AdminUI can be displayed when using Internet Explorer 11 [SOLR-14120](https://issues.apache.org/jira/browse/SOLR-14120) (jafurrer)
- Make &lt;expressible&gt; plugins work with packages [SOLR-14125](https://issues.apache.org/jira/browse/SOLR-14125) (noble)
- Reuse Jackson ObjectMapper in AuditLoggerPlugin [SOLR-14129](https://issues.apache.org/jira/browse/SOLR-14129) (janhoy)
- Add maxQueryLength option to DirectSolrSpellchecker. [SOLR-14131](https://issues.apache.org/jira/browse/SOLR-14131) (Andy Webb) (Bruno Roustant)
- Upgrade Angular JS 1.3.8 to 1.7.9 [SOLR-14132](https://issues.apache.org/jira/browse/SOLR-14132) (Kevin Risden)
- Jetty's InetAccessHandler can be enabled via environment variables, SOLR_IP_WHITELIST and SOLR_IP_BLACKLIST. These variables can restrict access to Solr based on IP addresses/networks. [SOLR-14136](https://issues.apache.org/jira/browse/SOLR-14136) (rmuir)
- Jetty's NCSA-formatted RequestLog can be enabled via environment variable, SOLR_REQUESTLOG_ENABLED=true. This will respect SOLR_LOGS_DIR if it is set. [SOLR-14138](https://issues.apache.org/jira/browse/SOLR-14138) (rmuir)
- Return correct isolation level when retrieving it from the SQL Connection [SOLR-14154](https://issues.apache.org/jira/browse/SOLR-14154) (Nick Vercammen) (Kevin Risden)
- Highlighting now works when the uniqueKey field is not stored but has docValues. And the original highlighter can now highlight text fields from docValues. [SOLR-14194](https://issues.apache.org/jira/browse/SOLR-14194) (Andrzej Wislowski) (David Smiley)
- Upgrade restlet to version 2.4.0 [SOLR-14221](https://issues.apache.org/jira/browse/SOLR-14221) (janhoy)
- HdfsDirectory now supports indexing geo-points, ranges or shapes. [SOLR-14242](https://issues.apache.org/jira/browse/SOLR-14242) (Adrien Grand)
- Validate Replica / ReplicaInfo on creation. [SOLR-14245](https://issues.apache.org/jira/browse/SOLR-14245) (ab)
- export command to have an option to write to a zip file [SOLR-14270](https://issues.apache.org/jira/browse/SOLR-14270) (noble)
- Make sharedLib configurable through system property. Also allow multiple paths, separated by comma. See Reference Guide 'format-of-solr-xml.adoc' and comment in 'solr.in.sh' for details [SOLR-14281](https://issues.apache.org/jira/browse/SOLR-14281) (janhoy)
- Upgrade Jaegar to 1.1.0 [SOLR-14286](https://issues.apache.org/jira/browse/SOLR-14286) (Cao Manh Dat)

### Fixed (29 changes)

- Support handling OPTIONS request for Hadoop authentication filter [SOLR-11554](https://issues.apache.org/jira/browse/SOLR-11554) (Peter Cseh) (Kevin Risden)
- Adding existence queries for PointFields. DocValuesFieldExistsQuery and NormsFieldExistsQuery are used for existence queries when possible. [SOLR-11746](https://issues.apache.org/jira/browse/SOLR-11746) (Houston Putman) (hossman) (Kai Chan)
- ConcurrentUpdateSolrClient doesn't respect timeouts for commits and optimize. [SOLR-12550](https://issues.apache.org/jira/browse/SOLR-12550) (Marc A. Morissette) (Bérénice MAUREL) (shalin)
- Fixed DocExpirationUpdateProcessorFactory to work with BasicAuth and other auth plugins that delegate to PKI for server initiated node-to-node communication. [SOLR-12859](https://issues.apache.org/jira/browse/SOLR-12859) (hossman)
- Add hashCode for autoscaling.Condition to accompany the already present equals. [SOLR-13041](https://issues.apache.org/jira/browse/SOLR-13041) (Zsolt Gyulavari) (Christine Poerschke)
- Fix lsof edge cases in the solr CLI script [SOLR-13089](https://issues.apache.org/jira/browse/SOLR-13089) (Martijn Koster) (janhoy)
- Deny atomic update for route.field, uniqueKey, version and throw exception. [SOLR-13411](https://issues.apache.org/jira/browse/SOLR-13411) (Dr Oleg Savrasov) (Mikhail Khludnev)
- Use default idleTimeout instead of 0 for HTTP2 requests. [SOLR-13887](https://issues.apache.org/jira/browse/SOLR-13887) (Houston Putman)
- Fix unsafe publication of Terms object in ZkShardTerms that can cause visibility issues and race conditions under contention. [SOLR-13897](https://issues.apache.org/jira/browse/SOLR-13897) (shalin)
- Ensure bin/solr's -q and -v options work with examples [SOLR-14017](https://issues.apache.org/jira/browse/SOLR-14017) (Andy Vuong) (Jason Gerlowski)
- Admin UI display for "state.json" should be in a scollable region [SOLR-14038](https://issues.apache.org/jira/browse/SOLR-14038) (Kevin Risden)
- Fix IndexOutOfBoundsException in PeerSync that can prevent nodes from recovering under certain circumstances. [SOLR-14058](https://issues.apache.org/jira/browse/SOLR-14058) (yonik)
- Fix segment look ahead NPE in CollapsingQParserPlugin [SOLR-14073](https://issues.apache.org/jira/browse/SOLR-14073) (Joel Bernstein)
- Handle the case in `delete-copy-field` when source is a dynamic field [SOLR-14090](https://issues.apache.org/jira/browse/SOLR-14090) (Frank Iversen) (Munendra S N)
- Fixed @LogLevel annotation in test-framework to correctly 'unset' Loggers after test [SOLR-14099](https://issues.apache.org/jira/browse/SOLR-14099) (hossman)
- SimUtils converts v2 to v1 request params incorrectly. [SOLR-14122](https://issues.apache.org/jira/browse/SOLR-14122) (Li Cao) (ab)
- Collection metadata remains in zookeeper if too many shards are requested. This also fixes a bug where an inability to assign a node based on existing autoscaling policy resulted in a server error instead of a bad request. [SOLR-14172](https://issues.apache.org/jira/browse/SOLR-14172) (Andras Salamon) (Kevin Risden) (shalin)
- Switch from String.trim() to StringUtils.isBlank() in query parsers [SOLR-14189](https://issues.apache.org/jira/browse/SOLR-14189) (Andy Webb) (Uwe Schindler)
- Race condition between SchemaManager and ZkIndexSchemaReader. [SOLR-14192](https://issues.apache.org/jira/browse/SOLR-14192) (ab)
- AdminUI login not working for JWTAuth when blockUnknown=false [SOLR-14196](https://issues.apache.org/jira/browse/SOLR-14196) (janhoy)
- Nullpointer exception in AuditEvent when initialized from AuthorizationContext [SOLR-14198](https://issues.apache.org/jira/browse/SOLR-14198) (janhoy)
- Do not fail when given timeout to connectionImpl.isValid() = 0 [SOLR-14205](https://issues.apache.org/jira/browse/SOLR-14205) (Nick Vercammen) (Kevin Risden)
- Fix logging statements with less or more arguments than placeholders. [SOLR-14207](https://issues.apache.org/jira/browse/SOLR-14207) (shalin)
- Introduced an issue for rolling restarts (Incompatible Java serialization). This change Fixes the compatibility issue while keeping the functionality in SOLR-14095. [SOLR-14219](https://issues.apache.org/jira/browse/SOLR-14219) [SOLR-14095](https://issues.apache.org/jira/browse/SOLR-14095) (Andy Webb) (Tomás Fernández Löbbe)
- Do not log error when trying to consume non-existing input stream due to Expect: 100-continue [SOLR-14250](https://issues.apache.org/jira/browse/SOLR-14250) (janhoy)
- Avoid NullPointerException in AggregateMetric. [SOLR-14252](https://issues.apache.org/jira/browse/SOLR-14252) (Andy Webb) (ab)
- Admin UI Properties screen does not show colons [SOLR-14287](https://issues.apache.org/jira/browse/SOLR-14287) (janhoy)
- IndexFetcher doesn't reset error count to 0 after the last packet is received [SOLR-14299](https://issues.apache.org/jira/browse/SOLR-14299) (Pushkar Raste) (Mike Drob)
- TextField.analyzeMultiTerm does not throw an exception when Analyzer returns no terms. [SOLR-6613](https://issues.apache.org/jira/browse/SOLR-6613) (Bruno Roustant)

### Other (15 changes)

- Document in Reference Guide how to disable or reduce swapping [SOLR-10306](https://issues.apache.org/jira/browse/SOLR-10306) (janhoy)
- (at least) 2 distinct failures possible when clients attempt searches during SolrCore reload. Removed Bandaid kludge. [SOLR-11035](https://issues.apache.org/jira/browse/SOLR-11035) (Erick Erickson)
- Solrj client will retry requests on SSLException with a suppressed SocketException [SOLR-13778](https://issues.apache.org/jira/browse/SOLR-13778) (very likely a hard-closed socket connection)
- Replace redundent test only copy of '_default' configset with SolrTestCase logic to correctly set 'solr.default.confdir' system property [SOLR-13794](https://issues.apache.org/jira/browse/SOLR-13794) (hossman)
- Process execution is removed from SystemInfoHandler. A best-effort attempt to execute `uname -a` and "`uptime`" on non-Windows platforms is no longer made. [SOLR-13983](https://issues.apache.org/jira/browse/SOLR-13983) (rmuir)
- Refactor HttpShardHandler.prepDistributed method. [SOLR-13996](https://issues.apache.org/jira/browse/SOLR-13996) (shalin)
- Make sure tests don't pickup other Hadoop installs [SOLR-14047](https://issues.apache.org/jira/browse/SOLR-14047) (Kevin Risden)
- Upgrade to Tika 1.23 when available [SOLR-14054](https://issues.apache.org/jira/browse/SOLR-14054) (Tim Allison)
- Remove deprecated soLingerTime when configuring Jetty connector [SOLR-14091](https://issues.apache.org/jira/browse/SOLR-14091) (Matthias Krueger) (Kevin Risden)
- Add WARN to Solr log that embedded ZK is not supported in production [SOLR-14114](https://issues.apache.org/jira/browse/SOLR-14114) (janhoy)
- Fix 20 Resource Leak warnings in SolrJ's apache/solr/common [SOLR-14169](https://issues.apache.org/jira/browse/SOLR-14169) (Andras Salamon) (Tomás Fernández Löbbe)
- Internal 'test' variable DirectUpdateHandler2.commitOnClose has been removed and replaced with TestInjection.skipIndexWriterCommitOnClose. Users that modified DUH2.commitOnClose in test cases for custom plugins/modicitations should now use TestInjection instead. [SOLR-14184](https://issues.apache.org/jira/browse/SOLR-14184) (hossman)
- Upgrade JQuery to 3.4.1 [SOLR-14209](https://issues.apache.org/jira/browse/SOLR-14209) (Kevin Risden)
- Improve ClusterStateMockUtil and make its methods public. [SOLR-14248](https://issues.apache.org/jira/browse/SOLR-14248) (shalin)
- Update jvm-settings.adoc [SOLR-14263](https://issues.apache.org/jira/browse/SOLR-14263) (Erick Erickson)


[8.4.1] - 2020-01-13
--------------------

### Upgrade Notes (1 change)

- Package manager now stores keys in package store instead of ZK. If you're using package manager and have already added any repositories, then you would need to re-add all the keys from /keys/exe location, one-by-one, using: "bin/solr add-key &lt;keyfile.der&gt;" [SOLR-14158](https://issues.apache.org/jira/browse/SOLR-14158) 

### Changed (1 change)

- Package manager to store public keys in a special "trusted" location instead of in ZooKeeper [SOLR-14158](https://issues.apache.org/jira/browse/SOLR-14158) (noble) (Ishan Chattopadhyaya)

### Fixed (4 changes)

- Cleanup Jetty SslContextFactory usage [SOLR-14106](https://issues.apache.org/jira/browse/SOLR-14106) (Ryan Rockenbaugh) (Jan Hoydahl) (Kevin Risden)
- Always log to stdout from server/scripts/cloud-scripts/zkcli.{bat|sh} [SOLR-14109](https://issues.apache.org/jira/browse/SOLR-14109) (janhoy)
- SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION needs to work with Jetty server/client SSL contexts [SOLR-14163](https://issues.apache.org/jira/browse/SOLR-14163) (Kevin Risden)
- SolrResponse serialVersionUID has changed in a backward incompatible way [SOLR-14165](https://issues.apache.org/jira/browse/SOLR-14165) (Andy Webb) (noble)


[8.4.0] - 2019-12-29
--------------------

### Upgrade Notes (11 changes)

- QueryResponse.getExplainMap() type has changed from Map&lt;String, String&gt; to Map&lt;String, Object&gt; in order to accommodate structured explanations. This is a partially back-compatible change - compiled third-party components will work the same as before due to type erasure but source code changes may be required. [SOLR-13806](https://issues.apache.org/jira/browse/SOLR-13806) 
- Deprecate legacy SolrCache implementations. Users are encouraged to transition their configurations to use org.apache.solr.search.CaffeineCache instead. [SOLR-13817](https://issues.apache.org/jira/browse/SOLR-13817) (ab)
- org.apache.solr.search.grouping.distributed.command.QueryCommand.Builder has new method 'setMainQuery' which is used to set top-level query. build() would fail if called without setting mainQuery. [SOLR-13823](https://issues.apache.org/jira/browse/SOLR-13823) 
- timeAllowed parameter is allowed to have 0 value [SOLR-13904](https://issues.apache.org/jira/browse/SOLR-13904) (Houston Putman) (Mikhail Khludnev)
- Using Collapse filter or expand component with grouping is explicitly disallowed as the combination would cause inconsistent behavior and NPEs. [SOLR-13970](https://issues.apache.org/jira/browse/SOLR-13970) 
- The default configset no longer has the following: - Library inclusions (&lt;lib ../&gt;) for extraction, solr-cell libs, clustering, velocity, LTR and language identifier - /browse, /tvrh and /update/extract handlers - TermVector component [SOLR-13978](https://issues.apache.org/jira/browse/SOLR-13978) (if someone wants it) (can be added using config APIs)
- Some security-related http headers such as Content-Security-Policy are now set. If you have custom html served up by Solr's http server that contains inline javascript, it will no longer execute in modern browsers. You can fix your JS code to not run inline anymore, or edit etc/jetty.xml and weaken the CSP, or remove/alter the headers with a reverse proxy. [SOLR-13982](https://issues.apache.org/jira/browse/SOLR-13982) (rmuir)
- VelocityResponseWriter has been hardened - only trusted configsets can render configset provided templates and rendering templates from request parameters has been removed. [SOLR-14025](https://issues.apache.org/jira/browse/SOLR-14025) 
- VelocityResponseWriter has been deprecated and may be removed in a future version. [SOLR-14065](https://issues.apache.org/jira/browse/SOLR-14065) 
- Untrusted configsets (ones that are uploaded via unsecured configset API) cannot use &lt;lib&gt; directive. Consider enabling authentication/authorization so that the uploaded configsets are trusted. Note: If you already have a collection using untrusted configset that uses &lt;lib&gt; directive, it will not load after upgrading to 8.4. You can re-upload your configset using "bin/solr zk -upconfig .." or place your libraries in the classpath and restart Solr. [SOLR-14071](https://issues.apache.org/jira/browse/SOLR-14071) 
- The "Blob Store" API and "runtimeLib" plugin mechanism that uses it is now considered deprecated. The replacement to it is the "Package Management" system, which includes a "File Store". These are experimental currently but will grow/stabalize/mature. [SOLR-14072](https://issues.apache.org/jira/browse/SOLR-14072) 

### Added (9 changes)

- Add DBSCAN clustering Streaming Evaluator [SOLR-10786](https://issues.apache.org/jira/browse/SOLR-10786) (Joel Bernstein)
- Support shards.preference in SolrJ for single shard collections. The parameter is now used by the CloudSolrClient and Streaming Expressions. [SOLR-12217](https://issues.apache.org/jira/browse/SOLR-12217) (Houston Putman) (Tomas Fernandez-Lobbe)
- A CLI based Package Manager ("bin/solr package help" for more details). [SOLR-13662](https://issues.apache.org/jira/browse/SOLR-13662) (Ishan Chattopadhyaya) (noble) (David Smiley) (Jan Hoydahl)
- A Package store to store and load package artifacts [SOLR-13821](https://issues.apache.org/jira/browse/SOLR-13821) (noble) (Ishan Chattopadhyaya)
- A Package management system with the following features: (a) A packages.json in ZK to store the configuration, (b) APIs to read/edit them, and (c) Isolated classloaders to load the classes from those packages when the 'class' attribute is prefixed with '&lt;package-name&gt;:' [SOLR-13822](https://issues.apache.org/jira/browse/SOLR-13822) (noble) (Ishan Chattopadhyaya)
- Add 'missing' aggregation in JSON FacetModule [SOLR-13911](https://issues.apache.org/jira/browse/SOLR-13911) (hossman) (Munendra S N)
- Add 'countvals' aggregation in JSON FacetModule [SOLR-13912](https://issues.apache.org/jira/browse/SOLR-13912) (hossman) (Munendra S N)
- Allow the precision Stream Evaluator to operate on matrices [SOLR-14043](https://issues.apache.org/jira/browse/SOLR-14043) (Joel bernstein)
- Allow the random Streaming Expression to create the x-axis [SOLR-14060](https://issues.apache.org/jira/browse/SOLR-14060) (Joel Bernstein)

### Changed (16 changes)

- Add support for aggregation on multivalued fields in JSON facets. min, max, avg, sum, sumsq, stddev, variance, percentile aggregations now have support for multivalued fields. [SOLR-11706](https://issues.apache.org/jira/browse/SOLR-11706) (hossman) (Munendra S N)
- 'javabin' must support a 1:1 mapping of the JSON update format [SOLR-13731](https://issues.apache.org/jira/browse/SOLR-13731) (noble)
- Support defining arbitrary autoscaling simulation scenarios. [SOLR-13831](https://issues.apache.org/jira/browse/SOLR-13831) (ab)
- Remove replica recovery terms with the replica term [SOLR-13844](https://issues.apache.org/jira/browse/SOLR-13844) (Houston Putman) (Cao Manh Dat)
- Move replica routing code to SolrJ. [SOLR-13865](https://issues.apache.org/jira/browse/SOLR-13865) (Houston Putman) (Tomas Fernandez-Lobbe)
- Use the new SolrCache.computeIfAbsent instead of non-atomic get / put in order to improve cache hit ratios. [SOLR-13898](https://issues.apache.org/jira/browse/SOLR-13898) (ab) (Ben Manes)
- Analytic component abandon requests exceedig limit passed via timeAllowed parameter [SOLR-13904](https://issues.apache.org/jira/browse/SOLR-13904) (Houston Putman) (Mikhail Khludnev)
- Make findRequestType in AuditEvent more robust [SOLR-13905](https://issues.apache.org/jira/browse/SOLR-13905) (janhoy)
- In the Cloud/tree section of the Admin UI, fix metadata panel and force an horizontal scrollbar for the tree [SOLR-13907](https://issues.apache.org/jira/browse/SOLR-13907) (Richard Goodman) (Tomás Fernández Löbbe)
- Add sensible defaults for the facet, random, facet2D, timeseries, stats and update Streaming Expressions [SOLR-13957](https://issues.apache.org/jira/browse/SOLR-13957) (Joel Bernstein)
- When using partial/atomic updates to remove child documents, we now support setting to null or an empty list as equivalent to the "remove" command. [SOLR-13961](https://issues.apache.org/jira/browse/SOLR-13961) (Thomas Wöckinger)
- Support postingsFormat and docValuesFormat in schema fields. [SOLR-13968](https://issues.apache.org/jira/browse/SOLR-13968) (Bruno Roustant)
- Clean up and document AuditEvent API [SOLR-13969](https://issues.apache.org/jira/browse/SOLR-13969) (janhoy)
- Fail the request when collapsing or expand is used with Grouping. [SOLR-13970](https://issues.apache.org/jira/browse/SOLR-13970) (Erick Erickson) (Joel Bernstein) (Munendra S N)
- Expose separate metrics for distributed and non-distributed requests. [SOLR-13979](https://issues.apache.org/jira/browse/SOLR-13979) (ab)
- Admin UI should not rely on javascript eval() [SOLR-13987](https://issues.apache.org/jira/browse/SOLR-13987) (rmuir) (Kevin Risden)

### Fixed (27 changes)

- Compute score if requested even when expanded docs not sorted by score in ExpandComponent. [SOLR-12393](https://issues.apache.org/jira/browse/SOLR-12393) (David Smiley) (Munendra S N)
- Use EUID instead of whoami to check for root in the bin/solr script [SOLR-13087](https://issues.apache.org/jira/browse/SOLR-13087) (Martijn Koster) (Jason Gerlowski)
- In dismax and edismax "minimum should match" queries, the &lt; operator not followed by a number will now return an HTTP 400 error rather than 500, and the error message will explain that &lt; must be followed by a number. [SOLR-13207](https://issues.apache.org/jira/browse/SOLR-13207) (Chris Hennick)
- Fix NPE in TermsComponent for DatePointField [SOLR-13403](https://issues.apache.org/jira/browse/SOLR-13403) (yonik) (Munendra S N)
- CoreContainer.auditloggerPlugin should be volatile [SOLR-13465](https://issues.apache.org/jira/browse/SOLR-13465) (janhoy) (hossman)
- SPLITSHARD using LINK method fails on disk usage checks. [SOLR-13563](https://issues.apache.org/jira/browse/SOLR-13563) (Andrew Kettmann) (ab)
- Fix BinaryField support for non-binary wt's [SOLR-13762](https://issues.apache.org/jira/browse/SOLR-13762) (Thomas Woeckinger) (Jason Gerlowski)
- NPE when calling /solr/admin/info/health on standalone solr [SOLR-13805](https://issues.apache.org/jira/browse/SOLR-13805) (Nicholas DiPiazza) (shalin)
- SolrJ QueryResponse._explainMap is incorrectly typed. [SOLR-13806](https://issues.apache.org/jira/browse/SOLR-13806) (Guna Sekhar Dorai) (ab)
- Fix ClassCastEx when score is requested with group.query. This also fixes score not being generated for distributed group.query case. [SOLR-13823](https://issues.apache.org/jira/browse/SOLR-13823) (Uwe Jäger) (Munendra S N)
- Fail on unknown operation in Request Parameters API [SOLR-13827](https://issues.apache.org/jira/browse/SOLR-13827) (Munendra S N) (noble)
- Fixed Backup failures - typically manifesting as NoSuchFileException - due to race conditions in saving/reserving commit points [SOLR-13872](https://issues.apache.org/jira/browse/SOLR-13872) (hossman)
- Robust support for ExpandComponent when used independently of CollapsingPostFilter. [SOLR-13877](https://issues.apache.org/jira/browse/SOLR-13877) [SOLR-7798](https://issues.apache.org/jira/browse/SOLR-7798) (Jörg Rathlev) (Michael Gibney) (Munendra S N)
- Collections API COLSTATUS does not check live_nodes when reporting replica's status. [SOLR-13882](https://issues.apache.org/jira/browse/SOLR-13882) (Erick Erickson) (Andrzej Białecki)
- Processing UpdateRequest with delegation token throws NullPointerException [SOLR-13921](https://issues.apache.org/jira/browse/SOLR-13921) (Istvan Farkas) (Kevin Risden)
- Tests configure Jetty differently than when running via start.jar [SOLR-13941](https://issues.apache.org/jira/browse/SOLR-13941) (janhoy) (Uwe Schindler)
- Fix: SPLITSHARD can cause data loss on a failure to commit after the sub-shards are active and a rollback is done to make parent shard active again [SOLR-13945](https://issues.apache.org/jira/browse/SOLR-13945) (Ishan Chattopadhyaya) (ab)
- Fix InterruptedException being swallowed in ZkStateReader’s getLeaderRetry method [SOLR-13950](https://issues.apache.org/jira/browse/SOLR-13950) (Andy Vuong) (Tomás Fernández Löbbe)
- Prometheus exporter in SolrCloud mode limited to 100 nodes [SOLR-13953](https://issues.apache.org/jira/browse/SOLR-13953) (Alex Jablonski) (Erick Erickson)
- Embedded ZooKeeper in Solr now does not try to load JettyAdminServer [SOLR-13954](https://issues.apache.org/jira/browse/SOLR-13954) (janhoy)
- LatLonPointSpatialField wasn't working correctly with atomic/partial updates or RTG. [SOLR-13966](https://issues.apache.org/jira/browse/SOLR-13966) (Thomas Wöckinger) (David Smiley)
- ConcurrentUpdateSolrClient connection stall prevention. [SOLR-13975](https://issues.apache.org/jira/browse/SOLR-13975) [SOLR-13896](https://issues.apache.org/jira/browse/SOLR-13896) (ab) (caomanhdat)
- solr create -c not working under Windows 10 [SOLR-13977](https://issues.apache.org/jira/browse/SOLR-13977) (janhoy)
- FIX: javabin performance regressions [SOLR-14013](https://issues.apache.org/jira/browse/SOLR-14013) (noble) (yonik) (Houston Putman)
- Untrusted configsets cannot use &lt;lib&gt; directive due to security reasons [SOLR-14071](https://issues.apache.org/jira/browse/SOLR-14071) (Ishan Chattopadhyaya)
- SPLITSHARD splitByPrefix doesn't work in async mode. This also affects splits triggered by the autoscale framework, which use async mode. [SOLR-14079](https://issues.apache.org/jira/browse/SOLR-14079) (Megan Carey) (Andy Vuong) (Bilal Waheed) (Ilan Ginzburg) (yonik)
- Fix grouping failure for date field in solrcloud [SOLR-9802](https://issues.apache.org/jira/browse/SOLR-9802) (Erick Erickson) (Munendra S N) (Vitaly Lavrov)

### Other (11 changes)

- Move some log messages to TRACE level [SOLR-12193](https://issues.apache.org/jira/browse/SOLR-12193) (gezapeti) (janhoy)
- Fix incorrect documentation for 'delete' op in Request parameters API [SOLR-12769](https://issues.apache.org/jira/browse/SOLR-12769) (Alexandre Rafalovitch) (Munendra S N)
- Solr Ref Guide no longer published in PDF format. [SOLR-13782](https://issues.apache.org/jira/browse/SOLR-13782) (Cassandra Targett)
- Upgrade jackson to 2.10.0 [SOLR-13818](https://issues.apache.org/jira/browse/SOLR-13818) (marungo) (Andras Salamon) (Kevin Risden)
- Strictly reject anything after JSON in most APIs [SOLR-13824](https://issues.apache.org/jira/browse/SOLR-13824) (Mikhail Khludnev) (Munendra S N)
- Provide mappings for jackson annotation @JsonProperty to use Jackson deserializer [SOLR-13841](https://issues.apache.org/jira/browse/SOLR-13841) (noble)
- SolrTestCaseJ4.getNextAvailablePort() has been deprecated (and will be removed in 9.0) since it is fundementally flawed. Users with tests that depend on this method should restructure them. [SOLR-13869](https://issues.apache.org/jira/browse/SOLR-13869) (hossman)
- Typos in the documentation. [SOLR-13885](https://issues.apache.org/jira/browse/SOLR-13885) (KoenDG) (Cassandra Targett)
- Code refactored to have collection name, slice name in Replica, Slice [SOLR-13992](https://issues.apache.org/jira/browse/SOLR-13992) (noble)
- Add thread safety annotations to Solr. This only introduces the annotations and doesn't add these to existing classes. [SOLR-13998](https://issues.apache.org/jira/browse/SOLR-13998) (Anshum Gupta) (Mark Miller)
- Document zkHost param on topic() stream [SOLR-13999](https://issues.apache.org/jira/browse/SOLR-13999) (Vergil Cheynov) (Jason Gerlowski)


[8.3.1] - 2019-12-03
--------------------

### Upgrade Notes (1 change)

- Velocity: The initialization parameters "params.resource.loader.enabled" and "solr.resource.loader.enabled" have been removed and replaced by Java system properties "velocity.resourceloader.params.enabled" and "velocity.resourceloader.solr.enabled" respectively (both turned off by default). Please see SOLR-13971 for more details. [SOLR-13971](https://issues.apache.org/jira/browse/SOLR-13971) 

### Fixed (5 changes)

- CoreContainer.auditloggerPlugin should be volatile [SOLR-13465](https://issues.apache.org/jira/browse/SOLR-13465) (janhoy) (hossman)
- Make findRequestType in AuditEvent more robust [SOLR-13905](https://issues.apache.org/jira/browse/SOLR-13905) (janhoy)
- Tests configure Jetty differently than when running via start.jar [SOLR-13941](https://issues.apache.org/jira/browse/SOLR-13941) (janhoy) (Uwe Schindler)
- JavaBinCodec has concurrent modification of CharArr resulting in corrupt internode updates [SOLR-13963](https://issues.apache.org/jira/browse/SOLR-13963) (Colvin Cowie) (noble)
- Velocity response writer's resource loading now possible only through startup parameters. [SOLR-13971](https://issues.apache.org/jira/browse/SOLR-13971) (Ishan Chattopadhyaya) (David Smiley)


[8.3.0] - 2019-11-02
--------------------

### Upgrade Notes (2 changes)

- Users who have written test cases that extend SolrTestCaseJ4 may see NullPointerExceptions if their tests directly reference both SolrTestCaseJ4.initCoreDataDir and SolrTestCaseJ4.deleteCore(). This change in behavior is due to a bug fix in deleteCore() to ensure the dataDir is properly reset in tests that call initCore()/deleteCore() multiple times in a given test (class). initCoreDataDir is now deprecated, and users are encouraged to use SolrTestCaseJ4.initAndGetDataDir() in it's place. See SOLR-13664 for more details. [SOLR-13664](https://issues.apache.org/jira/browse/SOLR-13664) 
- For JWTAuthPlugin, the 'jwkUrl' configuration key is deprecated and may be removed later, please use 'jwksUrl' instead. See SOLR-13734. [SOLR-13734](https://issues.apache.org/jira/browse/SOLR-13734) 

### Added (15 changes)

- QueryElevationComponent can have query rules configured with match="subset" wherein the words need only match a subset of the query's words and in any order. [SOLR-11866](https://issues.apache.org/jira/browse/SOLR-11866) (Bruno Roustant) (David Smiley)
- Ability to query aliases in Solr Admin UI [SOLR-13122](https://issues.apache.org/jira/browse/SOLR-13122) (janhoy)
- Support deterministic replica routing preferences for better cache usage [SOLR-13257](https://issues.apache.org/jira/browse/SOLR-13257) (Michael Gibney) (Christine Poerschke) (Tomás Fernández Löbbe)
- Add support for arbitrary ranges in JSON facet's Range facets. [SOLR-13272](https://issues.apache.org/jira/browse/SOLR-13272) (Apoorv Bhawsar) (Munendra S N) (Mikhail Khludnev) (Ishan Chattopadhyaya) (Jan Høydahl)
- Allow zplot to plot matrices [SOLR-13298](https://issues.apache.org/jira/browse/SOLR-13298) (Joel Bernstein)
- Two dimensional routed aliases are now available for organizing collections based on the data values of two fields. [SOLR-13375](https://issues.apache.org/jira/browse/SOLR-13375) (Gus Heck)
- SPLITSHARD implements a new splitByPrefix option that takes into account the actual document distribution when using compositeIds. Document distribution is calculated using the "id_prefix" field (if it exists) containing just the compositeId prefixes, or directly from the indexed "id" field otherwise. [SOLR-13399](https://issues.apache.org/jira/browse/SOLR-13399) (yonik) (Megan Carey)
- Add cat() stream source to create tuples from lines in local files [SOLR-13622](https://issues.apache.org/jira/browse/SOLR-13622) (Jason Gerlowski and Joel Bernstein)
- Add CsvStream, TsvStream Streaming Expressions and supporting Stream Evaluators [SOLR-13625](https://issues.apache.org/jira/browse/SOLR-13625) (Joel bernstein)
- Support integral plots, cosine distance and string truncation with math expressions [SOLR-13632](https://issues.apache.org/jira/browse/SOLR-13632) (Joel Bernstein)
- Add upper, lower, trim and split Stream Evaluators [SOLR-13667](https://issues.apache.org/jira/browse/SOLR-13667) (Joel Bernstein)
- command line option to export documents to a file [SOLR-13682](https://issues.apache.org/jira/browse/SOLR-13682) (noble)
- JWTAuthPlugin to support multiple JWKS endpoints [SOLR-13713](https://issues.apache.org/jira/browse/SOLR-13713) (janhoy)
- JWTAuthPlugin now supports multiple IdP issuers through configuring a new 'issuers' configuration key. Access tokens issued and signed by any of the configured issuers will be validated [SOLR-13734](https://issues.apache.org/jira/browse/SOLR-13734) (janhoy)
- Add CaffeineCache, an efficient implementation of SolrCache.(Ben Manes, Shawn Heisey, David Smiley, Andrzej Bialecki) [SOLR-8241](https://issues.apache.org/jira/browse/SOLR-8241) 

### Changed (19 changes)

- Improved error message when geodist(llpsf) is used with arguments referring to a LatLonPointSpatialField. [SOLR-11601](https://issues.apache.org/jira/browse/SOLR-11601) (Amrit Sarkar)
- Support InPlace DV updates for a field that does not yet exist in any documents [SOLR-12368](https://issues.apache.org/jira/browse/SOLR-12368) (hossman) (Simon Willnauer) (Adrien Grand) (Munendra S N)
- Code cleanup - Avoid using stream filter count where possible [SOLR-13542](https://issues.apache.org/jira/browse/SOLR-13542) (Koen De Groote) (Tomás Fernández Löbbe)
- Allow dynamic resizing of SolrCache-s. [SOLR-13558](https://issues.apache.org/jira/browse/SOLR-13558) [SOLR-13693](https://issues.apache.org/jira/browse/SOLR-13693) (ab)
- Add debug, trace logging to RuleBasedAuthorizationPlugin [SOLR-13638](https://issues.apache.org/jira/browse/SOLR-13638) (Jason Gerlowski)
- Some components register twice their metric names [SOLR-13702](https://issues.apache.org/jira/browse/SOLR-13702) (janhoy)
- Introducing SolrClient.ping(collection) in SolrJ [SOLR-13719](https://issues.apache.org/jira/browse/SOLR-13719) (Geza Nagy) (Mikhail Khludnev)
- BlockJoinParentQParser.getCachedFilter()made public for accessing from QParser plugins [SOLR-13720](https://issues.apache.org/jira/browse/SOLR-13720) (Stanislav Livotov) (Mikhail Khludnev)
- If a partial update (aka atomic update) is attempted on a document that has child docs, then ensure the schema supports it (_root_ stored/docValues) by throwing an exception. [SOLR-13728](https://issues.apache.org/jira/browse/SOLR-13728) (David Smiley)
- Optimized large managed schema modifications; Internal O(n^2) problem. [SOLR-13739](https://issues.apache.org/jira/browse/SOLR-13739) (Thomas Wöckinger) (David Smiley)
- Allow optional redaction of data saved by 'bin/solr autoscaling -save'. [SOLR-13742](https://issues.apache.org/jira/browse/SOLR-13742) (ab)
- Improve the tracking of "freedisk" in autoscaling simulations. [SOLR-13763](https://issues.apache.org/jira/browse/SOLR-13763) (ab)
- Add -v and -m to ulimit section of reference guide and bin/solr checks [SOLR-13771](https://issues.apache.org/jira/browse/SOLR-13771) (Erick Erickson)
- Add Prometheus Exporter GC and Heap options. [SOLR-13773](https://issues.apache.org/jira/browse/SOLR-13773) (Houston Putman) (Anshum Gupta) (David Smiley)
- EmbeddedSolrServer's defaultCore constructor argument is now optional [SOLR-13784](https://issues.apache.org/jira/browse/SOLR-13784) (David Smiley)
- Managed schema operations should do a core reload in Solr standalone mode. [SOLR-13795](https://issues.apache.org/jira/browse/SOLR-13795) (Thomas Wöckinger) (David Smiley)
- SSL: Adding Enabling/Disabling client's hostname verification config [SOLR-13798](https://issues.apache.org/jira/browse/SOLR-13798) (Cao Manh Dat)
- Ability to set the replication factor for index files created by HDFSDirectoryFactory [SOLR-6305](https://issues.apache.org/jira/browse/SOLR-6305) (Boris Pasko) (Kevin Risden)
- Max idle time support for SolrCache implementations. [SOLR-9658](https://issues.apache.org/jira/browse/SOLR-9658) (hoss) (ab)

### Fixed (42 changes)

- Backup and restore command really supports picking one of a few repositories by repository parameter [SOLR-11556](https://issues.apache.org/jira/browse/SOLR-11556) (Timothy Potter) (Mikhail Khludnev)
- Fix NPE when sorting by non-existent aggregate function in JSON Facet [SOLR-13022](https://issues.apache.org/jira/browse/SOLR-13022) (hossman) (Munendra S N)
- CDCR bootstrap does not replicate index to the replicas of target cluster. [SOLR-13141](https://issues.apache.org/jira/browse/SOLR-13141) (Krzysztof Watral) (Amrit Sarkar) (Tim) (Tdspringsteen) (shalin)
- Fix ClassCastException in Json Request API [SOLR-13180](https://issues.apache.org/jira/browse/SOLR-13180) (Johannes Kloos) (Jan Høydahl) (Munendra S N)
- Fix AIOOBE when group.facet is specified with group.query and return proper error code. [SOLR-13206](https://issues.apache.org/jira/browse/SOLR-13206) (Marek) (Munendra S N)
- BlobHandler generates non-padded md5 [SOLR-13238](https://issues.apache.org/jira/browse/SOLR-13238) (Jeff Walraven) (janhoy)
- Fixed UTILIZENODE action resulting in IllegalArgumentException. [SOLR-13240](https://issues.apache.org/jira/browse/SOLR-13240) (Hendrik Haddorp) (Richard Goodman) (Tim Owen) (shalin) (noble) (Christine Poerschke)
- ConcurrentUpdateHttp2SolrClient always log AsynchronousCloseException exception error on indexing. [SOLR-13293](https://issues.apache.org/jira/browse/SOLR-13293) (Cao Manh Dat)
- Multi-node race condition to create/remove nodeLost markers. [SOLR-13376](https://issues.apache.org/jira/browse/SOLR-13376) (hoss) (ab)
- Handle stats aggregation on date and string fields in SolrJ's JSON facet response processing [SOLR-13417](https://issues.apache.org/jira/browse/SOLR-13417) (Jason Gerlowski) (Munendra S N)
- Fix for class-cast issues during atomic-update 'removeregex' operations. This also incorporated some tests Tim wrote as a part of SOLR-9505. [SOLR-13539](https://issues.apache.org/jira/browse/SOLR-13539) [SOLR-9505](https://issues.apache.org/jira/browse/SOLR-9505) (Tim Owen) (Jason Gerlowski)
- Default solr.in.sh contains incorrect default value [SOLR-13647](https://issues.apache.org/jira/browse/SOLR-13647) (John Ryan)
- Fixed AbstractFullDistribZkTestBase.waitForActiveReplicaCount() to ensure replicas are active. [SOLR-13660](https://issues.apache.org/jira/browse/SOLR-13660) (hossman)
- Fixed SolrTestCaseJ4.deleteCore() to properly reset the dataDir used by initCore() [SOLR-13664](https://issues.apache.org/jira/browse/SOLR-13664) (hossman)
- Added missing netty dependencies to solrJ and upgraded netty to v 4.1.29.Final [SOLR-13665](https://issues.apache.org/jira/browse/SOLR-13665) (Jörn Franke) (janhoy)
- Cloud -&gt; Zk Status page now parses response from Zookeeper 3.5.5 correctly [SOLR-13672](https://issues.apache.org/jira/browse/SOLR-13672) (Jörn Franke) (janhoy) (Shawn Heisey)
- NodeAddedTrigger does not support configuration of replica type hint. A new replicaType property has been added to NodeAddTrigger so that new replicas of the given type are added. The default value is `NRT`. [SOLR-13674](https://issues.apache.org/jira/browse/SOLR-13674) (Irena Shaigorodsky) (shalin)
- All Metrics Gauges should be unregistered by components that registered them. [SOLR-13677](https://issues.apache.org/jira/browse/SOLR-13677) (noble) (ab)
- Default style of ExplainDocTransformer registered via solrconfig.xml should be same as default style of ExplainDocTransformer registered in defaultFactories [SOLR-13679](https://issues.apache.org/jira/browse/SOLR-13679) (Munendra S N)
- IndexSizeEstimator NullPointerException. [SOLR-13694](https://issues.apache.org/jira/browse/SOLR-13694) (ab) (hossman)
- - maxChars no longer working on CopyField with javabin [SOLR-13699](https://issues.apache.org/jira/browse/SOLR-13699) (Chris Troullis) (noble)
- Fixed a race condition when initializing metrics for new security plugins on security.json change [SOLR-13700](https://issues.apache.org/jira/browse/SOLR-13700) (hossman)
- Fixed JWTAuthPlugin to update metrics prior to continuing w/other filters or returning error [SOLR-13701](https://issues.apache.org/jira/browse/SOLR-13701) (hossman)
- Improve error message and change error code to 400 for client errors in ExpandComponent [SOLR-13704](https://issues.apache.org/jira/browse/SOLR-13704) (Munendra S N)
- JMX MBeans are not exposed because of race condition between creating platform mbean server and registering mbeans. [SOLR-13712](https://issues.apache.org/jira/browse/SOLR-13712) (shalin)
- Fixed distributed grouping when multiple 'fl' params are specified [SOLR-13717](https://issues.apache.org/jira/browse/SOLR-13717) (hossman) (Christine Poerschke)
- SPLITSHARD (async) with failures in underlying sub-operations can result in data loss [SOLR-13718](https://issues.apache.org/jira/browse/SOLR-13718) (Ishan Chattopadhyaya)
- Allow negative values for limit in TermsFacetMap [SOLR-13725](https://issues.apache.org/jira/browse/SOLR-13725) (Richard Walker) (Munendra S N)
- Fixed V2Requests - HttpSolrClient replaced first instance of "/solr" with "/api" which caused a change in host names starting with "solr". [SOLR-13727](https://issues.apache.org/jira/browse/SOLR-13727) (Megan Carey) (yonik)
- Fix regression in support for Date math in TRA start date that was introduced by SOLR-13375 [SOLR-13760](https://issues.apache.org/jira/browse/SOLR-13760) [SOLR-13375](https://issues.apache.org/jira/browse/SOLR-13375) 
- Fix ClassCastException in NestableJsonFacet [SOLR-13780](https://issues.apache.org/jira/browse/SOLR-13780) (Tiago Martinho de Barros) (Munendra S N)
- LRUStatsCache size explosion and ineffective caching. [SOLR-13790](https://issues.apache.org/jira/browse/SOLR-13790) (ab)
- HttpSolrCall now maintains internal request count (_forwardedCount) for remote queries and limits them to the number of replicas. This avoids making too many cascading calls to remote servers, which, if not restricted, can bring down nodes containing the said collection [SOLR-13793](https://issues.apache.org/jira/browse/SOLR-13793) (Kesharee Nandan Vishwakarma) (Ishan Chattopadhyaya)
- Managed schema manipulations were not persisting the optional luceneMatchVersion that can be set on an Analyzer. [SOLR-13802](https://issues.apache.org/jira/browse/SOLR-13802) (Thomas Wöckinger)
- Live shard split (where updates actively continue during the split) can lose updates due to cluster state happening to change between checking if the current shard is active and later checking if there are any sub-shard leaders to forward the update to. [SOLR-13815](https://issues.apache.org/jira/browse/SOLR-13815) (yonik)
- Improve ExecutePlanAction error handling. [SOLR-13828](https://issues.apache.org/jira/browse/SOLR-13828) (ab)
- RecursiveEvaluator casts Continuous numbers to Discrete Numbers, causing mismatch [SOLR-13829](https://issues.apache.org/jira/browse/SOLR-13829) (Trey Grainger) (Joel Bernstein)
- ZkController#getSolrCloudManager() created a new instance of ZkStateReader, thereby causing mismatch in the visibility of the cluster state and, as a result, undesired race conditions [SOLR-13834](https://issues.apache.org/jira/browse/SOLR-13834) (Clay Goddard) (Ishan Chattopadhyaya)
- HttpSolrCall produces incorrect extra AuditEvent on AuthorizationResponse.PROMPT [SOLR-13835](https://issues.apache.org/jira/browse/SOLR-13835) (janhoy) (hossman)
- The MOVEREPLICA API ignores replica type and always adds 'nrt' replicas [SOLR-13843](https://issues.apache.org/jira/browse/SOLR-13843) (Amrit Sarkar) (shalin)
- DistributedZkUpdateProcessor should have been propagating URP.finish() lifecycle like it used to before 8.1 (a regression). Impacts integrity since Run URP's finish() propagates this to the updateLog to fsync. [SOLR-13855](https://issues.apache.org/jira/browse/SOLR-13855) (David Smiley)
- facet.missing=true should return missing count even when facet.limit=0 [SOLR-6328](https://issues.apache.org/jira/browse/SOLR-6328) (hossman) (Munendra S N)

### Other (16 changes)

- Add `debug.explain.structured` to Admin UI. [SOLR-10377](https://issues.apache.org/jira/browse/SOLR-10377) (David Smiley) (Munendra S N)
- Clean up /solr/cloud-dev scripts and provide a single well documented script [SOLR-11492](https://issues.apache.org/jira/browse/SOLR-11492) (Gus Heck) (Robert Bunch)
- Update Ref Guide build tool versions [SOLR-12786](https://issues.apache.org/jira/browse/SOLR-12786) (Cassandra)
- Use StandardCharsets instead of String values [SOLR-12870](https://issues.apache.org/jira/browse/SOLR-12870) (Peter Somogyi) (Munendra S N)
- Add SolrRangeQuery getters for upper, lower bound [SOLR-13573](https://issues.apache.org/jira/browse/SOLR-13573) (Brian Rhees) (Jason Gerlowski)
- Factor out SearchGroupsResultTransformer.[de]serializeOneSearchGroup methods. [SOLR-13585](https://issues.apache.org/jira/browse/SOLR-13585) (Christine Poerschke) (Diego Ceccarelli)
- Clean trailing whitespace from 'analytics' contrib [SOLR-13629](https://issues.apache.org/jira/browse/SOLR-13629) (Neal Sidhwaney) (Jason Gerlowski)
- Add Getters/Setters in ResponseBuilder for analytics response handling [SOLR-13643](https://issues.apache.org/jira/browse/SOLR-13643) (Neal Sidhwaney) (Munendra S N)
- Precommit fail Java "var" until 9x. Fail "var...&lt;&gt;" constructs entirely [SOLR-13658](https://issues.apache.org/jira/browse/SOLR-13658) (Erick Erickson)
- Use try-with-resource to close the closeable resource [SOLR-13680](https://issues.apache.org/jira/browse/SOLR-13680) (Furkan KAMACI) (Munendra S N)
- New TestSSLTestConfig.testFailIfUserRunsTestsWithJVMThatHasKnownSSLBugs() to give people running tests more visibility if/when they use a known-buggy JVM causing most SSL tests to silently SKIP. [SOLR-13747](https://issues.apache.org/jira/browse/SOLR-13747) (hossman)
- Upgrade jackson to 2.9.9 [SOLR-13767](https://issues.apache.org/jira/browse/SOLR-13767) (janhoy)
- Use the safe fork of simple-xml for clustering contrib. [SOLR-13779](https://issues.apache.org/jira/browse/SOLR-13779) (Dawid Weiss)
- An annotation based system to write v2 APIs [SOLR-13787](https://issues.apache.org/jira/browse/SOLR-13787) (noble)
- Remove remaining Commons BeanUtils references. [SOLR-13791](https://issues.apache.org/jira/browse/SOLR-13791) (Andras Salamon) (Christine Poerschke)
- Add javadocs, uneven rejection and basic test coverage for the SolrTestCaseJ4.params method. [SOLR-13812](https://issues.apache.org/jira/browse/SOLR-13812) (Diego Ceccarelli) (Christine Poerschke) (Munendra S N)


[8.2.0] - 2019-07-26
--------------------

### Upgrade Notes (6 changes)

- Time Routed Aliases now have a '__TRA__' infix preceding the timestamp portion of the collection names. collections with the old format will not be altered and will continue to work, but any new TRA's or new collections for existing TRA's will use the new format. Solr will handle this invisibly, but any external code that attempted to predict collection names in TRA's will probably need adjustment. [SOLR-13419](https://issues.apache.org/jira/browse/SOLR-13419) 
- Routed Aliases now use collection properties rather than core properties to identify collections that belong to the alias by default. This should be invisible and fully backwards compatible from within solr, and existing routed alias collections with core based properties will continue to work, but new collections created will not add a property to core.properties anymoore so any external code that inspected core.properties will not find the 'routedAliasName' key in new cores belonging to routed aliases. [SOLR-13420](https://issues.apache.org/jira/browse/SOLR-13420) 
- Support for "addr" parameter from the "/solr/admin/zookeeper" endpoint has now been removed and will no longer be supported. [SOLR-13507](https://issues.apache.org/jira/browse/SOLR-13507) 
- org.apache.solr.util.SolrPluginUtils.IdentityRegenerator has been removed, please use the identical org.apache.solr.search.NoOpRegenerator instead. [SOLR-13515](https://issues.apache.org/jira/browse/SOLR-13515) (David Smiley) (Christine Poerschke)
- Upgrade Jetty to 9.4.19.v20190610. [SOLR-13541](https://issues.apache.org/jira/browse/SOLR-13541) (Erick Erickson) (Cao Manh Dat)
- Upgrade ZooKeeper to 3.5.5. ZooKeeper 3.5.5 introduces more security features. Include in your zoo.cfg file at minimum the following: 4lw.commands.whitelist=mntr,conf,ruok You can use 4lw.commands.whitelist=* to enable all ZooKeeper "4 letter commands". [SOLR-8346](https://issues.apache.org/jira/browse/SOLR-8346) (Erick Erickson)

### Added (11 changes)

- Add matches Stream Evaluator to support regex matching [SOLR-10291](https://issues.apache.org/jira/browse/SOLR-10291) (Joel Bernstein)
- Add facet2D Streaming Expression [SOLR-13047](https://issues.apache.org/jira/browse/SOLR-13047) (Nazerke Seidan) (Joel Bernstein)
- add an update param failOnVersionConflicts=false to updates not fail when there is a version conflict [SOLR-13320](https://issues.apache.org/jira/browse/SOLR-13320) (noble)
- OpenTracing support for Solr [SOLR-13434](https://issues.apache.org/jira/browse/SOLR-13434) (Cao Manh Dat)
- Preferred replicas on nodes with same system properties as the query master [SOLR-13445](https://issues.apache.org/jira/browse/SOLR-13445) (Cao Manh Dat)
- Add DeepRandomStream implementation [SOLR-13494](https://issues.apache.org/jira/browse/SOLR-13494) (Joel Bernstein)
- Raw index data analysis tool (extension of COLSTATUS collection command). [SOLR-13512](https://issues.apache.org/jira/browse/SOLR-13512) (ab)
- Allow zplot to automatically create the x axis [SOLR-13550](https://issues.apache.org/jira/browse/SOLR-13550) (Joel Bernstein)
- Add recNum Stream Evaluator [SOLR-13552](https://issues.apache.org/jira/browse/SOLR-13552) (Joel Bernstein)
- Add isNull and notNull Stream Evaluators [SOLR-13560](https://issues.apache.org/jira/browse/SOLR-13560) (Joel Bernstein)
- Allow zplot to visualize 2D clusters and convex hulls [SOLR-13589](https://issues.apache.org/jira/browse/SOLR-13589) (Joel Bernstein)

### Changed (15 changes)

- It would be nice if the Graph section of the Cloud tab in the Admin UI could give some more information about the replicas of a collection [SOLR-11558](https://issues.apache.org/jira/browse/SOLR-11558) (Erick Erickson)
- The MoreLikeThisComponent now supports the mlt.interestingTerms parameter. Previously this option was unique to the MLT handler. [SOLR-12304](https://issues.apache.org/jira/browse/SOLR-12304) (Alessandro Benedetti) (David Smiley)
- Expose IndexWriterConfig's ramPerThreadHardLimitMB through solrconfig.xml [SOLR-12554](https://issues.apache.org/jira/browse/SOLR-12554) (Ishan Chattopadhyaya) (Munendra S N)
- Query Result Cache does not honor maxRamBytes parameter. [SOLR-13003](https://issues.apache.org/jira/browse/SOLR-13003) (ab) (Brian Ecker)
- Make contrib/ltr Feature.defaultValue configurable. [SOLR-13049](https://issues.apache.org/jira/browse/SOLR-13049) (Stanislav Livotov) (Christine Poerschke)
- Add a request parameter to execute a streaming expression locally [SOLR-13306](https://issues.apache.org/jira/browse/SOLR-13306) 
- In autoscaling policies, use an explicit 'put : on-each-node' to specify the rules is applied on each node [SOLR-13329](https://issues.apache.org/jira/browse/SOLR-13329) (noble)
- Transaction log to natively support UUID types [SOLR-13347](https://issues.apache.org/jira/browse/SOLR-13347) (Thomas Wöckinger) (noble)
- Highlighting: Range queries will now highlight in hl.method=unified mode. [SOLR-13367](https://issues.apache.org/jira/browse/SOLR-13367) (David Smiley)
- Support saving/restoring autoscaling state for repeatable simulations. [SOLR-13440](https://issues.apache.org/jira/browse/SOLR-13440) (ab)
- autoscaling/suggestions should be able to give suggestions from config sent as a payload [SOLR-13468](https://issues.apache.org/jira/browse/SOLR-13468) (noble)
- autoscaling/diagnostics API should be able to give diagnostics output from config sent as a payload [SOLR-13484](https://issues.apache.org/jira/browse/SOLR-13484) (noble)
- /autoscaling/suggestions to be able to filter by type [SOLR-13493](https://issues.apache.org/jira/browse/SOLR-13493) (noble)
- In autoscaling policies, use an explicit 'nodeset' attribute for filtering nodes instead of using them directly at the toplevel [SOLR-13504](https://issues.apache.org/jira/browse/SOLR-13504) (noble)
- Admin UI visual indication of prod/test/dev environment [SOLR-13569](https://issues.apache.org/jira/browse/SOLR-13569) (janhoy)

### Fixed (24 changes)

- collections API CUSTERSTATUS command fails when configset missing [SOLR-12013](https://issues.apache.org/jira/browse/SOLR-12013) (Erick Erickson)
- Updates containing 'set' operation with value null or empty list should be considered as Atomic Update [SOLR-12127](https://issues.apache.org/jira/browse/SOLR-12127) (Oliver Kuldmäe) (Munendra S N) (Ishan Chattopadhyaya)
- Better error message when grouping on a tokenized (non SortableText) field in SolrCloud [SOLR-12249](https://issues.apache.org/jira/browse/SOLR-12249) (Erick Erickson)
- Fix IndexSizeTrigger to correctly work with "aboveBytes" and "splitMethod=link" parameters. [SOLR-12941](https://issues.apache.org/jira/browse/SOLR-12941) (ab)
- Improve error message and change error code to 400 when collapse field is non-docValued and non-uninvertible [SOLR-12979](https://issues.apache.org/jira/browse/SOLR-12979) (hossman) (Munendra S N)
- Fix NPE when invalid query parser is specified and return 400 error code. [SOLR-13187](https://issues.apache.org/jira/browse/SOLR-13187) (Cesar Rodriguez) (Marek) (Charles Sanders) (Munendra S N) (Mikhail Khludnev)
- Strengthen ScheduledTrigger's preferredOperation parameter validation. [SOLR-13280](https://issues.apache.org/jira/browse/SOLR-13280) (Christine Poerschke)
- unleashing terms.ttf from terms.list when distrib=false [SOLR-13333](https://issues.apache.org/jira/browse/SOLR-13333) (Munendra S N) (Mikhail Khludnev)
- Support group.query in multi-shard environment when group.main=true or group.format=simple [SOLR-13404](https://issues.apache.org/jira/browse/SOLR-13404) (Munendra S N)
- Fix rejected requests during full disk full + IndexFetch to use 503 not 403 [SOLR-13469](https://issues.apache.org/jira/browse/SOLR-13469) (hossman)
- Forwarded requests should skip authorization on receiving nodes [SOLR-13472](https://issues.apache.org/jira/browse/SOLR-13472) (adfel) (Ishan Chattopadhyaya)
- Fix "Search is temporarily disabled" logic to be consistent for entire request [SOLR-13474](https://issues.apache.org/jira/browse/SOLR-13474) (hossman)
- Stop the leader from trying to rejoin the election on session expiration and harden our zk reconnect code path. [SOLR-13489](https://issues.apache.org/jira/browse/SOLR-13489) (Mark Miller) (Anshum Gupta)
- Fix CollectionStateWatcher/CollectionStatePredicate based APIs in ZkStateReader and CloudSolrClient to be triggered on liveNode changes. Also add Predicate&lt;DocCollection&gt; equivalents for callers that don't care about liveNodes. [SOLR-13490](https://issues.apache.org/jira/browse/SOLR-13490) (hossman)
- SolrZkClient's watch wrapper no longer allows zookeeper to hold the same watch object multiple times. [SOLR-13491](https://issues.apache.org/jira/browse/SOLR-13491) 
- Fix distributed grouping related NullPointerException in JSONWriter.writeSolrDocument [SOLR-13496](https://issues.apache.org/jira/browse/SOLR-13496) (Christine Poerschke)
- NPE on omitHeader=true is fixed by sending omitHeader=false to shard searches [SOLR-13509](https://issues.apache.org/jira/browse/SOLR-13509) (Munendra S N) (Mikhail Khludnev)
- Fix input parameter handling in SchemaRequest.DynamicField and SchemaRequest.FieldTypes (Schema API) [SOLR-13521](https://issues.apache.org/jira/browse/SOLR-13521) (Tomás Fernández Löbbe)
- Fix http timeout and error logging bugs in RecoveryStrategy. [SOLR-13532](https://issues.apache.org/jira/browse/SOLR-13532) (Suril Shah) (hossman)
- toNativeType () TrieDate & EnumField do not handle CharSequence properly [SOLR-13538](https://issues.apache.org/jira/browse/SOLR-13538) (Munendra S N)
- ContentStreamUpdateRequest refused to close file [SOLR-13545](https://issues.apache.org/jira/browse/SOLR-13545) (Colvin Cowie) (Mikhail Khludnev)
- Fix many test and test-framework classes to not fail on After/AfterClass cleanup if assumptions fail in Before/BeforeClass setup [SOLR-13574](https://issues.apache.org/jira/browse/SOLR-13574) (hossman)
- Kerberos plugin to pass original user principal to avoid 403 on nodes not hosting a collection [SOLR-13619](https://issues.apache.org/jira/browse/SOLR-13619) (adfel) (Ishan Chattopadhyaya) (noble)
- Improve error message for unsupported field types and return 400 error code on unsupported values in collapsing [SOLR-9409](https://issues.apache.org/jira/browse/SOLR-9409) (hossman) (Munendra S N)

### Other (15 changes)

- Add test cases for edismax boost [SOLR-12364](https://issues.apache.org/jira/browse/SOLR-12364) (David Smiley) (Munendra S N)
- SSLTestConfig has been changed to throw AssumptionViolatedException when tests/seeds request SSL but the JVM appears to be an OpenJDK version known to have SSL bugs [SOLR-12988](https://issues.apache.org/jira/browse/SOLR-12988) (hossman) (Cao Manh Dat)
- Split Collections API Ref Guide page into several smaller child pages [SOLR-13235](https://issues.apache.org/jira/browse/SOLR-13235) (Cassandra Targett)
- Clarify ScheduledTrigger's "every parameter missing" error response. [SOLR-13279](https://issues.apache.org/jira/browse/SOLR-13279) (Christine Poerschke)
- Re-structure and clarify Security chapters in Ref Guide [SOLR-13371](https://issues.apache.org/jira/browse/SOLR-13371) (janhoy)
- noggit json parser is forked into solrj [SOLR-13437](https://issues.apache.org/jira/browse/SOLR-13437) (noble)
- Adjust auth metrics asserts in tests caused by SOLR-13449 [SOLR-13453](https://issues.apache.org/jira/browse/SOLR-13453) [SOLR-13449](https://issues.apache.org/jira/browse/SOLR-13449) (janhoy)
- Include the S2 Geometry lib to make it simpler to use prefixTree="s2" on a Geo3D spatial field. Improved documentation on Geo3D too. [SOLR-13467](https://issues.apache.org/jira/browse/SOLR-13467) (David Smiley)
- Remove support for "addr" parameter from the "/solr/admin/zookeeper" endpoint. [SOLR-13507](https://issues.apache.org/jira/browse/SOLR-13507) (janhoy) (Anshum Gupta)
- Add SearchHandler.newResponseBuilder method to facilitate custom plugins' maintenance of per-request state in a custom ResponseBuilder. [SOLR-13511](https://issues.apache.org/jira/browse/SOLR-13511) (Ramsey Haddad) (Christine Poerschke)
- Factor out a TopGroupsShardResponseProcessor.fillResultIds method. [SOLR-13576](https://issues.apache.org/jira/browse/SOLR-13576) (Christine Poerschke) (Diego Ceccarelli)
- Document Estonian analyzer in Solr Ref Guide [SOLR-13588](https://issues.apache.org/jira/browse/SOLR-13588) (Tomoko Uchida)
- Add a field type for Estonian language to default managed_schema [SOLR-13602](https://issues.apache.org/jira/browse/SOLR-13602) (Tomoko Uchida)
- Remove usage of GroupingSpecification's deprecated methods [SOLR-13603](https://issues.apache.org/jira/browse/SOLR-13603) (Munendra S N)
- Adding test cases for org.apache.solr.util.hll.NumberUtilTest [SOLR-8754](https://issues.apache.org/jira/browse/SOLR-8754) (Benoit Vanalderweireldt) (janhoy)


[8.1.1] - 2019-05-28
--------------------

### Fixed (1 change)

- Null Pointer Exception when querying collection through collection alias. [SOLR-13475](https://issues.apache.org/jira/browse/SOLR-13475) (Jörn Franke) (ab)


[8.1.0] - 2019-05-16
--------------------

### Upgrade Notes (8 changes)

- When requesting the status of an async request via REQUESTSTATUS collections API, the response will include the list of internal async requests (if any) in the "success" or "failed" keys (in addition to them being included outside those keys for backwards compatibility). See SOLR-12708 for more details [SOLR-12708](https://issues.apache.org/jira/browse/SOLR-12708) 
- Velocity and Velocity Tools were both upgraded as part of this release. Velocity upgraded from 1.7 to 2.0. Please see https://velocity.apache.org/engine/2.0/upgrading.html about upgrading. Velocity Tools upgraded from 2.0 to 3.0. For more details, please see https://velocity.apache.org/tools/3.0/upgrading.html for details about the upgrade. [SOLR-13335](https://issues.apache.org/jira/browse/SOLR-13335) 
- Solr's default behavior when dealing with 'maxBooleanClauses' has changed to reduce the risk of exponential query expansion when dealing with pathological query strings. A default upper limit of 1024 clauses (The same default prior to Solr 7.0) is now enforced at the node level, and can be overridden in solr.xml. The identically named solrconfig.xml setting is still available for limiting the size of 'explicit' boolean query strings, but this per-collection limit is still ristricted by the upper-bound of the global limit in solr.xml. See SOLR-13336 for more details. [SOLR-13336](https://issues.apache.org/jira/browse/SOLR-13336) 
- The default GC has been changed from CMS to G1. To override this (in order to switch to CMS or any other GC), use GC_TUNE section of bin/solr.in.sh or bin/solr.in.cmd. [SOLR-13394](https://issues.apache.org/jira/browse/SOLR-13394) 
- Custom TransientSolrCoreCache implementations no longer use the Observer/Observable pattern. To notify Solr that a core has been aged out of the cache, call CoreContainer.queueCoreToClose(SolrCore). See SOLR-13400 for details. [SOLR-13400](https://issues.apache.org/jira/browse/SOLR-13400) 
- Update requests sent to non-routed aliases that point to multiple collections are no longer accepted. Until now Solr followed an obscure convention of updating only the first collection from the list, which usually was not what the user intended. This change explicitly rejects such update requests. [SOLR-13407](https://issues.apache.org/jira/browse/SOLR-13407) 
- Until now, the CREATE command of Collections API returned status 0 even in case of failure. Now, the status code will be non-zero in case of failures [SOLR-5970](https://issues.apache.org/jira/browse/SOLR-5970) (e.g. 4xx) (5xx)
- SolrGangliaReporter has been removed from Solr because support for Ganglia has been removed from Dropwizard Metrics 4 due to a transitive dependency on LGPL. 

### Added (16 changes)

- Add hashRollup Streaming Expression [SOLR-10436](https://issues.apache.org/jira/browse/SOLR-10436) (Joel Bernstein)
- REINDEXCOLLECTION command for re-indexing of existing collections. This issue also adds a back-compat check of the .system collection to notify users of potential compatibility issues after upgrades or schema changes. [SOLR-11127](https://issues.apache.org/jira/browse/SOLR-11127) (ab)
- New AuditLoggerPlugin type allowing custom Audit logger plugins [SOLR-12120](https://issues.apache.org/jira/browse/SOLR-12120) (janhoy)
- JWT Token authentication plugin with OpenID Connect implicit flow login through Admin UI [SOLR-12121](https://issues.apache.org/jira/browse/SOLR-12121) (janhoy)
- Partial/Atomic Updates for nested documents. This enables atomic updates for nested documents, without the need to supply the whole nested hierarchy (which would be overwritten if absent). This is done by fetching the whole document hierarchy, updating the specific doc in the path that is to be updated, removing the old document hierarchy and indexing the new one with the atomic update merged into it. Also, [child] Doc Transformer now works with RealTimeGet. [SOLR-12638](https://issues.apache.org/jira/browse/SOLR-12638) (Moshe Bla) (David Smiley)
- Category Routed Aliases are now available for data driven assignment of documents to collections based on values of a field. The Ref Guide now has a page dedicated to explaining the different types of aliases. [SOLR-13131](https://issues.apache.org/jira/browse/SOLR-13131) (Gus Heck) (Moshe Bla)
- A true streaming parser for javabin payload/stream without creating any objects [SOLR-13171](https://issues.apache.org/jira/browse/SOLR-13171) (noble)
- Make SortableTextField work with export/streaming. NOTE: requires that the field have useDocValuesAsStored=true [SOLR-13261](https://issues.apache.org/jira/browse/SOLR-13261) (either explicit or as the default)
- Add collection RENAME command and support using aliases in most collection admin commands. [SOLR-13262](https://issues.apache.org/jira/browse/SOLR-13262) (ab)
- Read-only mode for SolrCloud collections [SOLR-13271](https://issues.apache.org/jira/browse/SOLR-13271) (ab) (shalin)
- Adding Http2 equivalent classes of CloudSolrClient and HttpClusterStateProvider [SOLR-13276](https://issues.apache.org/jira/browse/SOLR-13276) (Cao Manh Dat)
- Allow zplot to visualize probability distributions in Apache Zeppelin [SOLR-13287](https://issues.apache.org/jira/browse/SOLR-13287) (Joel Bernstein)
- Provide extended per-segment status of a collection. [SOLR-13292](https://issues.apache.org/jira/browse/SOLR-13292) (ab)
- Add fetchSize parameter to the jdbc Streaming Expression [SOLR-13374](https://issues.apache.org/jira/browse/SOLR-13374) (Joel Bernstein)
- Add variance and standard deviation stream evaluators [SOLR-13391](https://issues.apache.org/jira/browse/SOLR-13391) (Nazerke Seidan) (Joel Bernstein)
- Support simulating the execution of autoscaling suggestions. [SOLR-13427](https://issues.apache.org/jira/browse/SOLR-13427) (ab)

### Changed (14 changes)

- (at least) 2 distinct failures possible when clients attempt searches during SolrCore reload, added test band-aid for DocValuesNotIndexedTest. [SOLR-11035](https://issues.apache.org/jira/browse/SOLR-11035) 
- Make HDFSDirectoryFactory support other prefixes (besides hdfs:/) [SOLR-11473](https://issues.apache.org/jira/browse/SOLR-11473) (Kevin Risden)
- Throw an exception, instead of just a warning, when unknown atomic update operation is encountered [SOLR-12167](https://issues.apache.org/jira/browse/SOLR-12167) (Munendra S N) (Ishan Chattopadhyaya)
- Avoid unnecessary memory cost when DistributedUpdateProcessor timed-out lock is not used. [SOLR-12833](https://issues.apache.org/jira/browse/SOLR-12833) (jefferyyuan) (ab)
- Index replication could delete segments before downloading segments from master if there is not enough disk space [SOLR-12999](https://issues.apache.org/jira/browse/SOLR-12999) (noble)
- Optimizing facet.range.other by avoiding expensive exceptions [SOLR-13227](https://issues.apache.org/jira/browse/SOLR-13227) (Nikolay Khitrin) (Mikhail Khludnev)
- Only request the minimum required number of terms from each shard when using terms.sort=index and none are discarded due to terms.min/maxcount [SOLR-13337](https://issues.apache.org/jira/browse/SOLR-13337) (Morten Bøgeskov) (Munendra S N) (Mikhail Khludnev)
- Speed up collapsing by avoiding scoring of ineligible documents [SOLR-13348](https://issues.apache.org/jira/browse/SOLR-13348) (Andrzej Wislowski via Ishan Chattopadhyaya)
- Make UpdateHandler support other prefixes (besides hdfs:/) [SOLR-13359](https://issues.apache.org/jira/browse/SOLR-13359) (Kevin Risden)
- Switch default GC from CMS to G1 [SOLR-13394](https://issues.apache.org/jira/browse/SOLR-13394) (Ishan Chattopadhyaya) (Kesharee Nandan Vishwakarma) (Shawn Heisey) (Uwe Schindler) (Erick Ericsson) (shalin)
- Move log line "Processing SSL Credential Provider chain..." from INFO to DEBUG [SOLR-13398](https://issues.apache.org/jira/browse/SOLR-13398) (janhoy)
- Reject update requests sent to non-routed multi collection aliases. [SOLR-13407](https://issues.apache.org/jira/browse/SOLR-13407) (ab)
- Add .toString methods to BitDocSet and SortedIntDocSet so that enabling "showItems" on the filter caches shows some useful information about the values in the cache. [SOLR-13432](https://issues.apache.org/jira/browse/SOLR-13432) (shalin)
- Remove commons-lang as a dependency [SOLR-9079](https://issues.apache.org/jira/browse/SOLR-9079) (Kevin Risden)

### Fixed (38 changes)

- In-place update fails when resolving from Tlog if schema has a required field [SOLR-11876](https://issues.apache.org/jira/browse/SOLR-11876) (Justin Deoliveira) (janhoy) (Ishan Chattopadhyaya)
- 500 code on functional query syntax errors and parameter dereferencing errors [SOLR-11883](https://issues.apache.org/jira/browse/SOLR-11883) (Munendra S N) (Mikhail Khludnev)
- Grouping is broken on docValues-only fields (non-stored, non-indexed) [SOLR-12248](https://issues.apache.org/jira/browse/SOLR-12248) [SOLR-4647](https://issues.apache.org/jira/browse/SOLR-4647) (Erick Ericsson) (Adrien Grand) (Munendra S N) (Scott Stults) (Ishan Chattopadhyaya)
- prematurely reporting not yet finished async Collections API call as completed when collection's replicas are colocated at least at one node [SOLR-12291](https://issues.apache.org/jira/browse/SOLR-12291) (Varun Thacker) (Mikhail Khludnev)
- 500 error code on json.facet syntax errors [SOLR-12330](https://issues.apache.org/jira/browse/SOLR-12330) (Munendra S N) (Mikhail Khludnev)
- Editing authorization config via REST API now works in standalone mode [SOLR-12371](https://issues.apache.org/jira/browse/SOLR-12371) (janhoy)
- Async collection actions should not hide internal failures [SOLR-12708](https://issues.apache.org/jira/browse/SOLR-12708) (Mano Kovacs) (Varun Thacker) (Tomás Fernández Löbbe)
- MetricsHistoryHandler now uses PKI Auth for metrics collection in background thread [SOLR-12860](https://issues.apache.org/jira/browse/SOLR-12860) (janhoy) (Lorenzo)
- In-Place Update doesn't work with route.field [SOLR-13081](https://issues.apache.org/jira/browse/SOLR-13081) (Dr Oleg Savrasov) (Mikhail Khludnev)
- Cleanup replicasMetTragicEvent after all types of exception [SOLR-13229](https://issues.apache.org/jira/browse/SOLR-13229) (Tomás Fernández Löbbe)
- Prometheus Metric Exporter not threadsafe. This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores. [SOLR-13234](https://issues.apache.org/jira/browse/SOLR-13234) (Danyal Prout) (shalin)
- Admin UI Nodes view fails and is empty when a node is temporarily down [SOLR-13244](https://issues.apache.org/jira/browse/SOLR-13244) (janhoy)
- IndexSchema.getResourceLoader was being used to load non-schema things, which can be a memory leak if "shareSchema" and other circumstances occur. Furthermore it's reference to SolrConfig was removed. [SOLR-13253](https://issues.apache.org/jira/browse/SOLR-13253) (David Smiley)
- Correct message that is logged in solrj's ConnectionManager when an exception occurred while reconnecting to ZooKeeper. [SOLR-13254](https://issues.apache.org/jira/browse/SOLR-13254) (hu xiaodong) (Christine Poerschke)
- Fixed NPE in DocExpirationUpdateProcessorFactory [SOLR-13281](https://issues.apache.org/jira/browse/SOLR-13281) (Munendra S N) (Tomás Fernández Löbbe)
- NullPointerException with 500 http status on omitted or wrong wt param. It's fixed by fallback to json [SOLR-13284](https://issues.apache.org/jira/browse/SOLR-13284) (Munendra S N) (Mikhail Khludnev)
- Updates with enum fields and javabin cause ClassCastException [SOLR-13285](https://issues.apache.org/jira/browse/SOLR-13285) (noble)
- Reproducible failure in TestDistributedGrouping [SOLR-13295](https://issues.apache.org/jira/browse/SOLR-13295) (Erick Erickson)
- Fix ClassCastException in SolrJ JsonFaceting classes [SOLR-13318](https://issues.apache.org/jira/browse/SOLR-13318) (Munendra S N) (Jason Gerlowski)
- Atomic Update 'remove' operations broken for certain field types in SolrJ [SOLR-13331](https://issues.apache.org/jira/browse/SOLR-13331) (Thomas Wockinger) (Jason Gerlowski)
- add maxBooleanClauses (default to 1024) setting to solr.xml, reverting previous effective value of Integer.MAX_VALUE-1, to restrict risk of pathalogical query expansion. [SOLR-13336](https://issues.apache.org/jira/browse/SOLR-13336) (hossman)
- Prevent recovery, fetching index being kicked off after SolrCores already closed [SOLR-13339](https://issues.apache.org/jira/browse/SOLR-13339) (Cao Manh Dat)
- Fix spacing issue in browser log [SOLR-13343](https://issues.apache.org/jira/browse/SOLR-13343) (Marcus Eagan) (Jason Gerlowski)
- Admin UI inaccessible with RuleBasedAuthorizationPlugin [SOLR-13344](https://issues.apache.org/jira/browse/SOLR-13344) (janhoy) (Jason Gerlowski)
- High CPU usage in Solr due to Java 8 bug [SOLR-13349](https://issues.apache.org/jira/browse/SOLR-13349) (Erick Erickson)
- Workaround for VELOCITY-908 [SOLR-13351](https://issues.apache.org/jira/browse/SOLR-13351) (Kevin Risden)
- Remove risk of deadlock/threadleak when shutting down an Overseer(TriggerThread). [SOLR-13352](https://issues.apache.org/jira/browse/SOLR-13352) (hossman)
- 'all' permission ignored by RuleBasedAuthorizationPlugin in most cases [SOLR-13355](https://issues.apache.org/jira/browse/SOLR-13355) (Jason Gerlowski) (janhoy)
- Add 'includeIndexFieldFlags' support to SolrJ LukeRequest [SOLR-13362](https://issues.apache.org/jira/browse/SOLR-13362) (Jason Gerlowski)
- OverseerTaskQueue#remove should not throw an exception when no node exists after an exists check and the Overseer work loop should not allow free spinning the loop when it hits a KeeperException. [SOLR-13386](https://issues.apache.org/jira/browse/SOLR-13386) (Mark Miller) (Fernandez-Lobbe) (Mike Drob)
- Fix FileExchangeRateProvider to be a public class, as it appears in schema.xml [SOLR-13388](https://issues.apache.org/jira/browse/SOLR-13388) (Uwe Schindler)
- Fixed ZkClientClusterStateProvider to prevent risk of leaking ZkStateReader/threads when processing concurrent requests during shutdown. This primarily affected tests, but may have also caused odd errors/delays when restart/shutting down solr nodes. [SOLR-13393](https://issues.apache.org/jira/browse/SOLR-13393) (hossman)
- Cannot start/stop DaemonStream repeatedly, other API improvements [SOLR-13408](https://issues.apache.org/jira/browse/SOLR-13408) (Erick Erickson)
- Designated overseer wasn't able to rejoin election queue upon restart [SOLR-13410](https://issues.apache.org/jira/browse/SOLR-13410) (Ishan Chattopadhyaya) (Kesharee Nandan Vishwakarma)
- SolrClientNodeStateProvider always retries on requesting metrics from other nodes [SOLR-13449](https://issues.apache.org/jira/browse/SOLR-13449) (Cao Manh Dat)
- Return correct status upon collection creation failure [SOLR-5970](https://issues.apache.org/jira/browse/SOLR-5970) (Abraham Elmahrek) (Ishan Chattopadhyaya) (Jason Gerlowski) (Kesharee Nandan Vishwakarma)
- CSVResponseWriter & XLSXResponseWriter return empty field when fl alias is combined with '*' selector [SOLR-7414](https://issues.apache.org/jira/browse/SOLR-7414) (Michael Lawrence) (Munendra S N) (Ishan Chattopadhyaya)
- 500 error code on breaching timeAllowed by core and distributed (fsv) search, old and json facets [SOLR-9882](https://issues.apache.org/jira/browse/SOLR-9882) (Mikhail Khludnev)

### Other (27 changes)

- Upgrade Guava to 25.1-jre [SOLR-11763](https://issues.apache.org/jira/browse/SOLR-11763) (Markus Jelsma) (Kevin Risden)
- Enable async logging by default. This change improves throughput for logging. This opens up a small window where log messages could possibly be lost. If this is unacceptable, switching back to synchronous logging can be done by changing the log4j2.xml file, no internal Solr code changed to make async logging the default. [SOLR-12055](https://issues.apache.org/jira/browse/SOLR-12055) (Erick Erickson)
- Upgrade Dropwizard Metrics to 4.0.5 release. [SOLR-12461](https://issues.apache.org/jira/browse/SOLR-12461) (ab)
- Async logging ring buffer and OOM error. When very long messages are written [SOLR-12753](https://issues.apache.org/jira/browse/SOLR-12753) (1M messages or so)
- Document recommended Java/Solr combinations [SOLR-12809](https://issues.apache.org/jira/browse/SOLR-12809) (Erick Erickson) (Jan Høydahl et.al.)
- Refactored DistributedUpdateProcessor to put SolrCloud functionality into a subclass. [SOLR-12955](https://issues.apache.org/jira/browse/SOLR-12955) (Bar Rotstein) (David Smiley)
- Improve HdfsAutoAddReplicasIntegrationTest and HdfsCollectionsAPIDistributedZkTest [SOLR-13060](https://issues.apache.org/jira/browse/SOLR-13060) (Kevin Risden)
- MoveReplicaHDFSTest leaks threads, falls into an endless loop, logging like crazy [SOLR-13074](https://issues.apache.org/jira/browse/SOLR-13074) (Kevin Risden)
- Upgrade jackson to 2.9.8 [SOLR-13112](https://issues.apache.org/jira/browse/SOLR-13112) (Kevin Risden)
- Improve logging in StreamingSolrClients [SOLR-13222](https://issues.apache.org/jira/browse/SOLR-13222) (Peter Cseh) (Kevin Risden)
- Clean up any test failures resulting from defaulting to async logging [SOLR-13268](https://issues.apache.org/jira/browse/SOLR-13268) (Erick Erickson)
- Ensure HDFS tests clear System properties they set [SOLR-13307](https://issues.apache.org/jira/browse/SOLR-13307) (Kevin Risden)
- Improve HDFS tests [SOLR-13330](https://issues.apache.org/jira/browse/SOLR-13330) (Kevin Risden)
- Upgrade to velocity 2.0 and velocity-tools 3.0 [SOLR-13335](https://issues.apache.org/jira/browse/SOLR-13335) (Kevin Risden)
- Remove dom4j from Solr [SOLR-13342](https://issues.apache.org/jira/browse/SOLR-13342) (Kevin Risden)
- Add SolrCli AuthTool test [SOLR-13353](https://issues.apache.org/jira/browse/SOLR-13353) (Kevin Risden)
- Upgrade to ZooKeeper 3.4.14 [SOLR-13363](https://issues.apache.org/jira/browse/SOLR-13363) (Erick Erickson)
- Clarify 'Invalid stage name' warning logging in AutoScalingConfig [SOLR-13366](https://issues.apache.org/jira/browse/SOLR-13366) (Christine Poerschke)
- Replace Observable pattern in TransientSolrCoreCache [SOLR-13400](https://issues.apache.org/jira/browse/SOLR-13400) (Erick Erickson)
- Disable HTML directory listings in admin interface to prevent possible security issues [SOLR-13409](https://issues.apache.org/jira/browse/SOLR-13409) (Uwe Schindler)
- SolrSchema - Avoid NPE if Luke returns field with no type defined [SOLR-13414](https://issues.apache.org/jira/browse/SOLR-13414) (Kevin Risden)
- Upgrade RRD4j to version 3.5. [SOLR-13423](https://issues.apache.org/jira/browse/SOLR-13423) (ab)
- Ref-Guide: Wrong color of text in left column of horizontal definition list [SOLR-13425](https://issues.apache.org/jira/browse/SOLR-13425) (janhoy)
- Remove reflection in FSHDFSUtils.java [SOLR-7321](https://issues.apache.org/jira/browse/SOLR-7321) (Mike Drob) (Kevin Risden)
- Remove debug if branch in HdfsTransactionLog [SOLR-8033](https://issues.apache.org/jira/browse/SOLR-8033) (Kevin Risden)
- Remove the workaround implemented for HADOOP-13346 [SOLR-9762](https://issues.apache.org/jira/browse/SOLR-9762) (Kevin Risden)
- Remove the workaround implemented for HADOOP-12767 [SOLR-9763](https://issues.apache.org/jira/browse/SOLR-9763) (Kevin Risden)


[8.0.0] - 2019-03-14
--------------------

### Upgrade Notes (18 changes)

- The 'func' query parser now returns scores that are equal to 0 when a negative value is produced. This change is due to the fact that Lucene now requires scores to be positive. [LUCENE-7996](https://issues.apache.org/jira/browse/LUCENE-7996) (Adrien Grand)
- Memory codecs have been removed from the codebase (MemoryPostings, MemoryDocValues). If you used postingsFormat="Memory" or docValuesFormat="Memory" then either remove it to use the default or experiment with one of the others. [LUCENE-8267](https://issues.apache.org/jira/browse/LUCENE-8267) (Dawid Weiss)
- Due to the introduction of LIR redesign since Solr 7.3 (SOLR-11702) and the removing of old LIR implementation in Solr 8. Rolling updates are not possible unless all nodes must be on Solr 7.3 or higher. If not updates can be lost. [SOLR-11702](https://issues.apache.org/jira/browse/SOLR-11702) 
- In 'langid' contrib, the LanguageIdentifierUpdateProcessor base class changed some method signatures. If you have a custom language identifier implementation you will need to adapt your code. [SOLR-11774](https://issues.apache.org/jira/browse/SOLR-11774) 
- SolrMetric registries retained references to SolrCores when closed. A change of SolrMetricMAnager.registerGauge and SolrMetricProducer.initializeMetrics method signatures was required to fix it. Third party components that use this API need to be updated. [SOLR-11882](https://issues.apache.org/jira/browse/SOLR-11882) (Eros Taborelli) (Erick Erickson) (ab)
- The date format patterns used by ParseDateFieldUpdateProcessorFactory (present in "schemaless mode") are now interpreted by Java 8's java.time.DateTimeFormatter instead of Joda Time. The pattern language is very similar but not the same. Typically, simply update the pattern by changing an uppercase 'Z' to lowercase 'z' and that's it. For the current recommended set of patterns in schemaless mode, see "Schemaless Mode" in the ref guide, or simply examine the default configSet. Also note that the set of patterns (formats) here have expanded from before to subsume those patterns previously handled by the "extract" contrib (Solr Cell / Tika). [SOLR-12586](https://issues.apache.org/jira/browse/SOLR-12586) (David Smiley) (Bar Rotstein)
- The "extraction" contrib (Solr Cell) no longer does any date parsing, and thus no longer has the "date.formats" configuration. To ensure date strings are properly parsed, use ParseDateFieldUpdateProcessorFactory (an URP) commonly registered with the name "parse-date" in "schemaless mode". [SOLR-12593](https://issues.apache.org/jira/browse/SOLR-12593) (David Smiley) (Bar Rotstein)
- UpdateShardHandler's updateOnlyClient is now a Http2SolrClient (previous HttpSolrClient). This new client does not support 'maxConnections','maxConnectionsPerHost' parameters. [SOLR-12605](https://issues.apache.org/jira/browse/SOLR-12605) 
- When JSON data is sent to Solr with nested child documents split using the "split" parameter, the child docs will now be associated to their parents by the field/label string used in the JSON instead of anonymously. Most users probably won't notice the distinction since the label is lost any way unless special fields are in the schema. This choice used to be toggleable with an internal/expert "anonChildDocs" parameter flag which is now gone. [SOLR-12633](https://issues.apache.org/jira/browse/SOLR-12633) (David Smiley)
- HttpShardHandlerFactory's defaultClient is now a Http2SolrClient (previous HttpSolrClient). This new client does not support 'maxConnections','maxConnectionsPerHost' parameters. LBHttpSolrClient.Req and LBHttpSolrClient.Rsp are marked as deprecated, uses LBSolrClient.Req and LBSolrClient.Rsp instead. [SOLR-12640](https://issues.apache.org/jira/browse/SOLR-12640) 
- Since Http2SolrClient does not support exposing connections related metrics. These metrics are no longer available 'QUERY.httpShardHandler.{availableConnections, leasedConnections, maxConnections, pendingConnections}', 'UPDATE.updateShardHandler.{availableConnections, leasedConnections, maxConnections, pendingConnections}' [SOLR-12643](https://issues.apache.org/jira/browse/SOLR-12643) 
- The UnifiedHighlighter hl.weightMatches now defaults to true. If there are unforseen highlight problems, this may be the culprit. [SOLR-12754](https://issues.apache.org/jira/browse/SOLR-12754) 
- If you explicitly use BM25SimilarityFactory in your schema, the absolute scoring will be lower due to SOLR-13025. But ordering of documents will not change in the normal case. Use LegacyBM25SimilarityFactory if you need to force the old 6.x/7.x scoring. Note that if you have not specified any similarity in schema or use the default SchemaSimilarityFactory, then LegacyBM25Similarity is automatically selected for 'luceneMatchVersion' &lt; 8.0.0. See also explanation in Reference Guide chapter "Other Schema Elements". [SOLR-13025](https://issues.apache.org/jira/browse/SOLR-13025) 
- The default replica placement strategy used in Solr has been reverted to the 'legacy' policy used by Solr 7.4 and previous versions. This is due to multiple bugs in the autoscaling based replica placement strategy that was made default in Solr 7.5 which causes multiple replicas of the same shard to be placed on the same node in addition to the maxShardsPerNode and createNodeSet parameters being ignored. Although the default has changed, autoscaling will continue to be used if a cluster policy or preference is specified or a collection level policy is in use. The default replica placement strategy can be changed to use autoscaling again by setting a cluster property: curl -X POST -H 'Content-type:application/json' --data-binary ' { "set-obj-property": { "defaults" : { "cluster": { "useLegacyReplicaAssignment":false } } } }' http://$SOLR_HOST:$SOLR_PORT/api/cluster [SOLR-13248](https://issues.apache.org/jira/browse/SOLR-13248) 
- Deleting (or updating) documents by their uniqueKey is now scoped to only consider root documents, not child/nested documents. Thus a delete-by-id won't work on a child doc (no-op), and an attempt to update a child doc by providing a new doc with the same ID would add a new doc (probably erroneous). Both these actions were and still are problematic. In-place-updates are safe though. If you want to delete certain child documents and if you know they don't themselves have nested children then you must do so with a delete-by-query technique. [SOLR-5211](https://issues.apache.org/jira/browse/SOLR-5211) 
- Solr nodes can now listen and serve HTTP/2 requests. Most of internal requests (sent by UpdateShardHandler) (HttpShardHandler)
- ALPN is not supported in Java 8 or lower version therefore when a node started in Java 8 or a lower version with SSL enabled, it will send and can only be able to handle HTTP/1.1 requests. In case of using SSL Java 9 or latter versions are recommended. 
- Custom AuthenticationPlugin must provide its own setup for Http2SolrClient through implementing HttpClientBuilderPlugin.setup, if not internal requests can't be authenticated. 

### Added (14 changes)

- New Node-level health check handler at /admin/info/healthcheck and /node/health paths that checks if the node is live, connected to zookeeper and not shutdown. [SOLR-11126](https://issues.apache.org/jira/browse/SOLR-11126) (Anshum Gupta) (Amrit Sarkar) (shalin)
- Expand the set of recognized date format patterns of schemaless mode to subsume those handled by the "extract" contrib (Solr Cell / Tika). This is primarily a change in configuration of the default configSet for more patterns, but also included enabling "lenient" parsing in ParseDateFieldUpdateProcessorFactory. The default locale was changed from ROOT to en_US since well-known patterns assume this locale. [SOLR-12591](https://issues.apache.org/jira/browse/SOLR-12591) (David Smiley) (Bar Rotstein)
- The default configSet now includes an "ignored_*" dynamic field. [SOLR-12593](https://issues.apache.org/jira/browse/SOLR-12593) (David Smiley)
- Umbrella JIRA for adding support HTTP/2 [SOLR-12639](https://issues.apache.org/jira/browse/SOLR-12639) (Cao Manh Dat)
- Implement staggered SPLITSHARD requests in IndexSizeTrigger. [SOLR-12730](https://issues.apache.org/jira/browse/SOLR-12730) (ab)
- Improved nested document support, and enabled in the default schema with the presence of _nest_path_. When this field is present, certain things happen automatically. An internal URP is automatically used to populate it. The [child] (doc transformer) will return a hierarchy with relationships; no params needed. The relationship path is indexed for use in queries (can be disabled if not needed). Also, child documents needn't provide a uniqueKey value as Solr will supply one automatically by concatenating a path to that of the parent document's key. [SOLR-12768](https://issues.apache.org/jira/browse/SOLR-12768) [SOLR-13129](https://issues.apache.org/jira/browse/SOLR-13129) (David Smiley) (Moshe Bla)
- Add Metrics reporting for AuthenticationPlugin [SOLR-12791](https://issues.apache.org/jira/browse/SOLR-12791) (janhoy)
- Allow Authentication Plugins to intercept internode requests on a per-request basis. The BasicAuth plugin now supports a new parameter 'forwardCredentials', and when set to 'true', user's BasicAuth credentials will be used instead of PKI for client initiated internode requests. [SOLR-12799](https://issues.apache.org/jira/browse/SOLR-12799) (janhoy) (noble)
- MinHash query parser that builds queries providing a measure of Jaccard similarity [SOLR-12879](https://issues.apache.org/jira/browse/SOLR-12879) (Andy Hind) (Tommaso Teofili)
- Add natural and repeat Stream Evaluators [SOLR-13104](https://issues.apache.org/jira/browse/SOLR-13104) (Joel Bernstein)
- Allow the knnRegress Stream Evaluator to more easily perform bivariate regression. [SOLR-13134](https://issues.apache.org/jira/browse/SOLR-13134) (Joel Bernstein)
- Add movingMAD Stream Evaluator [SOLR-13147](https://issues.apache.org/jira/browse/SOLR-13147) (Joel Bernstein)
- Add command-line option for testing autoscaling configurations. [SOLR-13155](https://issues.apache.org/jira/browse/SOLR-13155) (ab)
- Add 'autoscaling' tool support to solr.cmd [SOLR-13241](https://issues.apache.org/jira/browse/SOLR-13241) (Jason Gerlowski)

### Changed (6 changes)

- ParseDateFieldUpdateProcessorFactory should reuse ParsePosition. [SOLR-12725](https://issues.apache.org/jira/browse/SOLR-12725) (ab)
- The NestedUpdateProcessor (which populates internal fields for nested child docs) is now auto-registered to run immediately prior to RunUpdateProcessor. If the schema has no _nest_*_ fields then it's a no-op. RunUpdateProcessorFactory looks up a special/internal URP chain "_preRun_" which is implicitly defined but could be defined by an app for customization if desired. [SOLR-12888](https://issues.apache.org/jira/browse/SOLR-12888) (David Smiley)
- Due to LUCENE-8563, the BM25Similarity formula no longer includes the (k1+1) factor in the numerator This gives a lower absolute score but doesn't affect ordering, as this is a constant factor which is the same for every document. Use LegacyBM25SimilarityFactory if you need the old 6.x/7.x scoring. See also upgrade notes [SOLR-13025](https://issues.apache.org/jira/browse/SOLR-13025) [LUCENE-8563](https://issues.apache.org/jira/browse/LUCENE-8563) (janhoy)
- during the ResponseBuilder.STAGE_GET_FIELDS directly copy string bytes and avoid creating String Objects [SOLR-13130](https://issues.apache.org/jira/browse/SOLR-13130) (noble)
- If _root_ is defined in the schema, it is now always populated automatically. This allows documents with children to be updated with a document that does not have children, whereas before it would break block-join queries. If you don't use nested documents then _root_ can be removed from the schema. [SOLR-5211](https://issues.apache.org/jira/browse/SOLR-5211) (Dr Oleg Savrasov) (Moshe Bla) (David Smiley) (Mikhail Khludnev)
- The response format has changed slightly for ReplicationHandler error-cases. All errors now have a non-200 'status' field, a 'message' field giving more details on the error, and an optional 'exception' field. [SOLR-6117](https://issues.apache.org/jira/browse/SOLR-6117) (Shalin Mangar) (Jason Gerlowski)

### Fixed (5 changes)

- langid.map.individual now works together with langid.map.keepOrig. Also the detectLanguage() API is changed to accept a Reader allowing for more memory efficient implementations [SOLR-11774](https://issues.apache.org/jira/browse/SOLR-11774) (janhoy)
- Fix block that was synchronizing on the wrong collection in OverseerTaskProcessor [SOLR-13058](https://issues.apache.org/jira/browse/SOLR-13058) (Gus Heck)
- Query boosts were not being combined correctly for documents where not all boost queries matched [SOLR-13126](https://issues.apache.org/jira/browse/SOLR-13126) (Alan Woodward) (Mikhail Khludnev)
- Autoscaling based replica placement is broken out of the box. Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons, this issue reverts the default replica placement policy to the 'legacy' assignment policy that was the default until Solr 7.4. [SOLR-13248](https://issues.apache.org/jira/browse/SOLR-13248) (Gus Heck) (Andrzej Bialecki) (Bram Van Dam) (shalin)
- ClasscastException when URPs try to read a String field which returns a ByteArrayUTF8CHarSequence . This is a regression in release 7.7 (noble) *SOLR-13299: Fix Windows startup script to disable HTTP/2 if TLS is enabled on Java 8. [SOLR-13255](https://issues.apache.org/jira/browse/SOLR-13255) [SOLR-13299](https://issues.apache.org/jira/browse/SOLR-13299) (Uwe Schindler)

### Other (14 changes)

- SlowCompositeReaderWrapper now uses MultiTerms directly instead of MultiFields [LUCENE-8513](https://issues.apache.org/jira/browse/LUCENE-8513) (David Smiley)
- Remove backward compatibility of old LIR implementation in 8.0 [SOLR-11812](https://issues.apache.org/jira/browse/SOLR-11812) (Cao Manh Dat)
- Renamed class Config to XmlConfigFile [SOLR-12365](https://issues.apache.org/jira/browse/SOLR-12365) (David Smiley)
- Solr no longer accepts index time boosts in JSON provided to Solr. [SOLR-12535](https://issues.apache.org/jira/browse/SOLR-12535) (David Smiley)
- Upgrade ParseDateFieldUpdateProcessorFactory (present in "schemaless mode") to use Java 8's java.time.DateTimeFormatter instead of Joda time (see upgrade notes). "Lenient" is enabled. Removed Joda Time dependency. [SOLR-12586](https://issues.apache.org/jira/browse/SOLR-12586) (David Smiley) (Bar Rotstein)
- Make "Nodes" view the default in AdminUI "Cloud" tab [SOLR-12614](https://issues.apache.org/jira/browse/SOLR-12614) (janhoy)
- Remove the Admin UI Cloud -&gt; Graph (Radial) view [SOLR-12620](https://issues.apache.org/jira/browse/SOLR-12620) (janhoy)
- Remove SolrMetricManager.overridableRegistryName method [SOLR-12652](https://issues.apache.org/jira/browse/SOLR-12652) (Peter Somogyi) (David Smiley)
- LowerCaseTokenizer is deprecated, and should be replaced by LetterTokenizer and LowerCaseFilter [SOLR-12775](https://issues.apache.org/jira/browse/SOLR-12775) (Alan Woodward)
- Store previous term (generation) of replica when start recovery process [SOLR-12805](https://issues.apache.org/jira/browse/SOLR-12805) (Cao Manh Dat)
- Fix retry logic in JettySolrRunner [SOLR-13036](https://issues.apache.org/jira/browse/SOLR-13036) (Gus Heck)
- Improve the error message reported by DocumentObjectBinder when a setter is not found [SOLR-13086](https://issues.apache.org/jira/browse/SOLR-13086) (Gus Heck)
- edismax now throws an exception when qf refers to a nonexistent field [SOLR-5163](https://issues.apache.org/jira/browse/SOLR-5163) (Charles Sanders) (David Smiley)
- Hadoop dependencies have been upgraded to Hadoop 3.2.0 from 2.7.2. [SOLR-9515](https://issues.apache.org/jira/browse/SOLR-9515) (Mark Miller) (Kevin Risden)


[7.7.3] - 2020-04-28
--------------------

### Fixed (10 changes)

- prematurely reporting not yet finished async Collections API call as completed when collection's replicas are colocated at least at one node [SOLR-12291](https://issues.apache.org/jira/browse/SOLR-12291) (Varun Thacker) (Mikhail Khludnev)
- DataImportHandler: Added enable.dih.dataConfigParam system property to toggle whether the dataConfig param is permitted. [SOLR-13158](https://issues.apache.org/jira/browse/SOLR-13158) (David Smiley) (janhoy) (Tomás Fernández Löbbe)
- Forwarded requests should skip authorization on receiving nodes [SOLR-13472](https://issues.apache.org/jira/browse/SOLR-13472) (Ishan Chattopadhyaya)
- SPLITSHARD (async) with failures in underlying sub-operations can result in data loss [SOLR-13718](https://issues.apache.org/jira/browse/SOLR-13718) (Ishan Chattopadhyaya)
- Use the safe fork of simple-xml for clustering contrib. [SOLR-13779](https://issues.apache.org/jira/browse/SOLR-13779) (Dawid Weiss) (Sachin Pattan)
- HttpSolrCall now maintains internal request count (_forwardedCount) for remote queries and limits them to the number of replicas. This avoids making too many cascading calls to remote servers, which, if not restricted, can bring down nodes containing the said collection [SOLR-13793](https://issues.apache.org/jira/browse/SOLR-13793) (Kesharee Nandan Vishwakarma) (Ishan Chattopadhyaya)
- Improve ExecutePlanAction error handling. [SOLR-13828](https://issues.apache.org/jira/browse/SOLR-13828) 
- Velocity response writer's resource loading now possible only through startup parameters. Also, removed velocity response writer from _default configset. [SOLR-13971](https://issues.apache.org/jira/browse/SOLR-13971) (Ishan Chattopadhyaya) (Sachin Pattan)
- VelocityResponseWriter has been hardened - only trusted configsets can render configset provided templates and rendering templates from request parameters has been removed. [SOLR-14025](https://issues.apache.org/jira/browse/SOLR-14025) 
- Back port javabin performance regression fixes from SOLR-14013 [SOLR-14259](https://issues.apache.org/jira/browse/SOLR-14259) [SOLR-14013](https://issues.apache.org/jira/browse/SOLR-14013) (noble)


[7.7.2] - 2019-06-04
--------------------

### Upgrade Notes (2 changes)

- When requesting the status of an async request via REQUESTSTATUS collections API, the response will include the list of internal async requests (if any) in the "success" or "failed" keys (in addition to them being included outside those keys for backwards compatibility). See SOLR-12708 for more details [SOLR-12708](https://issues.apache.org/jira/browse/SOLR-12708) 
- The Prometheus Metric Exporter now collects metrics from Solr at a fixed schedule that is controlled by the exporter itself. The default interval is 60s but it can be changed by specifying the --scrape-interval command line parameter to the tool. The collected metrics are cached and returned for any requests coming in before the next scheduled collection. This can impact the freshness of the metrics if prometheus is configured to query the tool more frequently. [SOLR-13234](https://issues.apache.org/jira/browse/SOLR-13234) 

### Fixed (25 changes)

- In-place update fails when resolving from Tlog if schema has a required field [SOLR-11876](https://issues.apache.org/jira/browse/SOLR-11876) (Justin Deoliveira) (janhoy) (Ishan Chattopadhyaya)
- Editing authorization config via REST API now works in standalone mode [SOLR-12371](https://issues.apache.org/jira/browse/SOLR-12371) (janhoy)
- Async collection actions should not hide internal failures [SOLR-12708](https://issues.apache.org/jira/browse/SOLR-12708) (Mano Kovacs) (Varun Thacker) (Tomás Fernández Löbbe)
- Avoid unnecessary memory cost when DistributedUpdateProcessor timed-out lock is not used. [SOLR-12833](https://issues.apache.org/jira/browse/SOLR-12833) (ab)
- MetricsHistoryHandler now uses PKI Auth for metrics collection in background thread [SOLR-12860](https://issues.apache.org/jira/browse/SOLR-12860) (janhoy) (Lorenzo)
- Upgrade jackson to 2.9.8 [SOLR-13112](https://issues.apache.org/jira/browse/SOLR-13112) (Kevin Risden)
- Query boosts were not being combined correctly for documents where not all boost queries matched [SOLR-13126](https://issues.apache.org/jira/browse/SOLR-13126) (Alan Woodward) (Mikhail Khludnev)
- Cleanup replicasMetTragicEvent after all types of exception [SOLR-13229](https://issues.apache.org/jira/browse/SOLR-13229) (Tomás Fernández Löbbe)
- Prometheus Metric Exporter not threadsafe. This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores. [SOLR-13234](https://issues.apache.org/jira/browse/SOLR-13234) (Danyal Prout) (shalin)
- Fix an NPE when setting a "policy" property for an existing collection [SOLR-13252](https://issues.apache.org/jira/browse/SOLR-13252) (ab)
- Correct message that is logged in solrj's ConnectionManager when an exception occurred while reconnecting to ZooKeeper. [SOLR-13254](https://issues.apache.org/jira/browse/SOLR-13254) (hu xiaodong) (Christine Poerschke)
- Fixed NPE in DocExpirationUpdateProcessorFactory [SOLR-13281](https://issues.apache.org/jira/browse/SOLR-13281) (Munendra S N) (Tomás Fernández Löbbe)
- Updates with enum fields and javabin cause ClassCastException [SOLR-13285](https://issues.apache.org/jira/browse/SOLR-13285) (noble)
- Atomic Update 'remove' operations broken for certain field types in SolrJ [SOLR-13331](https://issues.apache.org/jira/browse/SOLR-13331) (Thomas Wockinger) (Jason Gerlowski)
- Admin UI inaccessible with RuleBasedAuthorizationPlugin [SOLR-13344](https://issues.apache.org/jira/browse/SOLR-13344) (janhoy) (Jason Gerlowski)
- High CPU usage in Solr due to Java 8 bug [SOLR-13349](https://issues.apache.org/jira/browse/SOLR-13349) (Erick Erickson)
- Remove risk of deadlock/threadleak when shutting down an Overseer(TriggerThread). [SOLR-13352](https://issues.apache.org/jira/browse/SOLR-13352) (hossman)
- 'all' permission ignored by RuleBasedAuthorizationPlugin in most cases [SOLR-13355](https://issues.apache.org/jira/browse/SOLR-13355) (Jason Gerlowski) (janhoy)
- Clarify 'Invalid stage name' warning logging in AutoScalingConfig [SOLR-13366](https://issues.apache.org/jira/browse/SOLR-13366) (Christine Poerschke)
- OverseerTaskQueue#remove should not throw an exception when no node exists after an exists check and the Overseer work loop should not allow free spinning the loop when it hits a KeeperException. [SOLR-13386](https://issues.apache.org/jira/browse/SOLR-13386) (Mark Miller) (Fernandez-Lobbe) (Mike Drob)
- Move log line "Processing SSL Credential Provider chain..." from INFO to DEBUG [SOLR-13398](https://issues.apache.org/jira/browse/SOLR-13398) (janhoy)
- Disable HTML directory listings in admin interface to prevent possible security issues [SOLR-13409](https://issues.apache.org/jira/browse/SOLR-13409) (Uwe Schindler)
- Designated overseer wasn't able to rejoin election queue at head upon restart [SOLR-13410](https://issues.apache.org/jira/browse/SOLR-13410) (Ishan Chattopadhyaya) (Kesharee Nandan Vishwakarma)
- SolrSchema - Avoid NPE if Luke returns field with no type defined [SOLR-13414](https://issues.apache.org/jira/browse/SOLR-13414) (Kevin Risden)
- SolrClientNodeStateProvider always retries on requesting metrics from other nodes [SOLR-13449](https://issues.apache.org/jira/browse/SOLR-13449) (Cao Manh Dat)

### Other (1 change)

- Upgrade to ZooKeeper 3.4.14 [SOLR-13363](https://issues.apache.org/jira/browse/SOLR-13363) (Erick Erickson)


[7.7.1] - 2019-03-01
--------------------

### Upgrade Notes (1 change)

- * SOLR-13248: The default replica placement strategy used in Solr has been reverted to the 'legacy' policy used by Solr 7.4 and previous versions. This is due to multiple bugs in the autoscaling based replica placement strategy that was made default in Solr 7.5 which causes multiple replicas of the same shard to be placed on the same node in addition to the maxShardsPerNode and createNodeSet parameters being ignored. Although the default has changed, autoscaling will continue to be used if a cluster policy or preference is specified or a collection level policy is in use. The default replica placement strategy can be changed to use autoscaling again by setting a cluster property: curl -X POST -H 'Content-type:application/json' --data-binary ' { "set-obj-property": { "defaults" : { "cluster": { "useLegacyReplicaAssignment":false } } } }' http://$SOLR_HOST:$SOLR_PORT/api/cluster [SOLR-13248](https://issues.apache.org/jira/browse/SOLR-13248) 

### Fixed (2 changes)

- Autoscaling based replica placement is broken out of the box. Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons, this issue reverts the default replica placement policy to the 'legacy' assignment policy that was the default until Solr 7.4. [SOLR-13248](https://issues.apache.org/jira/browse/SOLR-13248) (Gus Heck) (Andrzej Bialecki) (Bram Van Dam) (shalin)
- ClasscastException when URPs try to read a String field which returns a ByteArrayUTF8CHarSequence . This is a regression in release 7.7 [SOLR-13255](https://issues.apache.org/jira/browse/SOLR-13255) (noble)


[7.7.0] - 2019-02-11
--------------------

### Upgrade Notes (1 change)

- The 'shards' parameter handling logic changes to use a new config element to determine what hosts can be requested. Please see Apache Solr Reference Guide chapter "Distributed Requests" for details, as well as SOLR-12770. [SOLR-12770](https://issues.apache.org/jira/browse/SOLR-12770) 

### Added (7 changes)

- Add a "tombstoneConfig" option to DocBasedVersionConstraintsProcessor that allows users to configure which fields/values to add to tombstone documents. This can be useful to make sure tombstone documents include fields that are marked as required in the schema [SOLR-12373](https://issues.apache.org/jira/browse/SOLR-12373) (Tomás Fernández Löbbe)
- Make it possible to configure a host whitelist for distributed search [SOLR-12770](https://issues.apache.org/jira/browse/SOLR-12770) (Christine Poerschke) (janhoy) (Erick Erickson) (Tomás Fernández Löbbe)
- JSON 'terms' Faceting now supports a 'prelim_sort' option to use when initially selecting the top ranking buckets, prior to the final 'sort' option used after refinement. [SOLR-12839](https://issues.apache.org/jira/browse/SOLR-12839) (hossman)
- The search Streaming Expression should properly support and push down paging when using the /select handler [SOLR-12984](https://issues.apache.org/jira/browse/SOLR-12984) (Joel Bernstein)
- Add zplot Stream Evaluator to plot math expressions in Apache Zeppelin [SOLR-13088](https://issues.apache.org/jira/browse/SOLR-13088) (Joel Bernstein)
- Add Admin UI login support for Kerberos [SOLR-13116](https://issues.apache.org/jira/browse/SOLR-13116) (janhoy) (Jason Gerlowski)
- Add a login page to Admin UI, with initial support for Basic Auth [SOLR-7896](https://issues.apache.org/jira/browse/SOLR-7896) (janhoy)

### Changed (15 changes)

- Remove static modifier from Overseer queue access. [SOLR-12804](https://issues.apache.org/jira/browse/SOLR-12804) (Mark Miller)
- Add configurable timeout to VersionBucket lock. [SOLR-12833](https://issues.apache.org/jira/browse/SOLR-12833) (Jeffery Yuan) (Mark Miller)
- Remove unneeded import statements [SOLR-12881](https://issues.apache.org/jira/browse/SOLR-12881) (Peter Somogyi) (Erick Erickson)
- BinaryResponseWriter (javabin format) should directly copy from BytesRef to output [SOLR-12885](https://issues.apache.org/jira/browse/SOLR-12885) (noble)
- Introduce more checks for shutdown and closed to improve clean close and shutdown. [SOLR-12896](https://issues.apache.org/jira/browse/SOLR-12896) (Mark Miller)
- Introduce AlreadyClosedException to clean up silly close / shutdown logging. [SOLR-12897](https://issues.apache.org/jira/browse/SOLR-12897) (Mark Miller)
- Replace cluster state polling with ZkStateReader#waitFor. [SOLR-12898](https://issues.apache.org/jira/browse/SOLR-12898) (Mark Miller)
- Admin UI "Nodes" view support for replica* replica names. [SOLR-12973](https://issues.apache.org/jira/browse/SOLR-12973) (Daniel Collins) (Christine Poerschke) (janhoy)
- JavabinLoader should avoid creating String Objects and create UTF8CharSequence fields from byte[] [SOLR-12983](https://issues.apache.org/jira/browse/SOLR-12983) (noble)
- When using binary format, ExportWriter to directly copy BytesRef instead of creating new String [SOLR-12992](https://issues.apache.org/jira/browse/SOLR-12992) (noble)
- Computing suggestions when policy have "#EQUAL" or "#ALL" rules take too long [SOLR-13016](https://issues.apache.org/jira/browse/SOLR-13016) (noble)
- solr.hdfs.buffer.size can be configured for HdfsBackupRepository for better performance [SOLR-13029](https://issues.apache.org/jira/browse/SOLR-13029) (Tim Owen) (Mikhail Khludnev)
- All shipped configurations still have `maxBooleanClauses` default to 1024. But if the `solr.max.booleanClauses` sysprop is specified, that will override the 1024 default. This enables users to update this property across the board more easily. [SOLR-13090](https://issues.apache.org/jira/browse/SOLR-13090) (Jason Gerlowski)
- Allow derivatives to be computed for the oscillate Stream Evaluator [SOLR-13146](https://issues.apache.org/jira/browse/SOLR-13146) (Joel Bernstein)
- support facet.sort for facet.field={!terms=foo,bar}field. [SOLR-13156](https://issues.apache.org/jira/browse/SOLR-13156) (Konstantin Perikov) (Mikhail Khludnev)

### Fixed (18 changes)

- New Admin UI Query does not URL-encode the query produced in the URL box [SOLR-10975](https://issues.apache.org/jira/browse/SOLR-10975) (janhoy)
- Spellcheck parameters not working in new UI [SOLR-11296](https://issues.apache.org/jira/browse/SOLR-11296) (Matt Pearce) (janhoy)
- Solr installer fails on SuSE linux [SOLR-11853](https://issues.apache.org/jira/browse/SOLR-11853) (Markus Mandalka) (janhoy)
- RebalanceLeaders API broken response format with wt=JSON [SOLR-11998](https://issues.apache.org/jira/browse/SOLR-11998) (Erick Erickson)
- Fix incorrect SOLR_SSL_KEYSTORE_TYPE variable in solr start script [SOLR-12237](https://issues.apache.org/jira/browse/SOLR-12237) (janhoy) (Joel Bernstein)
- Rule-base Authorization plugin skips authorization if querying node does not have collection replica [SOLR-12514](https://issues.apache.org/jira/browse/SOLR-12514) (noble)
- CVSResponseWriter omits useDocValuesAsStored=true field when fl=* [SOLR-12546](https://issues.apache.org/jira/browse/SOLR-12546) (Munendra S N) (Mikhail Khludnev)
- Fix SolrCloud distributed commit. [SOLR-12933](https://issues.apache.org/jira/browse/SOLR-12933) (Mark Miller)
- URI Too Long with large streaming expressions in SolrJ [SOLR-13014](https://issues.apache.org/jira/browse/SOLR-13014) (janhoy)
- NodeAddedTrigger and NodeLostTrigger do not reserve added/removed time populated by restoreState [SOLR-13053](https://issues.apache.org/jira/browse/SOLR-13053) (Cao Manh Dat)
- A failure while reloading a SolrCore can result in the SolrCore not being closed. [SOLR-13066](https://issues.apache.org/jira/browse/SOLR-13066) (Mark Miller)
- Management of markers for nodeLost / nodeAdded events is broken. This bug could have caused some events to be lost if they coincided with an Overseer leader crash. [SOLR-13072](https://issues.apache.org/jira/browse/SOLR-13072) (ab)
- The "terms" QParser's "automaton" method semi-required that the input terms/IDs be sorted. This query parser now does this. Unclear if this is a perf issue or actual bug. [SOLR-13080](https://issues.apache.org/jira/browse/SOLR-13080) (Daniel Lowe) (David Smiley)
- A trigger that creates trigger events more frequently than the cool down period can starve other triggers. This is mitigated to some extent by randomly choosing the trigger to resume after cool down. It is recommended that scheduled triggers not be used for very frequent operations to avoid this problem. [SOLR-13082](https://issues.apache.org/jira/browse/SOLR-13082) (ab) (shalin)
- REBALANCELEADERS is broken [SOLR-13091](https://issues.apache.org/jira/browse/SOLR-13091) (Erick Erickson)
- NPE when /admin/zookeeper/status endpoint hit in standalone mode [SOLR-13137](https://issues.apache.org/jira/browse/SOLR-13137) (janhoy)
- Fixed a bug in TestInjection that caused test only code to be invoked when TLOG replicas recieved commits if java assertions were enabled. [SOLR-13168](https://issues.apache.org/jira/browse/SOLR-13168) (hossman)
- Fix v2 API for AutoscalingHistoryHandler. [SOLR-9735](https://issues.apache.org/jira/browse/SOLR-9735) (ab)

### Other (7 changes)

- Upgrade ZooKeeper dependency to 3.4.13 [SOLR-12727](https://issues.apache.org/jira/browse/SOLR-12727) (Kevin Risden) (Erick Erickson) (Cao Manh Dat)
- Make massive improvements to the tests. [SOLR-12801](https://issues.apache.org/jira/browse/SOLR-12801) (Mark Miller)
- The new AutoScaling tests are way too flaky and need special attention. [SOLR-12923](https://issues.apache.org/jira/browse/SOLR-12923) (Mark Miller)
- ant test (without badapples=false) should pass easily for developers. [SOLR-12932](https://issues.apache.org/jira/browse/SOLR-12932) (Mark Miller)
- deprecate unused SolrIndexConfig.luceneVersion [SOLR-12972](https://issues.apache.org/jira/browse/SOLR-12972) (Christine Poerschke)
- Fix retry logic in JettySolrRunner [SOLR-13036](https://issues.apache.org/jira/browse/SOLR-13036) (Gus Heck)
- Improve the error message reported by DocumentObjectBinder when a setter is not found [SOLR-13086](https://issues.apache.org/jira/browse/SOLR-13086) (Gus Heck)


[7.6.0] - 2018-12-14
--------------------

### Upgrade Notes (4 changes)

- Autoscaling policy framework is now used as the default strategy to select the nodes on which new replicas or replicas of new collections are created. Previously, the maxShardsPerNode parameter was not allowed on collections when autoscaling policy was configured. Also if an autoscaling policy was configured then the default was to set an unlimited maxShardsPerNode automatically. Now the maxShardsPerNode parameter is always allowed during collection creation and maxShardsPerNode should be set correctly (if required) regardless of whether autoscaling policies are in effect or not. The default value of maxShardsPerNode continues to be 1 as before. It can be set to -1 during collection creation to fall back to the old behavior of unlimited maxShardsPerNode when using autoscaling policy. [SOLR-12739](https://issues.apache.org/jira/browse/SOLR-12739) 
- The min_rf parameter is no longer needed, Solr will always return the achieved replication factor [SOLR-12767](https://issues.apache.org/jira/browse/SOLR-12767) (rf)
- The cluster wide defaults structure has changed from {collectionDefaults: {nrtReplicas : 2}} to {defaults : {collection : {nrtReplicas : 2}}}. The old format continues to be supported and can be read from ZK as well as written using the V2 set-obj-property syntax but it is deprecated and will be removed in Solr 9. We recommend that users change their API calls to use the new format going forward. [SOLR-12827](https://issues.apache.org/jira/browse/SOLR-12827) 
- Added a Solr factory for ByteBuffersDirectory, which will replace deprecated RAMDirectory in Solr 9.0. [SOLR-12861](https://issues.apache.org/jira/browse/SOLR-12861) 

### Added (25 changes)

- /autoscaling/suggestions now include rebalance options as well even if there are no violations [SOLR-11522](https://issues.apache.org/jira/browse/SOLR-11522) (noble)
- Add recip Stream Evaluator to support reciprocal transformations [SOLR-11572](https://issues.apache.org/jira/browse/SOLR-11572) (Joel Bernstein)
- Add convexHull and associated geometric Stream Evaluators. [SOLR-11907](https://issues.apache.org/jira/browse/SOLR-11907) (Joel Bernstein)
- Suggestions API/UI should show an entry where a violation could not be resolved [SOLR-11997](https://issues.apache.org/jira/browse/SOLR-11997) (noble)
- The UnifiedHighlighter has a new hl.weightMatches param defaulting to false (will be true in 8.0). It's the highest query accuracy mode, and furthermore phrase queries are highlighted as one. [SOLR-12754](https://issues.apache.org/jira/browse/SOLR-12754) (David Smiley)
- Add support for Leaky ReLU and TanH activations in contrib/ltr NeuralNetworkModel class. [SOLR-12780](https://issues.apache.org/jira/browse/SOLR-12780) (Kamuela Lau) (Christine Poerschke)
- Introduce 'rows' and 'offset' parameter in FacetStream [SOLR-12795](https://issues.apache.org/jira/browse/SOLR-12795) (Joel Bernstein) (Amrit Sarkar) (Varun Thacker)
- Add enclosingDisk and associated geometric Stream Evaluators. [SOLR-12811](https://issues.apache.org/jira/browse/SOLR-12811) (Joel Bernstein)
- Implement maxOps limit for IndexSizeTrigger. [SOLR-12815](https://issues.apache.org/jira/browse/SOLR-12815) (ab)
- /autoscaling/suggestions to include suggestion to add-replica for lost replicas [SOLR-12822](https://issues.apache.org/jira/browse/SOLR-12822) (noble)
- Add oscillate Stream Evaluator to support sine wave analysis. [SOLR-12828](https://issues.apache.org/jira/browse/SOLR-12828) (Joel Bernstein)
- Add plist (parallel list) Streaming Expression [SOLR-12829](https://issues.apache.org/jira/browse/SOLR-12829) (Joel Bernstein)
- Add pairSort Stream Evaluator [SOLR-12840](https://issues.apache.org/jira/browse/SOLR-12840) (Joel Bernstein)
- Implement a MultiContentWriter in SolrJ to post multiple files/payload at once [SOLR-12843](https://issues.apache.org/jira/browse/SOLR-12843) (noble)
- Added support for "host" variable in autoscaling policy rules [SOLR-12846](https://issues.apache.org/jira/browse/SOLR-12846) (noble)
- Add log10 Stream Evaluator and allow the pow Stream Evaluator to accept a vector of exponents [SOLR-12862](https://issues.apache.org/jira/browse/SOLR-12862) (Joel Bernstein)
- Allow percentiles Stream Evaluator to accept an array of percentiles to calculate [SOLR-12936](https://issues.apache.org/jira/browse/SOLR-12936) (Joel bernstein)
- Cluster Status returns results for aliases, instead of throwing exceptions [SOLR-12938](https://issues.apache.org/jira/browse/SOLR-12938) (Gus Heck)
- Add an option in IndexSizeTrigger to select the split shard method. [SOLR-12942](https://issues.apache.org/jira/browse/SOLR-12942) (ab)
- Added a new 'uninvertible' option for fields and fieldtypes. This defaults to 'true' for backcompat allowing a FieldCache to be built for indexed fields as needed, but users are encouraged to set this to false (using docValues as needed) to reduce the risk of large fluxuations in heap size due to unexpected attempts to sort/facet/function on non-docValue fields. [SOLR-12962](https://issues.apache.org/jira/browse/SOLR-12962) (hossman)
- Add pivot Stream Evaluator to pivot facet co-occurrence counts into a matrix [SOLR-12971](https://issues.apache.org/jira/browse/SOLR-12971) (Joel Bernstein)
- Add ltrim and rtrim Stream Evaluators [SOLR-12975](https://issues.apache.org/jira/browse/SOLR-12975) (Joel Bernstein)
- Splitshard collections API now supports splitting into more than 2 sub-shards directly i.e. by providing a numSubShards parameter [SOLR-5004](https://issues.apache.org/jira/browse/SOLR-5004) (Christine Poerschke) (Anshum Gupta)
- {!collapse}: if you attempt to use CollapseQParser on a field that is multi-valued, you will now get an error. Previously, the collapsing behavior was unreliable and undefined despite no explicit error. [SOLR-6280](https://issues.apache.org/jira/browse/SOLR-6280) (Munendra S N) (David Smiley)
- ADDREPLICA command should be able to add more than one replica to a collection,shard at a time. The API now supports 'nrtReplicas', 'tlogReplicas', 'pullReplicas' parameters as well 'createNodeSet' parameter. As part of this change, the CREATESHARD API now delegates placing replicas entirely to the ADDREPLICA command and uses the new parameters to add all the replicas in one API call. [SOLR-9317](https://issues.apache.org/jira/browse/SOLR-9317) (shalin)

### Changed (11 changes)

- Some internal LeafReader.getFieldInfos implementations were being re-computed on-demand instead of once up front leading to some slowdowns in places like JSON Facets and field collapsing. [LUCENE-8557](https://issues.apache.org/jira/browse/LUCENE-8557) (Tim Underwood) (David Smiley)
- Support for stream.url or stream.file pointing to gzipped data. It's detected by either a content encoding header or file extension. [SOLR-10981](https://issues.apache.org/jira/browse/SOLR-10981) (Andrew Lundgren) (David Smiley) (Jan Høydahl)
- Make contrib/ltr LTRScoringModel immutable and cache its hashCode. [SOLR-12699](https://issues.apache.org/jira/browse/SOLR-12699) (Stanislav Livotov) (Edward Ribeiro) (Christine Poerschke)
- Make autoscaling policy based replica placement the default strategy for placing replicas. [SOLR-12739](https://issues.apache.org/jira/browse/SOLR-12739) (shalin)
- Solr now always includes in the response of update requests the achieved replication factor [SOLR-12767](https://issues.apache.org/jira/browse/SOLR-12767) (Tomás Fernández Löbbe)
- UninvertingReader wrapping is now a bit more lightweight: Does not create FieldInfo for fields that can't be uninverted (saves mem) and can avoid wrapping the reader altogether if there's nothing to uninvert. IndexSchema.getUninversionMap refactored to getUninversionMapper and no longer merges FieldInfos. [SOLR-12782](https://issues.apache.org/jira/browse/SOLR-12782) (David Smiley)
- use autoscaling policies with strict=false to prioritize node allocation [SOLR-12806](https://issues.apache.org/jira/browse/SOLR-12806) (noble)
- Json Facets: Show the FacetProcessor class name instead of the FacetRequest in the JSON Facets debug-trace output [SOLR-12880](https://issues.apache.org/jira/browse/SOLR-12880) (Tim Underwood)
- Eliminate excessive lambda allocation in json facets FacetFieldProcessorByHashDV [SOLR-12882](https://issues.apache.org/jira/browse/SOLR-12882) (Tim Underwood)
- MapWriter to use CharSequence instead of String [SOLR-12892](https://issues.apache.org/jira/browse/SOLR-12892) (noble)
- Json Facets: use DocValuesIterator advanceExact() instead of advance() in FacetFieldProcessorByHashDV and UniqueSinglevaluedSlotAcc. [SOLR-12964](https://issues.apache.org/jira/browse/SOLR-12964) (Tim Underwood)

### Fixed (19 changes)

- FacetStream works with bucketSizeLimit of -1 which will fetch all the buckets. [SOLR-11836](https://issues.apache.org/jira/browse/SOLR-11836) (Alfonso Muñoz-Pomer Fuentes) (Amrit Sarkar) (Varun Thacker)
- Autoscaling policy engine shuffles replicas needlessly [SOLR-12023](https://issues.apache.org/jira/browse/SOLR-12023) (noble)
- Edismax missing phrase queries when phrases contain multiterm synonyms [SOLR-12243](https://issues.apache.org/jira/browse/SOLR-12243) (Elizabeth Haubert) (Alessandro Benedetti) (Uwe Schindler) (Steve Rowe)
- Autoscaling framework based replica placement is not used unless a policy is specified or non-empty cluster policy exists. [SOLR-12648](https://issues.apache.org/jira/browse/SOLR-12648) (shalin)
- SplitShardCmd should lock the parent shard to prevent parallel splitting requests. [SOLR-12729](https://issues.apache.org/jira/browse/SOLR-12729) (ab)
- Migrate API should lock the collection instead of shard. [SOLR-12750](https://issues.apache.org/jira/browse/SOLR-12750) (shalin)
- When using min_rf, shard leader skipped bad replicas instead of marking them for recovery, this could create inconsistencies between replicas of the same shard. min_rf parameter is now deprecated, and even if provided replicas that don't ack an update from the leader will be marked for recovery. [SOLR-12767](https://issues.apache.org/jira/browse/SOLR-12767) (Tomás Fernández Löbbe)
- Setting of TMP in solr.cmd causes invisibility of Solr to JDK tools [SOLR-12776](https://issues.apache.org/jira/browse/SOLR-12776) (Petr Bodnar) (Erick Erickson)
- Ensure ConcurrentUpdateSolrClient sends documents to correct collection [SOLR-12803](https://issues.apache.org/jira/browse/SOLR-12803) (Jason Gerlowski)
- Metrics history causing "HttpParser URI is too large &gt;8192" when many collections [SOLR-12814](https://issues.apache.org/jira/browse/SOLR-12814) (janhoy)
- ZkController creates a cloud solr client with no connection or read timeouts. Now the http client created by the update shard handler is used instead. [SOLR-12836](https://issues.apache.org/jira/browse/SOLR-12836) (shalin)
- Improvements and fixes to let and select Streaming Expressions [SOLR-12851](https://issues.apache.org/jira/browse/SOLR-12851) (Joel Bernstein)
- Request forwarding for v2 API is broken [SOLR-12868](https://issues.apache.org/jira/browse/SOLR-12868) (noble)
- Java 9+ GC Logging filesize parameter should use a unit. [SOLR-12874](https://issues.apache.org/jira/browse/SOLR-12874) (Tim Underwood) (Uwe Schindler)
- fix ArrayIndexOutOfBoundsException when unique(field) or uniqueBlock(_root_) is used with DVHASH method in json.facet. [SOLR-12875](https://issues.apache.org/jira/browse/SOLR-12875) (Tim Underwood) (Mikhail Khludnev)
- fix facet.pivot refinement bugs when using facet.sort=index and facet.mincount&gt;1 [SOLR-12954](https://issues.apache.org/jira/browse/SOLR-12954) (hossman)
- Autoscaling tries to fetch metrics from dead nodes [SOLR-12977](https://issues.apache.org/jira/browse/SOLR-12977) (noble)
- In autoscaling NPE thrown for nodes where value is absent [SOLR-12978](https://issues.apache.org/jira/browse/SOLR-12978) (noble)
- Fix parsing of child documents using queryAndStreamResponse [SOLR-7557](https://issues.apache.org/jira/browse/SOLR-7557) (Marvin Bredal Lillehaug) (Stian Østerhaug) (janhoy)

### Other (13 changes)

- Upgrade to Tika 1.19.1 when available [SOLR-12423](https://issues.apache.org/jira/browse/SOLR-12423) (Tim Allison) (Erick Erickson)
- Add documentation to use Hadoop credential provider-based keystore/trustsore. [SOLR-12497](https://issues.apache.org/jira/browse/SOLR-12497) (Mano Kovacs) (Cassandra Targett)
- Fix parameter names in Solr JSON documentation [SOLR-12600](https://issues.apache.org/jira/browse/SOLR-12600) (Alexandre Rafalovitch)
- Simplify the Ref Guide HTML structure and use semantic HTML tags where possible. Adds new template files for Asciidoctor HTML conversion. Building the HTML version now requires the Slim gem. [SOLR-12746](https://issues.apache.org/jira/browse/SOLR-12746) (Cassandra Targett)
- Refactor Assign and extract replica placement strategies out of it. Now, assignment is done with the help of a builder class instead of calling a method with large number of arguments. The number of special cases that had to be handled have been cut down as well. [SOLR-12756](https://issues.apache.org/jira/browse/SOLR-12756) (shalin)
- Fix javadoc for SolrCloudTestCase.clusterShape() method and add a method that validates only against Active slices [SOLR-12762](https://issues.apache.org/jira/browse/SOLR-12762) (Anshum Gupta)
- Move TestCloudJSONFacetJoinDomain and TestCloudJSONFacetSKG to the facet test package [SOLR-12793](https://issues.apache.org/jira/browse/SOLR-12793) (Varun Thacker)
- Migrate cluster wide defaults syntax in cluster properties to a nested structure. The structure has changed from {collectionDefaults: {nrtReplicas : 2}} to {defaults : {collection : {nrtReplicas : 2}}}. [SOLR-12827](https://issues.apache.org/jira/browse/SOLR-12827) (ab) (shalin)
- Document statistics exposed by the Query Result Cache when maxRamMB is configured. [SOLR-12835](https://issues.apache.org/jira/browse/SOLR-12835) (shalin)
- Add Solr factory for ByteBuffersDirectory. [SOLR-12861](https://issues.apache.org/jira/browse/SOLR-12861) 
- Add Javadoc @since tag to Analyzer component classes [SOLR-12956](https://issues.apache.org/jira/browse/SOLR-12956) (Alexandre Rafalovitch)
- Add Javadoc @since tag to URP classes [SOLR-12966](https://issues.apache.org/jira/browse/SOLR-12966) (Alexandre Rafalovitch)
- ZkNodeProps to be able to load from both javabin and JSON [SOLR-13006](https://issues.apache.org/jira/browse/SOLR-13006) (noble)


[7.5.0] - 2018-09-24
--------------------

### Upgrade Notes (7 changes)

- TieredMergePolicy now respects maxSegmentSizeMB by default when executing findForcedMerges (optimize) and findForcedDeletesMerges (expungeDeletes) [LUCENE-7976](https://issues.apache.org/jira/browse/LUCENE-7976) (Erick Erickson)
- Extremely outdated UIMA contrib module has been removed [SOLR-11694](https://issues.apache.org/jira/browse/SOLR-11694) (Alexandre Rafalovitch)
- The configuration file for log4j2.xml is now in ../server/resources/log4j2.xml. All other copies have been removed. WINDOWS USERS: This JIRA corrects a bug in the start scripts that put example logs under ...\server, solr.log is now under ...\example. [SOLR-12008](https://issues.apache.org/jira/browse/SOLR-12008) (Erick Erickson)
- The data-driven schema no longer returns the *_str field-copy of text fields by default. The *_str field is still created and can be used for e.g. sorting, but to retrieve it you now need to explicitly list it in "fl" SOLR-12350 [SOLR-12350](https://issues.apache.org/jira/browse/SOLR-12350) 
- SignificantTermsQParserPlugin's name is now 'significantTerms' and its old name 'sigificantTerms' is deprecated. [SOLR-12395](https://issues.apache.org/jira/browse/SOLR-12395) 
- The heatmap facet response structure, when returned in JSON, changed from an even/odd name/value array to an object style. Although the object style makes more sense, this was an overlooked back-compat break; sorry. [SOLR-12398](https://issues.apache.org/jira/browse/SOLR-12398) 
- The data-driven schema no longer returns the *_str field-copy of text fields by default. The *_str field is still created and can be used for e.g. sorting, but to retrieve it you now need to explicitly list it in "fl" (SOLR-12350)

### Added (42 changes)

- Solr 7 Admin UI (Cloud &gt; Graph) should reflect the Replica type to give a more accurate representation of the cluster. [SOLR-11578](https://issues.apache.org/jira/browse/SOLR-11578) (Rhoit Singh) (Erick Erickson)
- When creating a configSet via the API, the "baseConfigSet" parameter now defaults to "_default". [SOLR-11861](https://issues.apache.org/jira/browse/SOLR-11861) (Amrit Sarkar) (David Smiley)
- Add knnRegress Stream Evaluator to support nearest neighbor regression [SOLR-11863](https://issues.apache.org/jira/browse/SOLR-11863) (Joel Bernstein)
- The QueryElevationComponent now has a useConfiguredElevatedOrder setting. When multiple docs are elevated, this specifies whether their relative order should be the order in the configuration file or if not then should they be subject to whatever the sort criteria is. Additionally, QEC was extensively refactored to be more extensible. [SOLR-11865](https://issues.apache.org/jira/browse/SOLR-11865) (Bruno Roustant) (David Smiley)
- Add machine learning functions for location data [SOLR-11943](https://issues.apache.org/jira/browse/SOLR-11943) (Joel Bernstein)
- Support percentage values in replica attribute in autoscaling policy [SOLR-11985](https://issues.apache.org/jira/browse/SOLR-11985) (noble)
- Allow percentage in freedisk attribute in autoscaling policy rules [SOLR-11986](https://issues.apache.org/jira/browse/SOLR-11986) (noble)
- Make it possible to co-locate replicas of multiple collections together in a node. A collection may be co-located with another collection during collection creation time by specifying a 'withCollection' parameter. It can also be co-located afterwards by using the modify collection API. The co-location guarantee is enforced regardless of future cluster operations whether they are invoked manually via the Collection API or by the Autoscaling framework. [SOLR-11990](https://issues.apache.org/jira/browse/SOLR-11990) (noble) (shalin)
- Time Routed Aliases now have a preemptiveCreateMath option to preemptively and asynchronously create the next collection in advance as new data gets within this time window of the end. [SOLR-12357](https://issues.apache.org/jira/browse/SOLR-12357) (Gus Heck) (David Smiley)
- Allow nested child documents to be in field values of a SolrInputDocument as an alternative to add/get ChildDocuments off to the side. The latter is now referred to as "anonymous" child documents as opposed to "labelled" (by the field name). Anonymous child docs might be deprecated in the future. This is an internal change that should work for javabin/SolrJ; separate issues will address XML & JSON formats populating nested docs in this way. AddUpdateCommand and it's relationship with DirectUpdateHandler2 was reworked substantially. [SOLR-12361](https://issues.apache.org/jira/browse/SOLR-12361) (Moshe Bla) (David Smiley)
- Uploading docs in JSON now supports child documents as field values, thus providing a label to the relationship instead of the current "anonymous" relationship. Use of this experimental feature sometimes requires a anonChildDocs=false parameter until Solr 8 due to syntax ambiguities. [SOLR-12362](https://issues.apache.org/jira/browse/SOLR-12362) (Moshe Bla) (David Smiley)
- The JSON Facet API now supports type=heatmap facets, just as classic faceting does. [SOLR-12398](https://issues.apache.org/jira/browse/SOLR-12398) (David Smiley)
- Factor out SolrDefaultStreamFactory class. [SOLR-12402](https://issues.apache.org/jira/browse/SOLR-12402) (Christine Poerschke)
- (EXPERIMENTAL) New NestedUpdateProcessorFactory (URP) to populate special fields _nest_parent_ and _nest_path_ of nested (child) documents. It will generate a uniqueKey of nested docs if they were blank too. [SOLR-12441](https://issues.apache.org/jira/browse/SOLR-12441) (Moshe Bla) (David Smiley)
- Add an UpdateRequest Object that implements RequestWriter.ContentWriter [SOLR-12474](https://issues.apache.org/jira/browse/SOLR-12474) (noble)
- Uploading docs in XML now supports child documents as field values, thus providing a label to the relationship instead of the current "anonymous" relationship. [SOLR-12485](https://issues.apache.org/jira/browse/SOLR-12485) (Moshe Bla) (David Smiley)
- An #EQUAL function for replica in autoscaling policy to equally distribute replicas [SOLR-12495](https://issues.apache.org/jira/browse/SOLR-12495) (noble)
- Add SolrJ support for the modify collection API. [SOLR-12506](https://issues.apache.org/jira/browse/SOLR-12506) (shalin)
- Modify collection API should support un-setting properties. [SOLR-12507](https://issues.apache.org/jira/browse/SOLR-12507) (shalin)
- Support non integer values for replica in autoscaling policy [SOLR-12511](https://issues.apache.org/jira/browse/SOLR-12511) (noble)
- Support range values for replica in autoscaling policy [SOLR-12517](https://issues.apache.org/jira/browse/SOLR-12517) (noble)
- The [child] transformer now returns a nested child doc structure (attached as fields if provided this way) provided the schema has the _nest_path_ field. This is part of a broader enhancement of nested docs. [SOLR-12519](https://issues.apache.org/jira/browse/SOLR-12519) (Moshe Bla) (David Smiley)
- Support a runtime function `#ALL` for 'replica' in autoscaling policies [SOLR-12522](https://issues.apache.org/jira/browse/SOLR-12522) (noble)
- Ability to disable configset upload via -Dconfigset.upload.enabled=false startup parameter [SOLR-12530](https://issues.apache.org/jira/browse/SOLR-12530) (Ishan Chattopadhyaya)
- autoscaling policy support to equally distribute replicas on the basis of arbitrary properties [SOLR-12536](https://issues.apache.org/jira/browse/SOLR-12536) (noble)
- JSON Facet "functions" now support an extended "type:func" syntax, similar to other types of facets. This also allows additional local params to be specified for if the aggregation function can take advantage of them. [SOLR-12567](https://issues.apache.org/jira/browse/SOLR-12567) (hossman)
- the JSON Facet 'relatedness()' aggregate function now supports a 'min_popularity' option using the extended type:func syntax [SOLR-12581](https://issues.apache.org/jira/browse/SOLR-12581) (hossman)
- support #EQUAL function, range operator, decimal and percentage in cores in autoscaling policies [SOLR-12592](https://issues.apache.org/jira/browse/SOLR-12592) (noble)
- Cluster properties restriction of known keys only is relaxed, and now unknown properties starting with "ext." will be allowed. This allows custom to plugins set their own cluster properties. [SOLR-12612](https://issues.apache.org/jira/browse/SOLR-12612) (Jeffery Yuan) (Tomás Fernández Löbbe)
- The predict evaluator should work with the polyfit function [SOLR-12629](https://issues.apache.org/jira/browse/SOLR-12629) (Joel Bernstein)
- Add gaussfit Stream Evaluator [SOLR-12634](https://issues.apache.org/jira/browse/SOLR-12634) (Joel Bernstein)
- Add Korean morphological analyzer ("nori") to default distribution. This also adds examples for configuration in Solr's schema. [SOLR-12655](https://issues.apache.org/jira/browse/SOLR-12655) (Uwe Schindler)
- Add outliers Stream Evaluator to support outlier detection with probability distributions [SOLR-12660](https://issues.apache.org/jira/browse/SOLR-12660) (Joel Bernstein)
- Add robust flag to knnRegress Stream Evaluator [SOLR-12671](https://issues.apache.org/jira/browse/SOLR-12671) (Joel Bernstein)
- Add functions to cache data structures and mathematical models [SOLR-12687](https://issues.apache.org/jira/browse/SOLR-12687) (Joel Bernstein)
- Add zscores Stream Evaluator [SOLR-12702](https://issues.apache.org/jira/browse/SOLR-12702) (Joel Bernstein)
- NodeAddedTrigger should support adding replicas to new nodes by setting preferredOperation=addreplica. [SOLR-12715](https://issues.apache.org/jira/browse/SOLR-12715) (shalin)
- NodeLostTrigger should support deleting replicas from lost nodes by setting preferredOperation=deletenode. [SOLR-12716](https://issues.apache.org/jira/browse/SOLR-12716) (shalin)
- The [child] transformer now takes an 'fl' param to specify which fields to return. It will evaluate doc transformers if present. In 7.5 a missing 'fl' defaults to the current behavior of all fields, but in 8.0 defaults to the top/request "fl". [SOLR-12722](https://issues.apache.org/jira/browse/SOLR-12722) (Moshe Bla) (David Smiley)
- "ZK Status" sub menu under "Cloud" tab to see status of zookeeper ensemble [SOLR-7767](https://issues.apache.org/jira/browse/SOLR-7767) (janhoy)
- Add "Nodes" view to the Admin UI "Cloud" tab, listing nodes and key metrics [SOLR-8207](https://issues.apache.org/jira/browse/SOLR-8207) (janhoy)
- Added a new (experimental) PhrasesIdentificationComponent for identifying potential phrases in query input based on overlapping shingles in the index. [SOLR-9418](https://issues.apache.org/jira/browse/SOLR-9418) (Akash Mehta) (Trey Grainger) (hossman)

### Changed (12 changes)

- HttpShardHandler now uses a default of 100k as maxConnections (10k previously) and default maxConnectionsPerHost as 100k (20 previously). They are now consisent with the UpdateShardHandler defaults. [SOLR-10697](https://issues.apache.org/jira/browse/SOLR-10697) (Varun Thacker)
- The export handler does not limit users to 4 sort fields and is now unlimited. However the speed at which we can export is directly proportional to the number of sort fields specified. This change also allows streaming expressions to group by on more than 4 fields. [SOLR-11598](https://issues.apache.org/jira/browse/SOLR-11598) (Aroop Ganguly) (Amrit Sarkar) (Varun Thacker)
- Time Routed Alias will now route documents to the ideal shard of a collection, thus avoiding a hop. Usually documents were already routed well but not always. [SOLR-11654](https://issues.apache.org/jira/browse/SOLR-11654) (Gus Heck) (David Smiley)
- Retry update requests sent by leaders to it's followers [SOLR-11881](https://issues.apache.org/jira/browse/SOLR-11881) (Varun Thacker) (Mark Miller) (Tomás Fernández Löbbe)
- When a replica is applying updates, some kind of updates can skip buffering for faster recovery. [SOLR-12305](https://issues.apache.org/jira/browse/SOLR-12305) (Cao Manh Dat)
- Do not use docValues as stored for _str (copy)fields in _default configset [SOLR-12350](https://issues.apache.org/jira/browse/SOLR-12350) (janhoy)
- Refactor JSON serialization code into SolrJ package [SOLR-12455](https://issues.apache.org/jira/browse/SOLR-12455) (noble)
- Improve SplitShardCmd performance and reliability. A new method of splitting has been introduced (splitMethod=link) which uses hard-linking of index files when possible, resulting in significant speedups and reduced CPU / IO load on shard leader. [SOLR-12509](https://issues.apache.org/jira/browse/SOLR-12509) (ab)
- While exporting documents using the export writer, if a field is specified as a sort parameter and also in the fl (field list) parameter, we save on one doc-value lookup. This can bring performance improvements of 15% and upwards depending on how many fields are in common. [SOLR-12572](https://issues.apache.org/jira/browse/SOLR-12572) (Amrit Sarkar) (Varun Thacker)
- Optimize Export writer upto 4 sort fields to get better performance. This was removed in SOLR-11598 but brought back in the same version [SOLR-12616](https://issues.apache.org/jira/browse/SOLR-12616) [SOLR-11598](https://issues.apache.org/jira/browse/SOLR-11598) (Amrit Sarkar) (Varun Thacker)
- Reduce object creation in HashBasedRouter. [SOLR-12723](https://issues.apache.org/jira/browse/SOLR-12723) (ab)
- When retrying internal requests, backoff only once for the full batch of retries [SOLR-12766](https://issues.apache.org/jira/browse/SOLR-12766) (Tomás Fernández Löbbe)

### Fixed (44 changes)

- Fix and improvements to SegmentsInfoRequestHandlerTest [SOLR-10028](https://issues.apache.org/jira/browse/SOLR-10028) (Christine Poerschke) (Tomás Fernández Löbbe)
- Race condition in PeerSync [SOLR-11216](https://issues.apache.org/jira/browse/SOLR-11216) (Cao Manh Dat)
- Solr SQL does not work with point numeric fields [SOLR-11585](https://issues.apache.org/jira/browse/SOLR-11585) (Joel Bernstein) (Kiran Chitturi)
- Improve error handling of shard splitting. Fix splitting of mixed replica types. [SOLR-11665](https://issues.apache.org/jira/browse/SOLR-11665) (ab)
- Keep nrtReplicas and replicationFactor in sync while creating a collection and modifying a collection [SOLR-11676](https://issues.apache.org/jira/browse/SOLR-11676) (Varun Thacker)
- NPE in tvrh if no field is specified and document doesn't contain any fields with term vectors [SOLR-11770](https://issues.apache.org/jira/browse/SOLR-11770) 
- Restoring collection now treats maxShardsPerNode=-1 as unlimited [SOLR-11807](https://issues.apache.org/jira/browse/SOLR-11807) (Varun Thacker)
- JSON Facet API: terms facet shard requests now indicate if they have more buckets to prevent unnecessary refinement requests. [SOLR-12326](https://issues.apache.org/jira/browse/SOLR-12326) (yonk)
- Fixed a bug in JSON Faceting that could cause incorrect counts/stats when using non default sort options. This also adds a new configurable "overrefine" option. [SOLR-12343](https://issues.apache.org/jira/browse/SOLR-12343) (Yonik Seeley) (hossman)
- SolrSlf4jReporter doesn't set MDC context. [SOLR-12344](https://issues.apache.org/jira/browse/SOLR-12344) (ab)
- Make 'significantTerms' the SignificantTermsQParserPlugin's name and deprecate its old 'sigificantTerms' name. [SOLR-12395](https://issues.apache.org/jira/browse/SOLR-12395) (Tobias Kässmann) (Christine Poerschke)
- If Zookeeper was pre-loaded with data before first-use, then the aliases information would be ignored. [SOLR-12413](https://issues.apache.org/jira/browse/SOLR-12413) (David Smiley) (Gaël Jourdan) (Gus Heck)
- Improve error message for invalid 'start', 'rows' parameters. [SOLR-12427](https://issues.apache.org/jira/browse/SOLR-12427) (Munendra S N) (Jason Gerlowski)
- Response /autoscaling/diagnostics shows improper json [SOLR-12449](https://issues.apache.org/jira/browse/SOLR-12449) (noble)
- Search Rate Trigger multiple bug fixes, improvements and documentation updates. [SOLR-12470](https://issues.apache.org/jira/browse/SOLR-12470) (ab)
- Fix MaxSizeAutoCommitTest failures [SOLR-12475](https://issues.apache.org/jira/browse/SOLR-12475) (Rupa Shankar) (Anshum Gupta)
- An update would return a client error(400) if it hit a AlreadyClosedException. We now return the error as a server error(500) instead [SOLR-12477](https://issues.apache.org/jira/browse/SOLR-12477) (Jeffery) (Varun Thacker)
- Config API returns status 0 for failed operations. [SOLR-12482](https://issues.apache.org/jira/browse/SOLR-12482) (Steve Rowe)
- User specified replicationFactor and maxShardsPerNode is used when specified during a restore operation. A user can now specify nrtReplicas/tlogReplicas/pullReplicas while restoring the collection. Specifying replicationFactor or nrtReplicas have the same effect and only one can be specified [SOLR-12489](https://issues.apache.org/jira/browse/SOLR-12489) (Varun Thacker)
- Reproducing TestCodecSupport.testMixedCompressionMode failure [SOLR-12513](https://issues.apache.org/jira/browse/SOLR-12513) (Erick Erickson)
- Fix some bugs in 'type:range' Facet refinement when sub-facets are combined with non default values for the 'other' and 'include' options. [SOLR-12516](https://issues.apache.org/jira/browse/SOLR-12516) (hossman)
- Collection collection fails if metrics are called during core creation [SOLR-12533](https://issues.apache.org/jira/browse/SOLR-12533) (Peter Cseh) (Mano Kovacs)
- Metrics handler throws an error if there are transient cores. [SOLR-12541](https://issues.apache.org/jira/browse/SOLR-12541) (ab)
- Allow SignificantTerms Query Parser to use local parameters [SOLR-12553](https://issues.apache.org/jira/browse/SOLR-12553) (Alexandre Rafalovitch)
- OpenNLPExtractNamedEntitiesUpdateProcessor cannot support multi fields because pattern replacement doesn't work correctly. [SOLR-12570](https://issues.apache.org/jira/browse/SOLR-12570) (Koji Sekiguchi)
- Update ref guide for additional information displayed in cloud view [SOLR-12576](https://issues.apache.org/jira/browse/SOLR-12576) (Erick Erickson)
- MetricsHistoryHandler.getOverseerLeader fails when hostname contains hyphen. [SOLR-12594](https://issues.apache.org/jira/browse/SOLR-12594) (ab)
- Migrate API should fail requests that do not specify split.key parameter [SOLR-12597](https://issues.apache.org/jira/browse/SOLR-12597) (shalin)
- Do not fetch non-stored fields [SOLR-12598](https://issues.apache.org/jira/browse/SOLR-12598) (Nikolay Khitrin) (Erick Erickson)
- Fix InfixSuggestersTest.testShutdownDuringBuild() failures. [SOLR-12606](https://issues.apache.org/jira/browse/SOLR-12606) (Steve Rowe)
- Fixed two separate bugs in shard splits which can cause data loss. The first case is when using TLOG replicas only, the updates forwarded from parent shard leader to the sub-shard leader are written only in tlog and not the index. If this happens after the buffered updates have been replayed then the updates can never be executed even though they remain the transaction log. The second case is when synchronously forwarding updates to sub-shard leader fails and the underlying errors are not propagated to the client. [SOLR-12607](https://issues.apache.org/jira/browse/SOLR-12607) (Cao Manh Dat) (shalin)
- HashQParserPlugin will no longer throw an NPE if the hash key field is a string when there are documents with empty values. All documents with empty values ( string , numeric ) will be processed by worker=0 This would fix the NPE when using the search stream with partitionKeys. [SOLR-12615](https://issues.apache.org/jira/browse/SOLR-12615) (Varun Thacker)
- CloudSolrClient retries requests unnecessarily exception from server [SOLR-12649](https://issues.apache.org/jira/browse/SOLR-12649) (noble) (shalin)
- Autoscaling policy not being refreshed due to caching [SOLR-12665](https://issues.apache.org/jira/browse/SOLR-12665) (noble)
- Autoscaling trigger listeners should be executed in the order of their creation. [SOLR-12668](https://issues.apache.org/jira/browse/SOLR-12668) (ab)
- RecoveryStrategy logs wrong wait time when retrying recovery. [SOLR-12670](https://issues.apache.org/jira/browse/SOLR-12670) (shalin)
- RollupStream should not use the HashQueryParser for 1 worker. [SOLR-12674](https://issues.apache.org/jira/browse/SOLR-12674) (Varun Thacker)
- MiniSolrCloudCluster internal jetty list should never have duplicates [SOLR-12679](https://issues.apache.org/jira/browse/SOLR-12679) (shalin)
- HashQuery will throw an exception if more than 4 partitionKeys is specified. Earlier after the 4th partitionKey the keys would be silently ignored. [SOLR-12683](https://issues.apache.org/jira/browse/SOLR-12683) (Varun Thacker)
- Guard AddSchemaFieldsUpdateProcessorFactory against null field names and field values. [SOLR-12704](https://issues.apache.org/jira/browse/SOLR-12704) (Steve Rowe) (Varun Thacker)
- SolrMetricReporterTest failure [SOLR-12733](https://issues.apache.org/jira/browse/SOLR-12733) (Erick Erickson) (David Smiley)
- timeseries() expression missing sum() results for empty buckets [SOLR-12749](https://issues.apache.org/jira/browse/SOLR-12749) (Joel Bernstein)
- Incorrect format of JMX cache stats. [SOLR-12765](https://issues.apache.org/jira/browse/SOLR-12765) (Bojan Smid) (ab)
- Fix SolrJ Field and Document analyzes for types that include CharacterFilter [SOLR-2834](https://issues.apache.org/jira/browse/SOLR-2834) (Alexandre Rafalovitch)

### Other (26 changes)

- Upgrade Apache Commons Compress to v1.18 [LUCENE-8456](https://issues.apache.org/jira/browse/LUCENE-8456) (Steve Rowe)
- Clean up web.xml, removing old redirects and outdated comments [SOLR-10984](https://issues.apache.org/jira/browse/SOLR-10984) (Varun Thacker) (janhoy)
- Use a lighter config for MetricsHandlerTest and ensure the core is up before the test starts [SOLR-11008](https://issues.apache.org/jira/browse/SOLR-11008) (Varun Thacker)
- Move Streaming Expressions section in Ref Guide to be a top-level section. [SOLR-11766](https://issues.apache.org/jira/browse/SOLR-11766) (Cassandra Targett)
- Cryptic error message when creating a collection with sharding that violates autoscaling policies [SOLR-12014](https://issues.apache.org/jira/browse/SOLR-12014) (noble)
- CdcrReplicationDistributedZkTest is broken into two test classes, CdcrOpsAndBoundariesTest which does not require node restarts and CdcrWithNodesRestartsTest which does. The tests themselves are made faster and more resilient to spurious failures. [SOLR-12130](https://issues.apache.org/jira/browse/SOLR-12130) (Varun Thacker) (Amrit Sarkar) (shalin)
- Improve Ref Guide main landing page. [SOLR-12164](https://issues.apache.org/jira/browse/SOLR-12164) (Cassandra Targett)
- Renamed the autoscaling variable 'INDEX.sizeInBytes' to 'INDEX.sizeInGB' [SOLR-12208](https://issues.apache.org/jira/browse/SOLR-12208) (noble)
- Leader should give up leadership when IndexWriter.tragedy occur [SOLR-12412](https://issues.apache.org/jira/browse/SOLR-12412) (Cao Manh Dat) (Tomas Fernandez-Lobbe)
- Tweak Overseer leadership transition related logging for easier troubleshooting. [SOLR-12454](https://issues.apache.org/jira/browse/SOLR-12454) (Christine Poerschke)
- Reduce Overseer.close() logging (for non-Overseer leaders) [SOLR-12464](https://issues.apache.org/jira/browse/SOLR-12464) (Christine Poerschke)
- Upgrade Jetty to 9.4.11.v20180605 [SOLR-12468](https://issues.apache.org/jira/browse/SOLR-12468) (Michael Braun) (shalin)
- Improve error reporting and docs regarding Collection backup feature shared-fs requirement [SOLR-12523](https://issues.apache.org/jira/browse/SOLR-12523) (janhoy)
- factor out a test-framework/ConfigRequest class [SOLR-12527](https://issues.apache.org/jira/browse/SOLR-12527) (Christine Poerschke)
- Upgrade to Tika 1.18 [SOLR-12551](https://issues.apache.org/jira/browse/SOLR-12551) (Tim Allison) (Erick Erickson)
- Put under a common "significantTerms" bucket all output by SignificantTerms Query Parser [SOLR-12574](https://issues.apache.org/jira/browse/SOLR-12574) (Alexandre Rafalovitch)
- Improve Solr resource loader coverage in the ref guide. [SOLR-12590](https://issues.apache.org/jira/browse/SOLR-12590) (Steve Rowe) (Cassandra Targett) (Christine Poerschke)
- Remove Commons BeanUtils as a dependency [SOLR-12617](https://issues.apache.org/jira/browse/SOLR-12617) (Varun Thacker)
- Combine SolrDocumentFetcher and RetrieveFieldsOptimizer [SOLR-12625](https://issues.apache.org/jira/browse/SOLR-12625) (Erick Erickson)
- ShardSplitTest should extend AbstractFullDistribZkTestBase instead of BasicDistributedZkTest. [SOLR-12656](https://issues.apache.org/jira/browse/SOLR-12656) (shalin)
- Make LeaderVoteWaitTimeoutTest more resilient against side effects of test methods. [SOLR-12675](https://issues.apache.org/jira/browse/SOLR-12675) (shalin)
- Fix ClassCastException and AIOOBE in TestSolrConfigHandlerConcurrent. [SOLR-12680](https://issues.apache.org/jira/browse/SOLR-12680) (shalin)
- Regularize LoggerFactory declarations [SOLR-12690](https://issues.apache.org/jira/browse/SOLR-12690) (Erick Erickson)
- Improve logging messages and verbosity around recoveries [SOLR-12744](https://issues.apache.org/jira/browse/SOLR-12744) (Cao Manh Dat) (Varun Thacker)
- Improve Autoscaling Policy and Preferences documentation. [SOLR-12771](https://issues.apache.org/jira/browse/SOLR-12771) (hossman) (Steve Rowe)
- In HdfsDirectoryTest replace RAMDirectory usages with ByteBuffersDirectory. [SOLR-8742](https://issues.apache.org/jira/browse/SOLR-8742) (hossman) (Mark Miller) (Andrzej Bialecki) (Steve Rowe)


[7.4.0] - 2018-06-27
--------------------

### Upgrade Notes (3 changes)

- Configuring slowQueryThresholdMillis now logs slow requests to a separate file - solr_slow_requests.log. Previously they would get logged in the solr.log file. [SOLR-11453](https://issues.apache.org/jira/browse/SOLR-11453) 
- Slave doesn't commit empty index when completely new index is detected on master during replication. To return the previous behavior pass false to skipCommitOnLeaderVersionZero in slave section of replication handler configuration, or pass it to the fetchindex command. [SOLR-11673](https://issues.apache.org/jira/browse/SOLR-11673) 
- Solr now uses Log4J 2.11 . The log4j configuration is now in log4j2.xml rather than log4j.properties files. This is a server side change only and clients using SolrJ won't need any changes. Clients can still use any logging implementation which is compatible with SLF4J. We now let log4j2 handle rotation of solr logs at startup, and bin/solr start scripts will no longer attempt this nor move existing console or GC logs into logs/archived either SOLR-12144 [SOLR-7887](https://issues.apache.org/jira/browse/SOLR-7887) [SOLR-12144](https://issues.apache.org/jira/browse/SOLR-12144) 

### Added (35 changes)

- Add support for Hadoop Credential Provider as SSL/TLS store password source. [SOLR-10783](https://issues.apache.org/jira/browse/SOLR-10783) (Mano Kovacs) (Mark Miller)
- A new CMS config option 'ioThrottle' to manually enable/disable ConcurrentMergeSchedule.doAutoIOThrottle. [SOLR-11200](https://issues.apache.org/jira/browse/SOLR-11200) (Amrit Sarkar) (Nawab Zada Asad iqbal) (Dawid Weiss)
- Add auto hard-commit settings based on tlog size [SOLR-11277](https://issues.apache.org/jira/browse/SOLR-11277) (Rupa Shankar) (Anshum Gupta)
- DocBasedVersionConstraintsProcessorFactory is more extensible and now supports a list of versioned fields. (versionField config may now be a comma-delimited list). [SOLR-11336](https://issues.apache.org/jira/browse/SOLR-11336) (Michael Braun) (David Smiley)
- Configuring slowQueryThresholdMillis logs slow requests to a separate file - solr_slow_requests.log. [SOLR-11453](https://issues.apache.org/jira/browse/SOLR-11453) (Shawn Heisey) (Remko Popma) (Varun Thacker)
- Implement a periodic house-keeping task. This uses a scheduled autoscaling trigger and currently performs cleanup of old inactive shards. [SOLR-11670](https://issues.apache.org/jira/browse/SOLR-11670) (ab) (shalin)
- Add ones and zeros Stream Evaluators [SOLR-11734](https://issues.apache.org/jira/browse/SOLR-11734) (Joel Bernstein)
- Basic long-term collection of aggregated metrics. Historical data is maintained as multi-resolution time series using round-robin databases in the '.system' collection. New /admin/metrics/history API allows retrieval of this data in numeric or graph formats. [SOLR-11779](https://issues.apache.org/jira/browse/SOLR-11779) [SOLR-12438](https://issues.apache.org/jira/browse/SOLR-12438) (ab)
- SolrJ SolrParams now implements Iterable&lt;Map.Entry&lt;String, String[]&gt;&gt; and also has a stream() method using it for convenience. [SOLR-11913](https://issues.apache.org/jira/browse/SOLR-11913) (David Smiley) (Tapan Vaishnav)
- Added the ability to listen to changes in the set of active collections in a cloud in the ZkStateReader, through the CloudCollectionsListener. [SOLR-11924](https://issues.apache.org/jira/browse/SOLR-11924) (Houston Putman) (Dennis Gove)
- Add possibility to define replica order with the shards.preference parameter to e.g. prefer PULL replicas for distributed queries. [SOLR-11982](https://issues.apache.org/jira/browse/SOLR-11982) (Ere Maijala) (Tomás Fernández Löbbe)
- Add support "add-distinct" in AtomicURP so that we can use the 'add-distict' as a request parameter e.g: atomic.&lt;multival-field-name&gt;=add-distict [SOLR-12015](https://issues.apache.org/jira/browse/SOLR-12015) (Amrit Sarkar) (noble)
- Factor out DefaultStreamFactory solrj class. [SOLR-12036](https://issues.apache.org/jira/browse/SOLR-12036) (Christine Poerschke)
- The "eq" (equals) function query now works with string fields, string literals, and perhaps anything. [SOLR-12139](https://issues.apache.org/jira/browse/SOLR-12139) (Andrey Kudryavtsev) (David Smiley)
- Add abstract MultiSolrCloudTestCase class. [SOLR-12151](https://issues.apache.org/jira/browse/SOLR-12151) (Christine Poerschke)
- Allow the monteCarlo Stream Evaluator to support variables [SOLR-12158](https://issues.apache.org/jira/browse/SOLR-12158) (Joel Bernstein)
- Add memset Stream Evaluator [SOLR-12159](https://issues.apache.org/jira/browse/SOLR-12159) (Joel Bernstein)
- Add random field type and dynamic field to the default managed-schema [SOLR-12175](https://issues.apache.org/jira/browse/SOLR-12175) (Joel Bernstein)
- Add index size autoscaling trigger, based on document count or size in bytes. [SOLR-12181](https://issues.apache.org/jira/browse/SOLR-12181) (ab)
- Add valueAt Stream Evaluator [SOLR-12221](https://issues.apache.org/jira/browse/SOLR-12221) (Joel Bernstein)
- Add discrete Fourier transform Stream Evaluators [SOLR-12266](https://issues.apache.org/jira/browse/SOLR-12266) (Joel Bernstein)
- Create Stream Evaluators for distance measures [SOLR-12273](https://issues.apache.org/jira/browse/SOLR-12273) (Joel Bernstein)
- Add IgnoreLargeDocumentProcessFactory [SOLR-12278](https://issues.apache.org/jira/browse/SOLR-12278) (Cao Manh Dat) (David Smiley)
- JSON Facet API: Domain change with graph query. [SOLR-12328](https://issues.apache.org/jira/browse/SOLR-12328) (Daniel Meehl) (Kevin Watters) (yonik)
- Added the TaggerRequestHandler (AKA SolrTextTagger) for tagging text. It's used as a component of NER/ERD systems including query-understanding. See the ref guide for more info. [SOLR-12376](https://issues.apache.org/jira/browse/SOLR-12376) (David Smiley)
- Support missing versionField on indexed docs in DocBasedVersionConstraintsURP. [SOLR-12378](https://issues.apache.org/jira/browse/SOLR-12378) (Oliver Bates) (Michael Braun) (Mark Miller)
- cluster-wide defaults for numShards, nrtReplicas, tlogReplicas, pullReplicas [SOLR-12387](https://issues.apache.org/jira/browse/SOLR-12387) (noble)
- Enable a strict ZooKeeper-connected search request mode, in which search requests will fail when the coordinating node can't communicate with ZooKeeper, by setting the "shards.tolerant" param to "requireZkConnected". [SOLR-12388](https://issues.apache.org/jira/browse/SOLR-12388) (Steve Rowe)
- support deeply nested json objects in clusterprops.json [SOLR-12389](https://issues.apache.org/jira/browse/SOLR-12389) (noble)
- Upgrade Carrot2 to 3.16.0, HPPC to 0.8.1, morfologik to 2.1.5. [SOLR-12396](https://issues.apache.org/jira/browse/SOLR-12396) (Dawid Weiss)
- Add getValue() and setValue() Stream Evaluators [SOLR-12401](https://issues.apache.org/jira/browse/SOLR-12401) (Joel Bernstein) (janhoy)
- Upgrade Solr to use Log4J 2.11 [SOLR-7887](https://issues.apache.org/jira/browse/SOLR-7887) (Tim Potter) (Keith Laban) (Shawn Heisey) (Ralph Goers) (Erick Erickson) (Varun Thacker)
- introducing uniqueBlock(_root_) aggregation as faster alternative to unique(_root_) for counting child value facets in parents via json.facet on block index [SOLR-8998](https://issues.apache.org/jira/browse/SOLR-8998) (Dr Oleg Savrasov) (Mikhail Khludnev)
- A new 'relatedness()' aggregate function for JSON Faceting to enable building Semantic Knowledge Graphs. [SOLR-9480](https://issues.apache.org/jira/browse/SOLR-9480) (Trey Grainger) (hossman)
- #Tagging queries in JSON Query DSL, equivalent to LocalParams based query/filter tagging. Multiple tags are comma separated. LocalParams Example : {!tag=colorfilt}color:blue Equivalent JSON Example : { "#colorfilt" : "color:blue" } [SOLR-9685](https://issues.apache.org/jira/browse/SOLR-9685) (Dmitry Tikhonov) (Mikhail Khludnev) (yonik)

### Changed (13 changes)

- LatLonPointSpatialField can now decode points from docValues when stored=false docValues=true, albeit with maximum precision of 1.37cm [SOLR-11731](https://issues.apache.org/jira/browse/SOLR-11731) (Karthik Ramachandran) (David Smiley)
- Avoid creating new exceptions for every request made to MDCAwareThreadPoolExecutor by distributed search and update operations. [SOLR-11880](https://issues.apache.org/jira/browse/SOLR-11880) (Varun Thacker) (shalin)
- DocStreamer now respects the ReturnFields when populating a SolrDocument, reducing the number of unneccessary fields a ResponseWriter will see if documentCache is used [SOLR-11891](https://issues.apache.org/jira/browse/SOLR-11891) (wei wang) (hossman)
- IndexFetcher now fetches only those files (from master/leader) that are different. This differential fetching now speeds up recovery times when full index replication is needed, but only a few segments diverge. [SOLR-11920](https://issues.apache.org/jira/browse/SOLR-11920) (Ishan Chattopadhyaya) (Shaun Sabo) (John Gallagher)
- Stream Evaluators should not copy matrices needlessly [SOLR-12198](https://issues.apache.org/jira/browse/SOLR-12198) (Joel Bernstein)
- QParserPlugin's built-in static registry now holds actual QParserPlugin instances instead of class references. This is consistent with other plugin registries and allows a SolrCore to load faster. [SOLR-12233](https://issues.apache.org/jira/browse/SOLR-12233) (Jeff Miller) (David Smiley)
- Replication IndexFetcher should cap its internal buffer size when the file being transferred is small. [SOLR-12312](https://issues.apache.org/jira/browse/SOLR-12312) (Jeff Miller) (David Smiley)
- Removed redundant lines for handling lists in JSON reponse writers. [SOLR-12333](https://issues.apache.org/jira/browse/SOLR-12333) (David Smiley) (Mikhail Khludnev)
- Remove the obsolete QueryWrapperFilter intermediate wrapper, which also removed some needless uses of SolrConstantScoreQuery as well. QWF since v5.4.0 sometimes needlessly internally executed and cached the query. Affects ExpandComponent, ChildDocTransformer, CurrencyFieldType, TermsQParser. [SOLR-12337](https://issues.apache.org/jira/browse/SOLR-12337) (David Smiley)
- Replay buffering tlog in parallel. [SOLR-12338](https://issues.apache.org/jira/browse/SOLR-12338) (Cao Manh Dat) (David Smiley)
- A slow "live docs" implementation was being used instead of a bitset. Affects classic faceting enum method, JSON Facets enum method, UnInvertedField faceting, GraphTermsQParser, JoinQParser. [SOLR-12366](https://issues.apache.org/jira/browse/SOLR-12366) (David Smiley)
- Optimize Lucene ScoreMode use: A non-cached filter query could be told incorrectly that scores were needed. The /export (ExportQParserPlugin) would declare incorrectly that scores are needed. Expanded docs (expand component) could be told incorrectly that scores are needed. [SOLR-12375](https://issues.apache.org/jira/browse/SOLR-12375) (David Smiley)
- Write buffering updates to another tlog. [SOLR-9922](https://issues.apache.org/jira/browse/SOLR-9922) (Cao Manh Dat)

### Fixed (56 changes)

- PeerSync will hit an NPE on no response errors when looking for fingerprint. [SOLR-10169](https://issues.apache.org/jira/browse/SOLR-10169) (Erick Erickson)
- ConjunctionSolrSpellChecker did not work with LuceneLevenshteinDistance [SOLR-10513](https://issues.apache.org/jira/browse/SOLR-10513) (Amrit Sarkar) (James Dyer)
- AtomicUpdateRequestProcessor can cause wrong/old values to be set under concurrent updates for the same document. Multithreaded test for AtomicUpdateRequestProcessor was also beefed up and fixed. [SOLR-10734](https://issues.apache.org/jira/browse/SOLR-10734) (Ishan Chattopadhyaya) (Noble Paul) (Amrit Sarkar) (shalin)
- Standardize CoreAdmin API success/failure status codes [SOLR-11551](https://issues.apache.org/jira/browse/SOLR-11551) (Jason Gerlowski) (Steve Rowe)
- By default slave doesn't commit empty index when completely new index appears on master. See Upgrade Notes to find a way to get back to the previous behavior. [SOLR-11673](https://issues.apache.org/jira/browse/SOLR-11673) (Mikhail Khludnev)
- Allow searchRate trigger to delete replicas. Improve configurability of the trigger by specifying upper / lower thresholds and respective actions [SOLR-11833](https://issues.apache.org/jira/browse/SOLR-11833) (ab)
- Fix bin/solr help-text inconsistencies [SOLR-11840](https://issues.apache.org/jira/browse/SOLR-11840) (Jason Gerlowski)
- SolrMetric registries retained references to SolrCores when closed. A change of SolrMetricMAnager.registerGauge and SolrMetricProducer.initializeMetrics method signatures was required to fix it. Third party components may continue to use the old API but should be updated to avoid this bug [SOLR-11882](https://issues.apache.org/jira/browse/SOLR-11882) (Eros Taborelli) (Erick Erickson) (ab)
- UpdateLog metrics are not initialized on core reload. [SOLR-11929](https://issues.apache.org/jira/browse/SOLR-11929) (ab) (Steve Rowe)
- ExtendedDismaxQParser fails to include charfilters in nostopanalyzer [SOLR-12035](https://issues.apache.org/jira/browse/SOLR-12035) (Tim Allison via Tomás Fernández Löbbe)
- Fixed inconsistent results format of subquery transformer for distributed search (multi-shard). [SOLR-12096](https://issues.apache.org/jira/browse/SOLR-12096) (Munendra S N) (Mikhail Khludnev) (Ishan Chattopadhyaya)
- Raise CryptoKeys.DEFAULT_KEYPAIR_LENGTH from 1024 to 2048. [SOLR-12103](https://issues.apache.org/jira/browse/SOLR-12103) (Mark Miller)
- Fixed a error in [child] transformer that could ocur if documentCache was not used [SOLR-12107](https://issues.apache.org/jira/browse/SOLR-12107) (hossman)
- Fixed the fallback behavior of [raw] and [xml] transformers when an incompatble 'wt' was specified, the field value was lost if documentCache was not used. [SOLR-12108](https://issues.apache.org/jira/browse/SOLR-12108) (hossman)
- Fix a test bug in CdcrBidirectionalTest.testBiDir [SOLR-12150](https://issues.apache.org/jira/browse/SOLR-12150) (Steve Rowe) (Amrit Sarkar) (Varun Thacker)
- Exception from UnInvertedField constructor puts threads to infinite wait. [SOLR-12155](https://issues.apache.org/jira/browse/SOLR-12155) (Andrey Kudryavtsev) (Mikhail Khludnev)
- JSON Facet API: Terms facet on a date field sometimes failed with an exception complaining about "Invalid Date String". [SOLR-12170](https://issues.apache.org/jira/browse/SOLR-12170) (yonik)
- Fixed race condition that could cause an invalid set of collection properties to be kept in memory when multiple collection property changes are done in a short period of time. [SOLR-12172](https://issues.apache.org/jira/browse/SOLR-12172) (Tomás Fernández Löbbe)
- Replica should watch clusterstate and unload itself if its entry is removed [SOLR-12187](https://issues.apache.org/jira/browse/SOLR-12187) (Cao Manh Dat)
- Need to properly escape output in GraphMLResponseWriter. [SOLR-12190](https://issues.apache.org/jira/browse/SOLR-12190) (yonik)
- Fixed a solr cli error message when ulimits are unlimited. [SOLR-12192](https://issues.apache.org/jira/browse/SOLR-12192) (Martijn Koster)
- TestReplicationHandler.doTestRepeater(): TEST_PORT interpolation failure: Server refused connection at: http://127.0.0.1:TEST_PORT/solr [SOLR-12199](https://issues.apache.org/jira/browse/SOLR-12199) (Mikhail Khludnev) (Dawid Weiss) (Steve Rowe)
- abandon OverseerExitThread when ZkController is closed. [SOLR-12200](https://issues.apache.org/jira/browse/SOLR-12200) (Mikhail Khludnev)
- TestReplicationHandler.doTestIndexFetchOnLeaderRestart(): handle unexpected replication failures [SOLR-12201](https://issues.apache.org/jira/browse/SOLR-12201) (Steve Rowe)
- Just rethrowing AssertionError caused by jdk bug in reflection with invocation details. [SOLR-12207](https://issues.apache.org/jira/browse/SOLR-12207) (ab) (Dawid Weiss) (Mikhail Khludnev)
- Leader may skip publish itself as ACTIVE when its last published state is DOWN [SOLR-12214](https://issues.apache.org/jira/browse/SOLR-12214) (Cao Manh Dat)
- NegativeArraySizeException on TransactionLog if previous document more than 1.9GB [SOLR-12250](https://issues.apache.org/jira/browse/SOLR-12250) (Cao Manh Dat)
- Remove optimize button from the core admin page [SOLR-12253](https://issues.apache.org/jira/browse/SOLR-12253) (Erick Erickson)
- A V2 request referencing a collection or alias may fail to resolve it if it was just recently created. Now we sync with ZooKeeper and try one more time. V1 partially did this but only for aliases; now it does both. [SOLR-12258](https://issues.apache.org/jira/browse/SOLR-12258) (David Smiley)
- If you attempt to delete a collection immediately after deleting an alias it used to be a part of, you may get an error that's it's a member of that alias. This check now ensures the alias state is sync()'ed with ZK first. [SOLR-12261](https://issues.apache.org/jira/browse/SOLR-12261) (David Smiley)
- Fixed bug in how Analytics component reads negative values from float and double fields. [SOLR-12271](https://issues.apache.org/jira/browse/SOLR-12271) (Houston Putman)
- wrong caching for {!filters} as well as for `filters` local param in {!parent} and {!child} [SOLR-12275](https://issues.apache.org/jira/browse/SOLR-12275) (David Smiley) (Mikhail Khluldnev)
- WordBreakSolrSpellchecker will no longer add parenthesis in collations when breaking words in non-boolean queries. [SOLR-12284](https://issues.apache.org/jira/browse/SOLR-12284) (James Dyer)
- Do not close any servlet streams and improve our servlet stream closing prevention code for users and devs. [SOLR-12290](https://issues.apache.org/jira/browse/SOLR-12290) (Mark Miller)
- Updates need to use their own connection pool to maintain connection reuse and prevent spurious recoveries. [SOLR-12293](https://issues.apache.org/jira/browse/SOLR-12293) (Mark Miller)
- update processors loaded from runtime jars fail to load if they are specified in an update processor chain [SOLR-12294](https://issues.apache.org/jira/browse/SOLR-12294) (noble)
- exiting OverseerTriggerThread without endless noise in log when Zookeeper session is expired [SOLR-12307](https://issues.apache.org/jira/browse/SOLR-12307) (Mikhail Khludnev)
- LISTALIASES is now assured to return an up-to-date response. Also, the test utility MiniSolrCloudCluster.deleteAllCollections will now first delete aliases since a collection cannot be deleted if an alias refers to it. [SOLR-12308](https://issues.apache.org/jira/browse/SOLR-12308) (David Smiley)
- Use http timeout's defined in solr.xml for creating ConcurrentUpdateSolrClient during indexing requests between leader and replica [SOLR-12314](https://issues.apache.org/jira/browse/SOLR-12314) (Mark Miller) (Varun Thacker)
- Register the /admin/info/key end-point at the startup time to avoid 404 [SOLR-12354](https://issues.apache.org/jira/browse/SOLR-12354) (noble)
- Fixes hash conflict in HashJoinStream and OuterHashJoinStream [SOLR-12355](https://issues.apache.org/jira/browse/SOLR-12355) (Dennis Gove)
- Autoscaling suggestions fail randomly with sorting [SOLR-12358](https://issues.apache.org/jira/browse/SOLR-12358) (noble)
- SnapShooter.getIndexCommit can forget to decref the searcher; though it's not clear in practice when. [SOLR-12374](https://issues.apache.org/jira/browse/SOLR-12374) (David Smiley)
- Don't spin off overseer when Zk controller is closed [SOLR-12377](https://issues.apache.org/jira/browse/SOLR-12377) (Mikhail Khludnev)
- When creating a time routed alias, the router.autoDeleteAge option wasn't considered. [SOLR-12416](https://issues.apache.org/jira/browse/SOLR-12416) (Joachim Sauer) (David Smiley)
- velocity response writer should enforce valid function name for v.json parameter [SOLR-12417](https://issues.apache.org/jira/browse/SOLR-12417) (Mano Kovacs) (yonik)
- Recovering flag of a replica is set equals to leader even it failed to receive update on recovering. [SOLR-12433](https://issues.apache.org/jira/browse/SOLR-12433) (Cao Manh Dat)
- bin/solr {config,healthcheck} ignore ZK_HOST in solr.in.{sh,cmd} [SOLR-12434](https://issues.apache.org/jira/browse/SOLR-12434) (Steve Rowe)
- Upgrade Dropwizard Metrics to version 3.2.6. [SOLR-12445](https://issues.apache.org/jira/browse/SOLR-12445) (ab)
- Don't allow referal to external resources in various config files (CVE-2018-8026). [SOLR-12450](https://issues.apache.org/jira/browse/SOLR-12450) (Yuyang Xiao) (Uwe Schindler)
- update.autoCreateFields must be set via Config API command 'set-user-property', but 'bin/solr create' tells users to use the default action 'set-property', which fails because the property is not editable. [SOLR-12481](https://issues.apache.org/jira/browse/SOLR-12481) (Steve Rowe)
- Spellcheck custom parameters not being passed through due to wrong prefix creation. [SOLR-3567](https://issues.apache.org/jira/browse/SOLR-3567) (Josh Lucas) (shalin)
- Fixed More Like This Handler to use all fields provided in mlt.fl when used with content stream. The similarity is calculated between the content stream's value and all fields listed in mlt.fl. [SOLR-5351](https://issues.apache.org/jira/browse/SOLR-5351) (Dawid Weiss)
- TestReplicationHandler.doTestReplicateAfterCoreReload(): stop checking for identical commits before/after master core reload; and make non-nightly mode test 10 docs instead of 0. [SOLR-6286](https://issues.apache.org/jira/browse/SOLR-6286) (shalin) (hossman) (Mark Miller) (Steve Rowe)
- Fix Solr's HTTP handling to respect '-Dsolr.ssl.checkPeerName=false' aka SOLR_SSL_CHECK_PEER_NAME [SOLR-9304](https://issues.apache.org/jira/browse/SOLR-9304) (Shawn Heisey) (Carlton Findley) (Robby Pond) (hossman)
- Delete requests do not send credentials & fails for Basic Authentication [SOLR-9399](https://issues.apache.org/jira/browse/SOLR-9399) (Susheel Kumar) (Aibao Luo) (Nikkolay Martinov) (Erick Erickson)

### Other (29 changes)

- Upgrade jackson from 2.5.4 to 2.9.5 [SOLR-10036](https://issues.apache.org/jira/browse/SOLR-10036) (Shashank Pedamallu) (Shawn Heisey) (Varun Thacker)
- Ability to run and debug standalone Solr and a single node SolrCloud server from Eclipse. Also being able to run all Lucene and Solr tests as a configuration [SOLR-11331](https://issues.apache.org/jira/browse/SOLR-11331) (Karthik Ramachandran via Varun Thacker) (Uwe Schindler)
- The following SolrParams methods are now deprecated: toSolrParams (use NamedList.toSolrParams instead), toMap, toMultiMap, toFilteredSolrParams, getAll. The latter ones have no direct replacement but are easy to implement yourself as-needed. [SOLR-11914](https://issues.apache.org/jira/browse/SOLR-11914) (David Smiley)
- Remove comments.apache.org integration for the Ref Guide; the comments system has been down since December 2017 and there is no concrete plan to bring it back. [SOLR-12018](https://issues.apache.org/jira/browse/SOLR-12018) (Cassandra Targett)
- Remove unnecessary printLayout usage in CDCR tests [SOLR-12076](https://issues.apache.org/jira/browse/SOLR-12076) (Varun Thacker)
- Fix format problem in FastLRUCache description string shown on Cache Statistics page. [SOLR-12086](https://issues.apache.org/jira/browse/SOLR-12086) (Sathiya N Sundararajan) (shalin)
- Move DistribStateManager, NodeStateProvider and SolrCloudManager interfaces out of the autoscaling package. [SOLR-12090](https://issues.apache.org/jira/browse/SOLR-12090) (shalin)
- Rename TimeSource.getTime to getTimeNs. [SOLR-12091](https://issues.apache.org/jira/browse/SOLR-12091) (ab)
- AutoScalingHandler validates trigger configurations before updating Zookeeper. [SOLR-12095](https://issues.apache.org/jira/browse/SOLR-12095) (ab)
- ZkTestServer was not handling connection timeout settings properly. [SOLR-12101](https://issues.apache.org/jira/browse/SOLR-12101) (Gus Heck) (Mark Miller)
- Solr Ref-Guide can now use some ivy version props directly as attributes in content [SOLR-12118](https://issues.apache.org/jira/browse/SOLR-12118) (hossman)
- Fix race conditions that caused TriggerIntegrationTest.testEventQueue and testNodeMarkersRegistration to fail. [SOLR-12133](https://issues.apache.org/jira/browse/SOLR-12133) (Mark Miller) (shalin)
- ref-guide 'bare-bones html' validation is now part of 'ant documentation' and validates javadoc links locally. [SOLR-12134](https://issues.apache.org/jira/browse/SOLR-12134) (hossman)
- EmbeddedSolrServer should use req.getContentWriter [SOLR-12142](https://issues.apache.org/jira/browse/SOLR-12142) (noble)
- SOLR_LOG_PRESTART_ROTATION now defaults to false, we leverage log4j2 for log rotation on startup [SOLR-12144](https://issues.apache.org/jira/browse/SOLR-12144) (janhoy)
- Split up TriggerIntegrationTest into multiple tests to isolate and increase reliability. [SOLR-12152](https://issues.apache.org/jira/browse/SOLR-12152) (shalin)
- Disallow explicit usage of Log4j2 logger via forbidden APIs. [SOLR-12154](https://issues.apache.org/jira/browse/SOLR-12154) (Varun Thacker) (Tomás Fernández Löbbe)
- Ref Guide: DisMax default mm param value is improperly documented as 100%. [SOLR-12165](https://issues.apache.org/jira/browse/SOLR-12165) (Steve Rowe)
- Fix ComputePlanActionTest.testSelectedCollections fails on jenkins by aggressively cleaning up trigger state left by other test methods in the test setup. [SOLR-12169](https://issues.apache.org/jira/browse/SOLR-12169) (shalin)
- Improve FORCELEADER to handle the case when a replica win the election but does not present in clusterstate [SOLR-12176](https://issues.apache.org/jira/browse/SOLR-12176) (Cao Manh Dat)
- Refactor Streaming Expression test cases [SOLR-12183](https://issues.apache.org/jira/browse/SOLR-12183) (Joel Bernstein)
- Fix minor compiler and intellij warnings in autoscaling policy framework. [SOLR-12252](https://issues.apache.org/jira/browse/SOLR-12252) (shalin)
- Upgrade Jetty to 9.4.10.v20180503 [SOLR-12265](https://issues.apache.org/jira/browse/SOLR-12265) (Varun Thacker) (Steve Rowe)
- Add more MDC logging information to core admin requests [SOLR-12288](https://issues.apache.org/jira/browse/SOLR-12288) (Varun Thacker)
- Add more MDC logging information to collection admin requests [SOLR-12289](https://issues.apache.org/jira/browse/SOLR-12289) (Varun Thacker)
- Added SolrCore.withSearcher(lambda) to make grabbing the searcher easier than the more awkward RefCounted API. [SOLR-12374](https://issues.apache.org/jira/browse/SOLR-12374) (David Smiley)
- Solr LTR jar now included in _default configset's solrconfig.xml [SOLR-12428](https://issues.apache.org/jira/browse/SOLR-12428) (Ishan Chattopadhyaya)
- Fix bin/solr help and ref guide text to describe ZK_HOST in solr.in.sh/solr.in.cmd as an alternative to -z cmdline param. [SOLR-12435](https://issues.apache.org/jira/browse/SOLR-12435) (Steve Rowe)
- Document 'bin/solr config' in the ref guide. [SOLR-12437](https://issues.apache.org/jira/browse/SOLR-12437) (Steve Rowe)


[7.3.1] - 2018-05-15
--------------------

### Fixed (9 changes)

- Cdcr bootstrapping should ensure that non-leader replicas should sync with the leader [SOLR-11724](https://issues.apache.org/jira/browse/SOLR-11724) (Amrit Sarkar) (Varun Thacker)
- A successful restore collection should mark the shard state as active and not buffering [SOLR-12065](https://issues.apache.org/jira/browse/SOLR-12065) (Rohit) (Varun Thacker)
- Cleanup deleted core when node start [SOLR-12066](https://issues.apache.org/jira/browse/SOLR-12066) (Cao Manh Dat)
- Deleting replicas sometimes fails and causes the replicas to exist in the down state [SOLR-12087](https://issues.apache.org/jira/browse/SOLR-12087) (Cao Manh Dat)
- LIR should skip deleted replicas [SOLR-12146](https://issues.apache.org/jira/browse/SOLR-12146) (Cao Manh Dat)
- Fix errors in solr-exporter.cmd. [SOLR-12202](https://issues.apache.org/jira/browse/SOLR-12202) (Minoru Osuka) (koji)
- Upgrade commons-fileupload dependency to 1.3.3 to address CVE-2016-1000031. [SOLR-12204](https://issues.apache.org/jira/browse/SOLR-12204) (Steve Rowe)
- Fixed some eventual-consistency issues with collection aliases by using ZooKeeper.sync(). [SOLR-12256](https://issues.apache.org/jira/browse/SOLR-12256) (David Smiley)
- Do not allow to use absolute URIs for including other files in solrconfig.xml and schema parsing (CVE-2018-8010). [SOLR-12316](https://issues.apache.org/jira/browse/SOLR-12316) (Ananthesh) (Ishan Chattopadhyaya) (Uwe Schindler)


[7.3.0] - 2018-04-04
--------------------

### Upgrade Notes (10 changes)

- If you are using the spatial JTS library with Solr, you must upgrade to 1.15.0. This new version of JTS is now dual-licensed to include a BSD style license. [LUCENE-8161](https://issues.apache.org/jira/browse/LUCENE-8161) 
- Collections created without specifying a configset name use a copy of the _default configset since 7.0. Before 7.3, the copied over configset was named the same as the collection name, but 7.3 onwards it will be named with an additional ".AUTOCREATED" suffix. [SOLR-11624](https://issues.apache.org/jira/browse/SOLR-11624) 
- The old Leader-In-Recovery implementation (SOLR-5495) is now deprecated and replaced. Solr will support rolling upgrades from old 7.x versions of Solr to future 7.x releases until the last release of the 7.x major version. This means in order to upgrade to Solr 8 in the future, you must be on Solr 7.3 or higher. [SOLR-11702](https://issues.apache.org/jira/browse/SOLR-11702) [SOLR-5495](https://issues.apache.org/jira/browse/SOLR-5495) 
- The behaviour of the autoscaling system has been modified to pause all triggers from execution between the start of actions and end of cool down period. The triggers will be resumed after the cool down period expires. Previously, the cool down period was a fixed period started after actions for a trigger event complete and during this time, all triggers continued to run but any events were rejected to be tried later. [SOLR-11747](https://issues.apache.org/jira/browse/SOLR-11747) 
- The throttling mechanism used to limit the rate of autoscaling events processed has been removed. This deprecates the 'actionThrottlePeriodSeconds' setting in the set-properties Autoscaling API which is now a no-op. Use the 'triggerCooldownPeriodSeconds' instead to pause event processing. [SOLR-11748](https://issues.apache.org/jira/browse/SOLR-11748) 
- The top-level &lt;highlighting&gt; syntax in solrconfig.xml is now formally deprecated in favour of &lt;searchComponent&gt; equivalent syntax. See also SOLR-1696. [SOLR-11798](https://issues.apache.org/jira/browse/SOLR-11798) [SOLR-1696](https://issues.apache.org/jira/browse/SOLR-1696) 
- QueryComponent's rq parameter parsing no longer considers the defType parameter. [SOLR-11809](https://issues.apache.org/jira/browse/SOLR-11809) 
- The default Solr log file size and number of backups is raised to 32MB and 10 respectively [SOLR-11957](https://issues.apache.org/jira/browse/SOLR-11957) 
- A new mechanism is introduced in SOLR-11702 to maintain consistency in SolrCloud between leader and replicas. This mechanism lets Solr know whether a replica is in-sync with the leader or not, even when the leader is not live. If all the replicas who participate in the leader election are out-of-sync with previous leader, the election will pause until a timeout (named "leaderVoteWait") before allowing an out-of-sync replica to become leader. Note that the new leader still needs to contains more updates than any other active replicas in the same shard. Therefore by increasing leaderVoteWait will increase the consistency (over availability) of the system. The default value of leaderVoteWait is 180,000 ms (3 minutes) and it can be adjusted in the "solrcloud" section of the solr.xml [SOLR-12051](https://issues.apache.org/jira/browse/SOLR-12051) [SOLR-11702](https://issues.apache.org/jira/browse/SOLR-11702) 
- The default value of `autoReplicaFailoverWaitAfterExpiration` has been increased to 120 seconds from the earlier default of 30 seconds. This affects how soon Solr adds new replicas to replace the replicas on nodes which have either crashed or shutdown. [SOLR-12067](https://issues.apache.org/jira/browse/SOLR-12067) 

### Added (44 changes)

- In the Solr analysis-extras contrib, added support for the OpenNLP-based analysis components in the Lucene analysis/opennlp module: tokenization, part-of-speech tagging, phrase chunking, and lemmatization. Also added OpenNLP-based named entity extraction as a Solr update request processor. [LUCENE-2899](https://issues.apache.org/jira/browse/LUCENE-2899) (Lance Norskog) (Grant Ingersoll) (Joern Kottmann) (Em) (Kai Gülzau) (Rene Nederhand) (Robert Muir) (Steven Bower) (Steve Rowe)
- Add termVectors Stream Evaluator [SOLR-10716](https://issues.apache.org/jira/browse/SOLR-10716) (Joel Bernstein)
- new tag "diskType" in autoscaling policy [SOLR-11062](https://issues.apache.org/jira/browse/SOLR-11062) (noble)
- Suggesters should accept required freedisk as a hint [SOLR-11063](https://issues.apache.org/jira/browse/SOLR-11063) (noble)
- Collection APIs should use the disk space hint when using policy framework [SOLR-11064](https://issues.apache.org/jira/browse/SOLR-11064) (noble)
- Implement a scheduled autoscaling trigger that runs on a fixed interval beginning with a given start time. [SOLR-11066](https://issues.apache.org/jira/browse/SOLR-11066) (David Smiley) (Gus Heck) (ab) (shalin)
- Add Mann-Whitney U test Stream Evaluator [SOLR-11172](https://issues.apache.org/jira/browse/SOLR-11172) (Mathew Skaria) (Joel Bernstein)
- Implement autoscaling trigger for arbitrary metrics that creates events when a given metric breaches a threshold [SOLR-11201](https://issues.apache.org/jira/browse/SOLR-11201) (shalin)
- Add support for "add-distinct" atomic update operation [SOLR-11267](https://issues.apache.org/jira/browse/SOLR-11267) (Amrit Sarkar) (noble)
- Simulation framework for autoscaling. [SOLR-11285](https://issues.apache.org/jira/browse/SOLR-11285) (ab)
- Support computing plans for only specific collections. [SOLR-11376](https://issues.apache.org/jira/browse/SOLR-11376) (ab)
- Add lerp and akima Stream Evaluators to support linear and akima spline interpolation [SOLR-11430](https://issues.apache.org/jira/browse/SOLR-11430) (Joel Bernstein)
- Add matrixMult Stream Evaluator to support matrix multiplication [SOLR-11588](https://issues.apache.org/jira/browse/SOLR-11588) (Joel Bernstein)
- Add OpenNLP language detection to the langid contrib. [SOLR-11592](https://issues.apache.org/jira/browse/SOLR-11592) (Koji) (Steve Rowe)
- Add contrib/ltr NeuralNetworkModel class. [SOLR-11597](https://issues.apache.org/jira/browse/SOLR-11597) (Michael A. Alcorn) (Yuki Yano) (Christine Poerschke)
- Alias properties (formerly "metadata") are now mutable via a new ALIASPROP command. These properties are returned from LISTALIASES. [SOLR-11617](https://issues.apache.org/jira/browse/SOLR-11617) (Gus Heck) (David Smiley)
- A new admin UI to display and execute suggestions [SOLR-11648](https://issues.apache.org/jira/browse/SOLR-11648) (Apoorv Bhawsar) (noble)
- TimeRoutedAlias URP now auto-creates new collections on the fly according to alias metadata rules that sets the time interval for each collection. An internal Overseer command "ROUTEDALIAS_CREATECOLL" was created to facilitate this. [SOLR-11653](https://issues.apache.org/jira/browse/SOLR-11653) (David Smiley)
- Add ttest and pairedTtest Stream Evaluators [SOLR-11681](https://issues.apache.org/jira/browse/SOLR-11681) (Joel Bernstein)
- Add chiSquareDataSet Stream Evaluator [SOLR-11683](https://issues.apache.org/jira/browse/SOLR-11683) (Joel Bernstein)
- Add l1norm, l2norm and linfnorm Stream Evaluators [SOLR-11689](https://issues.apache.org/jira/browse/SOLR-11689) (Joel Bernstein)
- Redesign current LIR implementation [SOLR-11702](https://issues.apache.org/jira/browse/SOLR-11702) (Cao Manh Dat) (shalin)
- Added "time routed alias" creation support to the CREATEALIAS command. It's for managing multiple collections partitioned by time. [SOLR-11722](https://issues.apache.org/jira/browse/SOLR-11722) (Gus Heck) (David Smiley)
- Rename knn Streaming Expression to knnSearch and add new knn Stream Evaluator [SOLR-11736](https://issues.apache.org/jira/browse/SOLR-11736) (Joel Bernstein)
- Add kmeans Stream Evaluator to support kmeans clustering [SOLR-11737](https://issues.apache.org/jira/browse/SOLR-11737) (Joel Bernstein)
- Add per-stage RequestHandler metrics. [SOLR-11778](https://issues.apache.org/jira/browse/SOLR-11778) (ab)
- Refactor LatchWatcher.await to protect against spurious wakeup [SOLR-11782](https://issues.apache.org/jira/browse/SOLR-11782) (Tomás Fernández Löbbe) (David Smiley) (Dawid Weiss)
- Add multiVariateNormalDistribution Stream Evaluator [SOLR-11785](https://issues.apache.org/jira/browse/SOLR-11785) (Joel Bernstein)
- Add integrate Stream Evaluator to support integral calculations [SOLR-11789](https://issues.apache.org/jira/browse/SOLR-11789) (Joel Bernstein)
- Add density Stream Evaluator [SOLR-11791](https://issues.apache.org/jira/browse/SOLR-11791) (Joel Bernstein)
- Add Solr metrics exporter for Prometheus [SOLR-11795](https://issues.apache.org/jira/browse/SOLR-11795) (Minoru Osuka) (koji)
- Add sumSq Stream Evaluator [SOLR-11808](https://issues.apache.org/jira/browse/SOLR-11808) (Joel Bernstein)
- multivalued primitive fields can now be sorted by implicitly choosing the min/max value for asc/desc sort orders. [SOLR-11854](https://issues.apache.org/jira/browse/SOLR-11854) (hossman)
- Add fuzzyKmeans Stream Evaluatory [SOLR-11862](https://issues.apache.org/jira/browse/SOLR-11862) (Joel Bernstein)
- Add indexOf, rowCount and columnCount StreamEvaluators [SOLR-11867](https://issues.apache.org/jira/browse/SOLR-11867) (Joel Bernstein)
- Add multiKmeans Stream Evaluator [SOLR-11890](https://issues.apache.org/jira/browse/SOLR-11890) (Joel Bernstein)
- new SortableTextField which supports analysis/searching just like TextField, but also sorting/faceting just like StrField. By default uses only the first 1024 chars of the original input string values, but this is configurable. [SOLR-11916](https://issues.apache.org/jira/browse/SOLR-11916) (hossman)
- Time Routed Aliases can have their oldest collections automatically deleted via the "router.autoDeleteAge" setting. [SOLR-11925](https://issues.apache.org/jira/browse/SOLR-11925) (David Smiley)
- Add abstract contrib/ltr AdapterModel to facilitate the development of scoring models that delegate scoring to an opaque pre-trained model. [SOLR-11941](https://issues.apache.org/jira/browse/SOLR-11941) (Christine Poerschke)
- Add collection level properties similar to cluster properties [SOLR-11960](https://issues.apache.org/jira/browse/SOLR-11960) (Peter Rusko) (Tomás Fernández Löbbe)
- Add a '*_t' and '*_t_sort' dynamic field for single valued text fields [SOLR-12006](https://issues.apache.org/jira/browse/SOLR-12006) (Varun Thacker)
- Add support for autoAddReplicas in the collection creation dialog in Admin UI. [SOLR-12077](https://issues.apache.org/jira/browse/SOLR-12077) (shalin)
- Added range faceting support for CurrencyFieldType. This includes both "facet.range" as well as json.facet's "type:range" [SOLR-3218](https://issues.apache.org/jira/browse/SOLR-3218) (Andrew Morrison) (Jan Høydahl) (Vitaliy Zhovtyuk) (hossman)
- introducing {!filters param=$fq excludeTags=f} query parser. Introducing {!.. filters=$fq excludeTags=t,q} in {!parent} and {!child} [SOLR-9510](https://issues.apache.org/jira/browse/SOLR-9510) (Dr. Oleg Savrasov) (Mikhail Khludnev)

### Changed (5 changes)

- NRTCachingDirectory does not need to preemptively delete segment files and generate exceptions [LUCENE-8149](https://issues.apache.org/jira/browse/LUCENE-8149) (Erick Erickson)
- Fixed distributed processing of facet.field/facet.pivot sub requests to prevent requesting unneccessary and excessive '0' count terms from each shard [SOLR-11711](https://issues.apache.org/jira/browse/SOLR-11711) (Houston Putman) (hossman)
- Optimize when useFilterForSortedQuery=true and there are no filter queries by avoiding needless match-all-docs bitset construction. [SOLR-11769](https://issues.apache.org/jira/browse/SOLR-11769) (Betim Deva) (David Smiley)
- avoid EOFException for empty input streams [SOLR-11879](https://issues.apache.org/jira/browse/SOLR-11879) (noble)
- Cluster state caching to avoid live fetch from ZK of cluster state for forwarding requests on nodes that do not host any replica of the collection [SOLR-8327](https://issues.apache.org/jira/browse/SOLR-8327) (Jessica Cheng Mallet) (John Gallagher) (Noble Paul) (Ishan Chattopadhyaya)

### Fixed (35 changes)

- In case of in-place updates, failure in leader to follower replica update request now throws the follower replica in leader-initiated-recovery [SOLR-10261](https://issues.apache.org/jira/browse/SOLR-10261) (Ishan Chattopadhyaya) (Steve Rowe)
- Stacked recovery requests do no cancel an in progress recovery first. [SOLR-10525](https://issues.apache.org/jira/browse/SOLR-10525) (Mike Drob) (Cao Manh Dat)
- Aggressive removal of a collection breaks cluster status API. [SOLR-10720](https://issues.apache.org/jira/browse/SOLR-10720) (Alexey Serba) (shalin)
- In-place update of nonexistent doc following existing doc update fails to create the doc. [SOLR-11459](https://issues.apache.org/jira/browse/SOLR-11459) (Andrey Kudryavtsev) (Mikhail Khludnev)
- If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not [SOLR-11555](https://issues.apache.org/jira/browse/SOLR-11555) (Erick Erickson)
- The Schema API should return non-zero status when there are failures. [SOLR-11631](https://issues.apache.org/jira/browse/SOLR-11631) (Noble Paul) (Steve Rowe)
- New HDFS collection reuses unremoved data from a deleted HDFS collection with same name causes inconsistent view of documents [SOLR-11661](https://issues.apache.org/jira/browse/SOLR-11661) (Cao Manh Dat) (shalin)
- AddReplicaSuggester / ComputePlanAction infinite loop. [SOLR-11714](https://issues.apache.org/jira/browse/SOLR-11714) (ab)
- Fix race condition that made Solr accept duplicate async IDs in collection API operations [SOLR-11739](https://issues.apache.org/jira/browse/SOLR-11739) (Tomás Fernánadez Löbbe)
- Rename core in solr standalone mode is not persisted [SOLR-11783](https://issues.apache.org/jira/browse/SOLR-11783) (Erick Erickson)
- PULL replicas stop replicating after collection RELOAD [SOLR-11794](https://issues.apache.org/jira/browse/SOLR-11794) (Samuel Tatipamula) (Tomás Fernández Löbbe)
- ConcurrentModificationException in SimSolrCloudTestCase.tearDown [SOLR-11821](https://issues.apache.org/jira/browse/SOLR-11821) (shalin)
- Fixed bucket ordering in distributed json.facet type:range when mincount&gt;0 [SOLR-11824](https://issues.apache.org/jira/browse/SOLR-11824) (hossman)
- Fix test failures resulting from SOLR-11218 [SOLR-11839](https://issues.apache.org/jira/browse/SOLR-11839) [SOLR-11218](https://issues.apache.org/jira/browse/SOLR-11218) (Erick Erickson)
- Admin UI collection creation was not properly handling the router.field and router.name parameters. Also changed the display label in the Admin UI from routerField to router.field to match the actual API. [SOLR-11843](https://issues.apache.org/jira/browse/SOLR-11843) (Shawn Heisey) (Cassandra Targett)
- Use time based expiration cache in all necessary places in HdfsDirectoryFactory. [SOLR-11873](https://issues.apache.org/jira/browse/SOLR-11873) (Mihaly Toth) (Mark Miller)
- Logging Screen in the Admin UI will now show "No Events available" when there are no events to show. Also, the spinner icon is removed to prevent users thinking the page has hung. [SOLR-11895](https://issues.apache.org/jira/browse/SOLR-11895) (Cassandra Targett) (Shawn Heisey)
- ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot [SOLR-11898](https://issues.apache.org/jira/browse/SOLR-11898) (Jeff Miller) (Erick Erickson)
- Fix contrib/ltr custom inner class feature/normaliser/model persistence. [SOLR-11931](https://issues.apache.org/jira/browse/SOLR-11931) (Christine Poerschke)
- Allow CLUSTERSTATUS "shard" parameter to accept comma (,) delimited list [SOLR-11950](https://issues.apache.org/jira/browse/SOLR-11950) (Chris Ulicny) (Jason Gerlowski)
- Don't allow referal to external resources in DataImportHandler's dataConfig request parameter (CVE-2018-1308). [SOLR-11971](https://issues.apache.org/jira/browse/SOLR-11971) (麦 香浓郁) (Uwe Schindler)
- TokenizerChain.normalize: only the first filter that is a MultiTermAwareComponent was participating in normalization instead of all. This bug normally doesn't matter since TextField doesn't call it. [SOLR-11976](https://issues.apache.org/jira/browse/SOLR-11976) (Tim Allison) (David Smiley)
- Fix exists() method in EphemeralDirectoryFactory/MockDirectoryFactory to prevent false positives [SOLR-11988](https://issues.apache.org/jira/browse/SOLR-11988) (hossman)
- Consistence problem when in-sync replicas are DOWN. [SOLR-12011](https://issues.apache.org/jira/browse/SOLR-12011) (Cao Manh Dat)
- JSON Facet API: terms facet on date field fails in refinement phase with "Invalid Date String" error. [SOLR-12020](https://issues.apache.org/jira/browse/SOLR-12020) (yonik)
- Fixed a bug in ApiSpec and other JSON resource loading that was causing unclosed file handles [SOLR-12021](https://issues.apache.org/jira/browse/SOLR-12021) (hossman)
- UTILIZENODE does not enforce policy rules [SOLR-12050](https://issues.apache.org/jira/browse/SOLR-12050) (hossman) (noble)
- Fix substitution bug in API V1 to V2 migration when using SolrJ with V2 API. [SOLR-12061](https://issues.apache.org/jira/browse/SOLR-12061) (Tomás Fernánadez Löbbe)
- Fix PeerSync, Leader Election failures and CDCR checkpoint inconsistencies on a cluster running CDCR [SOLR-12063](https://issues.apache.org/jira/browse/SOLR-12063) (Amrit Sarkar) (Varun Thacker)
- JSON Facet API: fix bug where a limit of -1 in conjunction with multiple facets or missing=true caused an NPE or AIOOBE. [SOLR-12064](https://issues.apache.org/jira/browse/SOLR-12064) (Karthik Ramachandran) (yonik)
- Invalid path string using ZkConfigManager.copyConfigDir(String fromConfig, String toConfig) [SOLR-12072](https://issues.apache.org/jira/browse/SOLR-12072) (Alessandro Hoss) (Erick Erickson)
- Fix RealTime GET to work on a cluster running CDCR when using Solr's in-place updates [SOLR-12083](https://issues.apache.org/jira/browse/SOLR-12083) (Amrit Sarkar) (Varun Thacker)
- Replica which failed to register in Zk can become leader [SOLR-12110](https://issues.apache.org/jira/browse/SOLR-12110) (Cao Manh Dat)
- After the core is reloaded, term of the core will not be watched [SOLR-12129](https://issues.apache.org/jira/browse/SOLR-12129) (Cao Manh Dat)
- Fix "bin/solr" shell scripts (Windows/Linux/Mac) to correctly detect major Java version and use numerical version comparison to enforce minimum requirements. Also remove obsolete "UseParNewGC" option. This allows to start Solr with Java 10 or later. [SOLR-12141](https://issues.apache.org/jira/browse/SOLR-12141) (Uwe Schindler)

### Other (45 changes)

- Get precommit lint warnings out of Solr core [SOLR-10809](https://issues.apache.org/jira/browse/SOLR-10809) (Erick Erickson)
- Use disk free metric in default cluster preferences [SOLR-11051](https://issues.apache.org/jira/browse/SOLR-11051) (noble)
- REPLACENODE should identify appropriate nodes if targetNode is not provided [SOLR-11067](https://issues.apache.org/jira/browse/SOLR-11067) (noble)
- Fail and return an error when attempting to delete a collection that's part of an alias [SOLR-11218](https://issues.apache.org/jira/browse/SOLR-11218) (Erick Erickson)
- Rename ResponseBuilder's getQueryCommand to createQueryCommand. [SOLR-11349](https://issues.apache.org/jira/browse/SOLR-11349) (Christine Poerschke)
- Remove unused "Admin Extra" files and mentions. [SOLR-11480](https://issues.apache.org/jira/browse/SOLR-11480) (Eric Pugh) (Christine Poerschke)
- Improve ref-guide solrj snippets via mock 'print()' method [SOLR-11575](https://issues.apache.org/jira/browse/SOLR-11575) (Jason Gerlowski) (hossman)
- Make message for missing dataimport config in UI more explicit. [SOLR-11613](https://issues.apache.org/jira/browse/SOLR-11613) (Shawn Heisey) (Amrit Sarkar via Cassandra Targett)
- Collections created from _default configset will now be associated with a configset with a suffix .AUTOCREATED. For example, a new collection "mycollection", created without specifying a configset name, will use the _default configset and the associated configset name will be "mycollection.AUTOCREATED". If this collection is deleted and re-created, the autocreated configset will be left behind and will be re-used for the re-created collection [SOLR-11624](https://issues.apache.org/jira/browse/SOLR-11624) (Ishan Chattopadhyaya) (Abhishek Kumar Singh)
- Add more intuitive CloudSolrClient.Builder constructors [SOLR-11629](https://issues.apache.org/jira/browse/SOLR-11629) (Varun Thacker) (Jason Gerlowski)
- Upgrade ZooKeeper dependency to 3.4.11 [SOLR-11658](https://issues.apache.org/jira/browse/SOLR-11658) (Jason Gerlowski) (Steve Rowe) (Erick Erickson)
- SolrDispatchFilter's use of a "close shield" in tests should not be applied to further servlet chain processing. [SOLR-11692](https://issues.apache.org/jira/browse/SOLR-11692) (Jeff Miller) (David Smiley)
- Upgrade to Tika 1.17 when available [SOLR-11701](https://issues.apache.org/jira/browse/SOLR-11701) (Tim Allison) (Karthik Ramachandran) (Erick Erickson)
- Solr Should Send Log Notifications if Ulimits are too low [SOLR-11703](https://issues.apache.org/jira/browse/SOLR-11703) (Kevin Cowan) (Erick Eickson)
- Pause triggers until actions finish executing and the cool down period expires. [SOLR-11747](https://issues.apache.org/jira/browse/SOLR-11747) (shalin)
- Remove Autoscaling action throttle. [SOLR-11748](https://issues.apache.org/jira/browse/SOLR-11748) (shalin)
- Remove AbstractSolrTestCase which has long been supplanted by SolrTestCaseJ4. [SOLR-11754](https://issues.apache.org/jira/browse/SOLR-11754) (David Smiley)
- In tests, fix race condition on SolrException.ignoreException. Also ensure we register "ignore_exception" in @BeforeClass (previously only @AfterClass) [SOLR-11757](https://issues.apache.org/jira/browse/SOLR-11757) (David Smiley)
- Reduce code duplication w.r.t. RestTestHarness(es). [SOLR-11793](https://issues.apache.org/jira/browse/SOLR-11793) (Christine Poerschke)
- Formally deprecate top-level &lt;highlighting&gt; syntax in solrconfig.xml in favour of &lt;searchComponent&gt; equivalent syntax. [SOLR-11798](https://issues.apache.org/jira/browse/SOLR-11798) (Christine Poerschke)
- Support customisation of the "highlighting" query response element. [SOLR-11801](https://issues.apache.org/jira/browse/SOLR-11801) (Ramsey Haddad) (Pranav Murugappan) (David Smiley) (Christine Poerschke)
- SolrJ's SolrResponse.getElaspedTime was sometimes a millisecond off. [SOLR-11805](https://issues.apache.org/jira/browse/SOLR-11805) (David Smiley)
- Upgrade Jetty to 9.4.8.v20171121 [SOLR-11810](https://issues.apache.org/jira/browse/SOLR-11810) (Varun Thacker) (Erick Erickson)
- Move Collections API classes to it's own package [SOLR-11817](https://issues.apache.org/jira/browse/SOLR-11817) (Varun Thacker)
- Update Ref Guide to include info on grouping operations and using curl for large files. [SOLR-11848](https://issues.apache.org/jira/browse/SOLR-11848) (Dariusz Wojtas) (Cassandra Targett)
- MoveReplicaSuggester should not suggest leader if other replicas are available [SOLR-11871](https://issues.apache.org/jira/browse/SOLR-11871) (noble)
- Add toggle to disable auto-refresh of Logging page in the UI [SOLR-11897](https://issues.apache.org/jira/browse/SOLR-11897) (Tommy Marshment-Howell via Cassandra Targett)
- Clarify in bin/solr help text whether commands can be run remotely [SOLR-11902](https://issues.apache.org/jira/browse/SOLR-11902) (Jason Gerlowski)
- Make DIH UI page safer by not default checking the clean checkbox [SOLR-11933](https://issues.apache.org/jira/browse/SOLR-11933) (Eric Pugh) (Tomás Fernández Löbbe)
- Increase MaxFileSize=32MB and MaxBackupIndex=10 for RollingFileAppender in log4j.properties [SOLR-11957](https://issues.apache.org/jira/browse/SOLR-11957) (Varun Thacker) (shalin)
- Remove BadApple and AwaitsFix annotations that link to closed JIRAs [SOLR-12017](https://issues.apache.org/jira/browse/SOLR-12017) (Erick Erickson)
- Increase thread lingering timeout to 80s. [SOLR-12027](https://issues.apache.org/jira/browse/SOLR-12027) (Mikhail Khludnev)
- BadApple and AwaitsFix annotations usage [SOLR-12028](https://issues.apache.org/jira/browse/SOLR-12028) (Erick Erickson) (Uwe Schindler)
- Refactor Policy framework to make simulated changes affect more than a single node [SOLR-12031](https://issues.apache.org/jira/browse/SOLR-12031) (noble)
- Increase checkStateInZk timeout [SOLR-12047](https://issues.apache.org/jira/browse/SOLR-12047) (Cao Manh Dat) (Varun Thacker)
- Election timeout when no replicas are qualified to become leader [SOLR-12051](https://issues.apache.org/jira/browse/SOLR-12051) (Cao Manh Dat)
- Increase autoAddReplicas default 30 second wait time to 120 seconds. [SOLR-12067](https://issues.apache.org/jira/browse/SOLR-12067) (Varun Thacker) (Mark Miller) (shalin)
- Fixed reproducable Failure in TestReplicationHandler.doTestIndexFetchOnLeaderRestart that happened due to using stale http connections. [SOLR-12078](https://issues.apache.org/jira/browse/SOLR-12078) (Gus Heck) (shalin)
- Document the diskType policy attribute and usage of disk space in Collection APIs. [SOLR-12097](https://issues.apache.org/jira/browse/SOLR-12097) (Cassandra Targett) (shalin)
- Document the Lucene spins auto-detection and its effect on CMS dynamic defaults. [SOLR-12098](https://issues.apache.org/jira/browse/SOLR-12098) (Cassandra Targett) (shalin)
- Remove reopenReaders attribute from 'IndexConfig in SolrConfig' page in ref guide. [SOLR-12099](https://issues.apache.org/jira/browse/SOLR-12099) (shalin)
- RequestBuilder now exposes isDistrib() method. Using this, plugins can know whether a request is distributed. [SOLR-3089](https://issues.apache.org/jira/browse/SOLR-3089) (Rok Rejc) (Frank Wesemann) (Abhishek Kumar Singh) (Mikhail Khludnev) (Ishan Chattopadhyaya)
- Change highlight color in UI Analysis screen [SOLR-6057](https://issues.apache.org/jira/browse/SOLR-6057) (Cassandra Targett)
- remove "optimize" from the UI. [SOLR-7733](https://issues.apache.org/jira/browse/SOLR-7733) (Erick Erickson)
- Make text elements in the UI darker for better contrast and readability [SOLR-8090](https://issues.apache.org/jira/browse/SOLR-8090) (Cassandra Targett)


[7.2.1] - 2018-01-15
--------------------

### Fixed (4 changes)

- If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not [SOLR-11555](https://issues.apache.org/jira/browse/SOLR-11555) (Erick Erickson)
- Overseer can never process some last messages [SOLR-11771](https://issues.apache.org/jira/browse/SOLR-11771) (Cao Manh Dat)
- Rename core in solr standalone mode is not persisted [SOLR-11783](https://issues.apache.org/jira/browse/SOLR-11783) (Erick Erickson)
- QueryComponent.prepare rq parsing could fail under SOLR 7.2.0 - fix: QueryComponent's rq parameter parsing no longer considers the defType parameter. [SOLR-11809](https://issues.apache.org/jira/browse/SOLR-11809) (Christine Poerschke and David Smiley in response to bug report) (analysis from Dariusz Wojtas and Diego Ceccarelli)


[7.2.0] - 2017-12-21
--------------------

### Upgrade Notes (2 changes)

- Starting a query string with local-params {!myparser ...} is used to switch the query parser to another, and is intended for use by Solr system developers, not end users doing searches. To reduce negative side-effects of unintended hack-ability, we've limited the cases that local-params will be parsed to only contexts in which the default parser is "lucene" or "func". So if defType=edismax then q={!myparser ...} won't work. In that example, put the desired query parser into defType. Another example is if deftype=edismax then hl.q={!myparser ...} won't work for the same reason. In that example, either put the desired query parser into hl.qparser or set hl.qparser=lucene. Most users won't run into these cases but some will and must change. If you must have full backwards compatibility, use luceneMatchVersion=7.1.0 or something earlier. [SOLR-11501](https://issues.apache.org/jira/browse/SOLR-11501) (David Smiley)
- The edismax parser by default no longer allows subqueries that specify a Solr parser using either local-params, or the older _query_ magic field trick. For example {!prefix f=myfield v=enterp} or _query_:"{!prefix f=myfield v=enterp}" are not supported by default anymore. If you want to allow power-users to do this, set uf=* _query_ or some other value that includes _query_. If you must have full backwards compatibility, use luceneMatchVersion=7.1.0 or something earlier. [SOLR-11501](https://issues.apache.org/jira/browse/SOLR-11501) (David Smiley)

### Added (33 changes)

- A new optional facet.matches parameter to return facet buckets only for terms that match a regular expression. [SOLR-10132](https://issues.apache.org/jira/browse/SOLR-10132) (Gus Heck) (Christine Poerschke)
- Add minMaxScale Stream Evaluator [SOLR-10680](https://issues.apache.org/jira/browse/SOLR-10680) (Joel Bernstein)
- Support bi-directional syncing of cdcr clusters. We still only support active indexing in one cluster, but have the ability to switch indexing clusters and cdcr will replicate correctly. [SOLR-11003](https://issues.apache.org/jira/browse/SOLR-11003) (Amrit Sarkar) (Varun Thacker)
- Implement trigger for searchRate event type. [SOLR-11072](https://issues.apache.org/jira/browse/SOLR-11072) (ab)
- Implement a set-property command for AutoScaling API. [SOLR-11202](https://issues.apache.org/jira/browse/SOLR-11202) (ab) (shalin)
- A new DefaultWrapperModel class for loading of large and/or externally stored LTRScoringModel definitions. [SOLR-11250](https://issues.apache.org/jira/browse/SOLR-11250) (Yuki Yano) (shalin) (Christine Poerschke)
- Add loess Stream Evaluator to support local regression [SOLR-11429](https://issues.apache.org/jira/browse/SOLR-11429) (Joel Bernstein)
- Solr should return rf when min_rf is specified for deletes as well as adds [SOLR-11438](https://issues.apache.org/jira/browse/SOLR-11438) (Erick Erickson)
- Implement an option in collection commands to wait for final results. [SOLR-11448](https://issues.apache.org/jira/browse/SOLR-11448) (ab)
- Add olsRegress, spline and derivative Stream Evaluators [SOLR-11485](https://issues.apache.org/jira/browse/SOLR-11485) (Joel Bernstein)
- Collection Aliases may now have metadata (currently an internal feature). [SOLR-11487](https://issues.apache.org/jira/browse/SOLR-11487) (Gus Heck) (David Smiley)
- Implement autoscaling Suggestions for freedisk violations [SOLR-11518](https://issues.apache.org/jira/browse/SOLR-11518) (noble)
- Implement autoscaling suggestions for replica count violations [SOLR-11519](https://issues.apache.org/jira/browse/SOLR-11519) (noble)
- Implement autoscaling suggestions for cores count violations [SOLR-11520](https://issues.apache.org/jira/browse/SOLR-11520) (noble)
- A new autoscaling/suggestions API end-point which gives autoscaling suggestions [SOLR-11524](https://issues.apache.org/jira/browse/SOLR-11524) (noble)
- Implement suggestions for port,ip_*, nodeRole,sysprop.*, metrics:* [SOLR-11538](https://issues.apache.org/jira/browse/SOLR-11538) (noble)
- New TimeRoutedAliasUpdateProcessor URP that routes documents to another collection in the same Alias defined set based on a time field (currently an internal feature). [SOLR-11542](https://issues.apache.org/jira/browse/SOLR-11542) (David Smiley)
- Add unit Stream Evaluator to support unitizing of vectors [SOLR-11565](https://issues.apache.org/jira/browse/SOLR-11565) (Joel Bernstein)
- Add transpose Stream Evaluator to support transposing of matrices [SOLR-11566](https://issues.apache.org/jira/browse/SOLR-11566) (Joel Bernstein)
- Add triangularDistribution Stream Evaluator [SOLR-11567](https://issues.apache.org/jira/browse/SOLR-11567) (Joel Bernstein)
- Add matrix Stream Evaluator to support efficient matrix operations [SOLR-11568](https://issues.apache.org/jira/browse/SOLR-11568) (Joel Bernstein)
- Add support for distance matrices to the distance Stream Evaluator [SOLR-11569](https://issues.apache.org/jira/browse/SOLR-11569) (Joel Bernstein)
- Add support for correlation matrices to the corr Stream Evaluator [SOLR-11570](https://issues.apache.org/jira/browse/SOLR-11570) (Joel Bernstein)
- Add diff Stream Evaluator to support time series differencing [SOLR-11571](https://issues.apache.org/jira/browse/SOLR-11571) (Mathew Skaria) (Joel Bernstein)
- Add support for covariance matrices to the cov Stream Evaluator [SOLR-11593](https://issues.apache.org/jira/browse/SOLR-11593) (Joel Bernstein)
- Change normalize function to standardize and make it work with matrices [SOLR-11599](https://issues.apache.org/jira/browse/SOLR-11599) (Joel Bernstein)
- Add Markov Chain Stream Evaluator [SOLR-11602](https://issues.apache.org/jira/browse/SOLR-11602) (Joel Bernstein)
- Add grandSum, sumRows, sumColumns, scalarDivide, scalarMultiply, scalarAdd, scalarSubtract Stream Evaluators [SOLR-11607](https://issues.apache.org/jira/browse/SOLR-11607) (Joel Bernstein)
- New synonymQueryStyle option to configure whether SynonymQuery, a DisjunctionMaxQuery, or BooleanQuery occurs over query terms that overlap their position. [SOLR-11662](https://issues.apache.org/jira/browse/SOLR-11662) (Doug Turnbull) (David Smiley)
- Support ranges in the probability Stream Evaluator [SOLR-11674](https://issues.apache.org/jira/browse/SOLR-11674) (Joel Bernstein)
- Add normalizeSum Stream Evaluator [SOLR-11680](https://issues.apache.org/jira/browse/SOLR-11680) (Joel Bernstein)
- Add geometricDistribution Stream Evaluator [SOLR-11697](https://issues.apache.org/jira/browse/SOLR-11697) (Joel Bernstein)
- A new UTILIZENODE command [SOLR-9743](https://issues.apache.org/jira/browse/SOLR-9743) (noble)

### Changed (5 changes)

- Refactor autoscaling framework to avoid direct references to Zookeeper and Solr to make testing and large scale simulations easier. [SOLR-11285](https://issues.apache.org/jira/browse/SOLR-11285) (ab)
- Lock autoscaling triggers when changes they requested are being made. This helps to ensure that cluster is in a stable state before processing any new trigger events. [SOLR-11320](https://issues.apache.org/jira/browse/SOLR-11320) (ab)
- Remove the usage of workqueue for Overseer. [SOLR-11443](https://issues.apache.org/jira/browse/SOLR-11443) (Cao Manh Dat) (Scott Blum)
- SolrIndexSearcher.localCollectionStatistics is now faster by leveraging an existing cached MultiFields. Noticeable when many fields are searched. [SOLR-11595](https://issues.apache.org/jira/browse/SOLR-11595) (David Smiley)
- Change `frange` to default to `cost=100` so default behavior is to PostFilter if user specifies `cache=false` [SOLR-11641](https://issues.apache.org/jira/browse/SOLR-11641) (hossman)

### Fixed (28 changes)

- Fix AIOOBE caused by FloatPayloadValueSource calling PostingsEnum.nextPosition() more than the given term's frequency in overridden FloatDocValues.floatVal(). [SOLR-10874](https://issues.apache.org/jira/browse/SOLR-10874) (Michael Kosten) (Erik Hatcher) (Steve Rowe)
- Small fixes to the mapping functions in the Analytics Component [SOLR-11146](https://issues.apache.org/jira/browse/SOLR-11146) (Houston Putman)
- Guard against unset fields when performing language detection. [SOLR-11231](https://issues.apache.org/jira/browse/SOLR-11231) (Chris Beer) (Steve Rowe)
- The queue size for ConcurrentUpdateSolrClient should default to 10 instead of throwing an IllegalArgumentException. [SOLR-11256](https://issues.apache.org/jira/browse/SOLR-11256) (Jason Gerlowski) (Anshum Gupta)
- A bootstrap of a target cluster does not need to download the tlog files from the source cluster [SOLR-11326](https://issues.apache.org/jira/browse/SOLR-11326) (Amrit Sarkar) (Varun Thacker)
- SolrGraphiteReporter fails to report metrics due to non-thread safe code. [SOLR-11413](https://issues.apache.org/jira/browse/SOLR-11413) (Erik Persson) (ab)
- Overseer queue needs a hard cap (maximum size) that clients respect [SOLR-11423](https://issues.apache.org/jira/browse/SOLR-11423) (Scott Blum) (Joshua Humphries) (Noble Paul)
- Overseer should not hang when process bad message. [SOLR-11445](https://issues.apache.org/jira/browse/SOLR-11445) (Cao Manh Dat) (shalin)
- ZkStateWriter should process commands in atomic. [SOLR-11447](https://issues.apache.org/jira/browse/SOLR-11447) (Cao Manh Dat) (shalin)
- Improve error handling in MoveReplicaCmd to avoid potential loss of data. [SOLR-11458](https://issues.apache.org/jira/browse/SOLR-11458) (ab)
- CloudSolrClient does not invalidate cache or retry for RouteException [SOLR-11484](https://issues.apache.org/jira/browse/SOLR-11484) (noble) (hossman)
- Support retrieval of cluster properties in HttpClusterStateProvider. [SOLR-11491](https://issues.apache.org/jira/browse/SOLR-11491) (ab)
- Collections created with legacyCloud=true cannot be opened if legacyCloud=false [SOLR-11503](https://issues.apache.org/jira/browse/SOLR-11503) (Erick Erickson)
- Solr hits NPE when fl only contains DV fields and any of them is a spatial field. [SOLR-11532](https://issues.apache.org/jira/browse/SOLR-11532) (Cao Manh Dat) (David Smiley)
- JSON Facet API: facet refinement could use UIF in phase one and DV uninversion in phase 2, resulting in too much memory use. [SOLR-11553](https://issues.apache.org/jira/browse/SOLR-11553) (yonik)
- Fix SolrZkClient.checkInterrupted [SOLR-11557](https://issues.apache.org/jira/browse/SOLR-11557) (Tomás Fernández Löbbe)
- Specifying the replicationFactor parameter while restoring a collection would lead to extra tlog and pull replicas being created [SOLR-11560](https://issues.apache.org/jira/browse/SOLR-11560) (Peter Szantai-Kis) (Varun Thacker)
- Restored collection should use stateFormat=2 instead of 1. [SOLR-11586](https://issues.apache.org/jira/browse/SOLR-11586) (Varun Thacker)
- Synchronize ZK connect/disconnect handling so that they are processed in linear order [SOLR-11590](https://issues.apache.org/jira/browse/SOLR-11590) (noble) (Varun Thacker)
- Correctly parse the new core-name in the V2 core rename API. [SOLR-11608](https://issues.apache.org/jira/browse/SOLR-11608) (Jason Gerlowski) (Anshum Gupta)
- Snapshot the segments more robustly such that segments created during a backup does does not fail the operation [SOLR-11616](https://issues.apache.org/jira/browse/SOLR-11616) (Varun Thacker)
- V2 requests that needed to be forwarded to other nodes would get an NPE. [SOLR-11619](https://issues.apache.org/jira/browse/SOLR-11619) (David Smiley)
- When the java commandline had exact duplicate arguments, the admin UI dashboard would not display any commandline arguments. [SOLR-11645](https://issues.apache.org/jira/browse/SOLR-11645) (Webster Homer) (Shawn Heisey)
- JSON Facet API: range facets containing unique, hll, min, max aggregations over string fields produced incorrect results since 7.0 [SOLR-11664](https://issues.apache.org/jira/browse/SOLR-11664) (Volodymyr Rudniev) (yonik)
- SolrCore.getNewIndexDir falsely returns {dataDir}/index on any IOException reading index.properties [SOLR-11687](https://issues.apache.org/jira/browse/SOLR-11687) (Nikolay Martynov) (Erick Erickson)
- V2 requests for create-alias didn't work when the collections param was an array. [SOLR-11691](https://issues.apache.org/jira/browse/SOLR-11691) (Jason Gerlowski) (Gus Heck) (David Smiley) (noble)
- bin/solr script ignored custom STOP_PORT on shutdown. [SOLR-9137](https://issues.apache.org/jira/browse/SOLR-9137) (Joachim Kohlhammer) (Steve Rowe) (Christine Poerschke)
- The ZkStateReader.removeCollectionStateWatcher method can cache a DocCollection reference and never update it causing stale state to be returned in ClusterState. [SOLR-9440](https://issues.apache.org/jira/browse/SOLR-9440) (shalin)

### Other (19 changes)

- Move CloudSolrClient.setParallelUpdates to its Builder. [SOLR-10469](https://issues.apache.org/jira/browse/SOLR-10469) (David Smiley)
- Adds comprehensive unit tests for the Analytics Component v2 [SOLR-11145](https://issues.apache.org/jira/browse/SOLR-11145) (Houston Putman)
- Ref guide documentation for Autoscaling APIs, triggers, listeners, actions for Solr 7.1 [SOLR-11165](https://issues.apache.org/jira/browse/SOLR-11165) (ab) (Cassandra Targett) (Noble Paul) (shalin)
- Factor out abstract metrics/SolrCore[Container]Reporter classes. [SOLR-11291](https://issues.apache.org/jira/browse/SOLR-11291) (Omar Abdelnabi) (Christine Poerschke)
- SolrJ must stream docs to server instead of writing to a buffer first [SOLR-11380](https://issues.apache.org/jira/browse/SOLR-11380) (noble)
- For Solr(Shard|Cluster)Reporter instances the SolrMetricManager.registerReporter method is now called after the SolrCore or CoreContainer has been set for the instance. [SOLR-11389](https://issues.apache.org/jira/browse/SOLR-11389) (Christine Poerschke)
- Improved consistency of collection alias handling, and collection references that are comma delimited lists of collections, across the various places collections can be referred to. Updates are delivered to the first in a list. It's now possible to refer to a comma delimited list of them in the path, ex: /solr/colA,colB/select?... [SOLR-11444](https://issues.apache.org/jira/browse/SOLR-11444) (David Smiley)
- Minor refactorings to DistributedUpdateProcessor. [SOLR-11464](https://issues.apache.org/jira/browse/SOLR-11464) [SOLR-11493](https://issues.apache.org/jira/browse/SOLR-11493) [SOLR-11511](https://issues.apache.org/jira/browse/SOLR-11511) (Gus Heck) (David Smiley)
- Solr should remove itself from live_nodes in zk immediately on shutdown. [SOLR-11478](https://issues.apache.org/jira/browse/SOLR-11478) (Cao Manh Dat)
- Randomize SolrTestCaseJ4.CloudSolrClientBuilder more, and simplify it. [SOLR-11507](https://issues.apache.org/jira/browse/SOLR-11507) [SOLR-11638](https://issues.apache.org/jira/browse/SOLR-11638) (Jason Gerlowski) (David Smiley)
- Restore Solr logo ASCII-art in startup log by removing unnecessary default confdir logging [SOLR-11562](https://issues.apache.org/jira/browse/SOLR-11562) (janhoy)
- Remove unused (public) LTRScoringModel.hasParams() method. [SOLR-11603](https://issues.apache.org/jira/browse/SOLR-11603) (Christine Poerschke)
- Disable tests automatically if Mockito does not work with Java runtime (Java 10). [SOLR-11606](https://issues.apache.org/jira/browse/SOLR-11606) (Uwe Schindler)
- Refactored payload handling to use lucene's PayloadDecoder framework [SOLR-11610](https://issues.apache.org/jira/browse/SOLR-11610) (Alan Woodward)
- Tone down verbosity of BackupManager logging [SOLR-11618](https://issues.apache.org/jira/browse/SOLR-11618) (Varun Thacker)
- Fix spurious failures of TriggerIntegrationTest due to timing issues. [SOLR-11621](https://issues.apache.org/jira/browse/SOLR-11621) (shalin)
- Add documentation of maxRamMB for filter cache and query result cache. [SOLR-11628](https://issues.apache.org/jira/browse/SOLR-11628) (shalin)
- Fixed CdcrUpdateLogTest.testSubReader() failure which was a test bug [SOLR-11713](https://issues.apache.org/jira/browse/SOLR-11713) (Varun Thacker) (Amrit Sarkar)
- Reduce log level for inconsequential NoSuchFileException that LukeRequestHandler may encounter [SOLR-9120](https://issues.apache.org/jira/browse/SOLR-9120) (hossman)


[7.1.0] - 2017-10-17
--------------------

### Upgrade Notes (6 changes)

- in the ReplicationHandler the master.commitReserveDuration sub-element is deprecated. Instead please configure a direct commitReserveDuration element for use in all modes [SOLR-10962](https://issues.apache.org/jira/browse/SOLR-10962) (master) (slave) (cloud)
- shard and cluster metric reporter configuration now requires a class attribute. If a reporter configures the group="shard" attribute then please also configure the class="org.apache.solr.metrics.reporters.solr.SolrShardReporter" attribute. If a reporter configures the group="cluster" attribute then please also configure the class="org.apache.solr.metrics.reporters.solr.SolrClusterReporter" attribute. [SOLR-11195](https://issues.apache.org/jira/browse/SOLR-11195) 
- the abstract DocTransformer class now has an abstract score-less transform method variant. [SOLR-11254](https://issues.apache.org/jira/browse/SOLR-11254) 
- all Stream Evaluators in solrj.io.eval have been refactored to have a simplier and more robust structure. This simplifies and condenses the code required to implement a new Evaluator and makes it much easier for evaluators to handle differing data types (primitives, objects, arrays, lists, and so forth). [SOLR-11283](https://issues.apache.org/jira/browse/SOLR-11283) (Dennis Gove)
- in the XML query parser [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (defType=xmlparser or {!xmlparser ... })
- 'autoAddReplicas' feature is ported to autoscaling framework. Existing users of this feature should not have to change anything. Note these changes: 1. Behaviour: Changing the autoAddReplicas property from disabled to enabled using MODIFYCOLLECTION API no longer replaces down replicas for the collection immediately. Instead, replicas are only added if a node containing them went down while autoAddReplicas was enabled. The params autoReplicaFailoverBadNodeExpiration and autoReplicaFailoverWorkLoopDelay are no longer used. 2. Deprecations: Enabling/disabling autoAddReplicas cluster wide with the API will be deprecated; use suspend/resume trigger APIs with name='.auto_add_replicas' instead. 

### Added (39 changes)

- New set-trigger and remove-trigger APIs for autoscaling. [SOLR-10339](https://issues.apache.org/jira/browse/SOLR-10339) (shalin)
- New set-listener and remove-listener API for autoscaling. [SOLR-10340](https://issues.apache.org/jira/browse/SOLR-10340) (shalin)
- New suspend-trigger and resume-trigger APIs for autoscaling. [SOLR-10358](https://issues.apache.org/jira/browse/SOLR-10358) (shalin)
- Implement autoscaling trigger for nodeAdded event. [SOLR-10376](https://issues.apache.org/jira/browse/SOLR-10376) (shalin)
- Implement trigger support for nodeLost event type [SOLR-10396](https://issues.apache.org/jira/browse/SOLR-10396) (Cao Manh Dat) (shalin)
- New ComputePlanAction for autoscaling which uses the policy framework to compute cluster operations upon a trigger fire. [SOLR-10496](https://issues.apache.org/jira/browse/SOLR-10496) (Noble Paul) (shalin)
- Make UUIDUpdateProcessorFactory as Runtime URP [SOLR-10858](https://issues.apache.org/jira/browse/SOLR-10858) (Amit Sarkar) (noble)
- Make ReplicationHandler's commitReserveDuration configurable in SolrCloud mode. [SOLR-10962](https://issues.apache.org/jira/browse/SOLR-10962) (Ramsey Haddad) (Christine Poerschke) (hossman)
- New ExecutePlanAction for autoscaling which executes the operations computed by ComputePlanAction against the cluster. [SOLR-10965](https://issues.apache.org/jira/browse/SOLR-10965) (shalin)
- Implement TriggerListener API [SOLR-10996](https://issues.apache.org/jira/browse/SOLR-10996) (ab) (shalin)
- Add addAll Stream Evaluator [SOLR-11019](https://issues.apache.org/jira/browse/SOLR-11019) (Joel Bernstein)
- Implement SystemLogListener for autoscaling [SOLR-11031](https://issues.apache.org/jira/browse/SOLR-11031) (ab)
- Add residuals Stream Evaluator [SOLR-11046](https://issues.apache.org/jira/browse/SOLR-11046) (Joel Bernstein)
- New /autoscaling/history API to return past cluster events and actions. [SOLR-11076](https://issues.apache.org/jira/browse/SOLR-11076) (ab)
- Add normalDistribution, uniformDistribution, sample and kolmogorovSmirnov Stream Evaluators [SOLR-11160](https://issues.apache.org/jira/browse/SOLR-11160) (Joel Bernstein)
- Payloads supports an "operator" param. Supported operators are 'or', "phrase" ( default ). A new "sum" function is also added. Example : {!payload_score f=payload_field func=sum operator=or}A B C" [SOLR-11199](https://issues.apache.org/jira/browse/SOLR-11199) (Varun Thacker)
- Any metrics value can be directly accessed in autoscaling policies [SOLR-11205](https://issues.apache.org/jira/browse/SOLR-11205) (noble)
- Make a metric accessible through a single param. [SOLR-11215](https://issues.apache.org/jira/browse/SOLR-11215) (ab)
- Add cumulativeProbability Stream Evaluator [SOLR-11225](https://issues.apache.org/jira/browse/SOLR-11225) (Joel Bernstein)
- Add discrete counting and probability Stream Evaluators [SOLR-11241](https://issues.apache.org/jira/browse/SOLR-11241) (Joel Bernstein)
- Query DSL for Solr [SOLR-11244](https://issues.apache.org/jira/browse/SOLR-11244) (Cao Manh Dat)
- JSON Facet API: min/max aggregations are now supported on single-valued date fields. [SOLR-11316](https://issues.apache.org/jira/browse/SOLR-11316) (yonik)
- JSON Facet API: min/max aggregations on numeric fields are now typed better so int/long fields return an appropriate integral type rather than a double. [SOLR-11317](https://issues.apache.org/jira/browse/SOLR-11317) (yonik)
- Add ebeAdd, ebeSubtract, ebeDivide, ebeMultiply, dotProduct and cosineSimilarity Stream Evaluators [SOLR-11321](https://issues.apache.org/jira/browse/SOLR-11321) (Joel Bernstein)
- Add Kendall's Tau-b rank and Spearmans rank correlation Stream Evaluators [SOLR-11338](https://issues.apache.org/jira/browse/SOLR-11338) (Joel Bernstein)
- Add Canberra, Chebyshev, Earth Movers and Manhattan Distance Stream Evaluators [SOLR-11339](https://issues.apache.org/jira/browse/SOLR-11339) (Joel Bernstein)
- Add sumDifference and meanDifference Stream Evaluators [SOLR-11342](https://issues.apache.org/jira/browse/SOLR-11342) (Joel Bernstein)
- Add primes Stream Evaluator [SOLR-11350](https://issues.apache.org/jira/browse/SOLR-11350) (Joel Bernstein)
- Add factorial and movingMedian Stream Evaluators [SOLR-11354](https://issues.apache.org/jira/browse/SOLR-11354) (Joel Bernstein)
- Add expMovingAverage (exponential moving average) and binomialCoefficient Stream Evaluators [SOLR-11377](https://issues.apache.org/jira/browse/SOLR-11377) (Mathew Skaria) (Joel Bernstein)
- Lucene's Geo3D (surface of sphere & ellipsoid) is now supported on spatial RPT fields by setting spatialContextFactory="Geo3D". Furthermore, this is the first time Solr has out of the box support for polygons. [SOLR-11382](https://issues.apache.org/jira/browse/SOLR-11382) (David Smiley)
- Add monteCarlo Stream Evaluator to support Monte Carlo simulations [SOLR-11388](https://issues.apache.org/jira/browse/SOLR-11388) (Joel Bernstein)
- Add weibullDistribution Stream Evaluator [SOLR-11398](https://issues.apache.org/jira/browse/SOLR-11398) (Joel Bernstein)
- Add logNormalDistribution Stream Evaluator [SOLR-11400](https://issues.apache.org/jira/browse/SOLR-11400) (Joel Bernstein)
- Add zipFDistribution Stream Evaluator [SOLR-11401](https://issues.apache.org/jira/browse/SOLR-11401) (Joel Bernstein)
- Add gammaDistribution Stream Evaluator [SOLR-11414](https://issues.apache.org/jira/browse/SOLR-11414) (Joel Bernstein)
- Add betaDistribution Stream Evaluator [SOLR-11415](https://issues.apache.org/jira/browse/SOLR-11415) (Joel Bernstein)
- Add polyfit and polyfitDerivative Stream Evaluators [SOLR-11436](https://issues.apache.org/jira/browse/SOLR-11436) (Joel Bernstein)
- Add harmonicFit Stream Evaluator [SOLR-11439](https://issues.apache.org/jira/browse/SOLR-11439) (Joel Bernstein)

### Changed (9 changes)

- Skip LEADER messages when there are leader only shards [SOLR-10285](https://issues.apache.org/jira/browse/SOLR-10285) (Cao Manh Dat) (Joshua Humphries)
- Allow nodeAdded / nodeLost events to report multiple nodes in one event. [SOLR-10769](https://issues.apache.org/jira/browse/SOLR-10769) (ab)
- Remove unnecessary toString() calls in solr-core's search package's debug logging. [SOLR-10985](https://issues.apache.org/jira/browse/SOLR-10985) (Michael Braun) (Christine Poerschke)
- Changes made via AutoScalingHandler should be atomic. [SOLR-11000](https://issues.apache.org/jira/browse/SOLR-11000) (ab) (shalin)
- MoveReplicaCmd should skip deleting old replica in case of its node is not live [SOLR-11124](https://issues.apache.org/jira/browse/SOLR-11124) (Cao Manh Dat)
- QueryParser: re-use the LookaheadSuccess exception. [SOLR-11242](https://issues.apache.org/jira/browse/SOLR-11242) (Michael Braun) (David Smiley)
- FastCharStream: re-use the READ_PAST_EOF exception. [SOLR-11314](https://issues.apache.org/jira/browse/SOLR-11314) (Michael Braun) (David Smiley)
- When legacyCloud=false, cores should not publish itself as DOWN on startup. [SOLR-11424](https://issues.apache.org/jira/browse/SOLR-11424) (Cao Manh Dat)
- Decide default when requested fields are both column and row stored. [SOLR-8344](https://issues.apache.org/jira/browse/SOLR-8344) (Cao Manh Dat) (David Smiley)

### Fixed (32 changes)

- TestLazyCores hangs [SOLR-10101](https://issues.apache.org/jira/browse/SOLR-10101) (Erick Erickson)
- Triggers should be able to restore state from old instances when taking over. [SOLR-10602](https://issues.apache.org/jira/browse/SOLR-10602) (shalin)
- fix NPE at sort=childfield(..) .. on absent values [SOLR-10668](https://issues.apache.org/jira/browse/SOLR-10668) (Mikhail Khludnev)
- OverseerTriggerThread does not start triggers on overseer start until autoscaling config watcher is fired. [SOLR-10714](https://issues.apache.org/jira/browse/SOLR-10714) (shalin)
- TriggerAction is initialised even if the trigger is never scheduled. [SOLR-10738](https://issues.apache.org/jira/browse/SOLR-10738) (shalin)
- Get expression fails to return EOF tuple [SOLR-10944](https://issues.apache.org/jira/browse/SOLR-10944) (Susheel Kumar) (Joel Bernstein)
- CREATE, CREATESHARD & ADDREPLICA to use policy framework & support replica types [SOLR-10994](https://issues.apache.org/jira/browse/SOLR-10994) (noble)
- Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false [SOLR-11011](https://issues.apache.org/jira/browse/SOLR-11011) (Cao Manh Dat)
- Fix three (JavaBinCodec not being closed) Resource Leak warnings. [SOLR-11012](https://issues.apache.org/jira/browse/SOLR-11012) (Christine Poerschke)
- MoveReplicaSuggester must check if the target becomes more 'loaded' than the source if an operation is performed [SOLR-11026](https://issues.apache.org/jira/browse/SOLR-11026) (noble)
- Issue with starting script with solr.home (-s) == solr [SOLR-11084](https://issues.apache.org/jira/browse/SOLR-11084) (Leil Ireson) (Amrit Sarkar) (Erick Erickson)
- Improve resiliency of autoscaling actions against overseer restarts and operation failures. [SOLR-11085](https://issues.apache.org/jira/browse/SOLR-11085) (shalin)
- Fix NullPointerException and always-returns-zero contrib/ltr OriginalScoreFeature issues in SolrCloud mode. [SOLR-11164](https://issues.apache.org/jira/browse/SOLR-11164) [SOLR-11180](https://issues.apache.org/jira/browse/SOLR-11180) [SOLR-11220](https://issues.apache.org/jira/browse/SOLR-11220) (Yuki Yano) (Jonathan Gonzalez) (Ryan Yacyshyn) (Christine Poerschke)
- GraphQuery also supports string fields which are indexed=false and docValues=true. Please refer to the Javadocs for DocValuesTermsQuery for it's performance characteristics. [SOLR-11190](https://issues.apache.org/jira/browse/SOLR-11190) (Karthik Ramachandran) (Varun Thacker)
- SolrStream.close can hit an NPE [SOLR-11224](https://issues.apache.org/jira/browse/SOLR-11224) (Erick Erickson)
- Fix occasional ConcurrentModificationException when using SolrInfoMBeanHandler. [SOLR-11255](https://issues.apache.org/jira/browse/SOLR-11255) (ab)
- fix NPE when EmbeddedSolrServer handles /admin/* request and so one [SOLR-11272](https://issues.apache.org/jira/browse/SOLR-11272) (Stephen Allen) (Mikhail Khludnev)
- Fix a race condition in the CDCR bootstrap process which could lead to bootstraps cancelling itself [SOLR-11278](https://issues.apache.org/jira/browse/SOLR-11278) (Amrit Sarkar) (shalin) (Varun Thacker)
- Stopping CDCR should cancel a running bootstrap operation. [SOLR-11278](https://issues.apache.org/jira/browse/SOLR-11278) (Amrit Sarkar) (shalin)
- fix comma handling in terms component. [SOLR-11289](https://issues.apache.org/jira/browse/SOLR-11289) (yonik)
- Potential data loss in TLOG replicas when masterVersion equals zero [SOLR-11293](https://issues.apache.org/jira/browse/SOLR-11293) (noble) (Cao Manh Dat)
- Message "Lock held by this virtual machine" during startup. Solr is trying to start some cores twice. [SOLR-11297](https://issues.apache.org/jira/browse/SOLR-11297) (Luiz Armesto) (Shawn Heisey) (Erick Erickson)
- Fix sorting on 'enum' fieldTypes that use sortMissingFirst or sortMissingLast [SOLR-11332](https://issues.apache.org/jira/browse/SOLR-11332) (hossman)
- Fix the DIH database example [SOLR-11348](https://issues.apache.org/jira/browse/SOLR-11348) (James Dyer)
- JSON Facet API: repeated values in a numeric points field with docValues enabled were double counted. [SOLR-11363](https://issues.apache.org/jira/browse/SOLR-11363) (Hossman) (yonik)
- The UnifiedHighlighter was ignoring the hl.fragsize parameter when hl.bs.type=SEPARATOR [SOLR-11399](https://issues.apache.org/jira/browse/SOLR-11399) (Marc Morissette) (David Smiley)
- SolrClientBuilder does not allow infinite timeout (value 0). [SOLR-11425](https://issues.apache.org/jira/browse/SOLR-11425) (Peter Szantai-Kis) (Mark Miller)
- MoveReplicaCmd mistakenly called registerCollectionStateWatcher on failure. [SOLR-11449](https://issues.apache.org/jira/browse/SOLR-11449) (ab)
- Disallow resolving of external entities in the XML query parser (defType=xmlparser). [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (Michael Stepankin) (Olga Barinova) (Uwe Schindler) (Christine Poerschke)
- Updating a cluster policy fails [SOLR-12444](https://issues.apache.org/jira/browse/SOLR-12444) (noble)
- Replica is active during autowarming resulting in queries being sent to a replica that may not have a registered searcher. This causes spikes in response times when adding a replica in busy clusters. [SOLR-6086](https://issues.apache.org/jira/browse/SOLR-6086) (Ludovic Boutros) (Timothy Potter) (shalin)
- EnumField's error reporting to now indicate the field name in failure log [SOLR-8984](https://issues.apache.org/jira/browse/SOLR-8984) (Lanny Ripple) (Ann Addicks) (Ishan Chattopadhyaya)

### Other (36 changes)

- Upgrade to Tika 1.16. [SOLR-10335](https://issues.apache.org/jira/browse/SOLR-10335) (Tim Allison) (Tomás Fernández Löbbe) (shalin)
- Configure SecureRandom non blocking for tests. [SOLR-10338](https://issues.apache.org/jira/browse/SOLR-10338) (Mihaly Toth) (hossman) (Ishan Chattopadhyaya) (Mark Miller)
- Port 'autoAddReplicas' feature to the autoscaling framework and make it work with non-shared filesystems [SOLR-10397](https://issues.apache.org/jira/browse/SOLR-10397) (Cao Manh Dat) (shalin)
- Remove contrib/ltr/lib from lib includes in the techproducts example config [SOLR-10451](https://issues.apache.org/jira/browse/SOLR-10451) (sungjunyoung) (janhoy)
- Less verbose output from bin/solr commands. [SOLR-10628](https://issues.apache.org/jira/browse/SOLR-10628) (Jason Gerlowski) (janhoy)
- Throttling strategy for triggers and policy executions. [SOLR-10643](https://issues.apache.org/jira/browse/SOLR-10643) (shalin)
- Make stream.body configurable and disabled by default [SOLR-10748](https://issues.apache.org/jira/browse/SOLR-10748) (janhoy)
- AutoScalingHandler should validate policy and preferences before updating zookeeper. [SOLR-10764](https://issues.apache.org/jira/browse/SOLR-10764) (shalin)
- Factor out abstract FilteringSolrMetricReporter class. [SOLR-10827](https://issues.apache.org/jira/browse/SOLR-10827) (Christine Poerschke)
- Convert tests that extend LuceneTestCase and use MiniSolrCloudCluster to instead extend SolrCloudTestCase. [SOLR-10916](https://issues.apache.org/jira/browse/SOLR-10916) (Steve Rowe)
- Changed SolrCoreParser.init to use the resource loader from getSchema() instead of the resource loader from getCore(). [SOLR-10957](https://issues.apache.org/jira/browse/SOLR-10957) (Christine Poerschke)
- Reduce SolrIndexSearcher casting in LTRRescorer. [SOLR-10964](https://issues.apache.org/jira/browse/SOLR-10964) (Christine Poerschke)
- Breakup QueryComponent.process method for readability. [SOLR-10990](https://issues.apache.org/jira/browse/SOLR-10990) (Christine Poerschke)
- Remove unnecessary Long-to-Integer and back casts in ReplicationHandler. [SOLR-11052](https://issues.apache.org/jira/browse/SOLR-11052) (Ramsey Haddad) (Christine Poerschke)
- Add a spins metric for data directory paths. [SOLR-11061](https://issues.apache.org/jira/browse/SOLR-11061) (ab)
- Improve TestIntervalFacets.testRandom [SOLR-11071](https://issues.apache.org/jira/browse/SOLR-11071) (Tomás Fernández Löbbe)
- Refactor handling of params in CloudSolrStream and FacetStream [SOLR-11075](https://issues.apache.org/jira/browse/SOLR-11075) (Erick Erickson)
- Add Replica.getProperty accessor. [SOLR-11090](https://issues.apache.org/jira/browse/SOLR-11090) (Christine Poerschke)
- TestLBHttpSolrClient.testReliablity takes 30 seconds because of the wrong server name [SOLR-11106](https://issues.apache.org/jira/browse/SOLR-11106) (Kensho Hirasawa) (Erick Erickson)
- Document 'assert' as a command option in bin/solr, and bin/solr.cmd scripts. [SOLR-11131](https://issues.apache.org/jira/browse/SOLR-11131) (Jason Gerlowski) (Anshum Gupta)
- Refactor common getSortField logic in various FieldTypes [SOLR-11132](https://issues.apache.org/jira/browse/SOLR-11132) (Jason Gerlowski) (hossman)
- Remove unused parameter in (private) SolrMetricManager.prepareCloudPlugins method. [SOLR-11140](https://issues.apache.org/jira/browse/SOLR-11140) (Omar Abdelnabi) (Christine Poerschke)
- remove-policy must fail if a policy to be deleted is used by a collection [SOLR-11157](https://issues.apache.org/jira/browse/SOLR-11157) (noble)
- contrib/ltr TestModelManagerPersistence improvements. [SOLR-11187](https://issues.apache.org/jira/browse/SOLR-11187) (Yuki Yano) (Christine Poerschke)
- Require class attribute for shard and cluster metric reporter configuration. [SOLR-11195](https://issues.apache.org/jira/browse/SOLR-11195) (Christine Poerschke)
- Upgrade HttpClient to 4.5.3. [SOLR-11209](https://issues.apache.org/jira/browse/SOLR-11209) (Hrishikesh Gadre) (Mark Miller)
- Raise UnInvertedField internal limit. [SOLR-11240](https://issues.apache.org/jira/browse/SOLR-11240) (Toke Eskildsen)
- Upgrade Jetty from 9.3.14.v20161028 to 9.3.20.v20170531 [SOLR-11249](https://issues.apache.org/jira/browse/SOLR-11249) (Michael Braun) (David Smiley)
- Add score-less (abstract) DocTransformer.transform method. [SOLR-11254](https://issues.apache.org/jira/browse/SOLR-11254) (Christine Poerschke)
- Automatically added SystemLogListener should not prevent deleting a trigger. [SOLR-11270](https://issues.apache.org/jira/browse/SOLR-11270) (ab)
- Fix inaccurate comments on docValues and StrField in the example schemas [SOLR-11306](https://issues.apache.org/jira/browse/SOLR-11306) (Tom Burton-West) (Jason Gerlowski) (Varun Thacker)
- JSON Facet API: instead of returning NaN, min & max aggregations omit the value for any bucket with no values in the numeric field. [SOLR-11322](https://issues.apache.org/jira/browse/SOLR-11322) (yonik)
- Make LTRScoringModel model more extensible. [SOLR-11351](https://issues.apache.org/jira/browse/SOLR-11351) (Christine Poerschke)
- RunExecutableListener was removed for security reasons. [SOLR-11482](https://issues.apache.org/jira/browse/SOLR-11482) (Michael Stepankin) (Olga Barinova) (Uwe Schindler) (Tomás Fernández Löbbe)
- Timeout property for waiting ZK get started. [SOLR-5129](https://issues.apache.org/jira/browse/SOLR-5129) (Cao Manh Dat) (Hrishikesh Gadre) (Varun Thacker)
- SOLR:10822: Share a Policy.session object between multiple collection admin calls to get the correct computations (noble)


[7.0.1] - 2017-10-06
--------------------

### Fixed (2 changes)

- Message "Lock held by this virtual machine" during startup. Solr is trying to start some cores twice. [SOLR-11297](https://issues.apache.org/jira/browse/SOLR-11297) (Luiz Armesto) (Shawn Heisey) (Erick Erickson)
- Solr 7.0 cannot read indexes from 6.x versions. [SOLR-11406](https://issues.apache.org/jira/browse/SOLR-11406) (Shawn Heisey) (Steve Rowe)


[7.0.0] - 2017-09-20
--------------------

### Added (51 changes)

- Add UninvertDocValuesMergePolicyFactory class. [SOLR-10046](https://issues.apache.org/jira/browse/SOLR-10046) (Keith Laban) (Christine Poerschke)
- Upgraded the Analytics Component to version 2.0 which now supports distributed collections, expressions over multivalued fields, a new JSON request language, and more. DocValues are now required for any field used in the analytics expression whereas previously docValues was not required. Please see SOLR-10123 for details. [SOLR-10123](https://issues.apache.org/jira/browse/SOLR-10123) (Houston Putman)
- Add support for different replica types, that can handle updates differently: - NRT: Writes updates to transaction log and indexes locally. Replicas of type “NRT” support NRT (soft commits) and RTG. Any NRT replica can become a leader. This was the only type supported in SolrCloud until now and it’s the default type. - TLOG: Writes to transaction log, but not to index, uses replication to copy segment files from the shard leader. Any TLOG replica can become leader (by first applying all local transaction log elements). If a replica is of type TLOG but is also the leader, it will behave as a NRT. This is exactly what was added in SOLR-9835 (non-realtime replicas), just the API and naming changes. - PULL: Doesn’t index or writes to transaction log, just replicates from the shard leader. PULL replicas can’t become shard leaders (i.e., if there are only PULL replicas in the collection at some point, updates will fail same as if there is no leaders, queries continue to work), so they don’t even participate in elections. [SOLR-10233](https://issues.apache.org/jira/browse/SOLR-10233) [SOLR-9835](https://issues.apache.org/jira/browse/SOLR-9835) (Tomás Fernández Löbbe)
- Add support for configurable metrics implementations. [SOLR-10262](https://issues.apache.org/jira/browse/SOLR-10262) (ab)
- Use _default config set if no collection.configName is specified with CREATE [SOLR-10272](https://issues.apache.org/jira/browse/SOLR-10272) (Ishan Chattopadhyaya)
- A new DSL to set cluster-wide preferences and policies on how to allocate replicas to nodes [SOLR-10278](https://issues.apache.org/jira/browse/SOLR-10278) (noble) (shalin)
- bin/solr support for enabling Kerberos authentication [SOLR-10282](https://issues.apache.org/jira/browse/SOLR-10282) (Ishan Chattopadhyaya) (Jason Gerlowski)
- Allow Passing SSL passwords through environment variables. [SOLR-10307](https://issues.apache.org/jira/browse/SOLR-10307) (Mano Kovacs) (Michael Suzuki) (Mark Miller)
- Adds basic math Streaming Evaluators [SOLR-10356](https://issues.apache.org/jira/browse/SOLR-10356) (Dennis Gove)
- Implement read API for autoscaling configuration at /admin/autoscaling or /cluster/autoscaling paths. [SOLR-10373](https://issues.apache.org/jira/browse/SOLR-10373) (shalin)
- Add ManagedSynonymGraphFilterFactory, deprecate ManagedSynonymFilterFactory. [SOLR-10379](https://issues.apache.org/jira/browse/SOLR-10379) (Steve Rowe)
- Adds UUID Streaming Evaluator [SOLR-10393](https://issues.apache.org/jira/browse/SOLR-10393) (Dennis Gove)
- v2 API error messages list the URL request path as /solr/____v2/... when the original path was /v2/... [SOLR-10406](https://issues.apache.org/jira/browse/SOLR-10406) (Cao Manh Dat) (noble)
- Make it possible to invoke v2 api calls using SolrJ [SOLR-10431](https://issues.apache.org/jira/browse/SOLR-10431) (Cao Manh Dat) (Noble Paul) (shalin)
- CollectionAdmin requests in SolrJ to support V2 calls [SOLR-10433](https://issues.apache.org/jira/browse/SOLR-10433) (noble)
- Adds support for HttpShardHandlerFactory.loadBalancerRequests(MinimumAbsolute|MaximumFraction) configuration. [SOLR-10479](https://issues.apache.org/jira/browse/SOLR-10479) (Ramsey Haddad) (Daniel Collins) (Christine Poerschke)
- JSON Facet API: Implement support for single-valued string fields for min/max aggregations. [SOLR-10547](https://issues.apache.org/jira/browse/SOLR-10547) (yonik)
- New _default config set replacing basic_configs and data_driven_schema_configs. [SOLR-10574](https://issues.apache.org/jira/browse/SOLR-10574) (Ishan Chattopadhyaya) (noble) (shalin) (hossman) (David Smiley) (janhoy) (Alexandre Rafalovitch)
- Add sql Streaming Expression [SOLR-10623](https://issues.apache.org/jira/browse/SOLR-10623) (Joel Bernstein)
- Add reverse Stream Evaluator [SOLR-10660](https://issues.apache.org/jira/browse/SOLR-10660) (Joel Bernstein)
- Add copyOf Stream Evaluator [SOLR-10661](https://issues.apache.org/jira/browse/SOLR-10661) (Joel Bernstein)
- Add length Stream Evaluator [SOLR-10662](https://issues.apache.org/jira/browse/SOLR-10662) (Joel Bernstein)
- Add distance Stream Evaluator [SOLR-10663](https://issues.apache.org/jira/browse/SOLR-10663) (Joel Bernstein)
- Add scale Stream Evaluator [SOLR-10664](https://issues.apache.org/jira/browse/SOLR-10664) (Joel Bernstein)
- Add rank transformation Stream Evaluator [SOLR-10666](https://issues.apache.org/jira/browse/SOLR-10666) (Joel Bernstein)
- Expose a diagnostics API to return nodes sorted by load in descending order and any policy violations. [SOLR-10677](https://issues.apache.org/jira/browse/SOLR-10677) (shalin)
- Add finddelay Stream Evaluator [SOLR-10684](https://issues.apache.org/jira/browse/SOLR-10684) (Joel Bernstein)
- Add copyOfRange Stream Evaluator [SOLR-10693](https://issues.apache.org/jira/browse/SOLR-10693) (Joel Bernstein)
- Add cumulative probability function [SOLR-10696](https://issues.apache.org/jira/browse/SOLR-10696) (Joel Bernstein)
- Add describe Stream Evaluator [SOLR-10724](https://issues.apache.org/jira/browse/SOLR-10724) (Joel Bernstein)
- Add knn Streaming Expression [SOLR-10731](https://issues.apache.org/jira/browse/SOLR-10731) (Joel Bernstein)
- Add sequence StreamEvaluator [SOLR-10743](https://issues.apache.org/jira/browse/SOLR-10743) (Joel Bernstein)
- Allow /stream handler to execute Stream Evaluators directly [SOLR-10747](https://issues.apache.org/jira/browse/SOLR-10747) (Joel Bernstein)
- Add array Stream Evaluator [SOLR-10753](https://issues.apache.org/jira/browse/SOLR-10753) (Joel Bernstein)
- Add hist Stream Evaluator [SOLR-10754](https://issues.apache.org/jira/browse/SOLR-10754) (Joel Bernstein)
- Add anova Stream Evaluator [SOLR-10765](https://issues.apache.org/jira/browse/SOLR-10765) (Joel Bernstein)
- Add movingAvg Stream Evaluator [SOLR-10767](https://issues.apache.org/jira/browse/SOLR-10767) (Joel Bernstein)
- Add arraySort Stream Evaluator [SOLR-10813](https://issues.apache.org/jira/browse/SOLR-10813) (Joel Bernstein)
- Add support for PointFields to {!graphTerms} query that is internally used by some graph traversal streaming expressions. [SOLR-10845](https://issues.apache.org/jira/browse/SOLR-10845) (yonik)
- MoreLikeThisComponent should expose setMaxDocFreqPct (maxDoc frequency percentage). [SOLR-10849](https://issues.apache.org/jira/browse/SOLR-10849) (Dawid Weiss)
- Add support for PointsFields to {!join} query. Joined fields should also have docValues enabled. [SOLR-10939](https://issues.apache.org/jira/browse/SOLR-10939) (yonik)
- Add support for PointFields for {!graph} query. [SOLR-11093](https://issues.apache.org/jira/browse/SOLR-11093) (yonik)
- TermsComponent support for Points fields. [SOLR-11173](https://issues.apache.org/jira/browse/SOLR-11173) (yonik)
- concat(...) function query [SOLR-3702](https://issues.apache.org/jira/browse/SOLR-3702) (Andrey Kudryavtsev) (Mikhail Khludnev)
- Possible to set solr.data.home property as root dir for all data [SOLR-6671](https://issues.apache.org/jira/browse/SOLR-6671) (janhoy) (Shawn Heisey) (Mark Miller)
- Refinement for JSON Facet API: Adding refine:true to any terms facet will cause an additional distributed search phase (overlapped with field retrieval) that requests additional info for top facet buckets from shards that did not previously contribute to that bucket. This will correct counts (and other statistics) for those top buckets collected in the first phase. [SOLR-7452](https://issues.apache.org/jira/browse/SOLR-7452) (yonik)
- Data driven schema now indexes text field "foo" as both "foo" (text_general) and as "foo_str" (string) to facilitate both search and faceting. AddSchemaFieldsUpdateProcessor now has the ability to add a "copyField" to the type mappings, with an optional maxChars limitation. You can also define one typeMappings as default. This also solves issues SOLR-8495, SOLR-6966, and SOLR-7058 [SOLR-9526](https://issues.apache.org/jira/browse/SOLR-9526) [SOLR-8495](https://issues.apache.org/jira/browse/SOLR-8495) [SOLR-6966](https://issues.apache.org/jira/browse/SOLR-6966) [SOLR-7058](https://issues.apache.org/jira/browse/SOLR-7058) (janhoy) (Steve Rowe) (hossman) (Alexandre Rafalovitch) (Shawn Heisey) (Cao Manh Dat)
- Create another replication mode for SolrCloud [SOLR-9835](https://issues.apache.org/jira/browse/SOLR-9835) 
- Collect aggregated metrics from nodes and shard leaders in overseer. [SOLR-9857](https://issues.apache.org/jira/browse/SOLR-9857) [SOLR-9858](https://issues.apache.org/jira/browse/SOLR-9858) (ab)
- Add solr/solr.cmd parameter to append jetty parameters to the start script. [SOLR-9910](https://issues.apache.org/jira/browse/SOLR-9910) (Mano Kovacs) (Mark Miller)
- Add support for PointFields in FacetModule (JSON Facets) [SOLR-9989](https://issues.apache.org/jira/browse/SOLR-9989) (Cao Manh Dat)

### Changed (8 changes)

- JSON Facet API: When a field/terms facet will retrieve all buckets (i.e. limit:-1) and there are no nested facets, aggregations are computed in the first collection phase so that the second phase which would normally involve calculating the domain for the bucket can be skipped entirely, leading to large performance improvements. [SOLR-10634](https://issues.apache.org/jira/browse/SOLR-10634) (yonik)
- Speed up Solr's use of the UnifiedHighlighter be re-using FieldInfos. [SOLR-10722](https://issues.apache.org/jira/browse/SOLR-10722) (David Smiley)
- Avoid polluting the filter cache for certain types of faceting (typically ranges) when the base docset is empty. [SOLR-10727](https://issues.apache.org/jira/browse/SOLR-10727) (David Smiley)
- Make docValues range queries behave the same as Trie/Point fields for Double/Float Infinity cases [SOLR-11070](https://issues.apache.org/jira/browse/SOLR-11070) (Tomás Fernández Löbbe) (Andrey Kudryavtsev)
- Move to non deprecated HttpClient impl classes to remove stale connection check on every request and move connection lifecycle management towards the client. [SOLR-4509](https://issues.apache.org/jira/browse/SOLR-4509) (Ryan Zezeski) (Mark Miller) (Shawn Heisey) (Steve Davids)
- Rename SOLR_AUTHENTICATION_CLIENT_CONFIGURER -&gt; SOLR_AUTHENTICATION_CLIENT_BUILDER [SOLR-9255](https://issues.apache.org/jira/browse/SOLR-9255) (janhoy)
- Make Solr's SchemaField implement Lucene's IndexableFieldType, removing the creation of a Lucene FieldType every time a field is indexed. [SOLR-9579](https://issues.apache.org/jira/browse/SOLR-9579) (John Call) (yonik)
- JSON Facet API: Recover performance lost due to the DocValues transition to an iterator API (LUCENE-7407). This only fixes calculating counts for single-valued string fields from the FieldCache, resulting in up to 56% better throughput for those cases. [SOLR-9822](https://issues.apache.org/jira/browse/SOLR-9822) [LUCENE-7407](https://issues.apache.org/jira/browse/LUCENE-7407) (yonik)

### Fixed (54 changes)

- Ensure that ConfigSets created via API are mutable. [SOLR-10137](https://issues.apache.org/jira/browse/SOLR-10137) (Hrishikesh) (Mark Miller)
- Allow running examples as root on Linux with -force option [SOLR-10223](https://issues.apache.org/jira/browse/SOLR-10223) (janhoy)
- TestSQLHandler reproducible failure: No match found for function signature min(&lt;NUMERIC&gt;) [SOLR-10353](https://issues.apache.org/jira/browse/SOLR-10353) (Kevin Risden)
- Solr HDFS snapshot export fails due to FileNotFoundException error when using MR1 instead of yarn. [SOLR-10360](https://issues.apache.org/jira/browse/SOLR-10360) (Hrishikesh) (Mark Miller)
- v2 API introspect response contains multiple copies of the experimental format WARNING [SOLR-10405](https://issues.apache.org/jira/browse/SOLR-10405) (Cao Manh Dat)
- v2 API introspect should return useful message for non-existent command [SOLR-10408](https://issues.apache.org/jira/browse/SOLR-10408) (Cao Manh Dat)
- v2 Collection API "modify" command specification's replicationFactor property is incorrectly typed as string, should be integer [SOLR-10411](https://issues.apache.org/jira/browse/SOLR-10411) (Cao Manh Dat)
- v2 API: many API command specification properties are typed "number" but should instead be typed "integer" [SOLR-10412](https://issues.apache.org/jira/browse/SOLR-10412) (Steve Rowe) (Cao Manh Dat)
- v2 API: parsed JSON type should be coerced to expected type [SOLR-10413](https://issues.apache.org/jira/browse/SOLR-10413) (Cao Manh Dat) (Noble Paul)
- Fix memory leak (upon collection reload or ZooKeeper session expiry) in ZkIndexSchemaReader. [SOLR-10506](https://issues.apache.org/jira/browse/SOLR-10506) (Torsten Bøgh Köster) (Christine Poerschke) (Jörg Rathlev) (Mike Drob)
- StreamHandler should allow connections to be closed early [SOLR-10698](https://issues.apache.org/jira/browse/SOLR-10698) (Joel Bernstein) (Varun Thacker) (Erick Erickson)
- REPLACENODE may cause data loss when replicationFactor is 1. [SOLR-10704](https://issues.apache.org/jira/browse/SOLR-10704) (ab) (shalin)
- /v2/ should not be an alias for /v2/collections [SOLR-10715](https://issues.apache.org/jira/browse/SOLR-10715) (Cao Manh Dat)
- Creating a core.properties fails if the parent of core.properties is a symlinked dierctory [SOLR-10719](https://issues.apache.org/jira/browse/SOLR-10719) (Erick Erickson)
- JSON Facet API: resize() implemented incorrectly for CountSlotAcc, HllAgg.NumericAcc resulting in exceptions when using a hashing faceting method and sorting by hll(numeric_field). [SOLR-10723](https://issues.apache.org/jira/browse/SOLR-10723) (yonik)
- Admin UI replication tab sometimes empty when failed replications [SOLR-10763](https://issues.apache.org/jira/browse/SOLR-10763) (janhoy) (Bojan Vitnik)
- fix NPE ExactSharedStatsCache, fixing maxdocs skew for terms which are absent at one of shards when using one of Exact*StatsCache [SOLR-10824](https://issues.apache.org/jira/browse/SOLR-10824) (Mikhail Khludnev)
- Fix CloudSolrClient to expand the collection parameter correctly [SOLR-10826](https://issues.apache.org/jira/browse/SOLR-10826) (Tim Owen) (Varun Thacker)
- Fixed IndexSchema to enforce that uniqueKey can not be Points based for correctness [SOLR-10829](https://issues.apache.org/jira/browse/SOLR-10829) (hossman)
- Solr now correctly enforces that the '_root_' field has the same fieldType as the uniqueKey field. With out this enforcement, child document updating was unreliable. [SOLR-10830](https://issues.apache.org/jira/browse/SOLR-10830) (hossman)
- Fixed VersionInfo.getMaxVersionFromIndex when using PointsField with indexed="true" [SOLR-10832](https://issues.apache.org/jira/browse/SOLR-10832) (hossman)
- Point numeric fields should throw SolrException(BAD_REQUEST) for malformed numbers in queries. Trie numeric fields should throw SolrException(BAD_REQUEST) for malformed docValues range queries. [SOLR-10833](https://issues.apache.org/jira/browse/SOLR-10833) (hossman) (Tomás Fernández Löbbe)
- Add support for point fields in Export Handler [SOLR-10835](https://issues.apache.org/jira/browse/SOLR-10835) (Tomás Fernández Löbbe)
- The query parsers igain, significantTerms, and tlogit (used by streaming expressions by the same name) might throw a NullPointerException if the referenced field had no indexed data in some shards. The fix included an optimization to use Solr's cached AtomicReader instead of re-calculating. [SOLR-10836](https://issues.apache.org/jira/browse/SOLR-10836) (David Smiley)
- Regression in loading runtime UpdateRequestProcessors like TemplateUpdateProcessorFactory [SOLR-10876](https://issues.apache.org/jira/browse/SOLR-10876) (noble)
- MOVEREPLICA command may lose data when replicationFactor is 1. [SOLR-10878](https://issues.apache.org/jira/browse/SOLR-10878) (ab) (shalin)
- DELETEREPLICA and DELETENODE commands should prevent data loss when replicationFactor is 1. [SOLR-10879](https://issues.apache.org/jira/browse/SOLR-10879) (ab)
- Using V2Request.process(solrClient) method throws NPE if the API returns an error [SOLR-10886](https://issues.apache.org/jira/browse/SOLR-10886) (Cao Manh Dat)
- RecoveryStrategy's sendPrepRecoveryCmd can get stuck for 5 minutes if leader is unloaded. [SOLR-10914](https://issues.apache.org/jira/browse/SOLR-10914) (shalin)
- Work around the static Lucene BooleanQuery.maxClauseCount that causes Solr's maxBooleanClauses setting behavior to be "last core wins". This patch sets BooleanQuery.maxClauseCount to its maximum value, thus disabling the global check, and replaces it with specific checks where desired via QueryUtils.build(). [SOLR-10921](https://issues.apache.org/jira/browse/SOLR-10921) (yonik)
- Fix extraction component to treat DatePointField the same as TrieDateField [SOLR-10948](https://issues.apache.org/jira/browse/SOLR-10948) (hossman)
- Fix example json in MultipleAdditiveTreesModel javadocs. [SOLR-10963](https://issues.apache.org/jira/browse/SOLR-10963) (Stefan Langenmaier) (Christine Poerschke)
- Fix DOWNNODE -&gt; queue-work explosion [SOLR-10983](https://issues.apache.org/jira/browse/SOLR-10983) (Scott Blum) (Joshua Humphries)
- Next button in Solr admin UI for collection list pagination does not work. [SOLR-11039](https://issues.apache.org/jira/browse/SOLR-11039) (janhoy)
- MoveReplicaCmd do not specify ulog dir in case of HDFS [SOLR-11041](https://issues.apache.org/jira/browse/SOLR-11041) (Cao Manh Dat)
- Fix facet.range.method=dv and interval facets on single-valued float fields with negative values. [SOLR-11043](https://issues.apache.org/jira/browse/SOLR-11043) (Tomás Fernández Löbbe) (Steve Rowe)
- The new replica created by MoveReplica will have to have same name and coreName as the old one in case of HDFS [SOLR-11045](https://issues.apache.org/jira/browse/SOLR-11045) (Cao Manh Dat)
- Fix overflow in point range queries when querying the type limits (e.g. q=field_i:{Integer.MAX_VALUE TO Integer.MAX_VALUE]) [SOLR-11057](https://issues.apache.org/jira/browse/SOLR-11057) (Tomás Fernández Löbbe)
- Fix overflow in interval faceting when querying Long limits (e.g. (Long.MAX_VALUE TO Long.MAX_VALUE]) [SOLR-11073](https://issues.apache.org/jira/browse/SOLR-11073) (Tomás Fernández Löbbe)
- V2Request in SolrJ should return the correct collection name so that the request is forwarded to the correct node [SOLR-11130](https://issues.apache.org/jira/browse/SOLR-11130) (noble)
- Fix solrj XMLResponseParser when nested docs transformer is used with indented XML [SOLR-11136](https://issues.apache.org/jira/browse/SOLR-11136) (hossman)
- SolrInfoMBeanHandler.getDiff() ADD case non-functional: NPE when a bean value goes from null -&gt; non-null. [SOLR-11151](https://issues.apache.org/jira/browse/SOLR-11151) (Steve Rowe)
- Child documents' return fields now include useDocValuesAsStored fields [SOLR-11154](https://issues.apache.org/jira/browse/SOLR-11154) (Mohammed Sheeri Shaketi Nauage via Ishan Chattopadhyaya)
- Fix contrib/ltr Normalizer persistence after solr core reload or restart. [SOLR-11163](https://issues.apache.org/jira/browse/SOLR-11163) (Yuki Yano) (Christine Poerschke)
- A split shard failure on IOException should be logged [SOLR-11182](https://issues.apache.org/jira/browse/SOLR-11182) (Varun Thacker)
- downconfig downloads empty file as folder [SOLR-11198](https://issues.apache.org/jira/browse/SOLR-11198) (Erick Erickson)
- SolrJmxReporter broken on core reload. This resulted in some or most metrics not being reported via JMX after core reloads, depending on timing. [SOLR-11221](https://issues.apache.org/jira/browse/SOLR-11221) (ab)
- Some SolrCore metrics should check if core is closed before reporting. [SOLR-11235](https://issues.apache.org/jira/browse/SOLR-11235) (ab)
- Replica Placement rules are ignored if a cluster policy exists. [SOLR-11243](https://issues.apache.org/jira/browse/SOLR-11243) (shalin)
- AtomicUpdateProcessor complains missing UpdateLog [SOLR-11268](https://issues.apache.org/jira/browse/SOLR-11268) (noble) (Ishan Chattopadhyaya)
- CloudSolrClient's ZK state version check with the server was ignored when handleSelect=false [SOLR-6807](https://issues.apache.org/jira/browse/SOLR-6807) (David Smiley)
- Fix bin/solr.cmd so it can run properly on Java 9 [SOLR-8689](https://issues.apache.org/jira/browse/SOLR-8689) (Uwe Schindler) (hossman)
- Connection and read timeouts are being ignored by UpdateShardHandler after SOLR-4509. [SOLR-9262](https://issues.apache.org/jira/browse/SOLR-9262) [SOLR-4509](https://issues.apache.org/jira/browse/SOLR-4509) (Mark Miller) (shalin)
- Fix 55% performance regression of FieldCache uninvert time of numeric fields. [SOLR-9837](https://issues.apache.org/jira/browse/SOLR-9837) (yonik)

### Other (89 changes)

- Allow CharTokenizer-derived tokenizers and KeywordTokenizer to configure the max token length. [LUCENE-7705](https://issues.apache.org/jira/browse/LUCENE-7705) (Amrit Sarkar) (Erick Erickson)
- Correct copyright year(s) in solr/LICENSE.txt file. [LUCENE-7852](https://issues.apache.org/jira/browse/LUCENE-7852) (Christine Poerschke) (Steve Rowe)
- Solr no longer uses the context class loader when resolving resources, they are only resolved against Solr's own or "core" class loader by default. [LUCENE-7883](https://issues.apache.org/jira/browse/LUCENE-7883) (Uwe Schindler)
- When attempting to facet with facet.mincount=0 over points fields, raise mincount to 1 and log a warning. [SOLR-10033](https://issues.apache.org/jira/browse/SOLR-10033) (Steve Rowe)
- Delete old deprecated Admin UI, leaving the AngularJS UI the only one supported [SOLR-10042](https://issues.apache.org/jira/browse/SOLR-10042) (janhoy)
- Removed FieldType.getNumericType(). Use getNumberType() instead. [SOLR-10236](https://issues.apache.org/jira/browse/SOLR-10236) (Tomás Fernández Löbbe)
- By default, stop splitting on whitespace prior to analysis in edismax and standard/"lucene" query parsers. [SOLR-10310](https://issues.apache.org/jira/browse/SOLR-10310) (Steve Rowe)
- Removed index level boost support from "documents" section of the admin UI [SOLR-10347](https://issues.apache.org/jira/browse/SOLR-10347) (Amrit Sarkar via Tomás Fernández Löbbe)
- Clicking Solr logo on AdminUI shows blank page [SOLR-10378](https://issues.apache.org/jira/browse/SOLR-10378) (Takumi Yoshida) (janhoy)
- Replace (instanceof TrieFooField || instanceof FooPointField) constructs with FieldType.getNumberType() or SchemaField.getSortField() where appropriate. [SOLR-10400](https://issues.apache.org/jira/browse/SOLR-10400) (hossman) (Steve Rowe)
- RecoveryStrategy is now a Runnable instead of a Thread. [SOLR-10414](https://issues.apache.org/jira/browse/SOLR-10414) (Tomás Fernández Löbbe)
- Expose safe system properties via metrics API as 'system.properties' in 'solr.jvm' group. Add support for selecting specific properties from any compound metric using 'property' parameter to /admin/metrics handler. [SOLR-10418](https://issues.apache.org/jira/browse/SOLR-10418) (ab)
- All collection APIs should use the new Policy framework for replica placement. [SOLR-10419](https://issues.apache.org/jira/browse/SOLR-10419) (Noble Paul) (shalin)
- Assign explicit useDocValuesAsStored values to all points field types in schema-point.xml/TestPointFields. [SOLR-10438](https://issues.apache.org/jira/browse/SOLR-10438) (hossman) (Steve Rowe)
- Deprecate timeout related setters from SolrClients, and replace with Builder based implementation [SOLR-10456](https://issues.apache.org/jira/browse/SOLR-10456) (Jason Gerlowski) (Anshum Gupta)
- Make default response format JSON (wt=json), and also indent text responses formats (indent=on) by default [SOLR-10494](https://issues.apache.org/jira/browse/SOLR-10494) (Trey Grainger & Cassandra Targett) (hossman)
- Test sortMissing{First,Last} with points fields. [SOLR-10501](https://issues.apache.org/jira/browse/SOLR-10501) (Steve Rowe)
- Deprecate CurrencyField in favor of new CurrencyFieldType, which works with point fields and provides control over dynamic fields used for the raw amount and currency code sub-fields. [SOLR-10503](https://issues.apache.org/jira/browse/SOLR-10503) [SOLR-10502](https://issues.apache.org/jira/browse/SOLR-10502) (hossman) (Steve Rowe)
- Make "compact" format default for /admin/metrics. [SOLR-10557](https://issues.apache.org/jira/browse/SOLR-10557) (ab)
- We'll now always throw an exception if defaultOperator is found in schema. This config has been deprecated since 3.6, and enforced for new configs since 6.6 [SOLR-10584](https://issues.apache.org/jira/browse/SOLR-10584) (janhoy)
- We'll now always throw an exception if defaultSearchField is found in schema. This config has been deprecated since 3.6, and enforced for new configs since 6.6 [SOLR-10585](https://issues.apache.org/jira/browse/SOLR-10585) (janhoy) (David Smiley)
- JDBCStream accepts columns of type TIME, DATE & TIMESTAMP as well as CLOBs and decimal numeric types [SOLR-10617](https://issues.apache.org/jira/browse/SOLR-10617) (James Dyer)
- Move the V1 &lt;-&gt; V2 API mapping to SolrJ [SOLR-10647](https://issues.apache.org/jira/browse/SOLR-10647) (noble)
- Remove ResponseBuilder.getSortSpec use in SearchGroupShardResponseProcessor. [SOLR-10659](https://issues.apache.org/jira/browse/SOLR-10659) (Judith Silverman) (Christine Poerschke)
- Add abstract doInit method to the SolrMetricReporter base class. [SOLR-10671](https://issues.apache.org/jira/browse/SOLR-10671) (Christine Poerschke) (Anshum Gupta)
- Deprecated and converted the PostingsSolrHighlighter to extend UnifiedSolrHighlighter and thus no longer use the PostingsHighlighter. It should behave mostly the same. [SOLR-10700](https://issues.apache.org/jira/browse/SOLR-10700) (David Smiley)
- Fix LTR failing tests. [SOLR-10710](https://issues.apache.org/jira/browse/SOLR-10710) (Diego Ceccarelli) (Tomás Fernández Löbbe)
- Ignore .pid and .out files in solr working directory [SOLR-10713](https://issues.apache.org/jira/browse/SOLR-10713) (Jason Gerlowski) (Mike Drob)
- Factor out createSliceShardsStr method from HttpShardHandler.prepDistributed. [SOLR-10741](https://issues.apache.org/jira/browse/SOLR-10741) (Domenico Fabio Marino) (Christine Poerschke)
- Update noggit to newer version (0.8) [SOLR-10744](https://issues.apache.org/jira/browse/SOLR-10744) (noble)
- replicationFactor (nrtReplicas) default is 0 if tlogReplicas is specified when creating a collection [SOLR-10752](https://issues.apache.org/jira/browse/SOLR-10752) (Tomás Fernández Löbbe)
- delete/refactor many solrj deprecations [SOLR-10755](https://issues.apache.org/jira/browse/SOLR-10755) (hossman)
- Undeprecate ZkStateReader.updateClusterState(), mark as @lucene.internal, and rename to forciblyRefreshAllClusterStateSlow(). [SOLR-10756](https://issues.apache.org/jira/browse/SOLR-10756) (hossman) (shalin) (Steve Rowe)
- delete/refactor/cleanup CollectionAdminRequest deprecations [SOLR-10757](https://issues.apache.org/jira/browse/SOLR-10757) (hossman)
- Remove trie field types and fields from example schemas. [SOLR-10760](https://issues.apache.org/jira/browse/SOLR-10760) [SOLR-11315](https://issues.apache.org/jira/browse/SOLR-11315) [SOLR-11313](https://issues.apache.org/jira/browse/SOLR-11313) (Steve Rowe)
- Switch trie numeric/date fields to points in data-driven-enabled example and test schemas. [SOLR-10761](https://issues.apache.org/jira/browse/SOLR-10761) (Steve Rowe)
- AutoScalingHandler should validate policy and preferences before updating zookeeper. [SOLR-10764](https://issues.apache.org/jira/browse/SOLR-10764) (shalin)
- JavaBinCodec should use close consistently rather than having marshal() and close() call finish() (which closes the underlying stream). [SOLR-10779](https://issues.apache.org/jira/browse/SOLR-10779) (Erick Erickson)
- Improve error handling and tests for Snitch and subclasses and general cleanups. [SOLR-10782](https://issues.apache.org/jira/browse/SOLR-10782) (Noble Paul) (shalin)
- Fix warnings in Assign.java and ReplicaAssigner.java classes. [SOLR-10790](https://issues.apache.org/jira/browse/SOLR-10790) (Christine Poerschke)
- Remove deprecated options in SSLTestConfig [SOLR-10791](https://issues.apache.org/jira/browse/SOLR-10791) (hossman)
- Deprecate and remove implicit registration of "lucenePlusSort" aka OldLuceneQParser [SOLR-10792](https://issues.apache.org/jira/browse/SOLR-10792) (hossman)
- BlobHandler should have a well-known permission name [SOLR-10793](https://issues.apache.org/jira/browse/SOLR-10793) (noble)
- TestPointFields: increase randomized testing of non-trivial values. [SOLR-10796](https://issues.apache.org/jira/browse/SOLR-10796) (Steve Rowe)
- Extracted functionality to collect eligible replicas from HttpShardHandler.prepDistributed() to a new method [SOLR-10799](https://issues.apache.org/jira/browse/SOLR-10799) (Domenico Fabio Marino) (Tomás Fernández Löbbe)
- Factor out HttpShardHandler.transformReplicasToShardUrls from HttpShardHandler.prepDistributed. [SOLR-10800](https://issues.apache.org/jira/browse/SOLR-10800) (Domenico Fabio Marino) (Christine Poerschke)
- Remove several deprecated methods that were exposed to plugin writers [SOLR-10801](https://issues.apache.org/jira/browse/SOLR-10801) (hossman)
- Mark all Trie/LegacyNumeric based fields @deprecated in Solr7. [SOLR-10803](https://issues.apache.org/jira/browse/SOLR-10803) (Steve Rowe)
- Randomize Points based numeric field types in all existing tests & test schemas where Trie numerics were previously hardcoded. [SOLR-10807](https://issues.apache.org/jira/browse/SOLR-10807) (hossman) (Steve Rowe) (Anshum Gupta)
- Ref guide documentation for Autoscaling [SOLR-10821](https://issues.apache.org/jira/browse/SOLR-10821) (Noble Paul) (Cassandra Targett) (shalin)
- Add reporting period to SolrMetricReporter base class. [SOLR-10823](https://issues.apache.org/jira/browse/SOLR-10823) (Christine Poerschke)
- Fixed tests and test configs to stop using numeric uniqueKey fields [SOLR-10834](https://issues.apache.org/jira/browse/SOLR-10834) (hossman)
- ExternalFileField/FloatFieldSource should throw a clear exception on initialization with a Points-based keyField, which is not supported. [SOLR-10846](https://issues.apache.org/jira/browse/SOLR-10846) (hossman) (Steve Rowe)
- Provide a clear exception when attempting to use the terms component with points fields. [SOLR-10847](https://issues.apache.org/jira/browse/SOLR-10847) (hossman) (Steve Rowe)
- SolrClients should clarify expectations for solrServerUrl parameter [SOLR-10851](https://issues.apache.org/jira/browse/SOLR-10851) (Jason Gerlowski) (Tomás Fernández Löbbe)
- Simplified how Trie vs Points based numerics are randomized by SolrTestCaseJ4 by adding a static option to PointsField to ignore 'precisionStep' attribute. This change also begins to attempt to randomize 'docValues' on numeric field types unless tests explicity enable/disable them. [SOLR-10864](https://issues.apache.org/jira/browse/SOLR-10864) (hossman) (Steve Rowe)
- Ref guide: Escape replacement substitutions, e.g. =&gt; to right arrow, so that they are rendered visibly in the PDF. Also add .adoc file checks to the top-level validate target, including for the invisible substitutions PDF problem. [SOLR-10883](https://issues.apache.org/jira/browse/SOLR-10883) (Steve Rowe)
- BBoxField should support point-based number sub-fields. [SOLR-10891](https://issues.apache.org/jira/browse/SOLR-10891) (Steve Rowe)
- Fix SOLR-10898 to not deterministicly fail 1/512 runs [SOLR-10898](https://issues.apache.org/jira/browse/SOLR-10898) (hossman)
- Make builder based SolrClient constructors to be the only valid way to construct client objects and increase the visibility of builder elements to be protected so extending the builder, and the clients is possible. [SOLR-10915](https://issues.apache.org/jira/browse/SOLR-10915) (Jason Gerlowski) (Anshum Gupta)
- ord & rord functions give confusing errors with PointFields. [SOLR-10919](https://issues.apache.org/jira/browse/SOLR-10919) (hossman) (Steve Rowe)
- Increase the odds of randomly choosing point fields in our SolrTestCaseJ4 numeric type randomization. [SOLR-10926](https://issues.apache.org/jira/browse/SOLR-10926) (hossman) (Steve Rowe)
- Removed unused 'valType' option from ExternalFileField [SOLR-10929](https://issues.apache.org/jira/browse/SOLR-10929) (hossman)
- Cleanup the default configset. The changes involve some documentation corrections, removing the currency field from the examples and a few dynamic fields [SOLR-10967](https://issues.apache.org/jira/browse/SOLR-10967) (Varun Thacker)
- Consolidate SolrClient builder code in an abstract base class [SOLR-11004](https://issues.apache.org/jira/browse/SOLR-11004) (Jason Gerlowski) (Anshum Gupta)
- Fix TestCloudJSONFacetJoinDomain test-only bug [SOLR-11016](https://issues.apache.org/jira/browse/SOLR-11016) (hossman)
- The elevate.xml config-file is made optional in the ElevationComponent. The default configset doesn't ship with a elevate.xml file anymore [SOLR-11021](https://issues.apache.org/jira/browse/SOLR-11021) (Varun Thacker)
- Added EnumFieldType, a non-Trie-based version of EnumField, and deprecated EnumField in favor of EnumFieldType. [SOLR-11023](https://issues.apache.org/jira/browse/SOLR-11023) (hossman) (Steve Rowe)
- Separately report disk space metrics for solr.data.home and core root directory. [SOLR-11036](https://issues.apache.org/jira/browse/SOLR-11036) (ab)
- Refactor to provide NodeConfig.getSolrDataHome internal API. [SOLR-11037](https://issues.apache.org/jira/browse/SOLR-11037) (ab) (janhoy) (shalin)
- Add random range query test that compares results across Trie*, *Point and DocValue-only fields [SOLR-11056](https://issues.apache.org/jira/browse/SOLR-11056) (Tomás Fernández Löbbe)
- MOVEREPLICA and REPLACENODE API parameter names are now 'sourceNode' and 'targetNode'. The old names viz. 'fromNode' for MOVEREPLICA and 'source', 'target' for REPLACENODE have been deprecated. [SOLR-11068](https://issues.apache.org/jira/browse/SOLR-11068) (shalin)
- Fix sporadic failures of MetricsHandlerTest.testPropertyFilter on jenkins [SOLR-11088](https://issues.apache.org/jira/browse/SOLR-11088) (shalin)
- Switch from Trie to Points field types in the .system collection schema. [SOLR-11119](https://issues.apache.org/jira/browse/SOLR-11119) (Steve Rowe)
- /analysis/field and /analysis/document requests should support points fields. [SOLR-11155](https://issues.apache.org/jira/browse/SOLR-11155) (Jason Gerlowski) (Steve Rowe)
- Change error handling in AutoScalingHandler to be consistent w/ other APIs [SOLR-11178](https://issues.apache.org/jira/browse/SOLR-11178) (noble)
- V2 APIs are now available at /api endpoint. [SOLR-11183](https://issues.apache.org/jira/browse/SOLR-11183) (Ishan Chattopadhyaya)
- A special value of -1 can be specified for 'maxShardsPerNode' to denote that there is no limit. The bin/solr script send maxShardsPerNode=-1 when creating collections. The use of maxShardsPerNode is not supported when a cluster policy is in effect or when a collection specific policy is specified during collection creation. [SOLR-11239](https://issues.apache.org/jira/browse/SOLR-11239) (Noble Paul) (shalin)
- Upgrade to Hadoop 2.7.4 to fix incompatibility with Java 9. [SOLR-11261](https://issues.apache.org/jira/browse/SOLR-11261) [SOLR-10966](https://issues.apache.org/jira/browse/SOLR-10966) (Uwe Schindler)
- Clean up mention of trie fields in documentation and source comments. [SOLR-11324](https://issues.apache.org/jira/browse/SOLR-11324) (Steve Rowe)
- eDismax lowercaseOperators now defaults to "false" for luceneMatchVersion &gt;= 7.0.0 [SOLR-4646](https://issues.apache.org/jira/browse/SOLR-4646) (janhoy) (David Smiley)
- Changed requestDispatcher's handleSelect to default to false, thus ignoring "qt". Simplified configs to not refer to handleSelect or "qt". Switch all tests that assumed true to assume false (added leading '/' in request handlers). Switch all tests referring to "standard" request handler to instead refer to "/select" with SearchHandler. Deprecated the old StandardRequestHandler. [SOLR-6807](https://issues.apache.org/jira/browse/SOLR-6807) (David Smiley)
- Set legacyCloud=false as default [SOLR-8256](https://issues.apache.org/jira/browse/SOLR-8256) (Cao Manh Dat)
- Improve RAMDirectory details in sample solrconfig files [SOLR-8437](https://issues.apache.org/jira/browse/SOLR-8437) (Mark Miller) (Varun Thacker)
- In solrconfig.xml remove &lt;mergePolicy&gt; (and related &lt;mergeFactor&gt; and &lt;maxMergeDocs&gt;) support in favor of the &lt;mergePolicyFactory&gt; element introduced by SOLR-8621 in Solr 5.5.0. [SOLR-8668](https://issues.apache.org/jira/browse/SOLR-8668) [SOLR-8621](https://issues.apache.org/jira/browse/SOLR-8621) (Christine Poerschke) (hossman)
- return child docs in DIH debug [SOLR-8762](https://issues.apache.org/jira/browse/SOLR-8762) (Gopikannan Venugopalsamy) (Mikhail Khludnev)
- Remove deprecated methods of ClusterState. [SOLR-9321](https://issues.apache.org/jira/browse/SOLR-9321) (Jason Gerlowski) (ishan) (Cao Manh Dat)
- Disable remote streaming in example configs by default. Adjust Upload Limit defaults [SOLR-9623](https://issues.apache.org/jira/browse/SOLR-9623) (janhoy) (yonik)
- SolrInfoMBean category and hierarchy cleanup. Per-component statistics are now obtained from the metrics API, legacy JMX support has been replaced with SolrJmxReporter functionality. Several reporter improvements (support for multiple prefix filters, "enabled" flag, reuse of service clients). [SOLR-9959](https://issues.apache.org/jira/browse/SOLR-9959) (ab)


[6.6.6] - 2018-04-05
--------------------

### Other (1 change)

- Lucene only release 


[6.6.5] - 2018-06-03
--------------------

### Added (1 change)

- Ability to disable configset upload via -Dconfigset.upload.enabled=false startup parameter [SOLR-12530](https://issues.apache.org/jira/browse/SOLR-12530) (Ishan Chattopadhyaya)

### Fixed (1 change)

- Don't allow referal to external resources in various config files (CVE-2018-8026). [SOLR-12450](https://issues.apache.org/jira/browse/SOLR-12450) (Yuyang Xiao) (Uwe Schindler)


[6.6.4] - 2018-05-18
--------------------

### Fixed (1 change)

- Do not allow to use absolute URIs for including other files in solrconfig.xml and schema parsing. [SOLR-12316](https://issues.apache.org/jira/browse/SOLR-12316) (Ananthesh) (Ishan Chattopadhyaya) (Uwe Schindler)


[6.6.3] - 2018-03-07
--------------------

### Fixed (3 changes)

- Collections created with legacyCloud=true cannot be opened if legacyCloud=false [SOLR-11503](https://issues.apache.org/jira/browse/SOLR-11503) (Erick Erickson)
- Don't allow referal to external resources in DataImportHandler's dataConfig request parameter. [SOLR-11971](https://issues.apache.org/jira/browse/SOLR-11971) (麦 香浓郁) (Uwe Schindler)
- LeaderInitiatedRecoveryThread does not retry on UnknownHostException [SOLR-11993](https://issues.apache.org/jira/browse/SOLR-11993) (shalin) (Cao Manh Dat) (Steve Rowe)


[6.6.2] - 2017-10-18
--------------------

### Upgrade Notes (2 changes)

- in the XML query parser [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (defType=xmlparser or {!xmlparser ... })
- RunExecutableListener was deprecated and is disabled by default for security reasons. Legacy applications still using it must explicitely pass '-Dsolr.enableRunExecutableListener=true' to the Solr command line. Be aware that you should really disable API-based config editing at the same time, using '-Ddisable.configEdit=true'! [SOLR-11482](https://issues.apache.org/jira/browse/SOLR-11482) (Uwe Schindler)

### Fixed (2 changes)

- Message "Lock held by this virtual machine" during startup. Solr is trying to start some cores twice. [SOLR-11297](https://issues.apache.org/jira/browse/SOLR-11297) (Luiz Armesto) (Shawn Heisey) (Erick Erickson)
- Disallow resolving of external entities in the XML query parser (defType=xmlparser). [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (Michael Stepankin) (Olga Barinova) (Uwe Schindler) (Christine Poerschke)

### Other (1 change)

- Upgrade to Tika 1.16. [SOLR-10335](https://issues.apache.org/jira/browse/SOLR-10335) (Tim Allison) (Tomás Fernández Löbbe) (shalin)


[6.6.1] - 2017-09-07
--------------------

### Fixed (11 changes)

- Provide a way to know when Core Discovery is finished and when all async cores are done loading [SOLR-10721](https://issues.apache.org/jira/browse/SOLR-10721) (Erick Erickson)
- standalone Solr loads UNLOADed core on request [SOLR-10857](https://issues.apache.org/jira/browse/SOLR-10857) (Erick Erickson) (Mikhail Khludnev)
- CloudSolrStream.toExpression incorrectly handles fq clauses [SOLR-10908](https://issues.apache.org/jira/browse/SOLR-10908) (Rohit) (Erick Erickson)
- Clean up a few details left over from pluggable transient core and untangling CoreDescriptor/CoreContainer references [SOLR-10910](https://issues.apache.org/jira/browse/SOLR-10910) (Erick Erickson)
- ParallelStream should set the StreamContext when constructing SolrStreams [SOLR-11024](https://issues.apache.org/jira/browse/SOLR-11024) (Joel Bernstein)
- CDCR bootstrapping can get into an infinite loop when a core is reloaded [SOLR-11069](https://issues.apache.org/jira/browse/SOLR-11069) (Amrit Sarkar) (Erick Erickson)
- Creating a core should write a core.properties file first and clean up on failure [SOLR-11122](https://issues.apache.org/jira/browse/SOLR-11122) (Erick Erickson)
- CoreContainer.load needs to send lazily loaded core descriptors to the proper list rather than send them all to the transient lists. [SOLR-11177](https://issues.apache.org/jira/browse/SOLR-11177) (Erick Erickson)
- SolrJmxReporter broken on core reload. This resulted in some or most metrics not being reported via JMX after core reloads, depending on timing. [SOLR-11221](https://issues.apache.org/jira/browse/SOLR-11221) (ab)
- Exclude static html files in the partials directory from authentication and authorization checks. The UI will open correctly with kerberos enabled [SOLR-11228](https://issues.apache.org/jira/browse/SOLR-11228) (Ishan Chattopadhyaya) (Varun Thacker)
- Upgrade to Hadoop 2.7.4 to fix incompatibility with Java 9. [SOLR-11261](https://issues.apache.org/jira/browse/SOLR-11261) [SOLR-10966](https://issues.apache.org/jira/browse/SOLR-10966) (Uwe Schindler)


[6.6.0] - 2017-06-06
--------------------

### Upgrade Notes (3 changes)

- Solr contribs map-reduce, morphlines-core and morphlines-cell have been removed. 
- JSON Facet API now uses hyper-log-log for numBuckets cardinality calculation and calculates cardinality before filtering buckets by any mincount greater than 1. 
- ZooKeeper dependency has been upgraded from 3.4.6 to 3.4.10. 

### Added (36 changes)

- Hide keystore and truststore passwords from /admin/info/* outputs. [SOLR-10076](https://issues.apache.org/jira/browse/SOLR-10076) (Mano Kovacs) (Mark Miller)
- Variance and Standard Deviation aggregators for the JSON Facet API. Example: json.facet={x:"stddev(field1)", y:"variance(field2)"} [SOLR-10082](https://issues.apache.org/jira/browse/SOLR-10082) (Rustam Hashimov) (yonik)
- MOVEREPLICA API [SOLR-10239](https://issues.apache.org/jira/browse/SOLR-10239) (Cao Manh Dat) (Noble Paul) (shalin)
- The search Streaming Expression should work in non-SolrCloud mode [SOLR-10274](https://issues.apache.org/jira/browse/SOLR-10274) (Joel Bernstein)
- Adds CartesianProductStream which turns a single tuple with a multi-valued field into N tuples, one for each value in the multi-valued field. [SOLR-10292](https://issues.apache.org/jira/browse/SOLR-10292) (Dennis Gove)
- Add date/time Stream Evaluators [SOLR-10303](https://issues.apache.org/jira/browse/SOLR-10303) (Gethin James) (Dennis Gove) (Joel Bernstein)
- Add totalTermFreq support to TermsComponent. [SOLR-10349](https://issues.apache.org/jira/browse/SOLR-10349) (Shai Erera)
- Add analyze Stream Evaluator to support streaming NLP [SOLR-10351](https://issues.apache.org/jira/browse/SOLR-10351) (Joel Bernstein)
- Add shuffle Streaming Expression [SOLR-10426](https://issues.apache.org/jira/browse/SOLR-10426) (Joel Bernstein)
- Add ls command to ZkCLI for listing only sub-directories. [SOLR-10430](https://issues.apache.org/jira/browse/SOLR-10430) (Peter Szantai-Kis) (Mark Miller)
- CloudSolrClient can now be initialized using the base URL of a Solr instance instead of ZooKeeper hosts. This is possible through the use of newly introduced HttpClusterStateProvider. To fetch a list of collection aliases, this depends on LISTALIASES command, and hence this way of initializing CloudSolrClient would not work if you have collection aliases on older versions of Solr server that doesn't support LISTALIASES. [SOLR-10446](https://issues.apache.org/jira/browse/SOLR-10446) (Ishan Chattopadhyaya) (Noble Paul)
- Collections API now supports a LISTALIASES command to return a list of all collection aliases. [SOLR-10447](https://issues.apache.org/jira/browse/SOLR-10447) (Yago Riveiro) (Ishan Chattopadhyaya) (Mark Miller) (Steve Molloy) (Shawn Heisey) (Mike Drob) (janhoy)
- Add echo Streaming Expression [SOLR-10504](https://issues.apache.org/jira/browse/SOLR-10504) (Joel Bernstein)
- Add multi-field support to TermsComponent when requesting terms' statistics. [SOLR-10505](https://issues.apache.org/jira/browse/SOLR-10505) (Shai Erera)
- Core Admin status command to emit collection details of each core [SOLR-10507](https://issues.apache.org/jira/browse/SOLR-10507) (noble)
- Add eval Streaming Expression [SOLR-10516](https://issues.apache.org/jira/browse/SOLR-10516) (Joel Bernstein)
- introducing sort=childfield(field) asc for searching by {!parent} [SOLR-10521](https://issues.apache.org/jira/browse/SOLR-10521) (Mikhail Khludnev)
- stats Streaming Expression should work in non-SolrCloud mode [SOLR-10536](https://issues.apache.org/jira/browse/SOLR-10536) (Joel Bernstein)
- SolrJ: Added SolrParams.toLocalParamsString() and ClientUtils.encodeLocalParamVal. [SOLR-10537](https://issues.apache.org/jira/browse/SOLR-10537) (David Smiley)
- Add let, get and tuple Streaming Expressions [SOLR-10559](https://issues.apache.org/jira/browse/SOLR-10559) (Dennis Gove) (Joel Bernstein)
- Add timeseries Streaming Expression [SOLR-10566](https://issues.apache.org/jira/browse/SOLR-10566) (Joel Bernstein)
- Add Correlation Stream Evaluator [SOLR-10582](https://issues.apache.org/jira/browse/SOLR-10582) (Joel Bernstein)
- JSON Faceting now supports a query time 'join' domain change option [SOLR-10583](https://issues.apache.org/jira/browse/SOLR-10583) (hossman)
- Add regress and predict Stream Evaluators [SOLR-10622](https://issues.apache.org/jira/browse/SOLR-10622) (Joel Bernstein)
- Add convolution Stream Evaluator [SOLR-10625](https://issues.apache.org/jira/browse/SOLR-10625) (Joel Bernstein)
- Add covariance Stream Evaluator [SOLR-10626](https://issues.apache.org/jira/browse/SOLR-10626) (Joel Bernstein)
- Add normalize Stream Evaluator [SOLR-10638](https://issues.apache.org/jira/browse/SOLR-10638) (Joel Bernstein)
- Add payload support with payload() value source and {!payload_score} and {!payload_check} query parsers. [SOLR-1485](https://issues.apache.org/jira/browse/SOLR-1485) (Erik Hatcher)
- Adding support for uploading zipped configsets using ConfigSets API [SOLR-6736](https://issues.apache.org/jira/browse/SOLR-6736) (Varun Rajput) (Ishan Chattopadhyaya) (Noble Paul) (Anshum Gupta) (Gregory Chanan)
- Support for enabling basic authentication using bin/solr|bin/solr.cmd. [SOLR-8440](https://issues.apache.org/jira/browse/SOLR-8440) (Ishan Chattopadhyaya) (janhoy) (Noble Paul) (Hrishikesh Gadre)
- An Update Processor to convert normal update operation to an atomic operations such as add, set,inc, remove ,set, removeregex [SOLR-9530](https://issues.apache.org/jira/browse/SOLR-9530) (Amrit Sarkar) (noble)
- Add Solr support for SimpleTextCodec, via &lt;codecFactory class="solr.SimpleTextCodecFactory"/&gt; in solrconfig.xml (per-field specification in the schema is not possible). [SOLR-9596](https://issues.apache.org/jira/browse/SOLR-9596) (Steve Rowe)
- Allow configuration for recoveryExecutor thread pool size. [SOLR-9936](https://issues.apache.org/jira/browse/SOLR-9936) (Tim Owen) (Mark Miller)
- Add support for grouping with PointFIelds. [SOLR-9992](https://issues.apache.org/jira/browse/SOLR-9992) (Cao Manh Dat)
- Add support for ExpandComponent with PointFields. [SOLR-9993](https://issues.apache.org/jira/browse/SOLR-9993) (Cao Manh Dat)
- Add support for CollapseQParser with PointFields. [SOLR-9994](https://issues.apache.org/jira/browse/SOLR-9994) (Varun Thacker) (Cao Manh Dat)

### Changed (6 changes)

- facet.heatmap is now significantly faster when the docset (base query) matches everything and there are no deleted docs. It's also faster when the docset matches a small fraction of the index or none. [SOLR-10499](https://issues.apache.org/jira/browse/SOLR-10499) (David Smiley)
- Better ZkStateWriter batching [SOLR-10524](https://issues.apache.org/jira/browse/SOLR-10524) (Cao Manh Dat) (Noble Paul) (shalin) (Scott Blum)
- JSON Facet API now uses hyper-log-log++ for determining the number of buckets when merging requests from a multi-shard distributed request. [SOLR-10548](https://issues.apache.org/jira/browse/SOLR-10548) (yonik)
- Optimize using cache for DistributedQueue in case of single-consumer [SOLR-10619](https://issues.apache.org/jira/browse/SOLR-10619) (Cao Manh Dat) (Scott Blum)
- Add a static convenience method ModifiableSolrParams#of(SolrParams) which returns the same instance if it already is modifiable, otherwise creates a new ModifiableSolrParams instance. [SOLR-9184](https://issues.apache.org/jira/browse/SOLR-9184) (Jörg Rathlev) (Koji)
- Reduced heap consumption for filter({!join ... score=...}) [SOLR-9217](https://issues.apache.org/jira/browse/SOLR-9217) (Andrey Kudryavtsev) (Gopikannan Venugopalsamy) (Mikhail Khludnev)

### Fixed (28 changes)

- The classic and flexible query parsers, as well as Solr's "lucene"/standard query parser, should require " TO " in range queries, and accept "TO" as endpoints in range queries. [LUCENE-7821](https://issues.apache.org/jira/browse/LUCENE-7821) (hossman) (Steve Rowe)
- Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions. [SOLR-10047](https://issues.apache.org/jira/browse/SOLR-10047) (Keith Laban) (shalin)
- bin/solr script recursive copy broken [SOLR-10108](https://issues.apache.org/jira/browse/SOLR-10108) (Erick Erickson)
- Fixes multi-term synonym parsing in ManagedSynonymFilterFactory. [SOLR-10264](https://issues.apache.org/jira/browse/SOLR-10264) (Jörg Rathlev) (Steve Rowe) (Christine Poerschke)
- ADMIN_PATHS is duplicated in two places and inconsistent. This can cause automatic retries to /admin/metrics handler by the CloudSolrClient. [SOLR-10281](https://issues.apache.org/jira/browse/SOLR-10281) (shalin)
- Unloading a core can remove a ZK SolrCore registration entry for the wrong SolrCore. [SOLR-10316](https://issues.apache.org/jira/browse/SOLR-10316) (Mark Miller)
- fix to SpellingQueryConverter to properly strip out colons in field-specific queries. [SOLR-10323](https://issues.apache.org/jira/browse/SOLR-10323) (Amrit Sarkar) (James Dyer)
- "Memory Pool not found" error when reporting JVM metrics. [SOLR-10362](https://issues.apache.org/jira/browse/SOLR-10362) (ab)
- bin\solr.cmd delete and healthcheck now works again; fixed continuation chars ^ [SOLR-10369](https://issues.apache.org/jira/browse/SOLR-10369) (Luis Goes) (janhoy)
- zkTransfer normalizes destination path incorrectly if source is a windows directory [SOLR-10387](https://issues.apache.org/jira/browse/SOLR-10387) (gopikannan venugopalsamy) (Erick Erickson)
- Fixed uninversion (aka: FieldCache) bugs with the numeric PointField classes, and CurrencyField [SOLR-10472](https://issues.apache.org/jira/browse/SOLR-10472) (hossman)
- Correct LBHttpSolrClient's confusing SolrServerException message when timeAllowed is exceeded. [SOLR-10473](https://issues.apache.org/jira/browse/SOLR-10473) (Christine Poerschke)
- TestPointFields.testPointFieldReturn() depends on order of unsorted hits. [SOLR-10474](https://issues.apache.org/jira/browse/SOLR-10474) (Steve Rowe)
- Full pagination in JSON Facet API using offset does not work. [SOLR-10480](https://issues.apache.org/jira/browse/SOLR-10480) (yonik)
- Investigate SolrCloudExampleTest failures. [SOLR-10493](https://issues.apache.org/jira/browse/SOLR-10493) (Erick Erickson)
- nested child docs are adopted by neighbour when several parents come in update/json/docs [SOLR-10500](https://issues.apache.org/jira/browse/SOLR-10500) (Alexey Suprun) (noble) (Mikhail Khludnev)
- child.facet.field doubled counts at least when rows&gt;0. [SOLR-10520](https://issues.apache.org/jira/browse/SOLR-10520) (Dr. Oleg Savrasov) (Mikhail Khludnev)
- facet.heatmap didn't honor facet exclusions ('ex') for distributed search. [SOLR-10526](https://issues.apache.org/jira/browse/SOLR-10526) (David Smiley)
- The new 'large' attribute had been forgotten in /schema/fieldtypes?showDefaults=true [SOLR-10549](https://issues.apache.org/jira/browse/SOLR-10549) (David Smiley)
- JSON Facet API numBuckets was not consistent between distributed and non-distributed requests when there was a mincount &gt; 1. This has been corrected by changing numBuckets cardinality processing to ignore mincount &gt; 1 for non-distributed requests. [SOLR-10552](https://issues.apache.org/jira/browse/SOLR-10552) (yonik)
- Prevent redundant core reload on config update [SOLR-10588](https://issues.apache.org/jira/browse/SOLR-10588) (Mikhail Khludnev)
- requests are suspended until SolrDispatchFilter initialization is completed. After core container shutdown or severe initialization problem Solr responds with http stauts 404 Not Found instead of 500 as it was before [SOLR-10615](https://issues.apache.org/jira/browse/SOLR-10615) (Mikhail Khludnev)
- HttpSolrCall.getAuthCtx().new AuthorizationContext() {...}.getParams() sometimes throws java.lang.NullPointerException [SOLR-10630](https://issues.apache.org/jira/browse/SOLR-10630) (hu xiaodong) (shalin)
- Windows script (solr.cmd) didn't work properly with directory containing spaces. Adding quotations to fix [SOLR-10735](https://issues.apache.org/jira/browse/SOLR-10735) (Uwe Schindler) (janhoy) (Tomas Fernandez-Lobbe) (Ishan Chattopadhyaya)
- Multiple highlight fields and wildcards are now supported e.g. hl.fl=title,text_* [SOLR-5127](https://issues.apache.org/jira/browse/SOLR-5127) (Sven-S. Porst) (Daniel Debray) (Simon Endele) (Christine Poerschke)
- Admin UI - Plugins / Stats - active item is now highlighted [SOLR-8149](https://issues.apache.org/jira/browse/SOLR-8149) (Labuzov Dmitriy) (janhoy)
- fix Spellcheck "collateMaxCollectDocs" parameter to work with queries that have the CollpasingQParserPlugin applied. [SOLR-8807](https://issues.apache.org/jira/browse/SOLR-8807) (James Dyer)
- Improve distribution of replicas when restoring a collection [SOLR-9527](https://issues.apache.org/jira/browse/SOLR-9527) (Hrishikesh Gadre) (Stephen Lewis) (Rohit) (Varun Thacker)

### Other (30 changes)

- Clean up references to CoreContainer and CoreDescriptors [SOLR-10007](https://issues.apache.org/jira/browse/SOLR-10007) (Erick Erickson)
- Admin UI -&gt; Cloud -&gt; Graph: Impossible to see shard state [SOLR-10147](https://issues.apache.org/jira/browse/SOLR-10147) (Amrit Sarkar) (janhoy)
- Use monotonically incrementing counter for doc ids in TestRecovery. [SOLR-10151](https://issues.apache.org/jira/browse/SOLR-10151) (Peter Szantai-Kis) (Mano Kovacs) (Mark Miller)
- Refactor IndexFetcher.doFetch() to return a more detailed result. [SOLR-10249](https://issues.apache.org/jira/browse/SOLR-10249) (Jeff Miller) (David Smiley)
- Refactor Document handling out of SolrIndexSearcher into a new class "SolrDocumentFetcher". Deprecated SolrPluginUtils.docListToSolrDocumentList(). [SOLR-10304](https://issues.apache.org/jira/browse/SOLR-10304) (David Smiley)
- Update Solr default/example and test configs to use SynonymGraphFilterFactory. [SOLR-10343](https://issues.apache.org/jira/browse/SOLR-10343) (Steve Rowe)
- Update Solr default/example and test configs to use WordDelimiterGraphFilterFactory. [SOLR-10344](https://issues.apache.org/jira/browse/SOLR-10344) (Steve Rowe)
- bin/solr script now prints warning when available system entropy is lower than 300 [SOLR-10352](https://issues.apache.org/jira/browse/SOLR-10352) (Esther Quansah via Ishan Chattopadhyaya)
- Enable edismax and standard query parsers to handle the option combination sow=false / autoGeneratePhraseQueries="true" by setting QueryBuilder.autoGenerateMultiTermSynonymsQuery. [SOLR-10357](https://issues.apache.org/jira/browse/SOLR-10357) (Steve Rowe)
- Handle a SolrCoreInitializationException while publishing core state during SolrCore creation [SOLR-10365](https://issues.apache.org/jira/browse/SOLR-10365) (Ishan Chattopadhyaya)
- Rename getSortWithinGroup to getWithinGroupSort in search.grouping.Command class. [SOLR-10394](https://issues.apache.org/jira/browse/SOLR-10394) (Judith Silverman) (Christine Poerschke)
- Generalize some internal facet logic to simplify points/non-points field handling [SOLR-10399](https://issues.apache.org/jira/browse/SOLR-10399) (Adrien Grand) (hossman)
- UpdateRequest#getRoutes()should copy the response parser [SOLR-10429](https://issues.apache.org/jira/browse/SOLR-10429) (noble)
- LBHttpSolrClient.doRequest is now always wrapped in a Mapped Diagnostic Context (MDC). [SOLR-10440](https://issues.apache.org/jira/browse/SOLR-10440) (Christine Poerschke)
- Upgrade Metrics library to 3.2.2. [SOLR-10514](https://issues.apache.org/jira/browse/SOLR-10514) (ab)
- SolrCLI.atPath cannot handle children that begin with a slash. [SOLR-10519](https://issues.apache.org/jira/browse/SOLR-10519) (Erick Erickson)
- Revert SpellCheckComponent response format change from SOLR-9972 (rel. 6.5.0). While this was an improvement for the json "arrntv" format, it caused problems for the default json format. [SOLR-10522](https://issues.apache.org/jira/browse/SOLR-10522) [SOLR-9972](https://issues.apache.org/jira/browse/SOLR-9972) (James Dyer) (reported by Nikita Pchelintsev)
- StreamExpressionParser should handle white space around = in named parameters [SOLR-10601](https://issues.apache.org/jira/browse/SOLR-10601) (Joel Bernstein)
- Static fields have turned to instance's field in SimplePostTool. Enabled TestSolrCLIRunExample.testTechproductsExample(). [SOLR-10614](https://issues.apache.org/jira/browse/SOLR-10614) (Andrey Kudryavtsev) (Mikhail Khludnev)
- solr.in.sh installed by install script should be writable by solr user [SOLR-10644](https://issues.apache.org/jira/browse/SOLR-10644) (janhoy)
- Deprecated LatLonType, GeoHashField, SpatialPointVectorFieldType, and SpatialTermQueryPrefixTreeFieldType. Instead, switch to LatLonPointSpatialField or SpatialRecursivePrefixTreeFieldType or RptWithGeometrySpatialField. [SOLR-10729](https://issues.apache.org/jira/browse/SOLR-10729) (David Smiley)
- Modernize the Solr ref guide's Chinese language analysis coverage. [SOLR-10758](https://issues.apache.org/jira/browse/SOLR-10758) (Steve Rowe)
- Cutover tests to using 'q.op' and 'df' instead of schema 'defaultOperator' and 'defaultSearchField' [SOLR-7041](https://issues.apache.org/jira/browse/SOLR-7041) (janhoy)
- New DataImportHandler 'atom' example, replacing broken 'rss' example [SOLR-7383](https://issues.apache.org/jira/browse/SOLR-7383) (Alexandre Rafalovitch)
- Make transient core cache pluggable [SOLR-8906](https://issues.apache.org/jira/browse/SOLR-8906) (Erick Erickson)
- Remove Solr contribs: map-reduce, morphlines-core and morphlines-cell. [SOLR-9221](https://issues.apache.org/jira/browse/SOLR-9221) (Steve Rowe)
- Upgrade Zookeeper to 3.4.10. [SOLR-9386](https://issues.apache.org/jira/browse/SOLR-9386) (Shawn Heisey) (Steve Rowe)
- Redone DataImportHandler 'tika' example, removing all unused and irrelevant definitions [SOLR-9601](https://issues.apache.org/jira/browse/SOLR-9601) (Alexandre Rafalovitch)
- print errors from solr.cmd [SOLR-9745](https://issues.apache.org/jira/browse/SOLR-9745) (Gopikannan Venugopalsamy) (Mikhail Khludnev)
- Adding isLoading=true as core status. Fixing start after stop scenario in bin/solr [SOLR-9867](https://issues.apache.org/jira/browse/SOLR-9867) (Andrey Kudryavtsev) (Mikhail Khludnev)


[6.5.1] - 2017-04-27
--------------------

### Fixed (12 changes)

- On 'downnode', lots of wasteful mutations are done to ZK. [SOLR-10277](https://issues.apache.org/jira/browse/SOLR-10277) (Joshua Humphries) (Scott Blum) (Varun Thacker) (shalin)
- SQL AVG function mis-interprets field type. [SOLR-10341](https://issues.apache.org/jira/browse/SOLR-10341) (Joel Bernstein)
- Fix debug related NullPointerException in solr/contrib/ltr OriginalScoreFeature class. [SOLR-10383](https://issues.apache.org/jira/browse/SOLR-10383) (Vitezslav Zak) (Christine Poerschke)
- The fetch() streaming expression wouldn't work if a value included query syntax chars (like :+-). Fixed, and enhanced the generated query to not pollute the queryCache. [SOLR-10404](https://issues.apache.org/jira/browse/SOLR-10404) (David Smiley)
- The JSON output of /admin/metrics is fixed to write the container as a map (SimpleOrderedMap) instead of an array (NamedList). [SOLR-10416](https://issues.apache.org/jira/browse/SOLR-10416) (shalin)
- Solr 6.x leaking one SolrZkClient instance per second [SOLR-10420](https://issues.apache.org/jira/browse/SOLR-10420) (Scott Blum) (Cao Manh Dat) (Markus Jelsma) (Steve Rowe)
- Fix params persistence for solr/contrib/ltr (MinMax|Standard)Normalizer classes. [SOLR-10421](https://issues.apache.org/jira/browse/SOLR-10421) (Jianxiong Dong) (Christine Poerschke)
- Disable graph query production via schema configuration &lt;fieldtype ... enableGraphQueries="false"&gt;. This fixes broken queries for ShingleFilter-containing query-time analyzers when request param sow=false. [SOLR-10423](https://issues.apache.org/jira/browse/SOLR-10423) (Steve Rowe)
- Fix indexed="false" on numeric PointFields [SOLR-10425](https://issues.apache.org/jira/browse/SOLR-10425) (Tomás Fernández Löbbe) (hossman)
- The new 'large' attribute had been forgotten in /schema/fields?showDefaults=true [SOLR-10439](https://issues.apache.org/jira/browse/SOLR-10439) (David Smiley)
- SQL interface does not use client cache. [SOLR-10444](https://issues.apache.org/jira/browse/SOLR-10444) (Joel Bernstein)
- edismax with sow=false fails to create dismax-per-term queries when any field is boosted. [SOLR-10527](https://issues.apache.org/jira/browse/SOLR-10527) (Steve Rowe)


[6.5.0] - 2017-03-27
--------------------

### Upgrade Notes (2 changes)

- JMX metric "avgTimePerRequest" (and the corresponding metric in the metrics API for each handler) used to be a simple non-decaying average based on total cumulative time and the number of requests. New Codahale Metrics implementation applies exponential decay to this value, which heavily biases the average towards the last 5 minutes. [SOLR-10226](https://issues.apache.org/jira/browse/SOLR-10226) (ab)
- Parallel SQL now uses Apache Calcite as its SQL framework. As part of this change the default aggregation mode has been changed to facet rather than map_reduce. There has also been changes to the SQL aggregate response and some SQL syntax changes. Consult the documentation for full details. [SOLR-8593](https://issues.apache.org/jira/browse/SOLR-8593) 

### Added (31 changes)

- New LatLonPointSpatialField replacement for LatLonType (and some uses of RPT). Multi-value capable indexed geo lat-lon points, query by rect or circle. Efficient distance sorting/boosting too. [SOLR-10039](https://issues.apache.org/jira/browse/SOLR-10039) (David Smiley)
- SQL result set fields should be ordered by the field list [SOLR-10085](https://issues.apache.org/jira/browse/SOLR-10085) (Joel Bernstein)
- StreamHandler now supports registering custom streaming expressions from the blob store [SOLR-10087](https://issues.apache.org/jira/browse/SOLR-10087) (Kevin Risden)
- Added button to the Admin UI 'Collection' tab for deleting an inactive shard [SOLR-10146](https://issues.apache.org/jira/browse/SOLR-10146) (Amrit Sarkar) (janhoy)
- & SOLR-10152: The Unified and Postings based highlighters: Add hl.bs.type=SEPARATOR along with new param hl.bs.separator to break passages by a provided single character. [SOLR-10153](https://issues.apache.org/jira/browse/SOLR-10153) [SOLR-10152](https://issues.apache.org/jira/browse/SOLR-10152) (Amrit Sarkar) (David Smiley)
- Add significantTerms Streaming Expression [SOLR-10156](https://issues.apache.org/jira/browse/SOLR-10156) (Joel Bernstein)
- Add support for "preload" option in MMapDirectoryFactory. [SOLR-10158](https://issues.apache.org/jira/browse/SOLR-10158) (Amrit Sarkar) (Uwe Schindler)
- Add disk total and disk free metrics. [SOLR-10224](https://issues.apache.org/jira/browse/SOLR-10224) (ab)
- CloudSolrClient can now return versions for documents added or deleted when "versions=true" is passed. However, if there is a leader election while this request is in transit, the versions may not be returned from that shard. [SOLR-10250](https://issues.apache.org/jira/browse/SOLR-10250) (Boris Naguet) (Ishan Chattopadhyaya)
- significantTerms Streaming Expression should work in non-SolrCloud mode [SOLR-10254](https://issues.apache.org/jira/browse/SOLR-10254) (Joel Bernstein)
- string/text fields may now declare themselves as large="true" in the schema. Large fields are always lazy loaded and will only take up space in the document cache if the actual value is &lt; 512KB. This option requires "stored" and must not be multiValued. It's intended for fields that might have very large values so that they don't get cached in memory. [SOLR-10286](https://issues.apache.org/jira/browse/SOLR-10286) (David Smiley)
- In-place updates of Numeric DocValues. To leverage this, the _version_ field and the updated field must both be stored=false, indexed=false, docValues=true. [SOLR-5944](https://issues.apache.org/jira/browse/SOLR-5944) (Ishan Chattopadhyaya) (hossman) (noble) (shalin) (yonik)
- Auto create .system collection on first request if it does not exist [SOLR-7955](https://issues.apache.org/jira/browse/SOLR-7955) (noble)
- Added new style APIs and a framework for creating new APIs and mapping old APIs to new [SOLR-8029](https://issues.apache.org/jira/browse/SOLR-8029) (noble) (Steve Rowe) (Cassandra Targett) (Timothy Potter)
- Deploy V2 API at /v2 instead of /solr/v2 [SOLR-8045](https://issues.apache.org/jira/browse/SOLR-8045) (Cao Manh Dat) (Noble Paul)
- Add support for PointFields in Solr [SOLR-8396](https://issues.apache.org/jira/browse/SOLR-8396) (Ishan Chattopadhyaya) (Tomás Fernández Löbbe)
- Integrate Apache Calcite into the SQLHandler [SOLR-8593](https://issues.apache.org/jira/browse/SOLR-8593) (Kevin Risden) (Cao Manh Dat) (Joel Bernstein)
- Make RecoveryStrategy settings configurable. [SOLR-9045](https://issues.apache.org/jira/browse/SOLR-9045) (Christine Poerschke)
- Solr's edismax and "Lucene"/standard query parsers will no longer split on whitespace before sending terms to analysis, if given the "sow=false" request param ("sow"=&gt;"split on whitespace"). This enables multi-term source synonyms to match at query-time using SynonymGraphFilterFactory; other analysis components will also now work at query time, e.g. ShingleFilterFactory. By default, and when the "sow=true" param is specified, these parsers' behavior remains the same: queries will be split on whitespace before sending individual terms to analysis. [SOLR-9185](https://issues.apache.org/jira/browse/SOLR-9185) (Steve Rowe)
- Authentication and Authorization plugins now work in standalone mode if security.json is placed in SOLR_HOME on every node. Editing config through API is supported but affects only that one node. [SOLR-9481](https://issues.apache.org/jira/browse/SOLR-9481) (janhoy)
- Add ability to recover from leader when index corruption is detected on SolrCore creation. [SOLR-9836](https://issues.apache.org/jira/browse/SOLR-9836) (Mike Drob) (Mark Miller)
- Allow pre-startup Solr log management in Solr bin scripts to be disabled. [SOLR-9885](https://issues.apache.org/jira/browse/SOLR-9885) (Mano Kovacs) (Mark Miller)
- Stop interrupting the update executor on shutdown, it can cause graceful shutdowns to put replicas into Leader Initiated Recovery among other undesirable things. [SOLR-9903](https://issues.apache.org/jira/browse/SOLR-9903) (Mark Miller)
- Add facet.excludeTerms parameter support. [SOLR-9912](https://issues.apache.org/jira/browse/SOLR-9912) (Jonny Marks) (David Smiley) (Christine Poerschke)
- Adds Stream Evaluators to support evaluating values from tuples. Supports boolean, numeric, and conditional evaluators. BooleanOperations have been removed in preference of BooleanEvaluators. [SOLR-9916](https://issues.apache.org/jira/browse/SOLR-9916) (Dennis Gove)
- Allow passing arbitrary java system properties to zkcli. [SOLR-9926](https://issues.apache.org/jira/browse/SOLR-9926) (Hrishikesh Gadre) (Mark Miller)
- SolrCoreParser now supports configuration of custom SpanQueryBuilder classes. [SOLR-9933](https://issues.apache.org/jira/browse/SOLR-9933) (Daniel Collins) (Christine Poerschke)
- Implement DatePointField [SOLR-9986](https://issues.apache.org/jira/browse/SOLR-9986) (Cao Manh Dat) (Tomás Fernández Löbbe)
- Add support for MultiValued DocValues in PointFields using SortedNumericDocValues [SOLR-9987](https://issues.apache.org/jira/browse/SOLR-9987) (Tomás Fernández Löbbe)
- Enable configuring SolrHttpClientBuilder via java system property. [SOLR-9997](https://issues.apache.org/jira/browse/SOLR-9997) (Hrishikesh Gadre) (Mark Miller)
- Instrument DirectUpdateHandler2. This registers existing statistics under metrics API and adds more metrics to track the rates of update and delete commands. [SOLR-9999](https://issues.apache.org/jira/browse/SOLR-9999) (ab)

### Changed (5 changes)

- PointFields will create IndexOrDocValuesQuery when a field is both, indexed=true and docValues=true [SOLR-10143](https://issues.apache.org/jira/browse/SOLR-10143) (Tomás Fernández Löbbe)
- The field with the longest value (if it exceeds 4K) is moved to be last in the Lucene Document in order to benefit from stored field optimizations in Lucene that can avoid reading it when it's not needed. If the field is multi-valued, they all move together to the end to retain order. [SOLR-10273](https://issues.apache.org/jira/browse/SOLR-10273) (David Smiley)
- Support Solr being proxied with another endpoint than default /solr, by using relative links in AdminUI javascripts [SOLR-9584](https://issues.apache.org/jira/browse/SOLR-9584) (Yun Jie Zhou) (janhoy)
- All filters that match all documents in the index now share the same memory (DocSet). [SOLR-9764](https://issues.apache.org/jira/browse/SOLR-9764) (Michael Sun) (yonik)
- Clear the deletes lists at UpdateLog before replaying from log. This prevents redundantly pre-applying DBQs, during the log replay, to every update in the log as if the DBQs were out of order. [SOLR-9941](https://issues.apache.org/jira/browse/SOLR-9941) (hossman) (Ishan Chattopadhyaya)

### Fixed (34 changes)

- CoreAdminHandler silently swallows some errors. [SOLR-10020](https://issues.apache.org/jira/browse/SOLR-10020) (Mike Drob) (Erick Erickson)
- Collection deletion leaves behind the snapshot metadata [SOLR-10049](https://issues.apache.org/jira/browse/SOLR-10049) (Hrishikesh Gadre) (yonik)
- Linux installer now renames existing bin/solr.in.* as bin/solr.in.*.orig to make the installed config in /etc/defaults be the one found by default when launching solr manually. [SOLR-10055](https://issues.apache.org/jira/browse/SOLR-10055) (janhoy)
- CoreContainer shutdown has race condition that can cause a hang on shutdown. [SOLR-10063](https://issues.apache.org/jira/browse/SOLR-10063) (Mark Miller)
- Installer script does not put zoo.cfg in SOLR_HOME [SOLR-10088](https://issues.apache.org/jira/browse/SOLR-10088) (janhoy)
- BlockDirectoryCache release hooks do not work with multiple directories. [SOLR-10104](https://issues.apache.org/jira/browse/SOLR-10104) (Mike Drob) (Mark Miller)
- Reordered delete-by-query causes inconsistenties between shards that have child documents [SOLR-10114](https://issues.apache.org/jira/browse/SOLR-10114) (Mano Kovacs) (Mihaly Toth) (yonik)
- A SolrCore reload can remove the index from the previous SolrCore during replication index rollover. [SOLR-10120](https://issues.apache.org/jira/browse/SOLR-10120) (Mark Miller)
- Fix race conditions in HDFS BlockCache that can contribute to corruption in high concurrency situations. [SOLR-10121](https://issues.apache.org/jira/browse/SOLR-10121) (yonik)
- Replication can skip removing a temporary index directory in some cases when it should not. [SOLR-10124](https://issues.apache.org/jira/browse/SOLR-10124) (Mark Miller)
- Upgrade to Caffeine 2.4.0 since v1.0.1 contributed to BlockCache corruption because the removal listener was called more than once for some items and not at all for other items. [SOLR-10141](https://issues.apache.org/jira/browse/SOLR-10141) (Ben Manes) (yonik)
- When DBQ is reordered with an in-place update, upon whose updated value the DBQ is based on, the DBQ fails due to excessive caching in DeleteByQueryWrapper [SOLR-10159](https://issues.apache.org/jira/browse/SOLR-10159) (Ishan Chattopadhyaya)
- ShardSplit can fail with NPE in OverseerCollectionMessageHandler#waitForCoreAdminAsyncCallToComplete. [SOLR-10168](https://issues.apache.org/jira/browse/SOLR-10168) (Mark Miller)
- ClassCastException in RecoveryStrategy. [SOLR-10170](https://issues.apache.org/jira/browse/SOLR-10170) (Mark Miller)
- Fix bin/solr so it can run properly on java9 [SOLR-10184](https://issues.apache.org/jira/browse/SOLR-10184) (hossman) (Uwe Schindler)
- ElectionContext#runLeaderProcess can hit NPE on core close. [SOLR-10196](https://issues.apache.org/jira/browse/SOLR-10196) (Mark Miller)
- The Schema API commands "add-field-type" and "replace-field-type" improperly specify SimilarityFactory params. [SOLR-10218](https://issues.apache.org/jira/browse/SOLR-10218) (Benjamin Deininger) (Troy Mohl) (Steve Rowe)
- Fix HDFS BlockCache evictions metric to not count explicit removal due to a directory close. [SOLR-10225](https://issues.apache.org/jira/browse/SOLR-10225) (yonik)
- add back "totalTime" metric to all handlers. See also the back-compat note. [SOLR-10226](https://issues.apache.org/jira/browse/SOLR-10226) (ab)
- Poly-fields should work with subfields that have docValues=true [SOLR-10237](https://issues.apache.org/jira/browse/SOLR-10237) (Tomás Fernández Löbbe) (David Smiley)
- MetricsHandler JSON output incorrect. [SOLR-10269](https://issues.apache.org/jira/browse/SOLR-10269) (ab)
- The autoAddReplica feature can result in SolrCores being assigned new shards when using legacyCloud=false and will also fail on a state check when taking over a core registration with a new core. [SOLR-10279](https://issues.apache.org/jira/browse/SOLR-10279) (Mark Miller) (Hrishikesh Gadre) (Patrick Dvorack)
- Learning to Rank (LTR) SolrFeature to reject searches with missing efi (External Feature Information) used by fq. [SOLR-10283](https://issues.apache.org/jira/browse/SOLR-10283) (Christine Poerschke)
- Solr's zkcli scripts now able to find the metrics libraries, which it couldn't earlier [SOLR-10302](https://issues.apache.org/jira/browse/SOLR-10302) (kiran) (Ishan Chattopadhyaya)
- SolrCore "instanceDir" metric not visible in JMX. [SOLR-10319](https://issues.apache.org/jira/browse/SOLR-10319) (ab)
- NPE using TermVectorComponent, MoreLikeThisComponent in combination with ExactStatsCache [SOLR-9114](https://issues.apache.org/jira/browse/SOLR-9114) (Cao Manh Dat) (Varun Thacker)
- Admin UI (angular) now works with Kerberos, by excluding serving of /solr/libs/* through SolrDispatchFilter. [SOLR-9516](https://issues.apache.org/jira/browse/SOLR-9516) (Cassandra Targett) (Amrit Sarkar) (Ishan Chattopadhyaya)
- Some bulk update paths could be very slow due to CUSC polling. [SOLR-9824](https://issues.apache.org/jira/browse/SOLR-9824) (David Smiley) (Mark Miller)
- "inc" atomic update doesn't respect default field value [SOLR-9838](https://issues.apache.org/jira/browse/SOLR-9838) (hoss) (Amrit Sarkar) (Ishan Chattopadhyaya)
- Overseer is not always closed after being started. [SOLR-9846](https://issues.apache.org/jira/browse/SOLR-9846) (Mark Miller)
- Fix init bug in SegmentsInfoRequestHandlerTest [SOLR-9976](https://issues.apache.org/jira/browse/SOLR-9976) (hossman)
- Fix config bug in DistribDocExpirationUpdateProcessorTest that allowed false assumptions about when index version changes [SOLR-9977](https://issues.apache.org/jira/browse/SOLR-9977) (hossman)
- Macro expansion should not be done in shard requests [SOLR-9979](https://issues.apache.org/jira/browse/SOLR-9979) (Tomás Fernández Löbbe)
- Unstored IntPointField returns Long type [SOLR-9996](https://issues.apache.org/jira/browse/SOLR-9996) (Ishan Chattopadhyaya)

### Other (28 changes)

- Refactor PointField & TrieField to now have a common base class, NumericFieldType. The TrieField.TrieTypes and PointField.PointTypes are now consolidated to NumericFieldType.NumberType. This refactoring also fixes a bug whereby PointFields were not using DocValues for range queries for indexed=false, docValues=true fields. [SOLR-10011](https://issues.apache.org/jira/browse/SOLR-10011) (Ishan Chattopadhyaya) (Tomás Fernández Löbbe)
- Increase the default hl.maxAnalyzedChars to 51200 for the Unified & Postings Highlighter so that all highlighters now have this same default. [SOLR-10018](https://issues.apache.org/jira/browse/SOLR-10018) (David Smiley)
- Cannot reload a core if it fails initialization. [SOLR-10020](https://issues.apache.org/jira/browse/SOLR-10020) (Mike Drob) (Erick Erickson)
- Reduce logging of pre-start log rotation [SOLR-10043](https://issues.apache.org/jira/browse/SOLR-10043) (janhoy)
- The test TestSelectiveWeightCreation appears to be unreliable. [SOLR-10072](https://issues.apache.org/jira/browse/SOLR-10072) (Michael Nilsson) (Mark Miller)
- EmbeddedSolrServer responds on Schema API requests [SOLR-10134](https://issues.apache.org/jira/browse/SOLR-10134) (Robert Alexandersson) (Mikhail Khludnev)
- For numeric types facet.contains= and facet.prefix= are now rejected. [SOLR-10155](https://issues.apache.org/jira/browse/SOLR-10155) (Gus Heck) (Christine Poerschke)
- Add Constant Reduction Rules to Calcite Planner [SOLR-10171](https://issues.apache.org/jira/browse/SOLR-10171) (Kevin Risden)
- Make HttpShardHandlerFactory.getReplicaListTransformer more extensible. [SOLR-10173](https://issues.apache.org/jira/browse/SOLR-10173) (Ramsey Haddad) (Christine Poerschke)
- Remove unused HDFS BlockCache metrics and add storeFails, as well as adding total counts for lookups, hits, and evictions. [SOLR-10214](https://issues.apache.org/jira/browse/SOLR-10214) (yonik)
- re-enable HDFS tests under JDK9 [SOLR-10219](https://issues.apache.org/jira/browse/SOLR-10219) (hossman) (Uwe Schindler)
- default TTL of PKIAuthenticationPlugin increased to 10secs [SOLR-10230](https://issues.apache.org/jira/browse/SOLR-10230) (noble)
- Fix DIH's TestJdbcDataSource to work with Java 9 and other Java runtimes that do not use the same DriverManager implementation like Oracle's original one. The test now uses a fully implemented Driver instance returning a mock connection. The test also works correct now if other drivers were installed before test execution (e.g., through IDE). [SOLR-10235](https://issues.apache.org/jira/browse/SOLR-10235) (hossman) (Uwe Schindler)
- Support non-numeric metrics and a "compact" format of /admin/metrics output. [SOLR-10247](https://issues.apache.org/jira/browse/SOLR-10247) (ab)
- Added tests to check that the changes in LUCENE-7564 and LUCENE-7670 enable AnalyzingInfixSuggester and BlendedInfixSuggester to play nicely with core reload. SolrSuggester.build() now throws SolrCoreState.CoreIsClosedException when interrupted by a core reload/shutdown. [SOLR-6246](https://issues.apache.org/jira/browse/SOLR-6246) [LUCENE-7564](https://issues.apache.org/jira/browse/LUCENE-7564) [LUCENE-7670](https://issues.apache.org/jira/browse/LUCENE-7670) (Steve Rowe)
- Remove replication & backup scripts in the solr/scripts directory of the checkout [SOLR-7453](https://issues.apache.org/jira/browse/SOLR-7453) (Varun Thacker)
- change morphline test config files to work around 'importCommands' bug when using java9 [SOLR-8876](https://issues.apache.org/jira/browse/SOLR-8876) (hossman)
- The docs/ folder in the binary distribution now contains a single index.html file linking to the online documentation, reducing the size of the download [SOLR-9450](https://issues.apache.org/jira/browse/SOLR-9450) (janhoy) (Shawn Heisey) (Uwe Schindler)
- Factor out FacetComponent.newSimpleFacets method. [SOLR-9800](https://issues.apache.org/jira/browse/SOLR-9800) (Jonny Marks) (Christine Poerschke)
- UpdateRequestProcessors have no way to guarantee the closing of resources used for a request. [SOLR-9842](https://issues.apache.org/jira/browse/SOLR-9842) (Mark Miller)
- Lower solr.cloud.wait-for-updates-with-stale-state-pause back down from 7 seconds. [SOLR-9848](https://issues.apache.org/jira/browse/SOLR-9848) (Mark Miller)
- factor out ShardResultTransformerUtils.[un]marshSortValue methods [SOLR-9890](https://issues.apache.org/jira/browse/SOLR-9890) (Judith Silverman) (Christine Poerschke)
- SimpleFacets: refactor "contains" check into "SubstringBytesRefFilter" class. [SOLR-9914](https://issues.apache.org/jira/browse/SOLR-9914) (Jonny Marks) (David Smiley) (Christine Poerschke)
- Convert/migrate tests using EasyMock to Mockito [SOLR-9966](https://issues.apache.org/jira/browse/SOLR-9966) (Cao Manh Dat) (Uwe Schindler)
- SpellCheckComponent collations and suggestions returned as a JSON object rather than a list [SOLR-9972](https://issues.apache.org/jira/browse/SOLR-9972) (Christine Poerschke in response to bug report from Ricky Oktavianus Lazuardy)
- Expose configVersion in core admin status [SOLR-9980](https://issues.apache.org/jira/browse/SOLR-9980) (Jessica Cheng Mallet) (Tomás Fernández Löbbe)
- Fixing NullPointerException failure by TestManagedSchemaThreadSafety adding check for Zookeeper session expiration [SOLR-9983](https://issues.apache.org/jira/browse/SOLR-9983) (Steve Rowe) (Mikhail Khludnev)
- Add PointFields in example/default schemas [SOLR-9990](https://issues.apache.org/jira/browse/SOLR-9990) (Tomás Fernández Löbbe)


[6.4.2] - 2017-03-07
--------------------

### Fixed (5 changes)

- Fix instanceof check in ConstDoubleSource.equals [SOLR-10083](https://issues.apache.org/jira/browse/SOLR-10083) (Pushkar Raste) (Christine Poerschke)
- Serious performance degradation in Solr 6.4.1 due to the new metrics collection. Default settings in solrconfig.xml /config/indexConfig/metrics have been changed to turn off IndexWriter metrics collection. Directory level metrics collection has been completely removed until a better design is found. [SOLR-10130](https://issues.apache.org/jira/browse/SOLR-10130) [SOLR-10182](https://issues.apache.org/jira/browse/SOLR-10182) (ab) (ishan)
- Transaction log replay can hit an NPE due to new Metrics code. [SOLR-10138](https://issues.apache.org/jira/browse/SOLR-10138) (ab)
- Fix NPE in CloudSolrClient when reading stale alias [SOLR-10190](https://issues.apache.org/jira/browse/SOLR-10190) (Janosch Woschitz) (Tomás Fernández Löbbe)
- Fix copy/paste in solr-ltr pom.xml template. [SOLR-10192](https://issues.apache.org/jira/browse/SOLR-10192) (Christine Poerschke)


[6.4.1] - 2017-02-06
--------------------

### Fixed (4 changes)

- Validation of filename params in ReplicationHandler [SOLR-10031](https://issues.apache.org/jira/browse/SOLR-10031) (Hrishikesh Gadre) (janhoy)
- Core swapping doesn't work with new metrics changes in place [SOLR-10054](https://issues.apache.org/jira/browse/SOLR-10054) (ab)
- solr.cmd SOLR_SSL_OPTS is overwritten [SOLR-8491](https://issues.apache.org/jira/browse/SOLR-8491) (Sam Yi) (Andy Hind) (Marcel Berteler) (Kevin Risden)
- "Plugin/Stats" section of the UI doesn't display empty metric types [SOLR-9969](https://issues.apache.org/jira/browse/SOLR-9969) (Tomás Fernández Löbbe)


[6.4.0] - 2017-01-23
--------------------

### Upgrade Notes (5 changes)

- complexphrase query parser now supports leading wildcards, beware of its' possible heaviness. Users are encouraged to use ReversedWildcardFilter in index time analysis. [SOLR-7466](https://issues.apache.org/jira/browse/SOLR-7466) 
- Metrics related classes in org.apache.solr.util.stats have been removed in favor of the dropwizard metrics library. Any custom plugins using these classes should be changed to use the equivalent classes from the metrics library. As part of this, the following changes were made to the output of Overseer Status API: * The "totalTime" metric has been removed because it is no longer supported * The metrics "75thPctlRequestTime", "95thPctlRequestTime", "99thPctlRequestTime" and "999thPctlRequestTime" in Overseer Status API have been renamed to "75thPcRequestTime", "95thPcRequestTime" and so on for consistency with stats output in other parts of Solr. * The metrics "avgRequestsPerMinute", "5minRateRequestsPerMinute" and "15minRateRequestsPerMinute" have been replaced by corresponding per-second rates viz. "avgRequestsPerSecond", "5minRateRequestsPerSecond" and "15minRateRequestsPerSecond" for consistency with stats output in other parts of Solr. [SOLR-8785](https://issues.apache.org/jira/browse/SOLR-8785) 
- Export handler returns zero for numeric fields that are not in the original doc. One consequence of this change is that you must be aware that some tuples will not have values if there were none in the original document. [SOLR-9166](https://issues.apache.org/jira/browse/SOLR-9166) 
- You are encouraged to try out the UnifiedHighlighter by setting hl.method=unified and report feedback. It might become the default in 7.0. It's more efficient/faster than the other highlighters, especially compared to the original Highlighter. That said, some options aren't supported yet. It will get more features in time, especially with your input. See HighlightParams.java for a listing of highlight parameters annotated with which highlighters use them. hl.useFastVectorHighlighter is now considered deprecated in lieu of hl.method=fastVector. [SOLR-9708](https://issues.apache.org/jira/browse/SOLR-9708) 
- maxWarmingSearchers now defaults to 1, and more importantly commits will now block if this limit is exceeded instead of throwing an exception (a good thing). Consequently there is no longer a risk in overlapping commits. Nonetheless users should continue to avoid excessive committing. Users are advised to remove any pre-existing maxWarmingSearchers entries from their solrconfig.xml files. [SOLR-9712](https://issues.apache.org/jira/browse/SOLR-9712) 

### Added (40 changes)

- Improve metrics reporting. This uses the dropwizard metric library, adding an internal API for registering and reporting metrics from Solr components. Several new metrics and an improved JMX reporter have been added [SOLR-4735](https://issues.apache.org/jira/browse/SOLR-4735) [SOLR-9921](https://issues.apache.org/jira/browse/SOLR-9921) (Alan Woodward) (Jeff Wartes) (Christine Poerschke) (Kelvin Wong) (shalin) (ab)
- New solr.dns.prevent.reverse.lookup system property that can be used to prevent long core (re)load delays on systems with missconfigured hostname/DNS [SOLR-5043](https://issues.apache.org/jira/browse/SOLR-5043) (hossman)
- Enable leading wildcard in complexphrase query parser, optimize it with ReversedWildcardFilterFactory when it's provided [SOLR-7466](https://issues.apache.org/jira/browse/SOLR-7466) (Mikhail Khludnev)
- Add HavingStream to Streaming API and StreamingExpressions [SOLR-8530](https://issues.apache.org/jira/browse/SOLR-8530) (Joel Bernstein)
- Adds Solr Learning to Rank (LTR) plugin for reranking results with machine learning models. [SOLR-8542](https://issues.apache.org/jira/browse/SOLR-8542) (Michael Nilsson) (Diego Ceccarelli) (Joshua Pantony) (Jon Dorando) (Naveen Santhapuri) (Alessandro Benedetti) (David Grohmann) (Christine Poerschke)
- Add a command-line tool to manage the snapshots functionality [SOLR-9038](https://issues.apache.org/jira/browse/SOLR-9038) (Hrishikesh Gadre) (yonik)
- Make collection backup/restore extensible. [SOLR-9055](https://issues.apache.org/jira/browse/SOLR-9055) (Hrishikesh Gadre) (Varun Thacker) (Mark Miller)
- Streaming expressions should support collection alias [SOLR-9077](https://issues.apache.org/jira/browse/SOLR-9077) (Kevin Risden)
- Solrj client support for hierarchical clusters and other topics marker. [SOLR-9293](https://issues.apache.org/jira/browse/SOLR-9293) (Dawid Weiss)
- Support Secure Impersonation / Proxy User for solr authentication [SOLR-9324](https://issues.apache.org/jira/browse/SOLR-9324) (Gregory Chanan) (Hrishikesh Gadre) (yonik)
- Adds Array of Name Type Value (json.nl=arrntv) style to JSONResponseWriter. [SOLR-9442](https://issues.apache.org/jira/browse/SOLR-9442) [SOLR-9787](https://issues.apache.org/jira/browse/SOLR-9787) (Jonny Marks) (Christine Poerschke) (hossman)
- Generic authentication plugins (GenericHadoopAuthPlugin and ConfigurableInternodeAuthHadoopPlugin) that delegate all functionality to Hadoop authentication framework. [SOLR-9513](https://issues.apache.org/jira/browse/SOLR-9513) (Hrishikesh Gadre) (Ishan Chattopadhyaya)
- Limit memory consumed by FastLRUCache with a new 'maxRamMB' config parameter. [SOLR-9633](https://issues.apache.org/jira/browse/SOLR-9633) (yonik) (Michael Sun) (shalin)
- SolrJ LukeResponse support dynamic fields [SOLR-9666](https://issues.apache.org/jira/browse/SOLR-9666) (Fengtan) (Kevin Risden)
- introduce cursorMark='true' in SolrEntityProcessor [SOLR-9668](https://issues.apache.org/jira/browse/SOLR-9668) [SOLR-7197](https://issues.apache.org/jira/browse/SOLR-7197) (Yegor Kozlov) (Raveendra Yerraguntl) (Mikhail Khludnev)
- FacetModule / JSON Facet API added the ability to add filters directly to any facet command. The filters are applied after any domain change operations. Example: { type:terms, field:category, filter:"user:yonik" } [SOLR-9681](https://issues.apache.org/jira/browse/SOLR-9681) (yonik)
- JSON Facet API: added "param" query type to facet domain filter specification to obtain filters via query parameters. [SOLR-9682](https://issues.apache.org/jira/browse/SOLR-9682) (yonik)
- Add priority Streaming Expression [SOLR-9684](https://issues.apache.org/jira/browse/SOLR-9684) (Joel Bernstein) (David Smiley)
- Added UnifiedSolrHighlighter, a highlighter adapter for Lucene's UnifiedHighlighter. The adapter is a derivative of the PostingsSolrHighlighter, supporting mostly the same parameters with some differences. Introduced "hl.method" parameter which can be set to original|fastVector|postings|unified to pick the highlighter at runtime without the need to modify solrconfig from the default configuration. hl.useFastVectorHighlighter is now considered deprecated in lieu of hl.method=fastVector. [SOLR-9708](https://issues.apache.org/jira/browse/SOLR-9708) (Timothy Rodriguez) (David Smiley)
- javabin Tuple parser for streaming and other end points [SOLR-9721](https://issues.apache.org/jira/browse/SOLR-9721) (noble)
- Substitute properties into JdbcDataSource configuration [SOLR-9725](https://issues.apache.org/jira/browse/SOLR-9725) (Jamie Jackson) (Yuri Sashevsky) (Mikhail Khludnev)
- Ability to specify Key Store type in solr.in.sh file for SSL [SOLR-9728](https://issues.apache.org/jira/browse/SOLR-9728) (Michael Suzuki) (Kevin Risden)
- Use instrumented jetty classes provided by the dropwizard metric library. [SOLR-9788](https://issues.apache.org/jira/browse/SOLR-9788) (shalin)
- Use metrics-jvm library to instrument jvm internals such as GC, memory usage and others. [SOLR-9805](https://issues.apache.org/jira/browse/SOLR-9805) (shalin)
- Added a new /admin/metrics API to return all metrics collected by Solr via API. API supports four optional multi-valued parameters: - 'group' (all,jvm,jetty,node,core), - 'type' (all,counter,timer,gauge,histogram), - 'prefix' that filters the returned metrics, - 'registry' that selects one or more registries by prefix (eg. solr.jvm,solr.core.collection1) - Example: http://localhost:8983/solr/admin/metrics?group=jvm,jetty&type=counter - Example: http://localhost:8983/solr/admin/metrics?group=jvm&prefix=buffers,os - Example: http://localhost:8983/solr/admin/metrics?registry=solr.node,solr.core&prefix=ADMIN [SOLR-9812](https://issues.apache.org/jira/browse/SOLR-9812) [SOLR-9911](https://issues.apache.org/jira/browse/SOLR-9911) [SOLR-9960](https://issues.apache.org/jira/browse/SOLR-9960) (shalin) (ab)
- FieldCache information fetched via the mbeans handler or seen via the UI now displays the total size used. The individual cache entries in the response are now formatted better as well. [SOLR-9844](https://issues.apache.org/jira/browse/SOLR-9844) (Varun Thacker)
- Collect metrics for index merges and index store IO [SOLR-9854](https://issues.apache.org/jira/browse/SOLR-9854) (ab)
- Collect metrics for shard replication and tlog replay on replicas [SOLR-9856](https://issues.apache.org/jira/browse/SOLR-9856) (ab)
- Enable configuring invariantParams via HttpSolrClient.Builder [SOLR-9860](https://issues.apache.org/jira/browse/SOLR-9860) (Hrishikesh Gadre) (Ishan Chattopadhyaya)
- Use instrumented http client and connection pool in HttpShardHandler and UpdateShardHandler. The metrics are collected per query-less URL and method by default but it can be configured to host/method and per-method as well. [SOLR-9877](https://issues.apache.org/jira/browse/SOLR-9877) [SOLR-9923](https://issues.apache.org/jira/browse/SOLR-9923) [SOLR-9948](https://issues.apache.org/jira/browse/SOLR-9948) (shalin)
- Add Ganglia, Graphite and SLF4J metrics reporters. [SOLR-9880](https://issues.apache.org/jira/browse/SOLR-9880) (ab)
- Add version to segments handler output [SOLR-9884](https://issues.apache.org/jira/browse/SOLR-9884) (Steven Bower) (Erick Erickson)
- Add a 'enable' flag to caches to enable/disable them [SOLR-9886](https://issues.apache.org/jira/browse/SOLR-9886) (Pushkar Raste) (noble)
- Add mkroot command to bin/solr and bin/solr.cmd [SOLR-9891](https://issues.apache.org/jira/browse/SOLR-9891) (Erick Erickson)
- Instrument and collect metrics from query, update, core admin and core load thread pools. [SOLR-9896](https://issues.apache.org/jira/browse/SOLR-9896) (shalin)
- Add hl.requireFieldMatch toggle support when using the UnifiedHighlighter. Defaults to false like the other highlighters that support this. [SOLR-9897](https://issues.apache.org/jira/browse/SOLR-9897) (David Smiley)
- Add NullStream to isolate the performance of the ExportWriter [SOLR-9905](https://issues.apache.org/jira/browse/SOLR-9905) (Joel Bernstein)
- Add SkipExistingDocumentsProcessor that skips duplicate inserts and ignores updates to missing docs [SOLR-9918](https://issues.apache.org/jira/browse/SOLR-9918) (Tim Owen) (koji)
- Add hl.fragsize support when using the UnifiedHighlighter to avoid snippets/Passages that are too small. Defaults to 70. [SOLR-9935](https://issues.apache.org/jira/browse/SOLR-9935) (David Smiley)
- Clean up some SolrInfoMBean categories. Add an alternative hierarchical view in JMX for SolrInfoMBeans, which uses similar conventions to SolrJmxReporter. [SOLR-9947](https://issues.apache.org/jira/browse/SOLR-9947) (ab)

### Changed (5 changes)

- Facet Module / JSON Facet API: Optimize blockChildren facets that have filters specified by using those filters as acceptDocs. [SOLR-9704](https://issues.apache.org/jira/browse/SOLR-9704) (yonik)
- Reduce number of lookupOrd calls made by the DocValuesFacets.getCounts method. [SOLR-9726](https://issues.apache.org/jira/browse/SOLR-9726) (Jonny Marks) (Christine Poerschke)
- Deriving distributed sort values (fieldSortValues) should reuse comparator and only invalidate leafComparator. [SOLR-9772](https://issues.apache.org/jira/browse/SOLR-9772) (John Call) (yonik)
- FieldType has a new getSetQuery() method that can take a set of terms and create a more efficient query (such as TermsQuery). The solr query parser has been changed to use this method when appropriate. The parser also knows when it is being used to parse a filter and will create TermsQueries from large lists of normal terms or numbers, resulting in a query that will execute faster. This also acts to avoid BooleanQuery maximum clause limit. Query parsing itself has also been optimized, resulting in less produced garbage and 5-7% better performance. [SOLR-9786](https://issues.apache.org/jira/browse/SOLR-9786) (yonik)
- StandardDirectoryFactory should use Files API for it's move implementation. [SOLR-9902](https://issues.apache.org/jira/browse/SOLR-9902) (Mark Miller) (Mike Drob)

### Fixed (38 changes)

- It may be possible for temporary files to accumulate until the Solr process is shut down. [SOLR-1953](https://issues.apache.org/jira/browse/SOLR-1953) (Karl Wright) (Mark Miller)
- Facet search on a docvalue field in a multi shard collection [SOLR-5260](https://issues.apache.org/jira/browse/SOLR-5260) (Trym Møller) (Erick Erickson)
- Support Facet.field on a non-DocValued, single-value, int field [SOLR-7495](https://issues.apache.org/jira/browse/SOLR-7495) (Varun Thacker) (Scott Stults)
- In files example, add a guard condition to javascript URP script [SOLR-9005](https://issues.apache.org/jira/browse/SOLR-9005) (Alexandre Rafalovitch)
- Fix DirectSolrSpellChecker to work when added through the Config API. [SOLR-9154](https://issues.apache.org/jira/browse/SOLR-9154) (Anshum Gupta)
- The HDFS BlockDirectoryCache should not let it's keysToRelease or names maps grow indefinitely. [SOLR-9284](https://issues.apache.org/jira/browse/SOLR-9284) (Mark Miller) (Michael Sun)
- Solr script not properly checking SOLR_PID [SOLR-9360](https://issues.apache.org/jira/browse/SOLR-9360) (Alessandro Benedetti) (Erick Erickson)
- SolrCore clean-up logic uses incorrect path to delete dataDir on failure to create a core. [SOLR-9433](https://issues.apache.org/jira/browse/SOLR-9433) (Evan Sayer) (shalin)
- AIOBE with confusing message for incomplete sort spec in Streaming Expression [SOLR-9495](https://issues.apache.org/jira/browse/SOLR-9495) (Gus Heck) (Joel Bernstein)
- NPE in Replica Placement Rules when using Overseer Role with other rules [SOLR-9503](https://issues.apache.org/jira/browse/SOLR-9503) (Tim Owen) (noble)
- CloudSolrClient's cluster state cache can break direct updates to leaders [SOLR-9512](https://issues.apache.org/jira/browse/SOLR-9512) (noble)
- JSON Facet API: don't stop at an empty facet bucket if any sub-facets still have a chance of matching something due to filter exclusions (which can widen the domain again). [SOLR-9519](https://issues.apache.org/jira/browse/SOLR-9519) (Michael Sun) (yonik)
- Solr throws exception when expand=true on empty index [SOLR-9616](https://issues.apache.org/jira/browse/SOLR-9616) (Timo Hund) (Ishan Chattopadhyaya)
- In Admin UI, do not attempt to highlight CSV output [SOLR-9624](https://issues.apache.org/jira/browse/SOLR-9624) (Alexandre Rafalovitch)
- new Admin UI now also highlights matched terms in the Analysis screen. [SOLR-9626](https://issues.apache.org/jira/browse/SOLR-9626) (Alexandre Rafalovitch)
- SimpleMLTQParser and CloudMLTQParser did not handle field boosts properly and CloudMLTQParser included extra strings from the field definitions in the query. [SOLR-9644](https://issues.apache.org/jira/browse/SOLR-9644) (Ere Maijala) (Anshum Gupta)
- fix exception from core status in parallel with core reload [SOLR-9699](https://issues.apache.org/jira/browse/SOLR-9699) [SOLR-4668](https://issues.apache.org/jira/browse/SOLR-4668) (Mikhail Khludnev)
- NPE in export handler when "fl" parameter is omitted. [SOLR-9701](https://issues.apache.org/jira/browse/SOLR-9701) (Erick Erickson)
- Don't forward DeleteByQuery requests to down replicas. [SOLR-9707](https://issues.apache.org/jira/browse/SOLR-9707) (Jessica Cheng Mallet) (Varun Thacker)
- RecoveryStrategy sends prep recovery command without setting read time out which can cause replica recovery to hang indefinitely on network partitions. [SOLR-9716](https://issues.apache.org/jira/browse/SOLR-9716) (Cao Manh Dat) (shalin)
- JDBCStream improvements [SOLR-9729](https://issues.apache.org/jira/browse/SOLR-9729) (Kevin Risden)
- Solr resolves the collection name against the first available leader or first replica of the first slice. This puts undue pressure on leader cores and likely on the wrong ones. This is fixed to randomly pick a leader on updates or a replica core otherwise. [SOLR-9736](https://issues.apache.org/jira/browse/SOLR-9736) (Cao Manh Dat) (shalin)
- A bug in macro expansion of multi-valued parameters caused non-expanded values after the first expanded value in the same multi-valued parameter to be dropped. [SOLR-9740](https://issues.apache.org/jira/browse/SOLR-9740) (Erik Hatcher) (yonik)
- PreAnalyzedField can cause managed schema corruption. [SOLR-9751](https://issues.apache.org/jira/browse/SOLR-9751) (Steve Rowe)
- Windows script doesn't need write permission [SOLR-9760](https://issues.apache.org/jira/browse/SOLR-9760) (Alex Crome by Mikhail Khludnev)
- RecordingJsonParser produces incomplete json [SOLR-9768](https://issues.apache.org/jira/browse/SOLR-9768) (Wojciech Stryszyk) (ab)
- CoreContainer incorrectly setting MDCLoggingContext for core [SOLR-9823](https://issues.apache.org/jira/browse/SOLR-9823) (Jessica Cheng Mallet) (Erick Erickson)
- Schema modifications are not immediately visible on the coordinating node. [SOLR-9832](https://issues.apache.org/jira/browse/SOLR-9832) (Steve Rowe)
- A variety of spots in the code can create a collection zk node after the collection has been removed. [SOLR-9834](https://issues.apache.org/jira/browse/SOLR-9834) (Mark Miller)
- Stop blocking further schema updates while waiting for a pending update to propagate to other replicas. This reduces the likelihood of a (time-limited) distributed deadlock during concurrent schema updates. [SOLR-9847](https://issues.apache.org/jira/browse/SOLR-9847) (Mark Miller) (Steve Rowe)
- replication.properties cannot be updated after being written and neither replication.properties or index.properties are durable in the face of a crash. [SOLR-9859](https://issues.apache.org/jira/browse/SOLR-9859) (Pushkar Raste) (Chris de Kok) (Cao Manh Dat) (Mark Miller)
- Example schemaless solr config files can lead to invalid tlog replays: when updates are buffered, update processors ordered before DistributedUpdateProcessor, e.g. field normalization, are never run. [SOLR-9883](https://issues.apache.org/jira/browse/SOLR-9883) (Steve Rowe)
- fix false positives on range queries with ReversedWildcardFilterFactory [SOLR-9900](https://issues.apache.org/jira/browse/SOLR-9900) (Yonik Seeley) (Mikhail Khludnev)
- Implement move in HdfsDirectoryFactory. [SOLR-9901](https://issues.apache.org/jira/browse/SOLR-9901) (Mark Miller)
- JSON Facet API percentile function caused a NullPointerException in distributed mode when there were no values in a bucket from a shard. [SOLR-9917](https://issues.apache.org/jira/browse/SOLR-9917) (yonik)
- random Streaming Expression is not registered in /stream or /graph handler [SOLR-9919](https://issues.apache.org/jira/browse/SOLR-9919) (Joel Bernstein)
- JSON Facet API hll (hyper-log-log) function returned 0 for non-empty buckets with no field values in local mode, but nothing for distributed mode. Both modes now return 0. [SOLR-9931](https://issues.apache.org/jira/browse/SOLR-9931) (yonik)
- Prevent against failure during failed snapshot cleanup from swallowing the actual cause for the snapshot to fail. [SOLR-9954](https://issues.apache.org/jira/browse/SOLR-9954) (thelabdude)

### Other (28 changes)

- Moves getIndexSize() from ReplicationHandler to SolrCore [SOLR-3990](https://issues.apache.org/jira/browse/SOLR-3990) (Shawn Heisey)
- Upgrade the clustering plugin to Carrot2 3.15.0. [SOLR-7539](https://issues.apache.org/jira/browse/SOLR-7539) (Dawid Weiss)
- Factor HttpShardHandler[Factory]'s url shuffling out into a ReplicaListTransformer class. [SOLR-8332](https://issues.apache.org/jira/browse/SOLR-8332) (Christine Poerschke) (Noble Paul)
- Use Dropwizard Metrics library for core metrics. The copied over code in org.apache.solr.util.stats has been removed. [SOLR-8785](https://issues.apache.org/jira/browse/SOLR-8785) (Jeff Wartes) (Kelvin Wong) (Christine Poerschke) (shalin)
- Refactored TestSegmentSorting out of TestMiniSolrCloudCluster [SOLR-8959](https://issues.apache.org/jira/browse/SOLR-8959) (hossman)
- providing a test to workaround a differently named uniqueKey field [SOLR-9448](https://issues.apache.org/jira/browse/SOLR-9448) (Mikhail Khludnev)
- Add setReadOnly(String ...) to ConnectionImpl [SOLR-9597](https://issues.apache.org/jira/browse/SOLR-9597) (Kevin Risden)
- Change hard-coded keysize from 512 to 1024 [SOLR-9609](https://issues.apache.org/jira/browse/SOLR-9609) (Jeremy Martini) (Erick Erickson)
- Remove several Guava & Apache Commons calls in favor of java 8 alternatives. [SOLR-9621](https://issues.apache.org/jira/browse/SOLR-9621) (Michael Braun) (David Smiley)
- in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec) [SOLR-9660](https://issues.apache.org/jira/browse/SOLR-9660) (Judith Silverman) (Christine Poerschke)
- Refactor '/export' to not hardcode the JSON output and to use an API [SOLR-9717](https://issues.apache.org/jira/browse/SOLR-9717) (noble)
- Refactor Responsewriters to remove dependencies on TupleStream, Tuple, Explanation [SOLR-9720](https://issues.apache.org/jira/browse/SOLR-9720) (noble)
- JavabinCodec implements PushWriter interface [SOLR-9739](https://issues.apache.org/jira/browse/SOLR-9739) (noble)
- refactor preferLocalShards implementation [SOLR-9758](https://issues.apache.org/jira/browse/SOLR-9758) (Christine Poerschke)
- IndexFingerprinting should use getCombinedCoreAndDeletesKey() instead of getCoreCacheKey() for per-segment caching [SOLR-9777](https://issues.apache.org/jira/browse/SOLR-9777) (Ishan Chattopadhyaya)
- (Search|Top)Group[s]ShardResponseProcessor.process: turned sortWithinGroup null check into assert. [SOLR-9783](https://issues.apache.org/jira/browse/SOLR-9783) (Christine Poerschke)
- Refactor CloudSolrClient to eliminate direct dependency on ZK [SOLR-9784](https://issues.apache.org/jira/browse/SOLR-9784) (noble)
- Upgrade jetty to 9.3.14.v20161028 [SOLR-9801](https://issues.apache.org/jira/browse/SOLR-9801) (shalin)
- Upgrade commons-fileupload to 1.3.2, fixing a potential vulnerability CVE-2016-3092 [SOLR-9819](https://issues.apache.org/jira/browse/SOLR-9819) (Anshum Gupta)
- ConcurrentUpdateSolrClient creates a RemoteSolrException if the remote host responded with a non-ok response (instead of a SolrException) and includes the remote error message as part of the exception message [SOLR-9827](https://issues.apache.org/jira/browse/SOLR-9827) (Tomás Fernández Löbbe)
- OverseerAutoReplicaFailoverThread can take too long to stop and leak out of unit tests. [SOLR-9846](https://issues.apache.org/jira/browse/SOLR-9846) (Mark Miller)
- Solr will reject CREATEALIAS requests if target collections don't exist [SOLR-9874](https://issues.apache.org/jira/browse/SOLR-9874) (Tomás Fernández Löbbe)
- fixing lazy logic for retrieving ReversedWildcardFilterFactory in SolrQueryParserBase [SOLR-9878](https://issues.apache.org/jira/browse/SOLR-9878) (Mikhail Khludnev)
- Update Mockito to version 2.6.2 for Java 9 support. Disable all legacy EasyMock tests when running on Java 9 until they were migrated to Mockito. [SOLR-9893](https://issues.apache.org/jira/browse/SOLR-9893) (Uwe Schindler)
- StandardDirectoryFactory should use optimizations for all FilterDirectorys not just NRTCachingDirectory. [SOLR-9899](https://issues.apache.org/jira/browse/SOLR-9899) (Mark Miller)
- PeerSync alreadyInSync check is not backwards compatible and results in full replication during a rolling restart [SOLR-9915](https://issues.apache.org/jira/browse/SOLR-9915) (Tim Owen) (noble)
- SolrTestCase.clearIndex has been improved to take advantage of low level test specific logic that clears the index metadata more completely then a normal *:* DBQ can due to update versioning. [SOLR-9934](https://issues.apache.org/jira/browse/SOLR-9934) (hossman)
- Map the nodes function name to the GatherNodesStream [SOLR-9944](https://issues.apache.org/jira/browse/SOLR-9944) (Joel Bernstein)


[6.3.0] - 2016-11-08
--------------------

### Upgrade Notes (6 changes)

- We are no longer backing up solr.log and solr_gc.log files in date-stamped copies forever. If you relied on the solr_log_&lt;date&gt; or solr_gc_log_&lt;date&gt; being in the logs folder that will no longer be the case. See SOLR-9570 for details. [SOLR-9570](https://issues.apache.org/jira/browse/SOLR-9570) 
- If you use the JSON Facet API (json.facet) with method=stream, you must now set sort='index asc' to get the streaming behavior; otherwise it won't stream. Reminder: "method" is a hint that doesn't change defaults of other parameters. 
- If you use the JSON Facet API (json.facet) to facet on a numeric field and if you use mincount=0 or if you set the prefix, then you will now get an error as these options are incompatible with numeric faceting. 
- Solr's logging verbosity at the INFO level has been greatly reduced, and you may need to update the log configs to use the DEBUG level to see all the logging messages you used to see at INFO level before. 
- The create/deleteCollection methods on MiniSolrCloudCluster have been deprecated. Clients should instead use the CollectionAdminRequest API. In addition, MiniSolrCloudCluster#uploadConfigDir(File, String) has been deprecated in favour of #uploadConfigSet(Path, String) 
- The bin/solr.in.sh (bin/solr.in.cmd on Windows) is now completely commented by default. Previously, this wasn't so, which had the effect of masking existing environment variables. 

### Added (27 changes)

- Add support for MoreLikeThis queries and responses in SolrJ client. [SOLR-1085](https://issues.apache.org/jira/browse/SOLR-1085) (Maurice Jumelet) (Bill Mitchell) (Cao Manh Dat) (shalin)
- Add a factory class corresponding to Lucene's NoMergePolicy. [SOLR-2212](https://issues.apache.org/jira/browse/SOLR-2212) (Lance Norskog) (Cao Manh Dat) (shalin)
- facet.method=enum can bypass exact counts calculation with facet.exists=true, it just returns 1 for terms which exists in result docset. [SOLR-5725](https://issues.apache.org/jira/browse/SOLR-5725) (Alexey Kozhemiakin) (Sebastian Koziel) (Radoslaw Zielinski) (Mikhail Khludnev)
- Reduce logging to logs/solr-&lt;port&gt;-console.log when not running in foreground mode Show timestamp also in foreground log. Also removes some logging noise. [SOLR-8186](https://issues.apache.org/jira/browse/SOLR-8186) (janhoy)
- Display configured Similarity in Schema-Browser, both global/default and per-field/field-type [SOLR-8370](https://issues.apache.org/jira/browse/SOLR-8370) (janhoy) (Alexandre Rafalovitch)
- Adds CommitStream to support sending commits to a collection being updated. [SOLR-8487](https://issues.apache.org/jira/browse/SOLR-8487) (Dennis Gove)
- Restore ability for users to add custom Streaming Expressions [SOLR-9103](https://issues.apache.org/jira/browse/SOLR-9103) (Cao Manh Dat)
- Excel workbook (.xlsx) response writer. use 'wt=xlsx' [SOLR-9127](https://issues.apache.org/jira/browse/SOLR-9127) (Tony Moriarty) (noble)
- Parallel SQL engine should support &gt;, &gt;=, &lt;, &lt;=, &lt;&gt;, != syntax [SOLR-9146](https://issues.apache.org/jira/browse/SOLR-9146) (Timothy Potter) (Joel Bernstein) (Kevin Risden)
- Added method LukeResponse.getSchemaFlags() which returns field information as an EnumSet [SOLR-9205](https://issues.apache.org/jira/browse/SOLR-9205) (Fengtan) (Alan Woodward)
- Optimizing, storing and deploying AI models with Streaming Expressions [SOLR-9258](https://issues.apache.org/jira/browse/SOLR-9258) (Cao Manh Dat) (Joel Bernstein)
- DELETEREPLICA can accept a 'count' and remove appropriate replicas [SOLR-9319](https://issues.apache.org/jira/browse/SOLR-9319) (Nitin Sharma) (noble)
- Ability to create/delete/list snapshots at collection level. [SOLR-9326](https://issues.apache.org/jira/browse/SOLR-9326) (Hrishikesh Gadre) (yonik)
- Add fetch Streaming Expression [SOLR-9337](https://issues.apache.org/jira/browse/SOLR-9337) (Joel Bernstein)
- Allow daemons to terminate when they finish iterating a topic [SOLR-9417](https://issues.apache.org/jira/browse/SOLR-9417) (Joel Bernstein)
- JettySolrRunner now has the option of restarting using a different port [SOLR-9469](https://issues.apache.org/jira/browse/SOLR-9469) (Alan Woodward)
- Kerberos delegation support in SolrJ [SOLR-9520](https://issues.apache.org/jira/browse/SOLR-9520) (Ishan Chattopadhyaya) (noble)
- You can now set Solr's log level through environment variable SOLR_LOG_LEVEL Also adds conveience arguments -q (quiet: WARN) and -v (verbose: DEBUG) to bin/solr [SOLR-9534](https://issues.apache.org/jira/browse/SOLR-9534) (janhoy)
- Support facet scoring with the scoreNodes expression [SOLR-9537](https://issues.apache.org/jira/browse/SOLR-9537) (Joel Bernstein)
- Every implicit requesthandler now has a default 'useParams' attribute [SOLR-9557](https://issues.apache.org/jira/browse/SOLR-9557) (noble)
- DIH TemplateTransformerto to support multivalued fields [SOLR-9558](https://issues.apache.org/jira/browse/SOLR-9558) (Ted Sullivan) (noble)
- Add ExecutorStream to execute stored Streaming Expressions [SOLR-9559](https://issues.apache.org/jira/browse/SOLR-9559) (Joel Bernstein)
- config API to show expanded useParams for request handlers inline [SOLR-9572](https://issues.apache.org/jira/browse/SOLR-9572) (noble)
- Add "overrequest" parameter to JSON Facet API to control amount of overrequest on a distributed terms facet. [SOLR-9654](https://issues.apache.org/jira/browse/SOLR-9654) (yonik)
- New TemplateUpdateProcessorFactory added [SOLR-9657](https://issues.apache.org/jira/browse/SOLR-9657) (noble)
- New parameter -u &lt;user:pass&gt; in bin/post to pass basicauth credentials [SOLR-9662](https://issues.apache.org/jira/browse/SOLR-9662) (janhoy)
- Support SOLR_AUTHENTICATION_OPTS in solr.cmd [SOLR-9670](https://issues.apache.org/jira/browse/SOLR-9670) (janhoy)

### Changed (11 changes)

- Roll over GC logs by default via bin/solr scripts [SOLR-7506](https://issues.apache.org/jira/browse/SOLR-7506) (shalin) (janhoy)
- JSON Facet API: new method=dvhash can be chosen for fields with high cardinality. [SOLR-9142](https://issues.apache.org/jira/browse/SOLR-9142) (David Smiley)
- Speed up Jmx MBean retrieval for FieldCache. [SOLR-9374](https://issues.apache.org/jira/browse/SOLR-9374) (Tim Owen) (shalin)
- Leader failure after creating a freshly replicated index can send nodes into recovery even if index was not changed [SOLR-9446](https://issues.apache.org/jira/browse/SOLR-9446) (Pushkar Raste) (noble)
- Do not clone SolrInputDocument if update processor chain does not contain custom processors. [SOLR-9447](https://issues.apache.org/jira/browse/SOLR-9447) (shalin)
- Example schemas do not index _version_ field anymore because the field has DocValues enabled already. [SOLR-9449](https://issues.apache.org/jira/browse/SOLR-9449) (shalin)
- JsonRecordReader should not deep copy document before handler.handle(). [SOLR-9452](https://issues.apache.org/jira/browse/SOLR-9452) (noble) (shalin)
- cache IndexFingerprint for each segment [SOLR-9506](https://issues.apache.org/jira/browse/SOLR-9506) (Pushkar Raste) (yonik) (noble)
- Eliminate unnecessary boxing/unboxing going on in SolrParams [SOLR-9546](https://issues.apache.org/jira/browse/SOLR-9546) (Pushkar Raste) (noble)
- Don't put replicas into recovery when first creating a Collection [SOLR-9566](https://issues.apache.org/jira/browse/SOLR-9566) (Alan Woodward)
- retrieving docValues as stored values was sped up by using the proper leaf reader rather than ask for a global view. In extreme cases, this leads to a 100x speedup. [SOLR-9592](https://issues.apache.org/jira/browse/SOLR-9592) (Takahiro Ishikawa) (yonik)

### Fixed (26 changes)

- Multivalued fields with dynamic names does not work properly with DIH. [SOLR-2039](https://issues.apache.org/jira/browse/SOLR-2039) (K A) (ruslan.shv) (Cao Manh Dat) (shalin)
- XPathEntityProcessor should reinitialize the XPathRecordReader instance if the 'forEach' or 'xpath' attributes are templates & it is not a root entity [SOLR-2094](https://issues.apache.org/jira/browse/SOLR-2094) (Cao Manh Dat) (noble)
- group.limit=-1 was not supported for grouping in distributed mode. [SOLR-4164](https://issues.apache.org/jira/browse/SOLR-4164) (Cao Manh Dat) (Lance Norskog) (Webster Homer) (hossman) (yonik)
- bin/solr start script now exits with informative message if using wrong Java version [SOLR-8080](https://issues.apache.org/jira/browse/SOLR-8080) (janhoy)
- Index replication interactions with IndexWriter can cause deadlock. [SOLR-9278](https://issues.apache.org/jira/browse/SOLR-9278) (Xunlong) (Mark Miller)
- PeerSync fails on a node restart due to IndexFingerPrint mismatch [SOLR-9310](https://issues.apache.org/jira/browse/SOLR-9310) (Pushkar Raste) (noble)
- solr.log is now written to $SOLR_LOGS_DIR without changing log4j.properties [SOLR-9325](https://issues.apache.org/jira/browse/SOLR-9325) (janhoy)
- Fix AlreadyClosedException on admin/mbeans?stats=true [SOLR-9330](https://issues.apache.org/jira/browse/SOLR-9330) (Mikhail Khludnev)
- Better validation for Schema API add-field and add-dynamic-field [SOLR-9411](https://issues.apache.org/jira/browse/SOLR-9411) (janhoy) (Steve Rowe)
- Solr collection backup on HDFS can only be manipulated by the Solr process owner. [SOLR-9441](https://issues.apache.org/jira/browse/SOLR-9441) (Hrishikesh Gadre) (Mark Miller)
- bin/install_solr_service.sh script got improved detection of Linux distro, especially within virtualized/Docker environment through parsing of /etc/*-release files. Now also supports CentOS. [SOLR-9475](https://issues.apache.org/jira/browse/SOLR-9475) (janhoy)
- The modify collection API should wait for the modified properties to show up in the cluster state. [SOLR-9484](https://issues.apache.org/jira/browse/SOLR-9484) (Cao Manh Dat) (shalin)
- A replica with an empty index becomes the leader even when other more qualified replicas are in line. [SOLR-9504](https://issues.apache.org/jira/browse/SOLR-9504) (shalin)
- CoreContainer threads now correctly set their MDC logging values [SOLR-9507](https://issues.apache.org/jira/browse/SOLR-9507) (Alan Woodward)
- Kerberos Delegation Tokens don't work without a chrooted ZK [SOLR-9518](https://issues.apache.org/jira/browse/SOLR-9518) (Ishan Chattopadhyaya) (noble)
- Improve error handling in ZKPropertiesWriter [SOLR-9522](https://issues.apache.org/jira/browse/SOLR-9522) (Varun Thacker)
- SolrIndexSearcher.getIndexFingerprint uses dubious synchronization [SOLR-9524](https://issues.apache.org/jira/browse/SOLR-9524) (Mike Drob) (noble)
- OldBackupDirectory timestamp field needs to be initialized to avoid NPE. [SOLR-9536](https://issues.apache.org/jira/browse/SOLR-9536) (Hrishikesh Gadre) (hossman) (Mark Miller)
- Kerberos delegation tokens requires Jackson library [SOLR-9542](https://issues.apache.org/jira/browse/SOLR-9542) (Ishan Chattopadhyaya) (noble)
- Fix NullPointerException when cores are loaded in parallel and switch schema.xml to managed-scheme. [SOLR-9554](https://issues.apache.org/jira/browse/SOLR-9554) (Alan Woodward) (Mikhail Khludnev)
- OverseerAutoFailoverReplicaThread was not exiting on interrupt [SOLR-9556](https://issues.apache.org/jira/browse/SOLR-9556) (Alan Woodward)
- Collection creation could fail if an ADDREPLICA subrequest arrived at a node before its local state had updated with the new collection data [SOLR-9563](https://issues.apache.org/jira/browse/SOLR-9563) (Alan Woodward)
- Pooled SSL connections were not being re-used [SOLR-9604](https://issues.apache.org/jira/browse/SOLR-9604) (Alan Woodward) (Mikhail Khludnev) (hossman)
- Fixed Interval Facet count issue in cases of open/close intervals on the same values [SOLR-9687](https://issues.apache.org/jira/browse/SOLR-9687) (Andy Chillrud) (Tomás Fernández Löbbe)
- blockUnknown property makes inter-node communication impossible [SOLR-9692](https://issues.apache.org/jira/browse/SOLR-9692) (noble)
- zk upconfig broken on windows [SOLR-9697](https://issues.apache.org/jira/browse/SOLR-9697) (Xavier Jmlucjav) (janhoy)

### Other (44 changes)

- Add tests to ensure that recovery does not fail on corrupted tlogs. [SOLR-4531](https://issues.apache.org/jira/browse/SOLR-4531) (Simon Scofield) (Cao Manh Dat) (shalin)
- Add a test to make sure that a leader always recovers from log on startup. [SOLR-5041](https://issues.apache.org/jira/browse/SOLR-5041) (Cao Manh Dat) (shalin)
- Add a test to ensure that election contexts are keyed off both collection name and coreNodeName so that killing a shard in one collection does not result in leader election in a different collection. See SOLR-5243 for the related bug. [SOLR-5245](https://issues.apache.org/jira/browse/SOLR-5245) [SOLR-5243](https://issues.apache.org/jira/browse/SOLR-5243) (Cao Manh Dat) (shalin)
- Move lots of SolrCloud logging from 'info' to 'debug' [SOLR-5563](https://issues.apache.org/jira/browse/SOLR-5563) (janhoy) (Alan Woodward)
- Remove unreachable printLayout usage in cloud tests. [SOLR-6090](https://issues.apache.org/jira/browse/SOLR-6090) (Cao Manh Dat) (shalin)
- Reduced logging during startup and shutdown, moved more logs to DEBUG level [SOLR-6677](https://issues.apache.org/jira/browse/SOLR-6677) (janhoy) (Shawn Heisey) (Alan Woodward)
- Updated the quickstart tutorial to cover the 6.2.0 release, and added ant target "generate-website-quickstart" to convert the bundled version of the tutorial into one suitable for the website. [SOLR-6871](https://issues.apache.org/jira/browse/SOLR-6871) 
- Solr stops printing stacktraces in log and output [SOLR-7436](https://issues.apache.org/jira/browse/SOLR-7436) (janhoy) (hossman) (Markus Jelsma)
- Refuse "bin/solr create" if run as root, unless -force is specified [SOLR-7826](https://issues.apache.org/jira/browse/SOLR-7826) (janhoy) (Binoy Dalal)
- Moved defaults within bin/solr.in.sh (and bin/solr.in.cmd on Windows) to bin/solr (and bin/solr.cmd) such that the default state of these files is to set nothing. This makes Solr work better with Docker. [SOLR-7850](https://issues.apache.org/jira/browse/SOLR-7850) (David Smiley)
- Remove mentions of unimplemented admin-extra from the new Admin UI [SOLR-8140](https://issues.apache.org/jira/browse/SOLR-8140) (Alexandre Rafalovitch)
- Narrow StreamFactory.withFunctionName clazz parameter to prevent misconfiguration [SOLR-8385](https://issues.apache.org/jira/browse/SOLR-8385) (Jason Gerlowski) (Kevin Risden)
- Add a test module for solr-test-framework [SOLR-8961](https://issues.apache.org/jira/browse/SOLR-8961) (Alan Woodward)
- SQLHandler causes NPE in non-cloud mode [SOLR-8969](https://issues.apache.org/jira/browse/SOLR-8969) (Markus Jelsma) (Kevin Risden)
- Reduce noise in solr logs during graceful shutdown. [SOLR-9365](https://issues.apache.org/jira/browse/SOLR-9365) (Cao Manh Dat) (shalin)
- Fix bin/solr calculations for start/stop wait time and RMI_PORT. [SOLR-9371](https://issues.apache.org/jira/browse/SOLR-9371) (Shawn Heisey) (Erick Erickson)
- SolrSuggester should selectively register close hook [SOLR-9406](https://issues.apache.org/jira/browse/SOLR-9406) (Gethin James) (Joel Bernstein)
- Add failOnMissingParams option to MacroExpander, add TestMacroExpander class. [SOLR-9412](https://issues.apache.org/jira/browse/SOLR-9412) (Jon Dorando) (Christine Poerschke)
- Make clusterstatus command logging less verbose. [SOLR-9451](https://issues.apache.org/jira/browse/SOLR-9451) (Varun Thacker)
- MiniSolrCloudCluster will not reuse ports by default when restarting its JettySolrRunners [SOLR-9474](https://issues.apache.org/jira/browse/SOLR-9474) (Alan Woodward)
- Remove HDFS properties from DIH solrconfig.xml, as started in SOLR-6943 [SOLR-9498](https://issues.apache.org/jira/browse/SOLR-9498) [SOLR-6943](https://issues.apache.org/jira/browse/SOLR-6943) (Alexandre Rafalovitch)
- Add a LogLevel annotation to set log levels on specific tests [SOLR-9500](https://issues.apache.org/jira/browse/SOLR-9500) (Alan Woodward)
- ResponseWriters should natively support MapSerializable [SOLR-9502](https://issues.apache.org/jira/browse/SOLR-9502) (noble)
- Install script install_solr_service.sh now checks existence of tools. New option -n to avoid starting service after installation [SOLR-9508](https://issues.apache.org/jira/browse/SOLR-9508) (janhoy)
- Reload core config when a core is reloaded [SOLR-9533](https://issues.apache.org/jira/browse/SOLR-9533) (Gethin James) (Joel Bernstein)
- Relocate (BinaryResponse|JSON|Smile)Writer tests to org.apache.solr.response which is the package of the classes they test. [SOLR-9538](https://issues.apache.org/jira/browse/SOLR-9538) (Jonny Marks) (Christine Poerschke)
- Allow ObjectReleaseTracker more time to check for asynchronously closing resources [SOLR-9544](https://issues.apache.org/jira/browse/SOLR-9544) (Alan Woodward)
- Do not allow bin/solr start as root user, unless -force param specified [SOLR-9547](https://issues.apache.org/jira/browse/SOLR-9547) (janhoy)
- The beginning of solr.log now starts with a more informative welcome message [SOLR-9548](https://issues.apache.org/jira/browse/SOLR-9548) (janhoy)
- Add JSONWriter constructor variant, JSONWriterTest.testConstantsUnchanged test. [SOLR-9551](https://issues.apache.org/jira/browse/SOLR-9551) (Jonny Marks) (Christine Poerschke)
- Make ReRankQParserPlugin's private ReRankCollector a public class of its own. [SOLR-9567](https://issues.apache.org/jira/browse/SOLR-9567) (Christine Poerschke)
- Various log tidying now happens at Solr startup: Old solr_log_&lt;date&gt; and solr_gc_log_&lt;date&gt; files are removed, avoiding disks to fill up, solr.log.X files are rotated, preserving solr.log from last run in solr.log.1, solr.log.1 =&gt; solr.log.2 etc solr-*-console.log files are moved into $SOLR_LOGS_DIR/archived/ instead of being overwritten Last JVM garbage collection log solr_gc.log is moved into $SOLR_LOGS_DIR/archived/ [SOLR-9570](https://issues.apache.org/jira/browse/SOLR-9570) (janhoy)
- Factor out AbstractReRankQuery from ReRankQParserPlugin's private ReRankQuery. [SOLR-9574](https://issues.apache.org/jira/browse/SOLR-9574) (Christine Poerschke)
- Make FieldAnalysisRequestHandler, DocumentAnalysisRequestHandler & DumpRequestHandler implicit [SOLR-9576](https://issues.apache.org/jira/browse/SOLR-9576) (noble)
- Remove Guava dependency from SolrJ [SOLR-9588](https://issues.apache.org/jira/browse/SOLR-9588) (Ishan Chattopadhyaya) (noble)
- Remove jackson dependency from SolrJ [SOLR-9589](https://issues.apache.org/jira/browse/SOLR-9589) (Ishan Chattopadhyaya) (noble)
- New AssertTool in SolrCLI for easier cross platform assertions from command line [SOLR-9610](https://issues.apache.org/jira/browse/SOLR-9610) (janhoy)
- Add HelloWorldSolrCloudTestCase class [SOLR-9625](https://issues.apache.org/jira/browse/SOLR-9625) (Christine Poerschke) (Alan Woodward) (Alexandre Rafalovitch)
- Add QParser.getSortSpec, deprecate misleadingly named QParser.getSort [SOLR-9627](https://issues.apache.org/jira/browse/SOLR-9627) (Judith Silverman) (Christine Poerschke)
- Add MiniSolrCloudCluster#deleteAllCollections() method [SOLR-9632](https://issues.apache.org/jira/browse/SOLR-9632) (Alan Woodward)
- Deprecate collection methods on MiniSolrCloudCluster [SOLR-9634](https://issues.apache.org/jira/browse/SOLR-9634) (Alan Woodward)
- Test only fix. Prevent CDCR tests from removing collection during recovery that used to blow up jvm [SOLR-9639](https://issues.apache.org/jira/browse/SOLR-9639) (Mikhail Khludnev)
- Refactor the core level snapshot cleanup mechanism to rely on Lucene [SOLR-9642](https://issues.apache.org/jira/browse/SOLR-9642) (Hrishikesh Gadre) (yonik)
- Better error messages in SolrCLI when authentication required [SOLR-9680](https://issues.apache.org/jira/browse/SOLR-9680) (janhoy)


[6.2.1] - 2016-09-20
--------------------

### Fixed (15 changes)

- fl renaming / alias of uniqueKey field generates null pointer exception in SolrCloud configuration [SOLR-6744](https://issues.apache.org/jira/browse/SOLR-6744) (Mike Drob) (Tomás Fernández Löbbe)
- blockUnknown property makes inter-node communication impossible [SOLR-9188](https://issues.apache.org/jira/browse/SOLR-9188) (noble)
- Snitch for freedisk uses '/' instead of 'coreRootDirectory' [SOLR-9381](https://issues.apache.org/jira/browse/SOLR-9381) (Tim Owen) (noble)
- HDFS Transaction logs stay open for writes which leaks Xceivers. [SOLR-9389](https://issues.apache.org/jira/browse/SOLR-9389) (Tim Owen) (Mark Miller)
- Fix TreeMergeOutputFormat to add timestamp metadata to a commit. SolrCloud replication relies on this. [SOLR-9408](https://issues.apache.org/jira/browse/SOLR-9408) (Jessica Cheng Mallet) (Varun Thacker)
- Fix locale lookup in DIH &lt;propertyWriter/&gt; to use BCP47 language tags to be consistent with other places in Solr. Language names still work for backwards compatibility. [SOLR-9430](https://issues.apache.org/jira/browse/SOLR-9430) (Uwe Schindler) (Boris Steiner)
- Shard split can be marked successful and sub-shard states switched to 'active' even when one or more sub-shards replicas do not recover due to the leader crashing or restarting between the time the replicas are created and before they can recover. This can cause data loss. [SOLR-9438](https://issues.apache.org/jira/browse/SOLR-9438) (shalin)
- Shard split clean up logic for older failed splits is faulty. The delete shard API has also been made more resilient against failures resulting from non-existent cores. [SOLR-9439](https://issues.apache.org/jira/browse/SOLR-9439) (shalin)
- Fix path usage for cloud backup/restore. [SOLR-9444](https://issues.apache.org/jira/browse/SOLR-9444) (Hrishikesh Gadre) (Uwe Schindler) (Varun Thacker)
- Admin requests are retried by CloudSolrClient and LBHttpSolrClient on failure. [SOLR-9445](https://issues.apache.org/jira/browse/SOLR-9445) (shalin)
- Deleting a sub-shard in recovery state can mark parent shard as inactive. [SOLR-9455](https://issues.apache.org/jira/browse/SOLR-9455) (shalin)
- DELETENODE, REPLACENODE should pass down the 'async' param to subcommands [SOLR-9461](https://issues.apache.org/jira/browse/SOLR-9461) (shalin) (noble)
- Shard split can fail to write commit data on shutdown/restart causing replicas to recover without replicating the index. This can cause data loss. [SOLR-9488](https://issues.apache.org/jira/browse/SOLR-9488) (shalin)
- Fixed bugs in BoolField that caused it to erroneously return "false" for all docs depending on usage [SOLR-9490](https://issues.apache.org/jira/browse/SOLR-9490) (Colvin Cowie) (Dan Fox) (hossman)
- Use of {!collapse} sometimes doesn't correctly return true for Collector.needsScores(), especially when the query was cached. This can cause an exception when 'q' is a SpanQuery or potentially others. [SOLR-9494](https://issues.apache.org/jira/browse/SOLR-9494) (David Smiley)

### Other (1 change)

- Fix TestReqParamsAPI test failures [SOLR-7362](https://issues.apache.org/jira/browse/SOLR-7362) (noble) (Varun Thacker)


[6.2.0] - 2016-08-25
--------------------

### Added (20 changes)

- CDCR: fall back to whole-index replication when tlogs are insufficient. [SOLR-6465](https://issues.apache.org/jira/browse/SOLR-6465) (Noble Paul) (Renaud Delbru) (shalin)
- Core level Backup/Restore now supports specifying the directory implementation to use via the "repository" parameter. [SOLR-7374](https://issues.apache.org/jira/browse/SOLR-7374) (Hrishikesh Gadre) (Varun Thacker) (Mark Miller)
- bin/solr script should support basic auth credentials provided in solr.in.sh [SOLR-8048](https://issues.apache.org/jira/browse/SOLR-8048) (noble)
- Solr core snapshots: The current commit can be snapshotted which retains the commit and associates it with a name. The core admin API can create snapshots, list them, and delete them. Snapshot names can be referenced in doing a core backup, and in replication. Snapshot metadata is stored in a new snapshot_metadata/ dir. [SOLR-9038](https://issues.apache.org/jira/browse/SOLR-9038) (Hrishikesh Gadre) (David Smiley)
- Add directUpdatesToLeadersOnly flag to solrj CloudSolrClient. [SOLR-9090](https://issues.apache.org/jira/browse/SOLR-9090) (Marvin Justice) (Christine Poerschke)
- Support dates and booleans in /export handler, support boolean DocValues fields [SOLR-9187](https://issues.apache.org/jira/browse/SOLR-9187) (Erick Erickson)
- Add scoreNodes Streaming Expression [SOLR-9193](https://issues.apache.org/jira/browse/SOLR-9193) (Joel Bernstein)
- Enhance the bin/solr script to perform file operations to/from Zookeeper [SOLR-9194](https://issues.apache.org/jira/browse/SOLR-9194) (Erick Erickson) (janhoy)
- Add Delegation Token Support to Solr. [SOLR-9200](https://issues.apache.org/jira/browse/SOLR-9200) (Gregory Chanan)
- Support collection.configName in MODIFYCOLLECTION request [SOLR-9216](https://issues.apache.org/jira/browse/SOLR-9216) (Keith Laban) (noble)
- Support parallel ETL with the topic expression [SOLR-9240](https://issues.apache.org/jira/browse/SOLR-9240) (Joel Bernstein)
- Collection Backup/Restore now supports specifying the directory implementation to use via the "repository" parameter. [SOLR-9242](https://issues.apache.org/jira/browse/SOLR-9242) (Hrishikesh Gadre) (Varun Thacker)
- Add terms.list parameter to the TermsComponent to fetch the docFreq for a list of terms [SOLR-9243](https://issues.apache.org/jira/browse/SOLR-9243) (Joel Bernstein)
- Support for a new tag 'role' in replica placement rules [SOLR-9251](https://issues.apache.org/jira/browse/SOLR-9251) (noble)
- Feature selection and logistic regression on text [SOLR-9252](https://issues.apache.org/jira/browse/SOLR-9252) (Cao Manh Dat) (Joel Bernstein)
- Allow spatialContextFactory to be simply "JTS". And if any spatial params include the old Spatial4j package "com.spatial4j.core" it is rewritten to "org.locationtech.spatial4j" with a warning. [SOLR-9270](https://issues.apache.org/jira/browse/SOLR-9270) (David Smiley)
- XML QueryParser support (defType=xmlparser) now extensible via configuration. [SOLR-9275](https://issues.apache.org/jira/browse/SOLR-9275) (Christine Poerschke)
- New boolean comparison function queries comparing numeric arguments: gt, gte, lt, lte, eq [SOLR-9279](https://issues.apache.org/jira/browse/SOLR-9279) (Doug Turnbull) (David Smiley)
- A DELETENODE command to delete all replicas in that node [SOLR-9318](https://issues.apache.org/jira/browse/SOLR-9318) (noble) (Nitin Sharma) (Varun Thacker)
- A REPLACENODE command to decommission an existing node with another new node [SOLR-9320](https://issues.apache.org/jira/browse/SOLR-9320) (noble) (Nitin Sharma) (Varun Thacker)

### Changed (4 changes)

- Make hdfs blockcache read buffer sizes configurable and improve cache concurrency. [SOLR-9219](https://issues.apache.org/jira/browse/SOLR-9219) (Mark Miller)
- Optimize ZkController.publishAndWaitForDownStates to not read all collection states and watch relevant collections instead. [SOLR-9264](https://issues.apache.org/jira/browse/SOLR-9264) (Hrishikesh Gadre) (shalin)
- Solr cache/search/update stats counters now use LongAdder which are supposed to have higher throughput under high contention. [SOLR-9335](https://issues.apache.org/jira/browse/SOLR-9335) (Varun Thacker)
- JSON Facets: method="stream" will no longer always uses & populates the filter cache, likely flushing it. 'cacheDf' can be configured to set a doc frequency threshold, now defaulting to 1/16th doc count. Using -1 Disables use of the cache. [SOLR-9350](https://issues.apache.org/jira/browse/SOLR-9350) (David Smiley) (yonik)

### Fixed (40 changes)

- In cloud-mode sort the cores smartly before loading & limit threads to improve cluster stability [SOLR-7280](https://issues.apache.org/jira/browse/SOLR-7280) (noble) (Erick Erickson) (shalin)
- UI Cloud-&gt;Tree view now shows .txt files correctly [SOLR-8379](https://issues.apache.org/jira/browse/SOLR-8379) (Alexandre Rafalovitch) (janhoy)
- TestLazyCores is failing a lot on the Jenkins cluster. [SOLR-8546](https://issues.apache.org/jira/browse/SOLR-8546) (Erick Erickson)
- Web UI doesn't correctly generate queries which include local parameters [SOLR-8596](https://issues.apache.org/jira/browse/SOLR-8596) (Alexandre Rafalovitch) (janhoy)
- 404 error when clicking nodes in cloud graph view in angular UI. [SOLR-8626](https://issues.apache.org/jira/browse/SOLR-8626) (janhoy) (Trey Grainger) (shalin)
- managed-schema is now syntax highlighted in cloud-&gt;Tree view [SOLR-8645](https://issues.apache.org/jira/browse/SOLR-8645) (Alexandre Rafalovitch) (janhoy)
- Fix SolrRequestInfo error logs if QuerySenderListener is being used [SOLR-8657](https://issues.apache.org/jira/browse/SOLR-8657) (Pascal Chollet) (Tomás Fernández Löbbe)
- Admin UI's Schema screen now works for fields with stored=false and some content indexed [SOLR-8715](https://issues.apache.org/jira/browse/SOLR-8715) (Alexandre Rafalovitch)
- Duplicate Solr process can cripple a running process. [SOLR-8777](https://issues.apache.org/jira/browse/SOLR-8777) (Jessica Cheng Mallet) (Scott Blum) (shalin)
- SolrIndexSearcher#doc() completely ignores field filters unless lazy field loading is enabled. [SOLR-8858](https://issues.apache.org/jira/browse/SOLR-8858) (Caleb Rackliffe) (David Smiley) (shalin)
- In Admin UI, enable scrolling for overflowing Versions and JVM property values [SOLR-8911](https://issues.apache.org/jira/browse/SOLR-8911) (Alexandre Rafalovitch)
- Admin UI now correctly supports multiple DIH handler end-points [SOLR-8993](https://issues.apache.org/jira/browse/SOLR-8993) (Upayavira) (Alexandre Rafalovitch)
- Admin UI now correctly displays json and text files in the collection/Files screen [SOLR-9002](https://issues.apache.org/jira/browse/SOLR-9002) (Upayavira) (Alexandre Rafalovitch)
- New Admin UI's Dataimport screen now correctly displays DIH Debug output [SOLR-9003](https://issues.apache.org/jira/browse/SOLR-9003) (Alexandre Rafalovitch)
- Admin UI now correctly implements Create Alias command [SOLR-9032](https://issues.apache.org/jira/browse/SOLR-9032) (Upayavira) (Alexandre Rafalovitch)
- Fixed TestManagedSchemaAPI failures which exposed race conditions in the schema API [SOLR-9088](https://issues.apache.org/jira/browse/SOLR-9088) (Varun Thacker) (noble)
- Change SolrPluginUtils.invokeSetters implementation to accommodate setter variants. [SOLR-9161](https://issues.apache.org/jira/browse/SOLR-9161) (Christine Poerschke) (Steve Rowe) (Uwe Schindler)
- NPE in IndexSchema using IBM JDK [SOLR-9179](https://issues.apache.org/jira/browse/SOLR-9179) (noble) (Colvin Cowie)
- Fix some races in CollectionStateWatcher API [SOLR-9181](https://issues.apache.org/jira/browse/SOLR-9181) (Alan Woodward) (Scott Blum)
- OverseerTaskQueue.peekTopN() fatally flawed [SOLR-9191](https://issues.apache.org/jira/browse/SOLR-9191) (Scott Blum) (Noble Paul)
- ZkController#publishAndWaitForDownStates logic is inefficient [SOLR-9199](https://issues.apache.org/jira/browse/SOLR-9199) (Hrishikesh Gadre)
- PeerSync recovery failes if number of updates requested is high. A new useRangeVersions config option is introduced (defaults to true) to send version ranges instead of individual versions for peer sync. [SOLR-9207](https://issues.apache.org/jira/browse/SOLR-9207) (Pushkar Raste) (shalin)
- Admin UI now fully implements Swap Cores interface [SOLR-9232](https://issues.apache.org/jira/browse/SOLR-9232) (Alexandre Rafalovitch)
- srcField parameter works only when all fields are captured in the /update/json/docs endpoint [SOLR-9234](https://issues.apache.org/jira/browse/SOLR-9234) (noble)
- Fixed NPE when using non-numeric range query in deleteByQuery [SOLR-9235](https://issues.apache.org/jira/browse/SOLR-9235) (hossman)
- AutoAddReplicas will append an extra /tlog to the update log location on replica failover. [SOLR-9236](https://issues.apache.org/jira/browse/SOLR-9236) (Eungsop Yoo) (Mark Miller)
- DefaultSolrHighlighter.doHighlightingByFastVectorHighlighter can't be overidden [SOLR-9237](https://issues.apache.org/jira/browse/SOLR-9237) (janhoy)
- If the JDBCStream sees an unknown column type it will now throw a detailed exception. [SOLR-9246](https://issues.apache.org/jira/browse/SOLR-9246) (Dennis Gove)
- GraphTermsQueryQParserPlugin throws NPE when field being searched is not present in segment [SOLR-9254](https://issues.apache.org/jira/browse/SOLR-9254) (Joel Bernstein)
- Fixed AIOOBE when using ValueSourceAugmenter in single node RTG [SOLR-9285](https://issues.apache.org/jira/browse/SOLR-9285) (hossman)
- Including 'score' in the 'fl' param when doing an RTG no longer causes an NPE [SOLR-9287](https://issues.apache.org/jira/browse/SOLR-9287) (hossman) (Ishan Chattopadhyaya)
- Fix [docid] transformer to return -1 when used in RTG with uncommitted doc [SOLR-9288](https://issues.apache.org/jira/browse/SOLR-9288) (hossman)
- ZkSolrResourceLoader should not retry fetching resources if the server has been shutdown. [SOLR-9291](https://issues.apache.org/jira/browse/SOLR-9291) (shalin)
- Fix distributed RTG to forward request params, fixes fq and non-default fl params [SOLR-9308](https://issues.apache.org/jira/browse/SOLR-9308) (hossman)
- Fix SolrCloud RTG response structure when multi ids requested but only 1 found [SOLR-9309](https://issues.apache.org/jira/browse/SOLR-9309) (hossman)
- CloudSolrClient.collectionStateCache is unbounded [SOLR-9334](https://issues.apache.org/jira/browse/SOLR-9334) (noble)
- NPE in CloudSolrClient when the response is null [SOLR-9339](https://issues.apache.org/jira/browse/SOLR-9339) (noble)
- LBHttpSolrClient.request now correctly returns Rsp.server when previously skipped servers were successfully tried. [SOLR-9391](https://issues.apache.org/jira/browse/SOLR-9391) (Christine Poerschke)
- Config API does not support adding caches [SOLR-9397](https://issues.apache.org/jira/browse/SOLR-9397) (noble)
- ConcurrentModificationException in ZkStateReader.getStateWatchers. [SOLR-9405](https://issues.apache.org/jira/browse/SOLR-9405) (Alan Woodward) (Edward Ribeiro) (shalin)

### Other (23 changes)

- Comment out trappy references to example docs in elevate.xml files [SOLR-7930](https://issues.apache.org/jira/browse/SOLR-7930) (Erick Erickson)
- BlockJoinFacetComponent is substituted by BlockJoinFacetDocSetComponent. It doesn't need to change solrconfig.xml [SOLR-8643](https://issues.apache.org/jira/browse/SOLR-8643) (Mikhail Khludnev)
- Test asserts that block join facets work with parent level fq exclusions. [SOLR-8644](https://issues.apache.org/jira/browse/SOLR-8644) (Dr. Oleg Savrasov) (Mikhail Khludnev)
- TestAuthenticationFramework should not extend TestMiniSolrCloudCluster. [SOLR-8787](https://issues.apache.org/jira/browse/SOLR-8787) (Trey Cahill) (shalin)
- Upgraded Extraction module to Apache Tika 1.13. [SOLR-8981](https://issues.apache.org/jira/browse/SOLR-8981) (Tim Allison) (Lewis John McGibbney) (Uwe Schindler)
- Update to Hadoop 2.7.2 [SOLR-9076](https://issues.apache.org/jira/browse/SOLR-9076) (Mark Miller) (Gregory Chanan)
- For the delete replica command we attempt to send the core admin delete request only if that node is actually up. [SOLR-9092](https://issues.apache.org/jira/browse/SOLR-9092) (Jessica Cheng Mallet) (Varun Thacker)
- Sync up basic_configs and data_driven_schema_configs, removing almost all differences except what is required for schemaless. [SOLR-9163](https://issues.apache.org/jira/browse/SOLR-9163) (yonik)
- More comprehensive tests of pseudo-fields for RTG and SolrCloud requests [SOLR-9180](https://issues.apache.org/jira/browse/SOLR-9180) (hossman)
- Remove unnecessary allocation and null check in UpdateRequestProcessorChain's getReqProcessors method. [SOLR-9195](https://issues.apache.org/jira/browse/SOLR-9195) (Christine Poerschke)
- extracting JdbcDataSource.createResultSetIterator() for extension [SOLR-9209](https://issues.apache.org/jira/browse/SOLR-9209) (Kristine Jetzke) (Mikhai Khludnev)
- asserting hasNext() contract in JdbcDataSource in DataImportHandler [SOLR-9256](https://issues.apache.org/jira/browse/SOLR-9256) (Kristine Jetzke) (Mikhai Khludnev)
- Clean up some more remnants of supporting old and new style solr.xml in tests [SOLR-9277](https://issues.apache.org/jira/browse/SOLR-9277) (Erick Erickson)
- Remove ReRankQuery's length constructor argument and member. [SOLR-9331](https://issues.apache.org/jira/browse/SOLR-9331) (Christine Poerschke)
- Change ZooKeeper disconnect and session expiry related logging from INFO to WARN to make debugging easier [SOLR-9340](https://issues.apache.org/jira/browse/SOLR-9340) (Varun Thacker)
- Factor out ReRankQParserPlugin.ReRankQueryRescorer private class. [SOLR-9353](https://issues.apache.org/jira/browse/SOLR-9353) (Christine Poerschke)
- [AngularUI] In Cloud-&gt;Tree file view area, collapse metadata by default [SOLR-9358](https://issues.apache.org/jira/browse/SOLR-9358) (janhoy)
- Improved TestInjection's randomization logic to use LuceneTestCase.random() [SOLR-9367](https://issues.apache.org/jira/browse/SOLR-9367) (hossman)
- Add QParser.getParser(String,SolrQueryRequest) variant. [SOLR-9385](https://issues.apache.org/jira/browse/SOLR-9385) (Christine Poerschke)
- Fixed CDCR Test failures which were due to leaked resources. [SOLR-9392](https://issues.apache.org/jira/browse/SOLR-9392) (shalin)
- Refactor move/renames in JSON FacetProcessor and FacetFieldProcessor. [SOLR-9404](https://issues.apache.org/jira/browse/SOLR-9404) (David Smiley)
- Make ReRankQParserPlugin's private ReRankWeight a public class of its own. [SOLR-9410](https://issues.apache.org/jira/browse/SOLR-9410) (Christine Poerschke)
- Refactored out OverseerCollectionMessageHandler to smaller classes [SOLR-9421](https://issues.apache.org/jira/browse/SOLR-9421) (noble)


[6.1.0] - 2016-06-17
--------------------

### Added (33 changes)

- new TolerantUpdateProcessorFactory to support skipping update commands that cause failures when sending multiple updates in a single request. [SOLR-445](https://issues.apache.org/jira/browse/SOLR-445) (Erick Erickson) (Tomás Fernández Löbbe) (Anshum Gupta) (hossman)
- Add /admin/collections?action=BACKUP and RESTORE assuming access to a shared file system. [SOLR-5750](https://issues.apache.org/jira/browse/SOLR-5750) (Varun Thacker) (David Smiley)
- Provide an option to limit the maximum number of cores that can be created on a node by the Auto Add Replica feature. For this you can set a "maxCoresPerNode" property via the Cluster Property API [SOLR-7117](https://issues.apache.org/jira/browse/SOLR-7117) (Varun Thacker) (Mark Miller)
- '/update/json/docs' path supports nested documents [SOLR-7123](https://issues.apache.org/jira/browse/SOLR-7123) (noble)
- Add a new ClassificationUpdateProcessorFactory. [SOLR-7739](https://issues.apache.org/jira/browse/SOLR-7739) (Alessandro Benedetti) (Tommaso Teofili)
- [subquery] document transformer executes separate requests per result document. [SOLR-8208](https://issues.apache.org/jira/browse/SOLR-8208) (Cao Manh Dat) (Mikhail Khludnev)
- Add CollectionStateWatcher API [SOLR-8323](https://issues.apache.org/jira/browse/SOLR-8323) [SOLR-9113](https://issues.apache.org/jira/browse/SOLR-9113) (Alan Woodward) (Scott Blum)
- Allow sharing of large in memory data structures across cores [SOLR-8349](https://issues.apache.org/jira/browse/SOLR-8349) (Gus Heck) (noble)
- Apply highlighting to hl.alternateField by default for Default and FastVectorHighlighter. Turn off with hl.highlightAlternate=false [SOLR-8583](https://issues.apache.org/jira/browse/SOLR-8583) (janhoy) (David Smiley)
- Resolve variables in encryptKeyFile of DIH's JdbcDataSource [SOLR-8610](https://issues.apache.org/jira/browse/SOLR-8610) (Kristine Jetzke) (Mikhail Khludnev)
- Enforce required parameters at query construction time in the SolrJ Collections API, add static factory methods, and deprecate old setter methods. [SOLR-8765](https://issues.apache.org/jira/browse/SOLR-8765) (Alan Woodward) (Jason Gerlowski)
- Add asynchronous sugar methods to the SolrJ Collections API. You can now call .processAsync() to run a method asynchronously, or .processAndWait() to wait for a call to finish without holding HTTP collections open. [SOLR-8782](https://issues.apache.org/jira/browse/SOLR-8782) (Alan Woodward)
- Implement Connection.prepareStatement [SOLR-8809](https://issues.apache.org/jira/browse/SOLR-8809) (Kevin Risden)
- Support GeoJSON response writer and general spatial formatting. Adding &wt=geojson&geojson.field=&lt;your geometry field&gt; Will return a FeatureCollection for each SolrDocumentList and a Feature with the requested geometry for each SolrDocument. The requested geometry field needs to either extend AbstractSpatialFieldType or store a GeoJSON string. This also adds a [geo] DocumentTransformer that can return the Shape in a variety of formats: &fl=[geo f=&lt;your geometry field&gt; w=(GeoJSON|WKT|POLY)] The default format is GeoJSON. For information on the supported formats, see: https://github.com/locationtech/spatial4j/blob/master/FORMATS.md To return the FeatureCollection as the root element, add '&omitHeader=true" [SOLR-8814](https://issues.apache.org/jira/browse/SOLR-8814) (ryan)
- authorization APIs do not use name as an identifier for a permission for update, delete commands and 'before' attribute [SOLR-8842](https://issues.apache.org/jira/browse/SOLR-8842) (noble)
- Spatial fields like RPT can now be configured to use Spatial4j registered shape formats e.g. via format="GeoJSON". [SOLR-8859](https://issues.apache.org/jira/browse/SOLR-8859) (ryan) (David Smiley)
- Add shortestPath Streaming Expression. This expression performs a breadth first graph traversal to find the shortest path(s) in an unweighted, directed graph stored in a SolrCloud collection. [SOLR-8888](https://issues.apache.org/jira/browse/SOLR-8888) (Joel Bernstein)
- New static method in DistributedUpdateProcessorFactory to allow UpdateProcessorFactories to indicate request params that should be forwarded when DUP distributes updates. [SOLR-8890](https://issues.apache.org/jira/browse/SOLR-8890) (hossman)
- When using a shared filesystem we should store data dir and tlog dir locations in the cluster state. [SOLR-8913](https://issues.apache.org/jira/browse/SOLR-8913) (Mark Miller)
- Adds Streaming to the admin page under the collections section. Includes ability to see graphically the expression explanation [SOLR-8918](https://issues.apache.org/jira/browse/SOLR-8918) (Dennis Gove)
- Add gatherNodes Streaming Expression to support breadth first traversals [SOLR-8925](https://issues.apache.org/jira/browse/SOLR-8925) (Joel Bernstein)
- Add optional --excluderegex argument to ZkCLI. [SOLR-8938](https://issues.apache.org/jira/browse/SOLR-8938) (Christine Poerschke)
- Add sort Streaming Expression. The expression takes a single input stream and a comparator and outputs tuples in stable order of the comparator. [SOLR-8962](https://issues.apache.org/jira/browse/SOLR-8962) (Dennis Gove)
- Add GraphHandler and GraphMLResponseWriter to support graph visualizations [SOLR-8972](https://issues.apache.org/jira/browse/SOLR-8972) (Joel Bernstein)
- Add SolrJ support for REBALANCELEADERS Collections API [SOLR-8976](https://issues.apache.org/jira/browse/SOLR-8976) (Anshum Gupta)
- Add Random Streaming Expression [SOLR-8986](https://issues.apache.org/jira/browse/SOLR-8986) (Joel Bernstein)
- Adds query option facet.distrib.mco which when set to true allows the use of facet.mincount=1 in cloud mode. [SOLR-8988](https://issues.apache.org/jira/browse/SOLR-8988) (Keith Laban) (Dennis Gove)
- Adds ability to get an Explanation of a Streaming Expression [SOLR-9009](https://issues.apache.org/jira/browse/SOLR-9009) (Dennis Gove)
- Implement StatementImpl/ResultSetImpl get/set fetch* methods and proper errors for traversal methods [SOLR-9020](https://issues.apache.org/jira/browse/SOLR-9020) (Kevin Risden)
- Extend facet telemetry support to legacy (non-json) facets under "debug/facet-debug" in the response. [SOLR-9026](https://issues.apache.org/jira/browse/SOLR-9026) (Michael Sun) (yonik)
- Add GraphTermsQuery to limit traversal on high frequency nodes [SOLR-9027](https://issues.apache.org/jira/browse/SOLR-9027) (Joel Bernstein) (David Smiley)
- 'core-admin-read' and 'core-admin-edit' are well known permissions [SOLR-9041](https://issues.apache.org/jira/browse/SOLR-9041) (noble)
- RuleBasedAuthorizationPlugin supports regex in param values eg: "command" : "REGEX:(i?)create" [SOLR-9049](https://issues.apache.org/jira/browse/SOLR-9049) (noble)

### Changed (11 changes)

- Don't force a full ZkStateReader refresh on every Overseer operation. [SOLR-8722](https://issues.apache.org/jira/browse/SOLR-8722) (Scott Blum) (shalin)
- Overseer operations performed with fine grained mutual exclusion [SOLR-8744](https://issues.apache.org/jira/browse/SOLR-8744) (noble) (Scott Blum)
- Deprecate costly ZkStateReader.updateClusterState(), replace with a narrow forceUpdateCollection(collection) [SOLR-8745](https://issues.apache.org/jira/browse/SOLR-8745) (Scott Blum) (shalin)
- Do not cache merge or 'read once' contexts in the hdfs block cache. [SOLR-8856](https://issues.apache.org/jira/browse/SOLR-8856) (Mark Miller) (Mike Drob)
- Optimize filter creation (DocSetCollector) to minimize the amount of garbage produced. This resulted in up to 3x throughput when small filter creation was the bottleneck, as well as orders of magnitude less garbage. [SOLR-8922](https://issues.apache.org/jira/browse/SOLR-8922) (Jeff Wartes) (yonik)
- bin/post (SimplePostTool) now streams the standard input instead of buffering fully. [SOLR-8937](https://issues.apache.org/jira/browse/SOLR-8937) (David Smiley)
- Zookeeper frenzy when a core is first created. [SOLR-8973](https://issues.apache.org/jira/browse/SOLR-8973) (Janmejay Singh) (Scott Blum) (shalin)
- Deprecate and reduce usage of ClusterState methods which may make calls to ZK via the lazy collection reference. [SOLR-9014](https://issues.apache.org/jira/browse/SOLR-9014) (Scott Blum) (shalin)
- Cluster properties are now cached on ZkStateReader. [SOLR-9106](https://issues.apache.org/jira/browse/SOLR-9106) (Alan Woodward)
- Upgrade commons-io to 2.5, avoid expensive array resizing in EmbeddedSolrServer [SOLR-9147](https://issues.apache.org/jira/browse/SOLR-9147) (Mikhail Khludnev)
- Improve performance of getting directory size with hdfs. [SOLR-9204](https://issues.apache.org/jira/browse/SOLR-9204) (Mark Miller)

### Fixed (18 changes)

- ConcurrentUpdateSolrClient ignores the collection parameter in some methods. [SOLR-7729](https://issues.apache.org/jira/browse/SOLR-7729) (Nicolas Gavalda) (Jorge Luis Betancourt Gonzalez) (Mark Miller)
- closing JDBC Statement on failures in DataImportHandler (DIH) [SOLR-8612](https://issues.apache.org/jira/browse/SOLR-8612) (Kristine Jetzke) (Mikhail Khludnev)
- SchemaManager waits correctly for replicas to be notified of a new change. [SOLR-8662](https://issues.apache.org/jira/browse/SOLR-8662) (sarowe) (Noble Paul) (Varun Thacker)
- keep LOG4J_CONFIG in solr.cmd [SOLR-8676](https://issues.apache.org/jira/browse/SOLR-8676) (Kristine Jetzke) (Mikhail Khludnev)
- edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by SOLR-2649. [SOLR-8812](https://issues.apache.org/jira/browse/SOLR-8812) [SOLR-2649](https://issues.apache.org/jira/browse/SOLR-2649) (Greg Pendlebury) (Jan Høydahl) (Erick Erickson) (Steve Rowe)
- The HDFS BlockDirectory should not clean up it's cache on shutdown. [SOLR-8855](https://issues.apache.org/jira/browse/SOLR-8855) (Mark Miller)
- Fix group.sort option [SOLR-8940](https://issues.apache.org/jira/browse/SOLR-8940) (hossman)
- OverseerTaskQueue.containsTaskWithRequestId encounters json parse error if a SolrResponse node is in the overseer queue. [SOLR-8948](https://issues.apache.org/jira/browse/SOLR-8948) (Jessica Cheng Mallet) (shalin)
- Cleanup clusterstate and replicas for a failed create collection request [SOLR-8983](https://issues.apache.org/jira/browse/SOLR-8983) (Varun Thacker) (Anshum Gupta)
- fix rare ZkStateReader visibility race during collection state format update [SOLR-9029](https://issues.apache.org/jira/browse/SOLR-9029) (Scott Blum) (hossman)
- Fix solr.cmd that wrongly assumes Jetty will always listen on 0.0.0.0. [SOLR-9046](https://issues.apache.org/jira/browse/SOLR-9046) (Bram Van Dam) (Uwe Schindler)
- Adds an explanation of the incoming stream to an UpdateStream's explanation [SOLR-9064](https://issues.apache.org/jira/browse/SOLR-9064) (Dennis Gove)
- Fix error handling issues in Streaming classes [SOLR-9128](https://issues.apache.org/jira/browse/SOLR-9128) (Joel Bernstein)
- Fix ClassCastException when using the /sql handler count() function with single-shard collections [SOLR-9141](https://issues.apache.org/jira/browse/SOLR-9141) (Minoru Osuka) (James Dyer)
- Fix SolrCLI so that bin/solr -e cloud example can be run from any CWD [SOLR-9151](https://issues.apache.org/jira/browse/SOLR-9151) (janhoy)
- Spellcheck does not return collations if "maxCollationTries" is used with "cursorMark". [SOLR-9165](https://issues.apache.org/jira/browse/SOLR-9165) (James Dyer)
- facet method ENUM was sometimes unnecessarily being rewritten to FCS, causing slowdowns [SOLR-9176](https://issues.apache.org/jira/browse/SOLR-9176) (Alessandro Benedetti) (Jesse McLaughlin) (Alan Woodward)
- config APIs unable to add multiple values with same name [SOLR-9198](https://issues.apache.org/jira/browse/SOLR-9198) (noble)

### Other (27 changes)

- DataImportHandler (DIH) JdbcDataSource supports multiple resultsets per query [SOLR-2199](https://issues.apache.org/jira/browse/SOLR-2199) (Kristine Jetzke) (Mark Waddle) (Mikhail Khludnev)
- Simplifies grouping code to use ResponseBuilder.needDocList() to determine if it needs to generate a doc list for grouped results. [SOLR-5616](https://issues.apache.org/jira/browse/SOLR-5616) (Steven Bower) (Keith Laban) (Dennis Gove)
- Implement builder pattern design for constructing SolrJ clients and also deprecate direct construction of client objects. [SOLR-8097](https://issues.apache.org/jira/browse/SOLR-8097) (Jason Gerlowski) (Shawn Heisey) (Anshum Gupta)
- Negative tests for JDBC Connection String [SOLR-8184](https://issues.apache.org/jira/browse/SOLR-8184) (Susheel Kumar) (Jason Gerlowski) (Kevin Risden)
- fix line separator in log4j.properties files [SOLR-8445](https://issues.apache.org/jira/browse/SOLR-8445) (Ahmet Arslan) (Mikhail Khludnev)
- Add Streaming Expressions tests for parameter substitution [SOLR-8458](https://issues.apache.org/jira/browse/SOLR-8458) (Joel Bernstein) (Cao Manh Dat) (Dennis Gove) (Kevin Risden)
- CloudSolrStream and FacetStream should take a SolrParams object rather than a Map&lt;String, String&gt; to allow more complex Solr queries to be specified. [SOLR-8467](https://issues.apache.org/jira/browse/SOLR-8467) (Erick Erickson)
- security rules made more foolproof by asking the requesthandler about the well known permission name. The APIs are also modified to ue 'index' as the unique identifier instead of name. Name is an optional attribute now and only to be used when specifying well-known permissions [SOLR-8842](https://issues.apache.org/jira/browse/SOLR-8842) (noble)
- Remove back-compat handling of router format made in SOLR-4221 in 4.5.0. [SOLR-8860](https://issues.apache.org/jira/browse/SOLR-8860) [SOLR-4221](https://issues.apache.org/jira/browse/SOLR-4221) (shalin)
- UpdateLog will now throw an exception if it doesn't know how to serialize a value. [SOLR-8866](https://issues.apache.org/jira/browse/SOLR-8866) (David Smiley)
- Optionally disable printing field cache entries in SolrFieldCacheMBean [SOLR-8869](https://issues.apache.org/jira/browse/SOLR-8869) (Gregory Chanan)
- Allow SolrInfoMBeans to return different statistics for /jmx vs web ui calls. [SOLR-8892](https://issues.apache.org/jira/browse/SOLR-8892) (Gregory Chanan) (Mark Miller)
- Add an idea module for solr/server to enable launching start.jar [SOLR-8929](https://issues.apache.org/jira/browse/SOLR-8929) (Scott Blum) (Steve Rowe)
- Solr should not close container streams. [SOLR-8933](https://issues.apache.org/jira/browse/SOLR-8933) (Mike Drob) (Uwe Schindler) (Mark Miller)
- Adds SelectStream as a default function in the StreamHandler [SOLR-9015](https://issues.apache.org/jira/browse/SOLR-9015) (Dennis Gove)
- Replace multiple "/replication" strings with one static constant. [SOLR-9037](https://issues.apache.org/jira/browse/SOLR-9037) (Christine Poerschke)
- zkcli should allow alternative locations for log4j configuration [SOLR-9047](https://issues.apache.org/jira/browse/SOLR-9047) (Gregory Chanan)
- Migrate some distributed tests to SolrCloudTestCase. [SOLR-9065](https://issues.apache.org/jira/browse/SOLR-9065) [SOLR-9072](https://issues.apache.org/jira/browse/SOLR-9072) [SOLR-9132](https://issues.apache.org/jira/browse/SOLR-9132) (Alan Woodward)
- Make CountMetric return long instead of double [SOLR-9066](https://issues.apache.org/jira/browse/SOLR-9066) (Kevin Risden)
- Make SolrTestCaseJ4.beforeClass() / .afterClass() public so it works with Mockito [SOLR-9081](https://issues.apache.org/jira/browse/SOLR-9081) (Georg Sorst) (Alan Woodward)
- Remove all &lt;types&gt; and &lt;fields&gt; from schemas. NOTE: as in the JIRA I left a few in to insure the (no cost) back compat. [SOLR-9083](https://issues.apache.org/jira/browse/SOLR-9083) (Erick Erickson)
- Fix a bunch of typos across 103 files [SOLR-9105](https://issues.apache.org/jira/browse/SOLR-9105) (Bartosz Krasiński) (janhoy)
- new @RandomizeSSL annotation for more fine grained control of SSL testing [SOLR-9107](https://issues.apache.org/jira/browse/SOLR-9107) (hossman) (sarowe)
- Move JoinFromCollection- SubQueryTransformer- BlockJoinFacet- Distrib Tests to SolrCloudTestCase [SOLR-9110](https://issues.apache.org/jira/browse/SOLR-9110) (Mikhail Khludnev)
- several static methods in ValueSourceParser have been made private [SOLR-9119](https://issues.apache.org/jira/browse/SOLR-9119) (hossman)
- Separate out the error statistics into server-side error vs client-side error [SOLR-9136](https://issues.apache.org/jira/browse/SOLR-9136) (Jessica Cheng Mallet) (Erick Erickson)
- New cloud based concurrent atomic update test [SOLR-9159](https://issues.apache.org/jira/browse/SOLR-9159) (hossman)


[6.0.1] - 2016-05-28
--------------------

### Upgrade Notes (1 change)

- If you use historical dates, specifically on or before the year 1582, you should re-index. 

### Fixed (24 changes)

- ZooKeeper ACL support fixed. [SOLR-8792](https://issues.apache.org/jira/browse/SOLR-8792) (Esther Quansah) (Ishan Chattopadhyaya) (Steve Rowe)
- /bin/solr create script always returns exit code 0 when a collection/core already exists. [SOLR-8801](https://issues.apache.org/jira/browse/SOLR-8801) (Khalid Alharbi) (Marius Grama) (Steve Rowe)
- HdfsUpdateLog does not use configured or new default number of version buckets and is hard coded to 256. [SOLR-8857](https://issues.apache.org/jira/browse/SOLR-8857) (Mark Miller) (yonik) (Gregory Chanan)
- SolrCloud Overseer clusterState could unexpectedly be null resulting in NPE. [SOLR-8875](https://issues.apache.org/jira/browse/SOLR-8875) (Scott Blum) (David Smiley)
- Make sure ReturnFields only returns the requested fields from (fl=) evn when DocumentTransformers ask for getExtraRequestFields() [SOLR-8902](https://issues.apache.org/jira/browse/SOLR-8902) (ryan)
- ZkStateReader's refreshLiveNodes(Watcher) is not thread safe. [SOLR-8914](https://issues.apache.org/jira/browse/SOLR-8914) (Scott Blum) (hoss) (sarowe) (Erick Erickson) (Mark Miller) (shalin)
- bin/post failed to detect stdin usage on Ubuntu; maybe other unixes. [SOLR-8946](https://issues.apache.org/jira/browse/SOLR-8946) (David Smiley)
- Preserve root cause when wrapping exceptions [SOLR-8971](https://issues.apache.org/jira/browse/SOLR-8971) (hossman)
- Fix top term links from schema browser page to use {!term} parser [SOLR-8990](https://issues.apache.org/jira/browse/SOLR-8990) (hossman)
- Restore Schema API GET method functionality removed in 6.0 [SOLR-8992](https://issues.apache.org/jira/browse/SOLR-8992) (noble) (Steve Rowe)
- Fix "name" field type definition in films example. [SOLR-9004](https://issues.apache.org/jira/browse/SOLR-9004) (Alexandre Rafalovitch) (Varun Thacker)
- Fix SolrIdentifierValidator to not allow empty identifiers. [SOLR-9016](https://issues.apache.org/jira/browse/SOLR-9016) (Shai Erera)
- Fixed some test related bugs preventing SSL + ClientAuth from ever being tested [SOLR-9028](https://issues.apache.org/jira/browse/SOLR-9028) (hossman)
- The 'downnode' overseer command can trip asserts in ZkStateWriter. [SOLR-9030](https://issues.apache.org/jira/browse/SOLR-9030) (Scott Blum) (Mark Miller) (shalin)
- Atomic updates failed to work when there were copyField targets that had docValues enabled. [SOLR-9034](https://issues.apache.org/jira/browse/SOLR-9034) (Karthik Ramachandran) (Ishan Chattopadhyaya) (yonik)
- Solr slave is doing full replication (entire index) of index after master restart. [SOLR-9036](https://issues.apache.org/jira/browse/SOLR-9036) (Lior Sapir) (Mark Miller) (shalin)
- Makes HashJoinStream and OuterHashJoinStream support different field names in the incoming streams, eg. fieldA=fieldB. [SOLR-9058](https://issues.apache.org/jira/browse/SOLR-9058) (Dennis Gove) (Stephan Osthold)
- NPE in SolrClientCache following collection reload [SOLR-9059](https://issues.apache.org/jira/browse/SOLR-9059) (Joel Bernstein) (Ryan Yacyshyn)
- (6.0 bug) For years &lt;= 1582, date math (round,add,sub) introduced error. Range faceting on such dates was also affected. With this fixed, this is the first release range faceting works on BC years. [SOLR-9080](https://issues.apache.org/jira/browse/SOLR-9080) [SOLR-9085](https://issues.apache.org/jira/browse/SOLR-9085) (David Smiley)
- Fix NullPointerException in TopGroupsShardResponseProcessor. [SOLR-9093](https://issues.apache.org/jira/browse/SOLR-9093) (Christine Poerschke)
- Race condition causing occasional SolrIndexSearcher leak when SolrCore is reloaded. [SOLR-9116](https://issues.apache.org/jira/browse/SOLR-9116) (Jessica Cheng Mallet) (shalin)
- The first SolrCore is leaked after reload. [SOLR-9117](https://issues.apache.org/jira/browse/SOLR-9117) (Jessica Cheng Mallet) (shalin)
- HashQParserPlugin should trim partition keys [SOLR-9118](https://issues.apache.org/jira/browse/SOLR-9118) (Joel Bernstein)
- Fix RestManager.addManagedResource return value. [SOLR-9134](https://issues.apache.org/jira/browse/SOLR-9134) (Christine Poerschke)

### Other (7 changes)

- - Refactor SSLConfig so that SSLTestConfig can provide SSLContexts using a NullSecureRandom to prevent SSL tests from blocking on entropy starved machines. - SSLTestConfig: Alternate (pseudo random) NullSecureRandom for Constants.SUN_OS. - SSLTestConfig: Replace NullSecureRandom w/ NotSecurePseudoRandom. - Change SSLTestConfig to use a keystore file that is included as a resource in the test-framework jar so users subclassing SolrTestCaseJ4 don't need to preserve magic paths. [SOLR-5776](https://issues.apache.org/jira/browse/SOLR-5776) [SOLR-9068](https://issues.apache.org/jira/browse/SOLR-9068) [SOLR-8970](https://issues.apache.org/jira/browse/SOLR-8970) (hossman)
- Improve javadocs for JavaBinCodec, ObjectResolver and enforce the single-usage policy. [SOLR-7516](https://issues.apache.org/jira/browse/SOLR-7516) (Jason Gerlowski) (Benoit Vanalderweireldt) (shalin)
- In SolrCloud mode, under the 'Core Selector' dropdown in the UI the Replication tab won't be displayed anymore. The Replication tab is only beneficial to users running Solr in master-slave mode. [SOLR-8967](https://issues.apache.org/jira/browse/SOLR-8967) (Varun Thacker)
- Added back support for 'includeDynamic' flag to /schema/fields endpoint [SOLR-8985](https://issues.apache.org/jira/browse/SOLR-8985) (noble)
- Upgrade commons-fileupload to 1.3.1, fixing a potential vulnerability [SOLR-9053](https://issues.apache.org/jira/browse/SOLR-9053) (Jeff Field) (Mike Drob) (janhoy)
- Get rid of javax.xml.bind.DatatypeConverter in SimplePostTool for Java 9 compatibility. [SOLR-9115](https://issues.apache.org/jira/browse/SOLR-9115) (Uwe Schindler)
- Fix "start solr" text in cluster.vm Velocity template [SOLR-9131](https://issues.apache.org/jira/browse/SOLR-9131) (janhoy)


[6.0.0] - 2016-04-08
--------------------

### Added (33 changes)

- New edismax param mm.autoRelax which helps in certain cases of the stopwords/zero-hits issue [SOLR-3085](https://issues.apache.org/jira/browse/SOLR-3085) (janhoy)
- Cross Data Center Replication. Active/passive replication for separate SolrClouds hosted on separate data centers. [SOLR-6273](https://issues.apache.org/jira/browse/SOLR-6273) (Renaud Delbru) (Yonik Seeley) (Erick Erickson)
- Add IterativeMergeStrategy to support running Parallel Iterative Algorithms inside of Solr [SOLR-6398](https://issues.apache.org/jira/browse/SOLR-6398) (Joel Bernstein)
- Add ComplementStream and IntersectStream to the Streaming API and Streaming Expressions [SOLR-7525](https://issues.apache.org/jira/browse/SOLR-7525) (Dennis Gove) (Jason Gerlowski) (Joel Bernstein)
- Add UpdateStream to Streaming API and Streaming Expression [SOLR-7535](https://issues.apache.org/jira/browse/SOLR-7535) (Jason Gerlowski) (Joel Bernstein)
- Basic graph traversal query Example: {!graph from="node_id" to="edge_id"}id:doc_1 [SOLR-7543](https://issues.apache.org/jira/browse/SOLR-7543) (Kevin Watters) (yonik)
- Parallel SQL Support [SOLR-7560](https://issues.apache.org/jira/browse/SOLR-7560) (Joel Bernstein)
- Adds Inner and LeftOuter Joins to the Streaming API and Streaming Expressions [SOLR-7584](https://issues.apache.org/jira/browse/SOLR-7584) (Dennis Gove) (Corey Wu)
- Add SelectStream and Tuple Operations to the Streaming API and Streaming Expressions [SOLR-7669](https://issues.apache.org/jira/browse/SOLR-7669) (Dennis Gove)
- Add StreamExpression Support to RollupStream [SOLR-7707](https://issues.apache.org/jira/browse/SOLR-7707) (Dennis Gove) (Joel Bernstein)
- Add the FacetStream to the Streaming API and wire it into the SQLHandler [SOLR-7903](https://issues.apache.org/jira/browse/SOLR-7903) (Joel Bernstein)
- Add StreamExpression Support to FacetStream [SOLR-7904](https://issues.apache.org/jira/browse/SOLR-7904) (Dennis Gove)
- MergeStream now supports merging more than 2 streams together [SOLR-7938](https://issues.apache.org/jira/browse/SOLR-7938) (Dennis Gove)
- JDBC Driver for SQL Interface [SOLR-7986](https://issues.apache.org/jira/browse/SOLR-7986) (Uwe Schindler) (Joel Bernstein)
- Add column alias support to the Parallel SQL Interface [SOLR-8002](https://issues.apache.org/jira/browse/SOLR-8002) (Joel Bernstein)
- Add the StatsStream to the Streaming API and wire it into the SQLHandler [SOLR-8038](https://issues.apache.org/jira/browse/SOLR-8038) (Joel Bernstein)
- Add support for SELECT DISTINCT queries to the SQL interface [SOLR-8086](https://issues.apache.org/jira/browse/SOLR-8086) (Joel Bernstein)
- Adds Hash and OuterHash Joins to the Streaming API and Streaming Expressions [SOLR-8188](https://issues.apache.org/jira/browse/SOLR-8188) (Dennis Gove)
- Change ReducerStream to use StreamEqualitor instead of StreamComparator [SOLR-8198](https://issues.apache.org/jira/browse/SOLR-8198) (Dennis Gove)
- StatsStream now implements the Expressible interface [SOLR-8268](https://issues.apache.org/jira/browse/SOLR-8268) (Dennis Gove)
- Ensure the /export handler works with NULL field values [SOLR-8285](https://issues.apache.org/jira/browse/SOLR-8285) (Joel Bernstein)
- Add ReduceOperation and wire it into the ReducerStream [SOLR-8337](https://issues.apache.org/jira/browse/SOLR-8337) (Joel Bernstein)
- Provide command to switch between non/secure mode in ZK [SOLR-8415](https://issues.apache.org/jira/browse/SOLR-8415) (Mike Drob) (Gregory Chanan)
- Real-time get now supports filters. [SOLR-8436](https://issues.apache.org/jira/browse/SOLR-8436) (yonik)
- Add JDBCStream to Streaming API and Streaming Expressions for integration with external data sources [SOLR-8479](https://issues.apache.org/jira/browse/SOLR-8479) (Dennis Gove)
- Improve Solr JDBC Driver to support SQL Clients like DBVisualizer [SOLR-8502](https://issues.apache.org/jira/browse/SOLR-8502) (Kevin Risden) (Joel Bernstein)
- Make it possible to use ip fragments in replica placement rules , such as ip_1, ip_2 etc [SOLR-8522](https://issues.apache.org/jira/browse/SOLR-8522) (Arcadius Ahouansou) (noble)
- Add asynchronous DaemonStreams to the Streaming API [SOLR-8550](https://issues.apache.org/jira/browse/SOLR-8550) (Joel Bernstein)
- Add ConcatOperation to be used with the SelectStream [SOLR-8556](https://issues.apache.org/jira/browse/SOLR-8556) (Joel Bernstein) (Dennis Gove)
- Add TopicStream to the streaming API to support publish/subscribe messaging [SOLR-8588](https://issues.apache.org/jira/browse/SOLR-8588) (Joel Bernstein) (Kevin Risden)
- Adds header 'zkConnected' to response of SearchHandler and PingRequestHandler to notify the client when a connection to zookeeper has been lost and there is a possibility of stale data on the node the request is coming from. [SOLR-8666](https://issues.apache.org/jira/browse/SOLR-8666) (Keith Laban) (Dennis Gove)
- params.json can now specify 'appends' and 'invariants' [SOLR-8698](https://issues.apache.org/jira/browse/SOLR-8698) (noble)
- allow _version_ field to be retrievable via docValues [SOLR-8831](https://issues.apache.org/jira/browse/SOLR-8831) (yonik)

### Changed (7 changes)

- Speed up queries and operations that use many terms when timeAllowed has not been specified. Speedups of up to 8% were observed. [SOLR-7876](https://issues.apache.org/jira/browse/SOLR-7876) (yonik)
- Speed up creation of filters from term range queries (i.e. non-numeric range queries) and use the filter cache for term range queries that are part of larger queries. Some observed speedups were up to 2.5x for production of filters, and up to 10x for query evaluation with embedded term range queres that resulted in filter cache hits. [SOLR-8037](https://issues.apache.org/jira/browse/SOLR-8037) (yonik)
- Can't query against negative float or double values when indexed="false" docValues="true" multiValued="false". [SOLR-8082](https://issues.apache.org/jira/browse/SOLR-8082) (hossman) (Ishan Chattopadhyaya) (yonik) (Steve Rowe)
- Optimize GraphQuery when maxDepth is set by not collecting edges at the maxDepth level. [SOLR-8532](https://issues.apache.org/jira/browse/SOLR-8532) (Kevin Watters) (yonik)
- FCS facet performance optimization which significantly speeds up processing when terms are high cardinality and the matching docset is small. When facet minCount &gt; 0 and the number of matching documents is small (or 0) this enhancement prevents considering terms which have a 0 count. Also includes change to move to the next non-zero term value when selecting a segment position. [SOLR-8559](https://issues.apache.org/jira/browse/SOLR-8559) (Keith Laban) (Steve Bower) (Dennis Gove)
- Non binary responses use chunked encoding because we flush the outputstream early. [SOLR-8669](https://issues.apache.org/jira/browse/SOLR-8669) (Mark Miller)
- ZkController#publishAndWaitForDownStates should use #publishNodeAsDown. [SOLR-8720](https://issues.apache.org/jira/browse/SOLR-8720) (Mark Miller)

### Fixed (39 changes)

- Fix position of OOM killer script when starting Solr in the background [SOLR-8145](https://issues.apache.org/jira/browse/SOLR-8145) (Jurian Broertjes via Timothy Potter)
- JSON Facet API - field faceting on a multi-valued string field without docValues (i.e. UnInvertedField implementation), but with a prefix or with a sort other than count, resulted in incorrect results. This has been fixed, and facet.prefix support for facet.method=uif has been enabled. [SOLR-8155](https://issues.apache.org/jira/browse/SOLR-8155) (Mikhail Khludnev) (yonik)
- Guard against CloudSolrStream close method NullPointerException [SOLR-8191](https://issues.apache.org/jira/browse/SOLR-8191) (Kevin Risden) (Joel Bernstein)
- ReplicaAssigner rejects valid nodes [SOLR-8375](https://issues.apache.org/jira/browse/SOLR-8375) (Kelvin Tan) (noble)
- Add field option in the new admin UI schema page loads up even when no schemaFactory has been explicitly specified since the default is ManagedIndexSchemaFactory. [SOLR-8386](https://issues.apache.org/jira/browse/SOLR-8386) (Erick Erickson) (Upayavira) (Varun Thacker)
- Ensures that quotes in solr params (eg. q param) are properly handled [SOLR-8409](https://issues.apache.org/jira/browse/SOLR-8409) (Dennis Gove)
- The collections create API should return after all replicas are active. [SOLR-8416](https://issues.apache.org/jira/browse/SOLR-8416) (Michael Sun) (Mark Miller) (Alexey Serba)
- Fix long overflow in sumOfSquares for Date statistics. [SOLR-8420](https://issues.apache.org/jira/browse/SOLR-8420) (Tom Hill) (Christine Poerschke) (Tomás Fernández Löbbe)
- Fix the core restore functionality to allow restoring multiple times on the same core [SOLR-8449](https://issues.apache.org/jira/browse/SOLR-8449) (Johannes Brucher) (Varun Thacker)
- CloudSolrStream and ParallelStream can choose replicas that are not active [SOLR-8461](https://issues.apache.org/jira/browse/SOLR-8461) (Cao Manh Dat) (Varun Thacker) (Joel Bernstein)
- SelectStream now properly handles non-lowercase and/or quoted select field names [SOLR-8485](https://issues.apache.org/jira/browse/SOLR-8485) (Dennis Gove)
- Merge index does not mark the Directory objects it creates as 'done' and they are retained in the Directory cache. [SOLR-8497](https://issues.apache.org/jira/browse/SOLR-8497) (Sivlio Sanchez) (Mark Miller)
- Fix a few places that were failing to pass dimensional values settings when copying a FieldInfo [SOLR-8525](https://issues.apache.org/jira/browse/SOLR-8525) (Ishan Chattopadhyaya via Mike McCandless)
- Improve JdbcTest to cleanup properly on failures [SOLR-8527](https://issues.apache.org/jira/browse/SOLR-8527) (Kevin Risden) (Joel Bernstein)
- Successful or not, requests are not always fully consumed by Solrj clients and we count on HttpClient or the JVM. [SOLR-8578](https://issues.apache.org/jira/browse/SOLR-8578) (Mark Miller)
- After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made. [SOLR-8599](https://issues.apache.org/jira/browse/SOLR-8599) (Keith Laban) (Dennis Gove)
- DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs. [SOLR-8633](https://issues.apache.org/jira/browse/SOLR-8633) (hossman) (Mark Miller)
- CloudSolrClient does not send credentials for update request [SOLR-8640](https://issues.apache.org/jira/browse/SOLR-8640) (noble) (hoss)
- PeerSync should use same nUpdates everywhere. [SOLR-8656](https://issues.apache.org/jira/browse/SOLR-8656) (Ramsey Haddad) (Mark Miller)
- Always consume the full request on the server, not just in the case of an error. [SOLR-8683](https://issues.apache.org/jira/browse/SOLR-8683) (Mark Miller)
- DistributedMap/Queue can create too many Watchers and some code simplification. [SOLR-8694](https://issues.apache.org/jira/browse/SOLR-8694) (Scott Blum) (Mark Miller)
- Ensure ZK watchers are not triggering our watch logic on connection events and make this handling more consistent. [SOLR-8695](https://issues.apache.org/jira/browse/SOLR-8695) (Scott Blum) (Mark Miller)
- Start the Overseer before actions that need the overseer on init and when reconnecting after zk expiration and improve init logic. [SOLR-8696](https://issues.apache.org/jira/browse/SOLR-8696) (Scott Blum) (Mark Miller)
- Scope ZK election nodes by session to prevent elections from interfering with each other and other small LeaderElector improvements. [SOLR-8697](https://issues.apache.org/jira/browse/SOLR-8697) [SOLR-8837](https://issues.apache.org/jira/browse/SOLR-8837) (Scott Blum) (Mark Miller) (Alan Woodward)
- CloudSolrClient decides that there are no healthy nodes to handle a request too early. [SOLR-8701](https://issues.apache.org/jira/browse/SOLR-8701) (Mark Miller)
- ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica placement. splitshard should preassign nodes using rules, if rules are present [SOLR-8728](https://issues.apache.org/jira/browse/SOLR-8728) (noble) (Shai Erera)
- Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes [SOLR-8738](https://issues.apache.org/jira/browse/SOLR-8738) (hossman)
- OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100. The limit has now been increased to 100. [SOLR-8748](https://issues.apache.org/jira/browse/SOLR-8748) (Scott Blum) (shalin)
- Fix document exclusion in mlt query parser in Cloud mode for schemas that have non-"id" unique field [SOLR-8769](https://issues.apache.org/jira/browse/SOLR-8769) (Erik Hatcher) (Anshum Gupta)
- Multi-threaded core shutdown creates executor per core. [SOLR-8771](https://issues.apache.org/jira/browse/SOLR-8771) (Mike Drob) (Mark Miller)
- Fix missing InterruptedException handling in ZkStateReader.java [SOLR-8779](https://issues.apache.org/jira/browse/SOLR-8779) (Varun Thacker)
- Collections API responses contain node name in the core-level responses that are returned. [SOLR-8790](https://issues.apache.org/jira/browse/SOLR-8790) (Anshum Gupta)
- Fix a race condition in the ClusterStatus API call whereby the call would fail when a concurrent delete collection api command was executed [SOLR-8804](https://issues.apache.org/jira/browse/SOLR-8804) (Alexey Serba) (Varun Thacker)
- JSON Facet API: fix faceting exception on multi-valued numeric fields that have docValues. [SOLR-8835](https://issues.apache.org/jira/browse/SOLR-8835) (yonik)
- Returning non-stored docValues is incorrect for negative floats and doubles. [SOLR-8838](https://issues.apache.org/jira/browse/SOLR-8838) (Ishan Chattopadhyaya) (Steve Rowe)
- Real-time get sometimes fails to retrieve stored fields from docValues. [SOLR-8865](https://issues.apache.org/jira/browse/SOLR-8865) (Ishan Chattopadhyaya) (yonik)
- {!frange} queries will now avoid matching documents without a value in the numeric field. For more complex functions, FunctionValues.exists() must also return true for the document to match. [SOLR-8867](https://issues.apache.org/jira/browse/SOLR-8867) (yonik)
- Fix TrieField.toObject(IndexableField) to work for field with docValues enabled. [SOLR-8886](https://issues.apache.org/jira/browse/SOLR-8886) (yonik)
- Fix StrField.toObject and toExternal to work with docValue IndexableField instances. [SOLR-8891](https://issues.apache.org/jira/browse/SOLR-8891) (yonik)

### Other (46 changes)

- Unloading or deleting the last replica of a shard now no longer cascades to remove the shard from the clusterstate. [SOLR-5209](https://issues.apache.org/jira/browse/SOLR-5209) (Christine Poerschke)
- Make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr. [SOLR-5730](https://issues.apache.org/jira/browse/SOLR-5730) (Christine Poerschke) (hossmann) (Tomás Fernández Löbbe) (Shai Erera)
- Improve example docs, using films data [SOLR-6127](https://issues.apache.org/jira/browse/SOLR-6127) (Varun Thacker) (ehatcher)
- Deprecated SolrServer classes have been removed [SOLR-6895](https://issues.apache.org/jira/browse/SOLR-6895) (Alan Woodward) (Erik Hatcher)
- Deprecated SolrClient.shutdown() method removed [SOLR-6954](https://issues.apache.org/jira/browse/SOLR-6954) (Alan Woodward)
- Upgrade Jetty to v9.3.8.v20160314. [SOLR-7339](https://issues.apache.org/jira/browse/SOLR-7339) (Gregg Donovan) (shalin) (Mark Miller) (Steve Rowe)
- Switch from Google's ConcurrentLinkedHashMap to Caffeine. Only affects HDFS support. [SOLR-7355](https://issues.apache.org/jira/browse/SOLR-7355) (Ben Manes) (Shawn Heisey)
- Improve overall robustness of the Streaming stack: Streaming API, Streaming Expressions, Parallel SQL [SOLR-7441](https://issues.apache.org/jira/browse/SOLR-7441) (Joel Bernstein)
- Add Equalitors to Streaming Expressions [SOLR-7513](https://issues.apache.org/jira/browse/SOLR-7513) (Dennis Gove) (Joel Bernstein)
- Simplify Interfaces used in Streaming Expressions [SOLR-7528](https://issues.apache.org/jira/browse/SOLR-7528) (Dennis Gove) (Joel Bernstein)
- Add checks in Streams for incoming stream order [SOLR-7554](https://issues.apache.org/jira/browse/SOLR-7554) (Dennis Gove) (Joel Bernstein)
- Remove deprecated zkCredientialsProvider element in solrcloud section of solr.xml. [SOLR-7624](https://issues.apache.org/jira/browse/SOLR-7624) (Xu Zhang) (Per Steffensen) (Ramkumar Aiyengar) (Mark Miller)
- Make ManagedIndexSchemaFactory the default schemaFactory when luceneMatchVersion &gt;= 6 [SOLR-8131](https://issues.apache.org/jira/browse/SOLR-8131) (Uwe Schindler) (shalin) (Varun Thacker)
- HDFSDirectoryFactory now defaults to using the global block cache. [SOLR-8132](https://issues.apache.org/jira/browse/SOLR-8132) (Mark Miller)
- Support upper case and mixed case column identifiers in the SQL interface [SOLR-8153](https://issues.apache.org/jira/browse/SOLR-8153) (Joel Bernstein)
- SQL JDBC - DriverImpl loadParams doesn't support keys with no values in the connection string [SOLR-8179](https://issues.apache.org/jira/browse/SOLR-8179) (Kevin Risden) (Joel Bernstein)
- Implement Closeable on TupleStream [SOLR-8190](https://issues.apache.org/jira/browse/SOLR-8190) (Kevin Risden) (Joel Bernstein)
- Change default hdfs tlog replication factor from 1 to 3. [SOLR-8258](https://issues.apache.org/jira/browse/SOLR-8258) (Mark Miller)
- Remove deprecated JettySolrRunner.getDispatchFilter() [SOLR-8259](https://issues.apache.org/jira/browse/SOLR-8259) 
- Change SchemaSimilarityFactory default to BM25Similarity [SOLR-8261](https://issues.apache.org/jira/browse/SOLR-8261) (hossman)
- Remove Java Serialization from the Streaming API. The /stream handler now only accepts Streaming Expressions. [SOLR-8266](https://issues.apache.org/jira/browse/SOLR-8266) (Jason Gerlowski) (Joel Bernstein)
- Change implicit default Similarity to use BM25 when luceneMatchVersion &gt;= 6 [SOLR-8270](https://issues.apache.org/jira/browse/SOLR-8270) (hossman)
- Change implicit default Similarity to use SchemaSimilarityFactory when luceneMatchVersion &gt;= 6 [SOLR-8271](https://issues.apache.org/jira/browse/SOLR-8271) (hossman)
- Enable /export, /stream and /sql handlers by default and remove them from example configs. [SOLR-8426](https://issues.apache.org/jira/browse/SOLR-8426) (shalin)
- Change /stream handler http param from "stream" to "expr" [SOLR-8443](https://issues.apache.org/jira/browse/SOLR-8443) (Joel Bernstein) (Dennis Gove)
- Improve JdbcTest to not use plain assert statements [SOLR-8529](https://issues.apache.org/jira/browse/SOLR-8529) (Kevin Risden) (Joel Bernstein)
- Date statistics: make "sum" a double instead of a long/date [SOLR-8671](https://issues.apache.org/jira/browse/SOLR-8671) (Tom Hill) (Christine Poerschke) (Tomás Fernández Löbbe)
- Prevent shards containing invalid characters from being created. Checks added server-side and in SolrJ. [SOLR-8677](https://issues.apache.org/jira/browse/SOLR-8677) (Shai Erera) (Jason Gerlowski) (Anshum Gupta)
- Make peersync fingerprinting optional with solr.disableFingerprint system property. [SOLR-8690](https://issues.apache.org/jira/browse/SOLR-8690) (yonik)
- Cache index fingerprints per searcher. [SOLR-8691](https://issues.apache.org/jira/browse/SOLR-8691) (yonik)
- Improve ZkStateReader logging. [SOLR-8693](https://issues.apache.org/jira/browse/SOLR-8693) (Scott Blum) (Mark Miller)
- Upgrade morfologik-stemming to version 2.1.0. [SOLR-8710](https://issues.apache.org/jira/browse/SOLR-8710) (Dawid Weiss)
- Upgrade Carrot2 clustering dependency to 3.12.0. [SOLR-8711](https://issues.apache.org/jira/browse/SOLR-8711) (Dawid Weiss)
- new UI and example solrconfig files point to Reference Guide for Solr Query Syntax instead of the wiki. [SOLR-8713](https://issues.apache.org/jira/browse/SOLR-8713) (Marius Grama) (Tomás Fernández Löbbe)
- schema GET operations on fields, dynamicFields, fieldTypes, copyField are reimplemented as a part of the bulk API with less details [SOLR-8736](https://issues.apache.org/jira/browse/SOLR-8736) (noble)
- docValues are now enabled by default for most non-text (string, date, and numeric) fields in the schema templates. [SOLR-8740](https://issues.apache.org/jira/browse/SOLR-8740) (yonik)
- Renamed Overseer.getInQueue to getStateUpdateQueue, getInternalQueue to getInternalWorkQueue and added javadocs. [SOLR-8746](https://issues.apache.org/jira/browse/SOLR-8746) (Scott Blum) (shalin)
- Add a test for SizeLimitedDistributedMap and improve javadocs. [SOLR-8752](https://issues.apache.org/jira/browse/SOLR-8752) (shalin)
- Add a new SolrCloudTestCase class, using MiniSolrCloudCluster [SOLR-8758](https://issues.apache.org/jira/browse/SOLR-8758) (Alan Woodward)
- Remove deprecated &lt;admin&gt; tag in solrconfig.xml and support for admin/gettableFiles [SOLR-8766](https://issues.apache.org/jira/browse/SOLR-8766) (noble) (Jason Gerlowski) (Varun Thacker)
- Improve error message when tuple can't be read by SolrJ JDBC [SOLR-8799](https://issues.apache.org/jira/browse/SOLR-8799) (Kevin Risden) (Joel Bernstein)
- Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType [SOLR-8810](https://issues.apache.org/jira/browse/SOLR-8810) (Kevin Risden)
- Implement DatabaseMetaDataImpl getTables() and fix getSchemas(). [SOLR-8819](https://issues.apache.org/jira/browse/SOLR-8819) (Trey Cahill) (Joel Bernstein) (Kevin Risden)
- Return 400, and a SolrException when an invalid json is provided to the update handler instead of 500. [SOLR-8836](https://issues.apache.org/jira/browse/SOLR-8836) (Jason Gerlowski) (Anshum Gupta)
- All dates are formatted via Instant.toString() (ISO-8601); see Solr upgrade notes for differences. Will now parse (and format) dates with a leading '+' or '-' (BC dates or dates &gt; 4 digit year. [value] and ms() and contrib/analytics now parse with date math. [SOLR-8904](https://issues.apache.org/jira/browse/SOLR-8904) (David Smiley)
- DateUtil in SolrJ moved to the extraction contrib as ExtractionDateUtil. Obsolete methods were removed. [SOLR-8904](https://issues.apache.org/jira/browse/SOLR-8904) (David Smiley)


[5.5.5] - 2017-10-24
--------------------

### Upgrade Notes (2 changes)

- in the XML query parser [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (defType=xmlparser or {!xmlparser ... })
- RunExecutableListener was deprecated and is disabled by default for security reasons. Legacy applications still using it must explicitely pass '-Dsolr.enableRunExecutableListener=true' to the Solr command line. Be aware that you should really disable API-based config editing at the same time, using '-Ddisable.configEdit=true'! [SOLR-11482](https://issues.apache.org/jira/browse/SOLR-11482) (Uwe Schindler)

### Fixed (2 changes)

- Leaking one SolrZkClient instance per second [SOLR-10420](https://issues.apache.org/jira/browse/SOLR-10420) (Scott Blum) (Cao Manh Dat) (Markus Jelsma) (Steve Rowe)
- Disallow resolving of external entities in the XML query parser (defType=xmlparser). [SOLR-11477](https://issues.apache.org/jira/browse/SOLR-11477) (Michael Stepankin) (Olga Barinova) (Uwe Schindler) (Christine Poerschke)

### Other (1 change)

- Update jmatio to 1.2 and prevent deserialization inside Matlab files. [SOLR-11486](https://issues.apache.org/jira/browse/SOLR-11486) (Uwe Schindler) (Steve Rowe)


[5.5.4] - 2017-02-15
--------------------

### Other (2 changes)

- Validation of filename params in ReplicationHandler [SOLR-10031](https://issues.apache.org/jira/browse/SOLR-10031) (Hrishikesh Gadre) (janhoy)
- Upgrade commons-fileupload to 1.3.2, fixing a potential vulnerability CVE-2016-3092 [SOLR-9819](https://issues.apache.org/jira/browse/SOLR-9819) (Anshum Gupta)


[5.5.3] - 2016-09-09
--------------------

### Other (1 change)

- Lucene only release 


[5.5.2] - 2016-06-25
--------------------

### Fixed (26 changes)

- closing JDBC Statement on failures in DataImportHandler (DIH) [SOLR-8612](https://issues.apache.org/jira/browse/SOLR-8612) (Kristine Jetzke) (Mikhail Khludnev)
- keep LOG4J_CONFIG in solr.cmd [SOLR-8676](https://issues.apache.org/jira/browse/SOLR-8676) (Kristine Jetzke) (Mikhail Khludnev)
- Ensure ZK watchers are not triggering our watch logic on connection events and make this handling more consistent. [SOLR-8695](https://issues.apache.org/jira/browse/SOLR-8695) (Scott Blum) (Mark Miller)
- ZooKeeper ACL support fixed. [SOLR-8792](https://issues.apache.org/jira/browse/SOLR-8792) (Esther Quansah) (Ishan Chattopadhyaya) (Steve Rowe)
- /bin/solr create script always returns exit code 0 when a collection/core already exists. [SOLR-8801](https://issues.apache.org/jira/browse/SOLR-8801) (Khalid Alharbi) (Marius Grama) (Steve Rowe)
- edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by SOLR-2649. [SOLR-8812](https://issues.apache.org/jira/browse/SOLR-8812) [SOLR-2649](https://issues.apache.org/jira/browse/SOLR-2649) (Greg Pendlebury) (Jan Høydahl) (Erick Erickson) (Steve Rowe)
- HdfsUpdateLog does not use configured or new default number of version buckets and is hard coded to 256. [SOLR-8857](https://issues.apache.org/jira/browse/SOLR-8857) (Mark Miller) (yonik) (Gregory Chanan)
- SolrCloud Overseer clusterState could unexpectedly be null resulting in NPE. [SOLR-8875](https://issues.apache.org/jira/browse/SOLR-8875) (Scott Blum) (David Smiley)
- Fix group.sort option [SOLR-8940](https://issues.apache.org/jira/browse/SOLR-8940) (hossman)
- bin/post failed to detect stdin usage on Ubuntu; maybe other unixes. [SOLR-8946](https://issues.apache.org/jira/browse/SOLR-8946) (David Smiley)
- Preserve root cause when wrapping exceptions [SOLR-8971](https://issues.apache.org/jira/browse/SOLR-8971) (hossman)
- Fix top term links from schema browser page to use {!term} parser [SOLR-8990](https://issues.apache.org/jira/browse/SOLR-8990) (hossman)
- Fix "name" field type definition in films example. [SOLR-9004](https://issues.apache.org/jira/browse/SOLR-9004) (Alexandre Rafalovitch) (Varun Thacker)
- The 'downnode' overseer command can trip asserts in ZkStateWriter. [SOLR-9030](https://issues.apache.org/jira/browse/SOLR-9030) (Scott Blum) (Mark Miller) (shalin)
- Atomic updates failed to work when there were copyField targets that had docValues enabled. [SOLR-9034](https://issues.apache.org/jira/browse/SOLR-9034) (Karthik Ramachandran) (Ishan Chattopadhyaya) (yonik)
- Solr slave is doing full replication (entire index) of index after master restart. [SOLR-9036](https://issues.apache.org/jira/browse/SOLR-9036) (Lior Sapir) (Mark Miller) (shalin)
- Fix NullPointerException in TopGroupsShardResponseProcessor. [SOLR-9093](https://issues.apache.org/jira/browse/SOLR-9093) (Christine Poerschke)
- Race condition causing occasional SolrIndexSearcher leak when SolrCore is reloaded. [SOLR-9116](https://issues.apache.org/jira/browse/SOLR-9116) (Jessica Cheng Mallet) (shalin)
- The first SolrCore is leaked after reload. [SOLR-9117](https://issues.apache.org/jira/browse/SOLR-9117) (Jessica Cheng Mallet) (shalin)
- HashQParserPlugin should trim partition keys [SOLR-9118](https://issues.apache.org/jira/browse/SOLR-9118) (Joel Bernstein)
- Fix RestManager.addManagedResource return value. [SOLR-9134](https://issues.apache.org/jira/browse/SOLR-9134) (Christine Poerschke)
- Fix SolrCLI so that bin/solr -e cloud example can be run from any CWD [SOLR-9151](https://issues.apache.org/jira/browse/SOLR-9151) (janhoy)
- Spellcheck does not return collations if "maxCollationTries" is used with "cursorMark". [SOLR-9165](https://issues.apache.org/jira/browse/SOLR-9165) (James Dyer)
- facet method ENUM was sometimes unnecessarily being rewritten to FCS, causing slowdowns [SOLR-9176](https://issues.apache.org/jira/browse/SOLR-9176) (Alessandro Benedetti) (Jesse McLaughlin) (Alan Woodward)
- OverseerTaskQueue.peekTopN() fatally flawed [SOLR-9191](https://issues.apache.org/jira/browse/SOLR-9191) (Scott Blum) (Noble Paul)
- config APIs unable to add multiple values with same name [SOLR-9198](https://issues.apache.org/jira/browse/SOLR-9198) (noble)

### Other (11 changes)

- Improve javadocs for JavaBinCodec, ObjectResolver and enforce the single-usage policy. [SOLR-7516](https://issues.apache.org/jira/browse/SOLR-7516) (Jason Gerlowski) (Benoit Vanalderweireldt) (shalin)
- fix line separator in log4j.properties files [SOLR-8445](https://issues.apache.org/jira/browse/SOLR-8445) (Ahmet Arslan) (Mikhail Khludnev)
- Stop ignoring sysprop solr.tests.mergePolicy, and make tests randomly choose between setting &lt;mergePolicy&gt; and &lt;mergePolicyFactory&gt;, which was added in SOLR-8621. [SOLR-8674](https://issues.apache.org/jira/browse/SOLR-8674) [SOLR-8621](https://issues.apache.org/jira/browse/SOLR-8621) (Christine Poerschke)
- UpdateLog will now throw an exception if it doesn't know how to serialize a value. [SOLR-8866](https://issues.apache.org/jira/browse/SOLR-8866) (David Smiley)
- Solr should not close container streams. [SOLR-8933](https://issues.apache.org/jira/browse/SOLR-8933) (Mike Drob) (Uwe Schindler) (Mark Miller)
- In SolrCloud mode, under the 'Core Selector' dropdown in the UI the Replication tab won't be displayed anymore. The Replication tab is only beneficial to users running Solr in master-slave mode. [SOLR-8967](https://issues.apache.org/jira/browse/SOLR-8967) (Varun Thacker)
- Replace multiple "/replication" strings with one static constant. [SOLR-9037](https://issues.apache.org/jira/browse/SOLR-9037) (Christine Poerschke)
- zkcli should allow alternative locations for log4j configuration [SOLR-9047](https://issues.apache.org/jira/browse/SOLR-9047) (Gregory Chanan)
- Upgrade commons-fileupload to 1.3.1, fixing a potential vulnerability [SOLR-9053](https://issues.apache.org/jira/browse/SOLR-9053) (Jeff Field) (Mike Drob) (janhoy)
- Fix a bunch of typos across 103 files [SOLR-9105](https://issues.apache.org/jira/browse/SOLR-9105) (Bartosz Krasiński) (janhoy)
- Fix "start solr" text in cluster.vm Velocity template [SOLR-9131](https://issues.apache.org/jira/browse/SOLR-9131) (janhoy)


[5.5.1] - 2016-05-05
--------------------

### Fixed (41 changes)

- Fix position of OOM killer script when starting Solr in the background [SOLR-8145](https://issues.apache.org/jira/browse/SOLR-8145) (Jurian Broertjes via Timothy Potter)
- JSON Facet API - field faceting on a multi-valued string field without docValues (i.e. UnInvertedField implementation), but with a prefix or with a sort other than count, resulted in incorrect results. This has been fixed, and facet.prefix support for facet.method=uif has been enabled. [SOLR-8155](https://issues.apache.org/jira/browse/SOLR-8155) (Mikhail Khludnev) (yonik)
- ReplicaAssigner rejects valid nodes [SOLR-8375](https://issues.apache.org/jira/browse/SOLR-8375) (Kelvin Tan) (noble)
- The collections create API should return after all replicas are active. [SOLR-8416](https://issues.apache.org/jira/browse/SOLR-8416) (Michael Sun) (Mark Miller) (Alexey Serba)
- Fix long overflow in sumOfSquares for Date statistics. [SOLR-8420](https://issues.apache.org/jira/browse/SOLR-8420) (Tom Hill) (Christine Poerschke) (Tomás Fernández Löbbe)
- Fix the core restore functionality to allow restoring multiple times on the same core [SOLR-8449](https://issues.apache.org/jira/browse/SOLR-8449) (Johannes Brucher) (Varun Thacker)
- Successful or not, requests are not always fully consumed by Solrj clients and we count on HttpClient or the JVM. [SOLR-8578](https://issues.apache.org/jira/browse/SOLR-8578) (Mark Miller)
- After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made. [SOLR-8599](https://issues.apache.org/jira/browse/SOLR-8599) (Keith Laban) (Dennis Gove)
- DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs. [SOLR-8633](https://issues.apache.org/jira/browse/SOLR-8633) (hossman) (Mark Miller)
- PeerSync should use same nUpdates everywhere. [SOLR-8656](https://issues.apache.org/jira/browse/SOLR-8656) (Ramsey Haddad) (Mark Miller)
- SchemaManager waits correctly for replicas to be notified of a new change [SOLR-8662](https://issues.apache.org/jira/browse/SOLR-8662) (sarowe) (Noble Paul) (Varun Thacker)
- Always consume the full request on the server, not just in the case of an error. [SOLR-8683](https://issues.apache.org/jira/browse/SOLR-8683) (Mark Miller)
- DistributedMap/Queue can create too many Watchers and some code simplification. [SOLR-8694](https://issues.apache.org/jira/browse/SOLR-8694) (Scott Blum) (Mark Miller)
- Scope ZK election nodes by session to prevent elections from interfering with each other and other small LeaderElector improvements. [SOLR-8697](https://issues.apache.org/jira/browse/SOLR-8697) [SOLR-8837](https://issues.apache.org/jira/browse/SOLR-8837) (Scott Blum) (Mark Miller) (Alan Woodward)
- CloudSolrClient decides that there are no healthy nodes to handle a request too early. [SOLR-8701](https://issues.apache.org/jira/browse/SOLR-8701) (Mark Miller)
- Variable solr.core.instanceDir was not being resolved [SOLR-8712](https://issues.apache.org/jira/browse/SOLR-8712) (Kristine Jetzke) (Shawn Heisey) (Alan Woodward)
- Allow hyphen in collection, core, shard, and alias name as the non-first character (Anshum Gupta) [SOLR-8725](https://issues.apache.org/jira/browse/SOLR-8725) (from 6.0)
- ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica placement. splitshard should preassign nodes using rules, if rules are present [SOLR-8728](https://issues.apache.org/jira/browse/SOLR-8728) (noble) (Shai Erera)
- fix (maxMergeDocs|mergeFactor) deprecation warnings: in solrconfig.xml &lt;maxMergeDocs|mergeFactor&gt; may not be combined with &lt;mergePolicyFactory&gt; and &lt;maxMergeDocs|mergeFactor&gt; on their own or combined with &lt;mergePolicy&gt; is a warning. [SOLR-8734](https://issues.apache.org/jira/browse/SOLR-8734) (Christine Poerschke) (Shai Erera)
- Managed synonym lists do not include the original term in the expand [SOLR-8737](https://issues.apache.org/jira/browse/SOLR-8737) (janhoy)
- Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes [SOLR-8738](https://issues.apache.org/jira/browse/SOLR-8738) (hossman)
- OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100. The limit has now been increased to 100. [SOLR-8748](https://issues.apache.org/jira/browse/SOLR-8748) (Scott Blum) (shalin)
- Fix document exclusion in mlt query parser in Cloud mode for schemas that have non-"id" unique field [SOLR-8769](https://issues.apache.org/jira/browse/SOLR-8769) (Erik Hatcher) (Anshum Gupta)
- Multi-threaded core shutdown creates executor per core. [SOLR-8771](https://issues.apache.org/jira/browse/SOLR-8771) (Mike Drob) (Mark Miller)
- Fix missing InterruptedException handling in ZkStateReader.java [SOLR-8779](https://issues.apache.org/jira/browse/SOLR-8779) (Varun Thacker)
- Collections API responses contain node name in the core-level responses that are returned. [SOLR-8790](https://issues.apache.org/jira/browse/SOLR-8790) (Anshum Gupta)
- Fix Core admin status API to not fail when computing the size of the segments_N file if the file no longer exists (for example, if a commit happened and the IndexReader hasn't refreshed yet). In this case the reported size of the file is -1. [SOLR-8793](https://issues.apache.org/jira/browse/SOLR-8793) (Shai Erera) (Alexey Serba) (Richard Coggins)
- Fix a race condition in the ClusterStatus API call whereby the call would fail when a concurrent delete collection api command was executed [SOLR-8804](https://issues.apache.org/jira/browse/SOLR-8804) (Alexey Serba) (Varun Thacker)
- JSON Facet API: fix faceting exception on multi-valued numeric fields that have docValues. [SOLR-8835](https://issues.apache.org/jira/browse/SOLR-8835) (yonik)
- Returning non-stored docValues is incorrect for negative floats and doubles. [SOLR-8838](https://issues.apache.org/jira/browse/SOLR-8838) (Ishan Chattopadhyaya) (Steve Rowe)
- Real-time get sometimes fails to retrieve stored fields from docValues. [SOLR-8865](https://issues.apache.org/jira/browse/SOLR-8865) (Ishan Chattopadhyaya) (yonik)
- AngularJS Query tab no longer URL-encodes the /select part of the request, fixing possible 404 issue when Solr is behind a proxy. Also, now supports old-style &qt param when handler not prefixed with "/" [SOLR-8870](https://issues.apache.org/jira/browse/SOLR-8870) (janhoy)
- Fix TrieField.toObject(IndexableField) to work for field with docValues enabled. [SOLR-8886](https://issues.apache.org/jira/browse/SOLR-8886) (yonik)
- Fix StrField.toObject and toExternal to work with docValue IndexableField instances. [SOLR-8891](https://issues.apache.org/jira/browse/SOLR-8891) (yonik)
- Fix to OnReconnect listener registration to allow listeners to deregister, such as when a core is reloaded or deleted to avoid a memory leak. [SOLR-8908](https://issues.apache.org/jira/browse/SOLR-8908) (Timothy Potter)
- ZkStateReader's refreshLiveNodes(Watcher) is not thread safe. [SOLR-8914](https://issues.apache.org/jira/browse/SOLR-8914) (Scott Blum) (hoss) (sarowe) (Erick Erickson) (Mark Miller) (shalin)
- Zookeeper frenzy when a core is first created. [SOLR-8973](https://issues.apache.org/jira/browse/SOLR-8973) (Janmejay Singh) (Scott Blum) (shalin)
- Cleanup clusterstate and replicas for a failed create collection request [SOLR-8983](https://issues.apache.org/jira/browse/SOLR-8983) (Varun Thacker) (Anshum Gupta)
- Remove mention of the managed_schema_configs as valid config directory when creating the collection for the SolrCloud example. [SOLR-9007](https://issues.apache.org/jira/browse/SOLR-9007) (Timothy Potter)
- Fix SolrIdentifierValidator to not allow empty identifiers. [SOLR-9016](https://issues.apache.org/jira/browse/SOLR-9016) (Shai Erera)
- Fix solr.cmd that wrongly assumes Jetty will always listen on 0.0.0.0. [SOLR-9046](https://issues.apache.org/jira/browse/SOLR-9046) (Bram Van Dam) (Uwe Schindler)

### Other (1 change)

- Add a new SolrCloudTestCase class, using MiniSolrCloudCluster [SOLR-8758](https://issues.apache.org/jira/browse/SOLR-8758) (Alan Woodward)


[5.5.0] - 2016-02-22
--------------------

### Added (22 changes)

- Allow specifying "spellcheck.maxResultsForSuggest" as a percentage of filter query results [SOLR-4280](https://issues.apache.org/jira/browse/SOLR-4280) (Markus Jelsma) (James Dyer)
- Improve PreAnalyzedField query analysis. [SOLR-4619](https://issues.apache.org/jira/browse/SOLR-4619) (Andrzej Bialecki) (Steve Rowe)
- BlockJoinFacetComponent and BlockJoinDocSetFacetComponent for calculating facets by child.facet.field parameter with {!parent ..}.. query. They count facets on children documents aggregating (deduplicating) counts by parent documents [SOLR-5743](https://issues.apache.org/jira/browse/SOLR-5743) (Dr. Oleg Savrasov) (Mikhail Khludnev)
- Improve CheckIndex to work against HdfsDirectory [SOLR-7928](https://issues.apache.org/jira/browse/SOLR-7928) (Mike Drob) (Gregory Chanan)
- Read field from DocValues for non stored fields. [SOLR-8220](https://issues.apache.org/jira/browse/SOLR-8220) (Keith Laban) (yonik) (Erick Erickson) (Ishan Chattopadhyaya) (shalin)
- JSON Facet API: add "facet-info" into debug section of response when debugQuery=true [SOLR-8230](https://issues.apache.org/jira/browse/SOLR-8230) (Michael Sun) (yonik)
- Add domain size and numBuckets to facet telemetry info (facet debug info for the new Facet Module). [SOLR-8312](https://issues.apache.org/jira/browse/SOLR-8312) (Michael Sun) (yonik)
- Add upconfig and downconfig commands to the bin/solr script [SOLR-8378](https://issues.apache.org/jira/browse/SOLR-8378) (Erick Erickson)
- XML QueryParser support (defType=xmlparser) Lucene includes a queryparser that supports the creation of Lucene queries from XML. The queries supported by lucene.queryparser.xml.CoreParser are now supported by the newly created solr.search.SolrCoreParser and in future SolrCoreParser could support additional queries also. Example: &lt;BooleanQuery fieldName="description"&gt; &lt;Clause occurs="must"&gt; &lt;TermQuery&gt;shirt&lt;/TermQuery&gt; &lt;/Clause&gt; &lt;Clause occurs="mustnot"&gt; &lt;TermQuery&gt;plain&lt;/TermQuery&gt; &lt;/Clause&gt; &lt;Clause occurs="should"&gt; &lt;TermQuery&gt;cotton&lt;/TermQuery&gt; &lt;/Clause&gt; &lt;Clause occurs="must"&gt; &lt;BooleanQuery fieldName="size"&gt; &lt;Clause occurs="should"&gt; &lt;TermsQuery&gt;S M L&lt;/TermsQuery&gt; &lt;/Clause&gt; &lt;/BooleanQuery&gt; &lt;/Clause&gt; &lt;/BooleanQuery&gt; [SOLR-839](https://issues.apache.org/jira/browse/SOLR-839) (Erik Hatcher) (Karl Wettin) (Daniel Collins) (Nathan Visagan) (Ahmet Arslan) (Christine Poerschke)
- RuleBasedAuthorizationPlugin adds an 'all' permission [SOLR-8428](https://issues.apache.org/jira/browse/SOLR-8428) (noble)
- Add a flag 'blockUnknown' to BasicAuthPlugin to block unauthenticated requests [SOLR-8429](https://issues.apache.org/jira/browse/SOLR-8429) (noble)
- Add wildcard support to role, to match any role in RuleBasedAuthorizationPlugin [SOLR-8434](https://issues.apache.org/jira/browse/SOLR-8434) (noble)
- adding facet.method=uif to bring back UnInvertedField faceting which is used to work on facet.method=fc. It's more performant for rarely changing indexes. Note: it ignores prefix and contains yet. [SOLR-8466](https://issues.apache.org/jira/browse/SOLR-8466) (Jamie Johnson) (Mikhail Khludnev)
- Make TTL of PKIAuthenticationPlugin's tokens configurable through a system property (pkiauth.ttl) [SOLR-8470](https://issues.apache.org/jira/browse/SOLR-8470) (noble)
- Let users choose compression mode in SchemaCodecFactory [SOLR-8477](https://issues.apache.org/jira/browse/SOLR-8477) (Tomás Fernández Löbbe)
- Allow the number of threads ConcurrentUpdateSolrClient StreamingSolrClients configurable by a system property. NOTE: this is an expert option and can result in more often needing to do full index replication for recovery, the sweet spot for using this is very high volume, leader-only indexing. [SOLR-8500](https://issues.apache.org/jira/browse/SOLR-8500) (Tim Potter) (Erick Erickson)
- Add generic support for collection APIs to be async. Thus more actions benefit from having async support. The commands that additionally get async support are: delete/reload collection, create/delete alias, create/delete shard, delete replica, add/delete replica property, add/remove role, overseer status, balance shard unique, rebalance leaders, modify collection, migrate state format [SOLR-8534](https://issues.apache.org/jira/browse/SOLR-8534) (Varun Thacker)
- Added RequestStatusState enum which can be used when comparing states of asynchronous requests. [SOLR-8560](https://issues.apache.org/jira/browse/SOLR-8560) (Shai Erera)
- added index fingerprint, a hash over all versions currently in the index. PeerSync now uses this to check if replicas are in sync. [SOLR-8586](https://issues.apache.org/jira/browse/SOLR-8586) (yonik)
- Deprecate &lt;mergePolicy&gt; in favor of &lt;mergePolicyFactory&gt;. It allows to configure both the "simple" merge policies, but also more advanced ones, e.g. UpgradeIndexMergePolicy. [SOLR-8621](https://issues.apache.org/jira/browse/SOLR-8621) (Christine Poerschke) (Shai Erera)
- SOLR allows creation of collections with invalid names [SOLR-8642](https://issues.apache.org/jira/browse/SOLR-8642) (Jason Gerlowski) (Erick Erickson)
- DELETESTATUS API for selective deletion and flushing of stored async collection API responses. [SOLR-8648](https://issues.apache.org/jira/browse/SOLR-8648) (Anshum Gupta)

### Changed (4 changes)

- Add an overseer action to publish an entire node as 'down'. [SOLR-7281](https://issues.apache.org/jira/browse/SOLR-7281) (Mark Miller) (shalin)
- Specify the entity request size when known in HttpSolrClient. [SOLR-8501](https://issues.apache.org/jira/browse/SOLR-8501) (Mark Miller)
- Just like creating cores, we should use multiple threads when closing cores. [SOLR-8615](https://issues.apache.org/jira/browse/SOLR-8615) (Mark Miller)
- Non binary responses use chunked encoding because we flush the outputstream early. [SOLR-8669](https://issues.apache.org/jira/browse/SOLR-8669) (Mark Miller)

### Fixed (35 changes)

- The default spellcheck query converter was ignoring terms consisting entirely of digits. [SOLR-2556](https://issues.apache.org/jira/browse/SOLR-2556) (James Dyer)
- MM ignored in edismax queries with operators. [SOLR-2649](https://issues.apache.org/jira/browse/SOLR-2649) (Greg Pendlebury) (Jan Høydahl et. al.) (Erick Erickson)
- Fixed local params to work correctly with multivalued params [SOLR-2798](https://issues.apache.org/jira/browse/SOLR-2798) (Demian Katz) (hossman)
- Fix ConjunctionSolrSpellChecker to not compare StringDistance by instance. [SOLR-6271](https://issues.apache.org/jira/browse/SOLR-6271) (Igor Kostromin) (James Dyer)
- cores?action=UNLOAD now waits for the core to close before unregistering it from ZK. [SOLR-6279](https://issues.apache.org/jira/browse/SOLR-6279) (Christine Poerschke)
- Fix "Files" UI to show the managed-schema file as well. [SOLR-6992](https://issues.apache.org/jira/browse/SOLR-6992) (Shawn Heisey) (Varun Thacker)
- Fix Spellcheck Collate to not invalidate range queries. [SOLR-7304](https://issues.apache.org/jira/browse/SOLR-7304) (James Dyer)
- AIOOBE in RecordingJSONParser [SOLR-7462](https://issues.apache.org/jira/browse/SOLR-7462) (Scott Dawson) (noble)
- HdfsLock may fail to close a FileSystem instance if it cannot immediately obtain an index lock. [SOLR-8015](https://issues.apache.org/jira/browse/SOLR-8015) (Mark Miller)
- &debug=results for distributed search when distrib.singlePass (sometimes activated automatically) could result in an NPE. [SOLR-8059](https://issues.apache.org/jira/browse/SOLR-8059) (David Smiley) (Markus Jelsma)
- Word Break Spellchecker would throw AIOOBE with certain queries containing "should" clauses. [SOLR-8175](https://issues.apache.org/jira/browse/SOLR-8175) (Ryan Josal) (James Dyer)
- Atomic updates and realtime-get do not work with non-stored docvalues. [SOLR-8276](https://issues.apache.org/jira/browse/SOLR-8276) (Ishan Chattopadhyaya) (yonik) (shalin)
- ConcurrentUpdateSolrClient attempts to use response's content type as charset encoding for parsing exception. [SOLR-8366](https://issues.apache.org/jira/browse/SOLR-8366) (shalin)
- Fix the LeaderInitiatedRecovery 'all replicas participate' fail-safe. [SOLR-8367](https://issues.apache.org/jira/browse/SOLR-8367) (Mark Miller) (Mike Drob)
- Try and prevent too many recovery requests from stacking up and clean up some faulty cancel recovery logic. [SOLR-8371](https://issues.apache.org/jira/browse/SOLR-8371) (Mark Miller)
- Canceled recovery can rarely lead to inconsistent shards: If a replica is recovering via index replication, and that recovery fails (for example if the leader goes down), and then some more updates are received (there could be a few left to be processed from the leader that just went down), and then that replica is brought down, it will think it is up-to-date when restarted. [SOLR-8372](https://issues.apache.org/jira/browse/SOLR-8372) (shalin) (Mark Miller) (yonik)
- KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request [SOLR-8373](https://issues.apache.org/jira/browse/SOLR-8373) (Ishan Chattopadhyaya) (noble)
- Windows start script fails when executed from a different drive. [SOLR-8401](https://issues.apache.org/jira/browse/SOLR-8401) (Nicolas Gavalda) (Erick Erickson)
- TermVectorComponent for distributed search when distrib.singlePass could include term vectors for documents that matched the query yet weren't in the returned documents. [SOLR-8419](https://issues.apache.org/jira/browse/SOLR-8419) (David Smiley)
- When authentication enabled, requests fail if sent to a node that doesn't host the collection [SOLR-8422](https://issues.apache.org/jira/browse/SOLR-8422) (noble)
- Our HttpClient retry policy is too permissive. [SOLR-8450](https://issues.apache.org/jira/browse/SOLR-8450) (Mark Miller) (shalin)
- We should not call method.abort in HttpSolrClient or HttpSolrCall#remoteQuery and HttpSolrCall#remoteQuery should not close streams. [SOLR-8451](https://issues.apache.org/jira/browse/SOLR-8451) (Mark Miller)
- Solr should attempt to consume the request inputstream on errors as we cannot count on the container to do it. [SOLR-8453](https://issues.apache.org/jira/browse/SOLR-8453) (Mark Miller) (Greg Wilkins) (yonik) (Joakim Erdfelt)
- /analysis/field could throw exceptions for custom attributes. [SOLR-8460](https://issues.apache.org/jira/browse/SOLR-8460) (David Smiley) (Uwe Schindler)
- SimplePostTool and therefore the bin/post script cannot upload files larger than 2.1GB. [SOLR-8494](https://issues.apache.org/jira/browse/SOLR-8494) (shalin)
- Raise default maxUpdateConnections and maxUpdateConnectionsPerHost to 100k each. [SOLR-8533](https://issues.apache.org/jira/browse/SOLR-8533) (Mark Miller)
- Highlighting a geo RPT field would throw an NPE instead of doing nothing. [SOLR-8541](https://issues.apache.org/jira/browse/SOLR-8541) (Pawel Rog) (David Smiley)
- Core discovery was not following symlinks [SOLR-8548](https://issues.apache.org/jira/browse/SOLR-8548) (Aaron LaBella) (Alan Woodward)
- Make collection deletion more robust. [SOLR-8551](https://issues.apache.org/jira/browse/SOLR-8551) (Mark Miller)
- Fix Embedded ZooKeeper to use &lt;solrHome&gt;/zoo_data for it's data directory [SOLR-8564](https://issues.apache.org/jira/browse/SOLR-8564) 
- Fix HDFSLogReader replay status numbers, a performance bug where we can reopen FSDataInputStream much too often, and an hdfs tlog data integrity bug. [SOLR-8575](https://issues.apache.org/jira/browse/SOLR-8575) (Mark Miller) (Patrick Dvorack) (yonik)
- memory leak in JsonRecordReader affecting /update/json/docs. Large payloads cause OOM [SOLR-8582](https://issues.apache.org/jira/browse/SOLR-8582) (noble) (shalin)
- Regular expression queries starting with escaped forward slash caused an exception. [SOLR-8605](https://issues.apache.org/jira/browse/SOLR-8605) (Scott Blum) (yonik)
- The Schema API refuses to add new fields that match existing dynamic fields. [SOLR-8607](https://issues.apache.org/jira/browse/SOLR-8607) (Jan Høydahl) (Steve Rowe)
- The commitWithin parameter is not passed on for deleteById in UpdateRequest in distributed queries [SOLR-8651](https://issues.apache.org/jira/browse/SOLR-8651) (Jessica Cheng Mallet) (Erick Erickson)

### Other (54 changes)

- Added test for score ordered grouping, and refactored TopGroupsResultTransformer. [LUCENE-6900](https://issues.apache.org/jira/browse/LUCENE-6900) (David Smiley)
- add RandomForceMergePolicy class in test-framework [LUCENE-6925](https://issues.apache.org/jira/browse/LUCENE-6925) (Christine Poerschke)
- Refactor several code places that lookup locales by string name to use BCP47 locale tag instead. LuceneTestCase now also prints locales on failing tests this way. In addition, several places in Solr now additionally support BCP47 in config files. [LUCENE-6978](https://issues.apache.org/jira/browse/LUCENE-6978) (Uwe Schindler) (Robert Muir)
- Warn in logs when expensive optimize calls are made [SOLR-3141](https://issues.apache.org/jira/browse/SOLR-3141) (yonik) (janhoy)
- bin/post now uses /update/json/docs for application/json content types, including support for .jsonl (JSON Lines) files. [SOLR-7042](https://issues.apache.org/jira/browse/SOLR-7042) (Erik Hatcher and shalin)
- revise BasicDistributedZkTest.test logic w.r.t. 'commitWithin did not work on some nodes' [SOLR-7774](https://issues.apache.org/jira/browse/SOLR-7774) (Christine Poerschke)
- Remove CLUSTERSTATUS related exclusivity checks while running commands in the Overseer because the CLUSTERSTATUS request is served by the individual nodes itself and not via the Overseer node [SOLR-7907](https://issues.apache.org/jira/browse/SOLR-7907) (Varun Thacker)
- Make QueryComponent more extensible. [SOLR-7968](https://issues.apache.org/jira/browse/SOLR-7968) (Markus Jelsma) (David Smiley)
- All example config sets now explicitly use the ManagedIndexSchemaFactory instead of ClassicIndexSchemaFactory. This means that the Schema APIs ( /&lt;collection&gt;/schema ) are enabled by default and the schema is mutable. The schema file will be called managed-schema [SOLR-8131](https://issues.apache.org/jira/browse/SOLR-8131) (Uwe Schindler) (shalin) (Varun Thacker)
- Add a new test fault injection approach and a new SolrCloud test that stops and starts the cluster while indexing data and with random faults. [SOLR-8279](https://issues.apache.org/jira/browse/SOLR-8279) (Mark Miller)
- replace LatLonType.getValueSource's QParser use [SOLR-8305](https://issues.apache.org/jira/browse/SOLR-8305) (Christine Poerschke)
- Core gets inaccessible after RENAME operation with special characters [SOLR-8308](https://issues.apache.org/jira/browse/SOLR-8308) (Erik Hatcher) (Erick Erickson)
- SimpleQueryParser doesn't use MultiTermAnalysis for Fuzzy Queries [SOLR-8313](https://issues.apache.org/jira/browse/SOLR-8313) (Tom Hill) (Erick Erickson)
- add & use responseHeader and response accessors to SolrQueryResponse. [SOLR-8317](https://issues.apache.org/jira/browse/SOLR-8317) (Christine Poerschke)
- add a (SolrQueryRequest free) SortSpecParsing.parseSortSpec variant [SOLR-8321](https://issues.apache.org/jira/browse/SOLR-8321) (Christine Poerschke)
- Several API tweaks so that public APIs were no longer refering to private classes [SOLR-8333](https://issues.apache.org/jira/browse/SOLR-8333) (ehatcher) (Shawn Heisey) (hossman)
- CoreDescriptor now takes a Path for its instance directory, rather than a String [SOLR-8336](https://issues.apache.org/jira/browse/SOLR-8336) (Alan Woodward)
- in OverseerTest replace strings such as "collection1" and "state" with variable or enum equivalent [SOLR-8338](https://issues.apache.org/jira/browse/SOLR-8338) (Christine Poerschke)
- Refactor SolrDocument and SolrInputDocument to have a common base abstract class called SolrDocumentBase. Deprecated methods toSolrInputDocument and toSolrDocument in ClientUtils. [SOLR-8339](https://issues.apache.org/jira/browse/SOLR-8339) (Ishan Chattopadhyaya) (shalin)
- Improve HdfsDirectory toString representation [SOLR-8351](https://issues.apache.org/jira/browse/SOLR-8351) (Mike Drob) (Gregory Chanan)
- randomise unload order in UnloadDistributedZkTest.testUnloadShardAndCollection [SOLR-8352](https://issues.apache.org/jira/browse/SOLR-8352) (Christine Poerschke)
- Support regex for skipping license checksums [SOLR-8353](https://issues.apache.org/jira/browse/SOLR-8353) (Gregory Chanan)
- UpdateLog.RecentUpdates now implements Closeable [SOLR-8357](https://issues.apache.org/jira/browse/SOLR-8357) (Alan Woodward)
- Restrict child classes from using parent logger's state [SOLR-8359](https://issues.apache.org/jira/browse/SOLR-8359) (Jason Gerlowski) (Mike Drob) (Anshum Gupta)
- simplify ExternalFileField.getValueSource implementation [SOLR-8360](https://issues.apache.org/jira/browse/SOLR-8360) (Christine Poerschke)
- Cleanup data_driven managed-schema and solrconfig.xml files. Commented out copyFields are removed and solrconfig.xml doesn't refer to field which are not defined. [SOLR-8381](https://issues.apache.org/jira/browse/SOLR-8381) (Varun Thacker)
- SolrCore.java + QParserPlugin.java container initialCapacity tweaks [SOLR-8383](https://issues.apache.org/jira/browse/SOLR-8383) (Christine Poerschke) (Mike Drob)
- All example configs shipped with Solr explicitly use ManagedIndexSchemaFactory, the schema file will be called managed-schema instead of schema.xml . It is not advised to use hand edit the managed-schema. You should use the schema APIs instead ( /&lt;collection&gt;/schema ) . If you do not want this behaviour in the example configs, before you start solr rename managed-schema to schema.xml and change the schemaFactory in solrconfig.xml file to explicitly use ClassicIndexSchemaFactory instead : &lt;schemaFactory class="ClassicIndexSchemaFactory"/&gt; [SOLR-8387](https://issues.apache.org/jira/browse/SOLR-8387) (Varun Thacker)
- factor out response/TestSolrQueryResponse.java from servlet/ResponseHeaderTest.java more TestSolrQueryResponse.java tests; add SolrReturnFields.toString method, ReturnFieldsTest.testToString test; [SOLR-8388](https://issues.apache.org/jira/browse/SOLR-8388) (Christine Poerschke)
- tweak SolrQueryResponse.getToLogAsString, add TestSolrQueryResponse.testToLog [SOLR-8404](https://issues.apache.org/jira/browse/SOLR-8404) (Christine Poerschke)
- Add all read paths to 'read' permission in RuleBasedAuthorizationPlugin [SOLR-8410](https://issues.apache.org/jira/browse/SOLR-8410) (noble)
- AbstractDistribZkTestBase.verifyReplicaStatus could throw NPE [SOLR-8414](https://issues.apache.org/jira/browse/SOLR-8414) (Christine Poerschke)
- TermVectorComponent for distributed search now requires a uniqueKey in the schema. Also, it no longer returns "uniqueKeyField" in the response. [SOLR-8419](https://issues.apache.org/jira/browse/SOLR-8419) (David Smiley)
- replace "partialResults" occurrences with SolrQueryResponse.RESPONSE_HEADER_PARTIAL_RESULTS_KEY [SOLR-8452](https://issues.apache.org/jira/browse/SOLR-8452) (Christine Poerschke)
- ZkStateReader logging improvements and cleanup of dead code [SOLR-8454](https://issues.apache.org/jira/browse/SOLR-8454) (Shai Erera) (Anshum Gupta)
- RecovertStrategy logging improvements and sleep-between-recovery-attempts bug fix. [SOLR-8455](https://issues.apache.org/jira/browse/SOLR-8455) (Shai Erera)
- Refactor and cleanup CoreAdminHandler [SOLR-8476](https://issues.apache.org/jira/browse/SOLR-8476) (noble) (Varun Thacker)
- TestSearchPerf no longer needs to duplicate SolrIndexSearcher.(NO_CHECK_QCACHE|NO_CHECK_FILTERCACHE) [SOLR-8481](https://issues.apache.org/jira/browse/SOLR-8481) (Christine Poerschke)
- add & use QueryCommand.[gs]etTerminateEarly accessors. [SOLR-8482](https://issues.apache.org/jira/browse/SOLR-8482) (Christine Poerschke)
- relocate 'IMPORTANT NOTE' in open-exchange-rates.json test-file to avoid OpenExchangeRatesOrgProvider.java warnings [SOLR-8483](https://issues.apache.org/jira/browse/SOLR-8483) (Christine Poerschke)
- refactor update/SolrIndexConfig.LOCK_TYPE_* into core/DirectoryFactory.LOCK_TYPE_* [SOLR-8484](https://issues.apache.org/jira/browse/SOLR-8484) (Christine Poerschke)
- No longer require jar/unzip for bin/solr [SOLR-8486](https://issues.apache.org/jira/browse/SOLR-8486) (Steven E. Harris) (janhoy)
- TestMiniSolrCloudCluster.createCollection to support extra & alternative collectionProperties [SOLR-8489](https://issues.apache.org/jira/browse/SOLR-8489) (Christine Poerschke)
- Improve error message when a large value is stored in an indexed string field. [SOLR-8498](https://issues.apache.org/jira/browse/SOLR-8498) (shalin)
- (IndexSchema|SolrIndexConfig)Test: private static finals for solrconfig.xml and schema.xml String literals. [SOLR-8504](https://issues.apache.org/jira/browse/SOLR-8504) (Christine Poerschke)
- core/DirectoryFactory.LOCK_TYPE_HDFS - add & use it instead of String literals [SOLR-8505](https://issues.apache.org/jira/browse/SOLR-8505) (Christine Poerschke)
- Support forcing define-lucene-javadoc-url to be local [SOLR-8535](https://issues.apache.org/jira/browse/SOLR-8535) (Gregory Chanan)
- Solr start script checks for cores which have failed to load as well before attempting to create a core with the same name [SOLR-8549](https://issues.apache.org/jira/browse/SOLR-8549) (Varun Thacker)
- SearchGroupShardResponseProcessor (initialCapacity) tweaks [SOLR-8555](https://issues.apache.org/jira/browse/SOLR-8555) (Christine Poerschke)
- add & use CommonParams.(ROWS|START)_DEFAULT constants [SOLR-8565](https://issues.apache.org/jira/browse/SOLR-8565) (Christine Poerschke)
- various initialCapacity tweaks (Fix Versions: trunk 5.5) [SOLR-8566](https://issues.apache.org/jira/browse/SOLR-8566) (Christine Poerschke)
- Use BinaryRequestWriter by default in HttpSolrClient and ConcurrentUpdateSolrClient. [SOLR-8595](https://issues.apache.org/jira/browse/SOLR-8595) (shalin)
- add default, no-op QParserPlugin.init(NamedList) method [SOLR-8597](https://issues.apache.org/jira/browse/SOLR-8597) (Christine Poerschke)
- add & use ReRankQParserPlugin parameter [default] constants, changed ReRankQuery.toString to use StringBuilder. [SOLR-8600](https://issues.apache.org/jira/browse/SOLR-8600) (Christine Poerschke)


[5.4.1] - 2016-01-23
--------------------

### Added (1 change)

- Make TTL of PKIAuthenticationPlugin's tokens configurable through a system property (pkiauth.ttl) [SOLR-8470](https://issues.apache.org/jira/browse/SOLR-8470) (noble)

### Fixed (7 changes)

- AIOOBE in RecordingJSONParser [SOLR-7462](https://issues.apache.org/jira/browse/SOLR-7462) (Scott Dawson) (noble)
- &debug=results for distributed search when distrib.singlePass (sometimes activated automatically) could result in an NPE. [SOLR-8059](https://issues.apache.org/jira/browse/SOLR-8059) (David Smiley) (Markus Jelsma)
- KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request [SOLR-8373](https://issues.apache.org/jira/browse/SOLR-8373) (Ishan Chattopadhyaya) (noble)
- Adapt to changes in LUCENE-6590 for use of boosts with MLTHandler and Simple/CloudMLTQParser [SOLR-8418](https://issues.apache.org/jira/browse/SOLR-8418) [LUCENE-6590](https://issues.apache.org/jira/browse/LUCENE-6590) (Jens Wille) (Ramkumar Aiyengar)
- When authentication enabled, requests fail if sent to a node that doesn't host the collection [SOLR-8422](https://issues.apache.org/jira/browse/SOLR-8422) (noble)
- /analysis/field could throw exceptions for custom attributes. [SOLR-8460](https://issues.apache.org/jira/browse/SOLR-8460) (David Smiley) (Uwe Schindler)
- SolrIndexSearcher.getDocSet(List&lt;Query&gt;) incorrectly included deleted documents when all of the queries were uncached (or there was no filter cache). This caused multi-select faceting (including the JSON Facet API) to include deleted doc counts when the remaining non-excluded filters were all uncached. This bug was first introduced in 5.3.0 [SOLR-8496](https://issues.apache.org/jira/browse/SOLR-8496) (Andreas Müller) (Vasiliy Bout) (Erick Erickson) (Shawn Heisey) (Hossman) (yonik)


[5.4.0] - 2015-12-14
--------------------

### Added (21 changes)

- SystemInfoHandler was improved to also show detailed operating system statistics on IBM J9 virtual machines. It also no longer fails on Java 9 with Jigsaw module system. [LUCENE-6795](https://issues.apache.org/jira/browse/LUCENE-6795) (Uwe Schindler)
- Add a collections dropdown to angular admin UI [SOLR-4316](https://issues.apache.org/jira/browse/SOLR-4316) (Upayavira) (Shalin Shekhar Mangar)
- In Angular UI, add a Collections UI when in cloud mode [SOLR-4388](https://issues.apache.org/jira/browse/SOLR-4388) (Upayavira)
- A utility Collection API to move a collection from shared clusterstate.json (stateFormat=1, default until 4.x) to the per-collection state.json stored in ZooKeeper (stateFormat=2, default since 5.0) seamlessly without any application down-time. Example: http://localhost:8983/solr/admin/collections?action=MIGRATESTATEFORMAT&collection=&lt;collection_name&gt; [SOLR-5756](https://issues.apache.org/jira/browse/SOLR-5756) (Noble Paul) (Scott Blum) (shalin)
- Add a 'sort' local param to the collapse QParser to support using complex sort options to select the representitive doc for each collapsed group. [SOLR-6168](https://issues.apache.org/jira/browse/SOLR-6168) (Umesh Prasad) (hossman)
- filterCache access added to the solr query syntax. Example: description:HDTV OR filter(+promotion:tv +promotion_date:[NOW/DAY TO NOW/DAY+7DAY]) [SOLR-7219](https://issues.apache.org/jira/browse/SOLR-7219) (yonik)
- A collection API to force elect a leader, called FORCELEADER, when all replicas in a shard are down [SOLR-7569](https://issues.apache.org/jira/browse/SOLR-7569) (Ishan Chattopadhyaya) (Mark Miller) (shalin) (noble)
- Allow fromIndex parameter to ScoreJoinQParserPlugin {!join score=.. fromIndex=..}.. to refer to a single-sharded collection that has a replica on all nodes where there is a replica in the to index [SOLR-7775](https://issues.apache.org/jira/browse/SOLR-7775) (Andrei Beliakov) (Mikhail Khludnev)
- Introduce a ConfigSet management API [SOLR-7789](https://issues.apache.org/jira/browse/SOLR-7789) (Gregory Chanan)
- Add links between original and new Admin UIs [SOLR-7858](https://issues.apache.org/jira/browse/SOLR-7858) [SOLR-8199](https://issues.apache.org/jira/browse/SOLR-8199) (Upayavira)
- Analyzing suggesters can now filter suggestions by a context field [SOLR-7888](https://issues.apache.org/jira/browse/SOLR-7888) (Arcadius Ahouansou) (janhoy)
- Add boost support, and also exclude the queried document in MoreLikeThis QParser [SOLR-7912](https://issues.apache.org/jira/browse/SOLR-7912) (Jens Wille) (Anshum Gupta)
- Provide pluggable context tool support for VelocityResponseWriter [SOLR-7915](https://issues.apache.org/jira/browse/SOLR-7915) (Erik Hatcher)
- Print Solr's version with command bin/solr version [SOLR-7961](https://issues.apache.org/jira/browse/SOLR-7961) (janhoy)
- Add a LIST command to ConfigSets API [SOLR-7995](https://issues.apache.org/jira/browse/SOLR-7995) (Gregory Chanan)
- Basic auth support in SolrJ [SOLR-8053](https://issues.apache.org/jira/browse/SOLR-8053) (noble)
- CloneFieldUpdateProcessorFactory now supports choosing a "dest" field name based on a regex pattern and replacement init options. [SOLR-8113](https://issues.apache.org/jira/browse/SOLR-8113) (Gus Heck) (hossman)
- Create/delete fields/dynamic fields/copy fields via schema tab on Angular UI [SOLR-8139](https://issues.apache.org/jira/browse/SOLR-8139) 
- Introduce possibility to configure ParseContext in ExtractingRequestHandler/ExtractingDocumentLoader [SOLR-8166](https://issues.apache.org/jira/browse/SOLR-8166) (Andriy Binetsky) (Uwe Schindler)
- JSON Facet API: add "method" param to terms/field facets to give an execution hint for what method should be used to facet. [SOLR-8217](https://issues.apache.org/jira/browse/SOLR-8217) (yonik)
- SchemaSimilarityFactory now supports a 'defaultSimFromFieldType' init option for using a fieldType name to identify which Similarity to use as a default. [SOLR-8329](https://issues.apache.org/jira/browse/SOLR-8329) (hossman)

### Changed (7 changes)

- Watch /collections zk node on all nodes so that cluster state updates are more efficient especially when cluster has a mix of collections in stateFormat=1 and stateFormat=2. [SOLR-6629](https://issues.apache.org/jira/browse/SOLR-6629) (Scott Blum) (shalin)
- New optimized DistributedQueue implementation for overseer increases message processing performance by ~470%. [SOLR-6760](https://issues.apache.org/jira/browse/SOLR-6760) (Noble Paul) (Scott Blum) (shalin)
- Filter (DocSet) production from term queries has been optimized and is anywhere from 20% to over 100% faster and produces less garbage on average. [SOLR-7918](https://issues.apache.org/jira/browse/SOLR-7918) (yonik)
- Reduce memory allocated by JavaBinCodec to encode small strings by an amount equal to the string.length(). JavaBinCodec now uses a double pass approach to write strings larger than 64KB to avoid allocating buffer memory equal to string's UTF8 size. [SOLR-7971](https://issues.apache.org/jira/browse/SOLR-7971) (yonik) (Steve Rowe) (Mikhail Khludnev) (Noble Paul) (shalin)
- Utils.toUTF8 uses larger buffer than necessary for holding UTF8 data. [SOLR-7983](https://issues.apache.org/jira/browse/SOLR-7983) (shalin)
- JSON Facet API optimization to faceting by count on docvalue fields (or indexed fields with method=dv) when there are multiple hits expected for enoug buckets. For example, this more than doubled the performance of faceting 5M documents over a field with 1M unique values. [SOLR-8222](https://issues.apache.org/jira/browse/SOLR-8222) (yonik)
- DistributedUpdateProcessor#doFinish should explicitly check and ensure it does not try to put itself into LIR. [SOLR-8288](https://issues.apache.org/jira/browse/SOLR-8288) (Mark Miller)

### Fixed (59 changes)

- Fix error 'Illegal character in query' when proxying request. [SOLR-5971](https://issues.apache.org/jira/browse/SOLR-5971) (Uwe Schindler) (Ishan Chattopadhyaya) (Eric Bus)
- Skip the automatic loading of resources in the "lib" subdirectory by SolrResourceLoader, but only if we are loading resources from the solr home directory. Fixes the inability to use ICU analysis components with a "solr." prefix on the classname. [SOLR-6188](https://issues.apache.org/jira/browse/SOLR-6188) (Shawn Heisey)
- ConcurrentUpdateSolrClient hang in blockUntilFinished. If updates are still flowing and shutdown is called on the executor service used by ConcurrentUpdateSolrClient, a race condition can cause that client to hang in blockUntilFinished. [SOLR-6406](https://issues.apache.org/jira/browse/SOLR-6406) (Mark Miller) (yonik)
- ClassCastException in SolrResponseBase.getQTime on update response from CloudSolrClient when parallelUpdates is enabled (default) and multiple docs are sent as a single update. [SOLR-6547](https://issues.apache.org/jira/browse/SOLR-6547) (kevin) (hossman) (shalin)
- bin/solr status should return exit code 3, not 0 if Solr is not running [SOLR-7169](https://issues.apache.org/jira/browse/SOLR-7169) (Dominik Siebel) (Timothy Potter)
- Many small fixes to Angular UI [SOLR-7666](https://issues.apache.org/jira/browse/SOLR-7666) (Upayavira) (Alexandre Rafalovitch)
- Ping requests stopped working with distrib=true in Solr 5.2.1. [SOLR-7746](https://issues.apache.org/jira/browse/SOLR-7746) (Alexey Serba) (Michael Sun) (Gregory Chanan)
- ZK connection loss or session timeout do not stall indexing threads anymore. All activity related to leader initiated recovery is performed by a dedicated LIR thread in the background. [SOLR-7819](https://issues.apache.org/jira/browse/SOLR-7819) (Ramkumar Aiyengar) (shalin)
- Possible deadlock when closing refcounted index writers. [SOLR-7836](https://issues.apache.org/jira/browse/SOLR-7836) (Jessica Cheng Mallet) (Erick Erickson) (Mark Miller) (yonik)
- DataImportHandler's delta imports leak memory because the delta keys are kept in memory and not cleared after the process is finished. [SOLR-7843](https://issues.apache.org/jira/browse/SOLR-7843) (Pablo Lozano) (shalin)
- Zookeeper session expiry during shard leader election can cause multiple leaders. [SOLR-7844](https://issues.apache.org/jira/browse/SOLR-7844) (Mike Roberts) (Mark Miller) (Jessica Cheng)
- Fix usage of currentTimeMillis instead of nanoTime in multiple places, whitelist valid uses of currentTimeMillis [SOLR-7859](https://issues.apache.org/jira/browse/SOLR-7859) (Ramkumar Aiyengar)
- Overseer does not handle BadVersionException correctly and, in some cases, can go into an infinite loop if cluster state in ZooKeeper is modified externally. [SOLR-7869](https://issues.apache.org/jira/browse/SOLR-7869) (Scott Blum) (shalin)
- Resolve XSS issue in Admin UI Schema Browser [SOLR-7920](https://issues.apache.org/jira/browse/SOLR-7920) (David Chiu) (Upayavira)
- Fix very rare race condition that can cause an update to fail via NullPointerException during a core reload. [SOLR-7935](https://issues.apache.org/jira/browse/SOLR-7935) (yonik)
- multivalued params are concatenated when using config API [SOLR-7941](https://issues.apache.org/jira/browse/SOLR-7941) (noble)
- Fixed an integer overflow bug in the HyperLogLog code used by the 'cardinality' option of stats.field to prevent ArrayIndexOutOfBoundsException in a distributed search when a large precision is selected and a large number of values exist in each shard [SOLR-7954](https://issues.apache.org/jira/browse/SOLR-7954) (hossman)
- There are interrupts on shutdown in places that can cause ChannelAlreadyClosed exceptions which prevents proper closing of transaction logs, interfere with the IndexWriter, the hdfs client and other things. [SOLR-7956](https://issues.apache.org/jira/browse/SOLR-7956) (Mark Miller) (Scott Blum)
- AddSchemaFieldsUpdateProcessorFactory does not check if the ConfigSet is immutable [SOLR-7967](https://issues.apache.org/jira/browse/SOLR-7967) (Gregory Chanan)
- wrong and misleading error message 'no default request handler is registered' [SOLR-7984](https://issues.apache.org/jira/browse/SOLR-7984) (noble) (hossman)
- After a new leader is elected it should change it's state to ACTIVE even if the last published state is something else if it has already registered with ZK. [SOLR-7989](https://issues.apache.org/jira/browse/SOLR-7989) (Ishan Chattopadhyaya) (Mark Miller) (noble)
- Raw json output for fields stopped working in 5.3.0 when requested fields do not include the unique key field name. [SOLR-7993](https://issues.apache.org/jira/browse/SOLR-7993) (Bill Bell) (Ryan McKinley) (shalin)
- Fixed bugs in field(foo,min) and field(foo,max) when some docs have no values [SOLR-8001](https://issues.apache.org/jira/browse/SOLR-8001) (David Smiley) (hossman)
- Partial update on document with multivalued date field fails to parse date and can also fail to remove dates in some cases. [SOLR-8050](https://issues.apache.org/jira/browse/SOLR-8050) (Burkhard Buelte) (Luc Vanlerberghe) (shalin)
- Fix the exclusion filter so that collections that start with js, css, img, tpl can be accessed. [SOLR-8058](https://issues.apache.org/jira/browse/SOLR-8058) (Upayavira) (Steve Rowe) (Anshum Gupta)
- Ensure that only the valid ZooKeeper registered leader can put a replica into Leader Initiated Recovery. [SOLR-8069](https://issues.apache.org/jira/browse/SOLR-8069) (Mark Miller) (Jessica Cheng) (Anshum Gupta)
- Rebalance leaders feature does not set CloudDescriptor#isLeader to false when bumping leaders. [SOLR-8072](https://issues.apache.org/jira/browse/SOLR-8072) (Mark Miller)
- Solr fails to start on Windows with obscure errors when using relative path. [SOLR-8073](https://issues.apache.org/jira/browse/SOLR-8073) (Alexandre Rafalovitch) (Ishan Chattopadhyaya) (shalin)
- Leader Initiated Recovery should not stop a leader that participated in an election with all of it's replicas from becoming a valid leader. [SOLR-8075](https://issues.apache.org/jira/browse/SOLR-8075) (Mark Miller)
- Replication can still cause index corruption. [SOLR-8077](https://issues.apache.org/jira/browse/SOLR-8077) (Mark Miller)
- Fix a variety of issues that can result in replicas getting out of sync. [SOLR-8085](https://issues.apache.org/jira/browse/SOLR-8085) (yonik) (Mark Miller)
- HdfsUpdateLog should not replay buffered documents as a replacement to dropping them. [SOLR-8094](https://issues.apache.org/jira/browse/SOLR-8094) (Mark Miller)
- Allow disabling HDFS Locality Metrics and disable by default as it may have performance implications on rapidly changing indexes. [SOLR-8095](https://issues.apache.org/jira/browse/SOLR-8095) (Mike Drob) (Mark Miller)
- Config API does not work for spellchecker [SOLR-8104](https://issues.apache.org/jira/browse/SOLR-8104) (noble)
- bin/solr -f should use exec to start the JVM [SOLR-8107](https://issues.apache.org/jira/browse/SOLR-8107) (Martijn Koster) (Timothy Potter)
- update-&lt;component-name&gt; does not work if the component is only present in solrconfig.xml [SOLR-8126](https://issues.apache.org/jira/browse/SOLR-8126) (noble)
- Set v.locale specified locale for all LocaleConfig extending VelocityResponseWriter tools. [SOLR-8128](https://issues.apache.org/jira/browse/SOLR-8128) (Erik Hatcher)
- Solr's hdfs safe mode detection does not catch all cases of being in safe mode. [SOLR-8130](https://issues.apache.org/jira/browse/SOLR-8130) (Mark Miller) (Mike Drob)
- Overseer Task Processor/Queue can miss responses, leading to timeouts. [SOLR-8152](https://issues.apache.org/jira/browse/SOLR-8152) (Gregory Chanan)
- JmxMonitoredMap#clear triggers a query on all the MBeans thus generating lots of warnings. [SOLR-8162](https://issues.apache.org/jira/browse/SOLR-8162) (Marius Dumitru Florea) (shalin)
- Authorization framework does not work with POST params [SOLR-8167](https://issues.apache.org/jira/browse/SOLR-8167) (noble)
- eTag calculation during HTTP Cache Validation uses unsynchronized WeakHashMap causing threads to be stuck in runnable state. [SOLR-8189](https://issues.apache.org/jira/browse/SOLR-8189) (shalin)
- JSON Facet API allBuckets:true did not work correctly when faceting on a multi-valued field with sub-facets / facet functions. [SOLR-8192](https://issues.apache.org/jira/browse/SOLR-8192) (yonik)
- Stop processing updates more quickly on node shutdown. When a node is shut down, streaming updates would continue, but new update requests would be aborted. This can cause big update reorders that can cause replicas to get out of sync. [SOLR-8203](https://issues.apache.org/jira/browse/SOLR-8203) (Mark Miller) (yonik)
- JSON Facet API limit:0 did not always work correctly. [SOLR-8206](https://issues.apache.org/jira/browse/SOLR-8206) (yonik)
- Only active replicas should handle incoming requests against a collection [SOLR-8215](https://issues.apache.org/jira/browse/SOLR-8215) (Varun Thacker)
- Avoid accidentally swallowing OutOfMemoryError (in LeaderInitiatedRecoveryThread.java or CoreContainer.java) [SOLR-8223](https://issues.apache.org/jira/browse/SOLR-8223) (Mike Drob) (Christine Poerschke)
- HttpSolrCore.getCoreByCollection() can throw NPE [SOLR-8254](https://issues.apache.org/jira/browse/SOLR-8254) (Alan Woodward) (Mark Miller)
- MiniSolrCloudCluster needs to use a thread-safe list to keep track of its child nodes [SOLR-8255](https://issues.apache.org/jira/browse/SOLR-8255) (Alan Woodward)
- Comment out /stream handler from sample solrconfig.xml's for security reasons [SOLR-8262](https://issues.apache.org/jira/browse/SOLR-8262) (Joel Bernstein)
- Fixed bug in SimilarityFactory initialization that prevented SolrCoreAware factories -- such as SchemaSimilarityFactory -- from functioning properly with managed schema features. [SOLR-8280](https://issues.apache.org/jira/browse/SOLR-8280) (hossman)
- JSON Facet API - fix NPEs when short form "sort:index" or "sort:count" are used. [SOLR-8284](https://issues.apache.org/jira/browse/SOLR-8284) (Michael Sun) (yonik)
- TrieDoubleField and TrieLongField now override toNativeType [SOLR-8287](https://issues.apache.org/jira/browse/SOLR-8287) (Ishan Chattopadhyaya) (Christine Poerschke)
- Fix NPE in collapse QParser when collapse field is missing from all docs in a segment [SOLR-8295](https://issues.apache.org/jira/browse/SOLR-8295) (hossman)
- Fix XXE vulnerability in MBeansHandler "diff" feature [SOLR-8307](https://issues.apache.org/jira/browse/SOLR-8307) (Erik Hatcher)
- If BasicAuth enabled, inter node requests fail after node restart [SOLR-8326](https://issues.apache.org/jira/browse/SOLR-8326) (noble) (Anshum Gupta)
- Fixed NullPointerException in HighlightComponent. [SOLR-8340](https://issues.apache.org/jira/browse/SOLR-8340) (zengjie) (Christine Poerschke)
- Fix JSON Facet API excludeTags when specified in the form of domain:{excludeTags:mytag} [SOLR-8341](https://issues.apache.org/jira/browse/SOLR-8341) (yonik)
- update permissions were failing node recovery [SOLR-8355](https://issues.apache.org/jira/browse/SOLR-8355) (noble) (Anshum Gupta)

### Other (52 changes)

- Add a test to assert that [elevated] DocTransfer works correctly with javabin response format. [SOLR-4854](https://issues.apache.org/jira/browse/SOLR-4854) (Ray) (shalin)
- DistributedUpdateProcessor now logs replay flag as boolean instead of int [SOLR-7007](https://issues.apache.org/jira/browse/SOLR-7007) (Mike Drob) (Christine Poerschke)
- Update Carrot2 clustering component to version 3.10.4. Upgrade HPPC library to version 0.7.1. [SOLR-7790](https://issues.apache.org/jira/browse/SOLR-7790) [SOLR-7791](https://issues.apache.org/jira/browse/SOLR-7791) (Dawid Weiss)
- Start Scripts: Allow a configurable stack size [-Xss] [SOLR-7831](https://issues.apache.org/jira/browse/SOLR-7831) (Steve Davids) (Mark Miller)
- Write a test which asserts that requests to stateFormat=2 collection succeed on a node even after all local replicas of that collection have been removed. [SOLR-7870](https://issues.apache.org/jira/browse/SOLR-7870) (Scott Blum) (shalin)
- Split out use of child timers from RTimer to a sub-class [SOLR-7902](https://issues.apache.org/jira/browse/SOLR-7902) (Ramkumar Aiyengar)
- Previously removed unlockOnStartup option (LUCENE-6508) now logs warning if configured, will be an error in 6.0. Also improved error msg if an index is locked on startup [SOLR-7942](https://issues.apache.org/jira/browse/SOLR-7942) [LUCENE-6508](https://issues.apache.org/jira/browse/LUCENE-6508) (hossman)
- Upgrade Jetty to 9.2.13.v20150730. [SOLR-7943](https://issues.apache.org/jira/browse/SOLR-7943) (Bill Bell) (shalin)
- Start scripts now gives generic help for bin/solr -h and bin/solr --help [SOLR-7960](https://issues.apache.org/jira/browse/SOLR-7960) (janhoy)
- Solr Admin UI Solr now sets the HTTP header X-Frame-Options to DENY to avoid clickjacking. [SOLR-7966](https://issues.apache.org/jira/browse/SOLR-7966) (yonik)
- Unavailable clustering engines should not fail the core. [SOLR-7969](https://issues.apache.org/jira/browse/SOLR-7969) (Dawid Weiss)
- Factor out a SearchGroupsFieldCommandResult class. [SOLR-7970](https://issues.apache.org/jira/browse/SOLR-7970) (Christine Poerschke)
- Fix two typos (in a CoreAdminHandler log message and a TestCloudPivotFacet comment). [SOLR-7979](https://issues.apache.org/jira/browse/SOLR-7979) (Mike Drob) (Christine Poerschke)
- SolrRequestParser tests no longer depend on external URLs that may fail to work. [SOLR-7999](https://issues.apache.org/jira/browse/SOLR-7999) (Uwe Schindler)
- remove unnecessary ResponseBuilder.getQueryCommand() calls [SOLR-8025](https://issues.apache.org/jira/browse/SOLR-8025) (Christine Poerschke)
- Leader no longer puts replicas in recovery in case of a failed update, when minRF isn't achieved. [SOLR-8034](https://issues.apache.org/jira/browse/SOLR-8034) (Jessica Cheng) (Timothy Potter) (Anshum Gupta)
- SolrCore.checkStale method doesn't restore interrupt status. [SOLR-8066](https://issues.apache.org/jira/browse/SOLR-8066) (shalin)
- Throw a SolrException if the core container has initialization errors or is shutting down [SOLR-8068](https://issues.apache.org/jira/browse/SOLR-8068) (Ishan Chattopadhyaya) (Noble Paul) (Anshum Gupta)
- LoadAdminUIServlet directly references admin.html [SOLR-8074](https://issues.apache.org/jira/browse/SOLR-8074) (Mark Miller) (Upayavira)
- Convert the ZookeeperInfoServlet to a handler at /admin/zookeeper [SOLR-8083](https://issues.apache.org/jira/browse/SOLR-8083) (noble)
- Improve Linux service installation script [SOLR-8101](https://issues.apache.org/jira/browse/SOLR-8101) (Sergey Urushkin) (Timothy Potter)
- in Grouping.java rename groupSort and sort to withinGroupSort and groupSort [SOLR-8114](https://issues.apache.org/jira/browse/SOLR-8114) (Christine Poerschke)
- SearchGroupsResultTransformer tweaks (String literals, list/map initialCapacity) [SOLR-8116](https://issues.apache.org/jira/browse/SOLR-8116) (Christine Poerschke)
- contrib/analytics FieldFacetAccumulator now throws IOException instead of SolrException [SOLR-8147](https://issues.apache.org/jira/browse/SOLR-8147) (Scott Stults) (Christine Poerschke)
- Fix build failure due to too much output from QueryResponseTest [SOLR-8150](https://issues.apache.org/jira/browse/SOLR-8150) (janhoy)
- OverseerCollectionMessageHandler was logging info data as WARN [SOLR-8151](https://issues.apache.org/jira/browse/SOLR-8151) (Alan Woodward)
- jcl-over-slf4j should have officially been a SolrJ dependency; it now is. [SOLR-8180](https://issues.apache.org/jira/browse/SOLR-8180) (David Smiley) (Kevin Risden)
- Improve error reporting for null documents in UpdateRequest [SOLR-8194](https://issues.apache.org/jira/browse/SOLR-8194) (Markus Jelsma) (Alan Woodward)
- IndexFetcher download trace now includes bytes-downloaded[-per-second] [SOLR-8195](https://issues.apache.org/jira/browse/SOLR-8195) (Christine Poerschke)
- TestMiniSolrCloudCluster.testStopAllStartAll case plus necessary MiniSolrCloudCluster tweak [SOLR-8196](https://issues.apache.org/jira/browse/SOLR-8196) (Christine Poerschke)
- DistributedUpdateProcessor (initialCapacity) tweaks [SOLR-8218](https://issues.apache.org/jira/browse/SOLR-8218) (Christine Poerschke)
- MiniSolrCloudCluster should create subdirectories for its nodes [SOLR-8221](https://issues.apache.org/jira/browse/SOLR-8221) (Alan Woodward)
- Added ClassicSimilarityFactory, marked DefaultSimilarityFactory as deprecated. [SOLR-8239](https://issues.apache.org/jira/browse/SOLR-8239) (hossman)
- Fix SolrCLI to clean the config directory in case creating a core failed. [SOLR-8246](https://issues.apache.org/jira/browse/SOLR-8246) (Jason Gerlowski) (Shai Erera)
- AbstractDistribZkTestBase can sometimes fail to shut down its ZKServer [SOLR-8253](https://issues.apache.org/jira/browse/SOLR-8253) (Alan Woodward)
- Deprecate JettySolrRunner.getDispatchFilter(), add .getSolrDispatchFilter() and .getCoreContainer() [SOLR-8259](https://issues.apache.org/jira/browse/SOLR-8259) (Alan Woodward)
- Use NIO2 APIs in core discovery [SOLR-8260](https://issues.apache.org/jira/browse/SOLR-8260) (Alan Woodward)
- Upgrade commons-collections to 3.2.2. This fixes a known serialization vulnerability [SOLR-8269](https://issues.apache.org/jira/browse/SOLR-8269) (janhoy)
- (Search|Top)GroupsFieldCommand tweaks [SOLR-8277](https://issues.apache.org/jira/browse/SOLR-8277) (Christine Poerschke)
- Use NIO2 APIs in ConfigSetService [SOLR-8278](https://issues.apache.org/jira/browse/SOLR-8278) (Alan Woodward)
- factor out StrParser from QueryParsing.StrParser and SortSpecParsing[Test] from QueryParsing[Test] [SOLR-8283](https://issues.apache.org/jira/browse/SOLR-8283) (Christine Poerschke)
- Remove instances of solr.hdfs.blockcache.write.enabled from tests and docs [SOLR-8286](https://issues.apache.org/jira/browse/SOLR-8286) (Gregory Chanan)
- remove SchemaField.checkFieldCacheSource's unused QParser argument [SOLR-8290](https://issues.apache.org/jira/browse/SOLR-8290) (Christine Poerschke)
- Cleanup solrconfig.xmls under solr/example/example-DIH/solr (removed obsolete clustering handler sections). [SOLR-8294](https://issues.apache.org/jira/browse/SOLR-8294) (Dawid Weiss)
- small preferLocalShards implementation refactor [SOLR-8298](https://issues.apache.org/jira/browse/SOLR-8298) (Christine Poerschke)
- ConfigSet DELETE operation no longer allows deletion of config sets that are currently in use by other collections [SOLR-8299](https://issues.apache.org/jira/browse/SOLR-8299) (Anshum Gupta)
- Use constants for the /overseer_elect znode [SOLR-8300](https://issues.apache.org/jira/browse/SOLR-8300) (Varun Thacker)
- SolrResourceLoader now takes a Path as its instance directory [SOLR-8302](https://issues.apache.org/jira/browse/SOLR-8302) (Alan Woodward) (Shawn Heisey)
- CustomBufferedIndexInput now includes resource description when throwing EOFException. [SOLR-8303](https://issues.apache.org/jira/browse/SOLR-8303) (Mike Drob) (Uwe Schindler)
- Removed default core checks in the dispatch filter since we don't have a default core anymore [SOLR-8315](https://issues.apache.org/jira/browse/SOLR-8315) (Varun Thacker)
- Standardize and fix logger creation and usage so that they aren't shared across source files.(Jason Gerlowski, Uwe Schindler, Anshum Gupta) [SOLR-8330](https://issues.apache.org/jira/browse/SOLR-8330) 
- Fix check-example-lucene-match-version Ant task and addVersion.py script to check and update luceneMatchVersion under solr/example/ configs as well logic. [SOLR-8363](https://issues.apache.org/jira/browse/SOLR-8363) (Varun Thacker)


[5.3.2] - 2016-01-23
--------------------

### Fixed (10 changes)

- &debug=results for distributed search when distrib.singlePass (sometimes activated automatically) could result in an NPE. [SOLR-8059](https://issues.apache.org/jira/browse/SOLR-8059) (David Smiley) (Markus Jelsma)
- Authorization framework does not work with POST params [SOLR-8167](https://issues.apache.org/jira/browse/SOLR-8167) (noble)
- Upgrade commons-collections to 3.2.2. This fixes a known serialization vulnerability [SOLR-8269](https://issues.apache.org/jira/browse/SOLR-8269) (janhoy)
- If BasicAuth enabled, inter node requests fail after node restart [SOLR-8326](https://issues.apache.org/jira/browse/SOLR-8326) (noble) (Anshum Gupta)
- Fixed NullPointerException in HighlightComponent. [SOLR-8340](https://issues.apache.org/jira/browse/SOLR-8340) (zengjie) (Christine Poerschke)
- update permissions were failing node recovery [SOLR-8355](https://issues.apache.org/jira/browse/SOLR-8355) (noble) (Anshum Gupta)
- KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request [SOLR-8373](https://issues.apache.org/jira/browse/SOLR-8373) (Ishan Chattopadhyaya) (noble)
- When authentication enabled, requests fail if sent to a node that doesn't host the collection [SOLR-8422](https://issues.apache.org/jira/browse/SOLR-8422) (noble)
- /analysis/field could throw exceptions for custom attributes. [SOLR-8460](https://issues.apache.org/jira/browse/SOLR-8460) (David Smiley) (Uwe Schindler)
- SolrIndexSearcher.getDocSet(List&lt;Query&gt;) incorrectly included deleted documents when all of the queries were uncached (or there was no filter cache). This caused multi-select faceting (including the JSON Facet API) to include deleted doc counts when the remaining non-excluded filters were all uncached. This bug was first introduced in 5.3.0 [SOLR-8496](https://issues.apache.org/jira/browse/SOLR-8496) (Andreas Müller) (Vasiliy Bout) (Erick Erickson) (Shawn Heisey) (Hossman) (yonik)


[5.3.1] - 2015-09-24
--------------------

### Fixed (9 changes)

- SimplePostTool (also bin/post) -filetypes "*" now works properly in 'web' mode [SOLR-7929](https://issues.apache.org/jira/browse/SOLR-7929) (Erik Hatcher)
- Resolve XSS issue in Admin UI stats page [SOLR-7949](https://issues.apache.org/jira/browse/SOLR-7949) (David Chiu) (janhoy)
- Fix VelocityResponseWriter template encoding issue. Templates must be UTF-8 encoded. [SOLR-7972](https://issues.apache.org/jira/browse/SOLR-7972) (Erik Hatcher)
- Fixed example/files update-script.js to be Java 7 and 8 compatible. [SOLR-7978](https://issues.apache.org/jira/browse/SOLR-7978) (Erik Hatcher)
- SolrJ could not make requests to handlers with '/admin/' prefix [SOLR-7988](https://issues.apache.org/jira/browse/SOLR-7988) (noble) (ludovic Boutros)
- Use of timeAllowed can cause incomplete filters to be cached and incorrect results to be returned on subsequent requests. [SOLR-7990](https://issues.apache.org/jira/browse/SOLR-7990) (Erick Erickson) (yonik)
- security.json is not loaded on server start [SOLR-8000](https://issues.apache.org/jira/browse/SOLR-8000) (noble)
- RuleBasedAuthorization plugin does not work for the collection-admin-edit permission [SOLR-8004](https://issues.apache.org/jira/browse/SOLR-8004) (noble)
- Fix VelocityResponseWriter's $resource.get(key,baseName,locale) to use specified locale. [SOLR-8041](https://issues.apache.org/jira/browse/SOLR-8041) (Erik Hatcher)


[5.3.0] - 2015-08-21
--------------------

### Added (23 changes)

- new two argument option for the existing field() function; picks the min/max value of a docValues field to use as a ValueSource: "field(field_name,min)" and "field(field_name,max)" [SOLR-2522](https://issues.apache.org/jira/browse/SOLR-2522) (hossman)
- Let facet queries and facet ranges hang off of pivots. Example: facet.range={!tag=r1}price&facet.query={!tag=q1}somequery&facet.pivot={!range=r1 query=q1}category,manufacturer [SOLR-4212](https://issues.apache.org/jira/browse/SOLR-4212) [SOLR-6353](https://issues.apache.org/jira/browse/SOLR-6353) (Steve Molloy) (hossman) (shalin)
- score local parameter for block join query parser {!parent} [SOLR-5882](https://issues.apache.org/jira/browse/SOLR-5882) (Andrey Kudryavtsev) (Mikhail Khludnev)
- Response for an async call is now stored in zk so that it can be returned by the REQUESTSTATUS API. Also, the number of stored (failed and successful) responses are now restricted to 10,000 each as a safety net. [SOLR-5886](https://issues.apache.org/jira/browse/SOLR-5886) (Anshum Gupta)
- Scoring for query time join [SOLR-6234](https://issues.apache.org/jira/browse/SOLR-6234) (Mikhail Khludnev)
- Make the Schema-API a first class citizen of SolrJ. The new SchemaRequest and its inner classes can be used to make requests to the Schema API. [SOLR-7182](https://issues.apache.org/jira/browse/SOLR-7182) (Sven Windisch) (Marius Grama) (shalin)
- Nested C-style comments in queries. [SOLR-7220](https://issues.apache.org/jira/browse/SOLR-7220) (yonik)
- Expose znodeVersion property for each of the collections returned for the clusterstatus operation in the collections API [SOLR-7389](https://issues.apache.org/jira/browse/SOLR-7389) (Marius Grama) (shalin)
- Expose HDFS Block Locality Metrics via JMX [SOLR-7458](https://issues.apache.org/jira/browse/SOLR-7458) (Mike Drob) (Mark Miller)
- A DocTransformer can now request fields from the SolrIndexSearcher that are not necessarily returned in the file SolrDocument by returning a list of fields from DocTransformer#getExtraRequestFields [SOLR-7622](https://issues.apache.org/jira/browse/SOLR-7622) (ryan)
- MoreLikeThis QParser now supports all options provided by the MLT Handler i.e. mintf, mindf, minwl, maxwl, maxqt, and maxntp. [SOLR-7639](https://issues.apache.org/jira/browse/SOLR-7639) 
- New response format added wt=smile [SOLR-7651](https://issues.apache.org/jira/browse/SOLR-7651) (noble)
- Add 'port' tag support in replica placement rules [SOLR-7668](https://issues.apache.org/jira/browse/SOLR-7668) (Adam McElwee) (Noble Paul)
- Faceting on nested objects / Block-join faceting with the new JSON Facet API. Example: Assuming books with nested pages and an input domain of pages, the following will switch the domain to books before faceting on the author field: authors:{ type:terms, field:author, domain:{toParent:"type:book"} } [SOLR-7676](https://issues.apache.org/jira/browse/SOLR-7676) (yonik)
- SolrJ now supports parsing the output of the clustering component. [SOLR-7724](https://issues.apache.org/jira/browse/SOLR-7724) (Alessandro Benedetti) (Dawid Weiss)
- Support for Immutable ConfigSets [SOLR-7742](https://issues.apache.org/jira/browse/SOLR-7742) (Gregory Chanan)
- Improved security framework where security components can be edited/reloaded, Solr now watches /security.json. Components can choose to make their config editable [SOLR-7757](https://issues.apache.org/jira/browse/SOLR-7757) (Noble Paul) (Anshum Gupta) (Ishan Chattopadhyaya)
- support creation of a coreless collection via createNodeSet=EMPTY [SOLR-7766](https://issues.apache.org/jira/browse/SOLR-7766) (Christine Poerschke)
- Add bin/post -p alias for -port parameter. [SOLR-7769](https://issues.apache.org/jira/browse/SOLR-7769) (ehatcher)
- Added includeIndexFieldFlags (backwards compatible default is true) to /admin/luke. When there are many fields in the index, setting this flag to false can dramatically speed up requests. [SOLR-7799](https://issues.apache.org/jira/browse/SOLR-7799) (ehatcher)
- An AuthenticationPlugin which implements the HTTP BasicAuth protocol and stores credentials securely in ZooKeeper [SOLR-7837](https://issues.apache.org/jira/browse/SOLR-7837) (Noble Paul) (Anshum Gupta) (Ishan Chattopadhyaya)
- An authorizationPlugin interface where the access control rules are stored/managed in ZooKeeper [SOLR-7838](https://issues.apache.org/jira/browse/SOLR-7838) (Noble Paul) (Anshum Gupta) (Ishan Chattopadhyaya)
- Solr-managed inter-node authentication when authentication enabled [SOLR-7849](https://issues.apache.org/jira/browse/SOLR-7849) (Noble Paul)

### Changed (6 changes)

- Terms facets with the JSON Facet API now defer calculating non-sorting stats until a second phase, after the top N facets are found. This improves performance proportional to the number of non-sorting statistics being calculated in addition to the number of buckets and domain documents. For Example: The facet request {type:terms, field:field1, facet:{x:"unique(field2)"}} saw a 7x improvement when field1 and 1M unique terms and field2 had 1000 unique terms. [SOLR-7455](https://issues.apache.org/jira/browse/SOLR-7455) (yonik)
- Avoid redundant 'exists' calls made to ZK while fetching cluster state updates. [SOLR-7660](https://issues.apache.org/jira/browse/SOLR-7660) (shalin)
- Reduce SearchHandler's use of ShardHandler objects across shards in a search, from one for each shard and the federator, to just one for the federator. [SOLR-7714](https://issues.apache.org/jira/browse/SOLR-7714) (Christine Poerschke) (Ramkumar Aiyengar)
- Minor optimizations to QueryComponent.process (reduce eager instantiations, cache method calls) [SOLR-7751](https://issues.apache.org/jira/browse/SOLR-7751) (Christine Poerschke) (Ramkumar Aiyengar)
- ZkStateReader.updateClusterState fetches watched collections twice from ZK. [SOLR-7840](https://issues.apache.org/jira/browse/SOLR-7840) (shalin)
- Speedup SolrQueryTimeoutImpl. Avoid setting a timeout time when timeAllowed parameter is not set. [SOLR-7875](https://issues.apache.org/jira/browse/SOLR-7875) (Tomás Fernández Löbbe)

### Fixed (36 changes)

- Clean-up old (unused) index directories in the background after initializing a new index; previously, Solr would leave old index.yyyyMMddHHmmssSSS directories left behind after failed recoveries in the data directory, which unnecessarily consumes disk space. [SOLR-4506](https://issues.apache.org/jira/browse/SOLR-4506) (Mark Miller) (Timothy Potter)
- Allow delete documents by doing a score join query. [SOLR-6357](https://issues.apache.org/jira/browse/SOLR-6357) (Mikhail Khludnev) (Timothy Potter)
- facet.threads can return wrong results when using facet.prefix multiple times on same field. [SOLR-6686](https://issues.apache.org/jira/browse/SOLR-6686) (Michael Ryan) (Tim Underwood) (shalin)
- ReRankQueryParserPlugin checks now whether the reRankQuery parameter is present and not empty. [SOLR-6835](https://issues.apache.org/jira/browse/SOLR-6835) (帅广应) (Marius Grama) (shalin)
- Nested documents with unknown fields don't work in schemaless mode. [SOLR-7091](https://issues.apache.org/jira/browse/SOLR-7091) (Steve Rowe)
- Change default query used by /admin/ping to not rely on other parameters such as query parser or default field. [SOLR-7108](https://issues.apache.org/jira/browse/SOLR-7108) (ehatcher)
- The Collections API ADDREPLICA command property.name is not reflected in the clusterstate until after Solr restarts [SOLR-7132](https://issues.apache.org/jira/browse/SOLR-7132) (Erick Erickson)
- MoreLikeThis Query parser should handle multiple field names [SOLR-7143](https://issues.apache.org/jira/browse/SOLR-7143) (Jens Wille) (Anshum Gupta)
- addreplica API fails with incorrect error msg "cannot create collection" [SOLR-7172](https://issues.apache.org/jira/browse/SOLR-7172) (Erick Erickson)
- Slow loading SolrCores should not hold up all other SolrCores that have finished loading from serving requests. [SOLR-7361](https://issues.apache.org/jira/browse/SOLR-7361) (Mark Miller) (Timothy Potter) (Ramkumar Aiyengar)
- CoreAdminHandler Reload throws NPE on null core name instead of a bad request error. [SOLR-7529](https://issues.apache.org/jira/browse/SOLR-7529) (Jellyfrog) (Edward Ribeiro) (shalin)
- Search requests should return the shard name that is down. [SOLR-7566](https://issues.apache.org/jira/browse/SOLR-7566) (Marius Grama) (shalin)
- Limit lsof port check in bin/solr to just listening ports [SOLR-7635](https://issues.apache.org/jira/browse/SOLR-7635) (Upayavira) (Ramkumar Aiyengar)
- Throw correct exception (RemoteSolrException) on receiving a HTTP 413. [SOLR-7664](https://issues.apache.org/jira/browse/SOLR-7664) (Ramkumar Aiyengar) (Eirik Lygre)
- (and linked tickets): Many fixes to AngularJS Admin UI bringing it close to feature parity with existing UI. [SOLR-7666](https://issues.apache.org/jira/browse/SOLR-7666) (Upayavira)
- Race condition in shard splitting can cause operation to hang indefinitely or sub-shards to never become active. [SOLR-7673](https://issues.apache.org/jira/browse/SOLR-7673) (shalin)
- Add missing _root_ field to managed-schema template so that the default data driven config set can index nested documents by default. [SOLR-7675](https://issues.apache.org/jira/browse/SOLR-7675) (yonik)
- Schema API doesn't take similarity attribute into account when adding field types. [SOLR-7679](https://issues.apache.org/jira/browse/SOLR-7679) (Marius Grama) (Steve Rowe)
- Schema API: add-copy-field should accept the maxChars parameter. [SOLR-7682](https://issues.apache.org/jira/browse/SOLR-7682) (Steve Rowe)
- ReRankQuery rewrite method can change the QueryResultKey causing cache misses. [SOLR-7689](https://issues.apache.org/jira/browse/SOLR-7689) (Emad Nashed) (Yonik Seeley) (Joel Bernstein)
- Fix the bin/solr -e cloud example to work if lsof is not installed on the local machine by waiting for 10 seconds before starting the second node. [SOLR-7693](https://issues.apache.org/jira/browse/SOLR-7693) (hossman) (Timothy Potter)
- Schema API doesn't take class or luceneMatchVersion attributes into account for the analyzer when adding a new field type. [SOLR-7697](https://issues.apache.org/jira/browse/SOLR-7697) (Marius Grama) (Steve Rowe)
- CoreAdminHandler Unload no longer handles null core name and throws NPE instead of a bad request error. [SOLR-7705](https://issues.apache.org/jira/browse/SOLR-7705) (John Call) (Edward Ribeiro) (shalin)
- Add missing fields to SolrIndexerConfig.toMap [SOLR-7741](https://issues.apache.org/jira/browse/SOLR-7741) (Mike Drob) (Christine Poerschke) (Ramkumar Aiyengar)
- Fix bin/solr to start on IBM J9. [SOLR-7748](https://issues.apache.org/jira/browse/SOLR-7748) (Shai Erera)
- Fixed ExactStatsCache and LRUStatsCache to not throw an NPE when a term is not present on a shard. [SOLR-7756](https://issues.apache.org/jira/browse/SOLR-7756) (Varun Thacker) (Anshum Gupta)
- Hardened the behavior of TokenizerChain when null arguments are used in constructor. This prevents NPEs in some code paths. [SOLR-7765](https://issues.apache.org/jira/browse/SOLR-7765) (Konstantin Gribov) (hossman)
- JSON Facet API: Terms facet on string/text fields with sub-facets caused a bug that resulted in filter cache lookup misses as well as the filter cache exceeding it's configured size. [SOLR-7781](https://issues.apache.org/jira/browse/SOLR-7781) (yonik)
- map-reduce contrib script to set classpath for convenience refers to example rather than server. [SOLR-7810](https://issues.apache.org/jira/browse/SOLR-7810) (Mark Miller)
- Fixed distributed stats to be calculated for all the query terms. Earlier the stats were calculated with the terms that are present in the last shard of a distributed request. [SOLR-7818](https://issues.apache.org/jira/browse/SOLR-7818) (Varun Thacker) (Anshum Gupta)
- Fixed a bug in distributed pivot faceting that could result in a facet.missing=true count which was lower then the correct count if facet.sort=index and facet.pivot.mincount &gt; 1 [SOLR-7829](https://issues.apache.org/jira/browse/SOLR-7829) (hossman)
- ZK connection loss or session expiry events should not fire config directory listeners. [SOLR-7842](https://issues.apache.org/jira/browse/SOLR-7842) (noble) (shalin)
- VersionInfo caused an unhandled NPE when trying to determine the max value for the version field. [SOLR-7866](https://issues.apache.org/jira/browse/SOLR-7866) (Timothy Potter)
- SegmentsInfoRequestHandler gets a ref counted IndexWriter and does not properly release it. [SOLR-7908](https://issues.apache.org/jira/browse/SOLR-7908) (Mark Miller) (shalin)
- The techproducts example fails when running in a directory that contains spaces. [SOLR-7921](https://issues.apache.org/jira/browse/SOLR-7921) (Ishan Chattopadhyaya) (Timothy Potter)
- SolrCLI masks underlying cause of create collection failure. [SOLR-7934](https://issues.apache.org/jira/browse/SOLR-7934) (Timothy Potter)

### Other (41 changes)

- Remove ability to forcefully unlock an index. This is no longer supported by the underlying Lucene locking framework. [LUCENE-6508](https://issues.apache.org/jira/browse/LUCENE-6508) (Uwe Schindler) (Mike McCandless) (Robert Muir)
- Add as-you-type "instant search" to example/files /browse. [SOLR-3719](https://issues.apache.org/jira/browse/SOLR-3719) (Esther Quansah) (ehatcher)
- On Java 7 raise permgen for running tests. [SOLR-5022](https://issues.apache.org/jira/browse/SOLR-5022) (Uwe Schindler)
- Enable registering interceptors for the calls made using HttpClient and make the request object available at the interceptor context [SOLR-6625](https://issues.apache.org/jira/browse/SOLR-6625) (Ishan Chattopadhyay) (Gregory Chanan) (noble) (Anshum Gupta)
- MiniSolrCloudCluster based tests can fail with ZooKeeperException NoNode for /live_nodes. [SOLR-7146](https://issues.apache.org/jira/browse/SOLR-7146) (Vamsee Yarlagadda) (shalin)
- Ship Solr with the Web application directory exploded into server/solr-webapp, solr.war is no longer included in the distribution bundles. [SOLR-7227](https://issues.apache.org/jira/browse/SOLR-7227) (Timothy Potter) (Uwe Schindler)
- Replace shards.info occurrences with ShardParams.SHARDS_INFO [SOLR-7485](https://issues.apache.org/jira/browse/SOLR-7485) (Christine Poerschke) (Ramkumar Aiyengar)
- The "name" parameter in ADDREPLICA Collections API call has be deprecated. One cannot specify the core name for a replica [SOLR-7499](https://issues.apache.org/jira/browse/SOLR-7499) (Varun Thacker) (noble) (Erick Erickson)
- Finish and improve MDC context logging support. [SOLR-7590](https://issues.apache.org/jira/browse/SOLR-7590) (Mark Miller)
- Allow method chaining for all CollectionAdminRequests in Solrj. [SOLR-7595](https://issues.apache.org/jira/browse/SOLR-7595) (shalin)
- Remove cruft from SolrCloud tests. [SOLR-7599](https://issues.apache.org/jira/browse/SOLR-7599) (shalin)
- Fix test only bug in UpdateRequestProcessorFactoryTest [SOLR-7603](https://issues.apache.org/jira/browse/SOLR-7603) (hossman)
- Fix SegmentsInfoRequestHandlerTest when more than one segment is created. [SOLR-7619](https://issues.apache.org/jira/browse/SOLR-7619) (Ramkumar Aiyengar) (Steve Rowe)
- Add correct spelling (zkCredentialsProvider) as an alternative to zkCredientialsProvider element in solrcloud section of solr.xml. [SOLR-7624](https://issues.apache.org/jira/browse/SOLR-7624) (Xu Zhang) (Per Steffensen) (Ramkumar Aiyengar) (Mark Miller)
- Have RulesTest consider disk space limitations of where the test is being run [SOLR-7629](https://issues.apache.org/jira/browse/SOLR-7629) (Christine Poerschke) (Ramkumar Aiyengar)
- Upgrade Jetty to 9.2.11.v20150529 [SOLR-7634](https://issues.apache.org/jira/browse/SOLR-7634) (Bill Bell) (shalin)
- CLUSTERSTATUS API is executed at CollectionsHandler [SOLR-7636](https://issues.apache.org/jira/browse/SOLR-7636) (noble)
- Remove explicitly defined request handlers from example and test solrconfig's that are already defined implicitly, such as /admin/ping, /admin/system, and several others. [SOLR-7645](https://issues.apache.org/jira/browse/SOLR-7645) (ehatcher)
- Rename releaseCommitPointAndExtendReserve in DirectoryFileStream to extendReserveAndReleaseCommitPoint, and reverse the code to match. [SOLR-7659](https://issues.apache.org/jira/browse/SOLR-7659) (shalin) (Shawn Heisey)
- deprecate the class TransformerWithContext [SOLR-7665](https://issues.apache.org/jira/browse/SOLR-7665) (noble)
- Switch RTimer to use nanoTime (improves accuracy of QTime, and other times returned by Solr handlers) [SOLR-7678](https://issues.apache.org/jira/browse/SOLR-7678) (Ramkumar Aiyengar)
- Use POST instead of GET when finding versions for mismatches with CloudInspectUtil for tests [SOLR-7680](https://issues.apache.org/jira/browse/SOLR-7680) (Ramkumar Aiyengar)
- Authentication plugin is now loaded using the ResourceLoader. [SOLR-7703](https://issues.apache.org/jira/browse/SOLR-7703) (Avi Digmi) (Anshum Gupta)
- Replace async occurrences with CommonAdminParams.ASYNC [SOLR-7710](https://issues.apache.org/jira/browse/SOLR-7710) (Christine Poerschke) (Ramkumar Aiyengar)
- Correct initial capacity for the list that holds the default components for the SearchHandler [SOLR-7711](https://issues.apache.org/jira/browse/SOLR-7711) (Christine Poerschke) (Varun Thacker)
- fixed test to account for aggregate floating point precision loss [SOLR-7712](https://issues.apache.org/jira/browse/SOLR-7712) (hossman)
- Look for solr.xml in Zookeeper by default in SolrCloud mode. If not found, it will be loaded from $SOLR_HOME/solr.xml as before. Sysprop solr.solrxml.location is now gone. [SOLR-7735](https://issues.apache.org/jira/browse/SOLR-7735) (janhoy)
- Fix typo bug with TestConfigOverlay [SOLR-7740](https://issues.apache.org/jira/browse/SOLR-7740) (Christine Poerschke) (Ramkumar Aiyengar)
- Change TestConfig.testDefaults to cover all SolrIndexConfig fields [SOLR-7750](https://issues.apache.org/jira/browse/SOLR-7750) (Christine Poerschke) (Ramkumar Aiyengar)
- Removed fastutil and java-hll dependency, integrated HyperLogLog from java-hll into Solr core. [SOLR-7787](https://issues.apache.org/jira/browse/SOLR-7787) (Dawid Weiss)
- JSON Facet API: the avg() facet function now skips missing values rather than treating them as a 0 value. The def() function can be used to treat missing values as 0 if that is desired. Example: facet:{ mean:"avg(def(myfield,0))" } [SOLR-7800](https://issues.apache.org/jira/browse/SOLR-7800) 
- Prevent class loading deadlock in TrieDateField; refactor date formatting and parsing out of TrieDateField and move to static utility class DateFormatUtil. [SOLR-7803](https://issues.apache.org/jira/browse/SOLR-7803) (Markus Heiden) (Uwe Schindler)
- Update Kite Morphlines to 1.1.0 [SOLR-7805](https://issues.apache.org/jira/browse/SOLR-7805) (Mark Miller)
- TestMiniSolrCloudCluster.testCollectionCreateSearchDelete async collection-creation (sometimes) [SOLR-7823](https://issues.apache.org/jira/browse/SOLR-7823) (Christine Poerschke)
- Forbid all usages of log4j and java.util.logging classes in Solr except classes which are specific to logging implementations. Remove accidental usage of log4j logger from a few places. The default log level for org.apache.zookeeper is changed from ERROR to WARN for zkcli.{sh,cmd} only. [SOLR-7825](https://issues.apache.org/jira/browse/SOLR-7825) (Oliver Schrenk) (Tim Potter) (Uwe Schindler) (shalin)
- bin/post now allows either -url or -c, rather than requiring both. [SOLR-7832](https://issues.apache.org/jira/browse/SOLR-7832) (ehatcher)
- Implement run example logic in Java instead of OS-specific scripts in bin/solr and bin\solr.cmd [SOLR-7847](https://issues.apache.org/jira/browse/SOLR-7847) (Timothy Potter)
- Remove unused ZkStateReader.updateClusterState(false) method. [SOLR-7854](https://issues.apache.org/jira/browse/SOLR-7854) (Scott Blum) (shalin)
- Lowercase the CLUSTERPROP command in ZkCLI for consistency, print error for unknown cmd [SOLR-7863](https://issues.apache.org/jira/browse/SOLR-7863) (janhoy)
- TestAuthenticationFramework.testBasics to preserve/restore the original request(Username|Password) [SOLR-7877](https://issues.apache.org/jira/browse/SOLR-7877) (Christine Poerschke)
- example/files improvements - added language detection and faceting, added title field, relocated .js files. [SOLR-7900](https://issues.apache.org/jira/browse/SOLR-7900) (Esther Quansah and Erik Hatcher)


[5.2.1] - 2015-06-15
--------------------

### Fixed (9 changes)

- Requests aren't distributed evenly if the collection isn't present locally. [SOLR-7493](https://issues.apache.org/jira/browse/SOLR-7493) (Jeff Wartes) (shalin)
- SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool. [SOLR-7512](https://issues.apache.org/jira/browse/SOLR-7512) (Mark Miller) (Adam McElwee)
- New Facet Module should respect shards.tolerant and process all non-failing shards instead of throwing an exception. [SOLR-7518](https://issues.apache.org/jira/browse/SOLR-7518) (yonik)
- A request with a json content type but no body caused a null pointer exception [SOLR-7574](https://issues.apache.org/jira/browse/SOLR-7574) (yonik)
- Fix javascript bug introduced by SOLR-7409 that breaks the dataimport screen in the admin UI. [SOLR-7588](https://issues.apache.org/jira/browse/SOLR-7588) [SOLR-7409](https://issues.apache.org/jira/browse/SOLR-7409) (Bill Bell) (Shawn Heisey)
- Faceting on a numeric field with a unique() subfacet function on another numeric field can result in incorrect results or an exception. [SOLR-7616](https://issues.apache.org/jira/browse/SOLR-7616) (yonik)
- Fix new (Angular-based) admin UI Cloud pane [SOLR-7638](https://issues.apache.org/jira/browse/SOLR-7638) (Upayavira) (ehatcher)
- Fix example/files update-script.js to work with Java 7 [SOLR-7652](https://issues.apache.org/jira/browse/SOLR-7652) (ehatcher)
- The DefaultSolrHighlighter since 5.0 was determining if payloads were present in a way that was slow, especially when lots of fields were highlighted. It's now fast. [SOLR-7655](https://issues.apache.org/jira/browse/SOLR-7655) (David Smiley)

### Other (2 changes)

- Fix regression from SOLR-7484 that made it impossible to override SolrDispatchFilter#execute() and SolrDispatchFilter#sendError(). You can now override these functions in HttpSolrCall. [SOLR-7623](https://issues.apache.org/jira/browse/SOLR-7623) [SOLR-7484](https://issues.apache.org/jira/browse/SOLR-7484) (ryan)
- Expose remote IP and Host via the AuthorizationContext to be used by the authorization plugin. [SOLR-7648](https://issues.apache.org/jira/browse/SOLR-7648) (Ishan Chattopadhyaya) (Anshum Gupta)


[5.2.0] - 2015-06-07
--------------------

### Added (25 changes)

- Make it possible to specify AES encrypted password in dataconfig.xml [SOLR-4392](https://issues.apache.org/jira/browse/SOLR-4392) (Noble Paul)
- Rule Based Replica Assignment during collection, shard creation and replica creation [SOLR-6220](https://issues.apache.org/jira/browse/SOLR-6220) (Noble Paul)
- Restore a Solr core from a backed up index. Restore API Example - http://localhost:8983/solr/techproducts/replication?command=restore&name=backup_name Restore Status API Example - http://localhost:8983/solr/techproducts/replication?command=restorestatus [SOLR-6637](https://issues.apache.org/jira/browse/SOLR-6637) (Varun Thacker) (noble) (shalin)
- New 'cardinality' option for stats.field, uses HyperLogLog to efficiently estimate the cardinality of a field w/bounded RAM. [SOLR-6968](https://issues.apache.org/jira/browse/SOLR-6968) (hossman)
- zkcli script can perfrom the CLUSTERPROP command without a running Solr cluster [SOLR-7176](https://issues.apache.org/jira/browse/SOLR-7176) (Hrishikesh Gadre) (Per Steffensen) (Noble Paul)
- DIH-TikaEntityprocessor, create lat-lon field from Metadata [SOLR-7231](https://issues.apache.org/jira/browse/SOLR-7231) (Tim Allison) (Noble Paul)
- Admin UI - Refactoring using AngularJS. More functionality moving the Admin UI to Angular JS [SOLR-7241](https://issues.apache.org/jira/browse/SOLR-7241) [SOLR-7263](https://issues.apache.org/jira/browse/SOLR-7263) [SOLR-7279](https://issues.apache.org/jira/browse/SOLR-7279) [SOLR-7300](https://issues.apache.org/jira/browse/SOLR-7300) [SOLR-7396](https://issues.apache.org/jira/browse/SOLR-7396) [SOLR-7397](https://issues.apache.org/jira/browse/SOLR-7397) [SOLR-7492](https://issues.apache.org/jira/browse/SOLR-7492) (Upayavira) (Erick)
- Pluggable authentication module in Solr. This defines an interface and a mechanism to create, load, and use an Authentication plugin. [SOLR-7274](https://issues.apache.org/jira/browse/SOLR-7274) (Noble Paul) (Ishan Chattopadhyaya) (Gregory Chanan) (Anshum Gupta)
- Authorization framework for Solr. It defines an interface and a mechanism to create, load, and use an Authorization plugin. [SOLR-7275](https://issues.apache.org/jira/browse/SOLR-7275) (Noble Paul) (Ishan Chattopadhyaya) (Anshum Gupta)
- Limit memory consumed by LRUCache with a new 'maxRamMB' config parameter. [SOLR-7372](https://issues.apache.org/jira/browse/SOLR-7372) (yonik) (shalin)
- Return raw XML or JSON (in the appropriate writer) using DocumentTransformers. ?fl=id,name,json_s:[json],xml_s:[xml] [SOLR-7376](https://issues.apache.org/jira/browse/SOLR-7376) (ryan)
- Solr Streaming Expressions [SOLR-7377](https://issues.apache.org/jira/browse/SOLR-7377) (Dennis Gove) (Joel Bernstein) (Steven Bower)
- (experimental) New spatial RptWithGeometrySpatialField, based on CompositeSpatialStrategy, which blends RPT indexes for speed with serialized geometry for accuracy. Includes a Lucene segment based in-memory shape cache. [SOLR-7379](https://issues.apache.org/jira/browse/SOLR-7379) (David Smiley)
- Add a new "facet.range.method" parameter to let users choose how to do range faceting between an implementation based on filters (previous algorithm, using "facet.range.method=filter") or DocValues ("facet.range.method=dv"). Input parameters and output of both methods are the same. [SOLR-7406](https://issues.apache.org/jira/browse/SOLR-7406) (Tomás Fernández Löbbe)
- JSON Facet API - unique() is now implemented for numeric and date fields. [SOLR-7417](https://issues.apache.org/jira/browse/SOLR-7417) (yonik)
- Optional flatter form for the JSON Facet API via a "type" parameter: top_authors : { type:terms, field:author, limit:5 } is equivalent to top_authors : { terms : { field:author, limit:5 } } [SOLR-7422](https://issues.apache.org/jira/browse/SOLR-7422) (yonik)
- Make HDFS transaction log replication factor configurable. [SOLR-7437](https://issues.apache.org/jira/browse/SOLR-7437) (Mark Miller)
- stats.field now supports individual local params for 'countDistinct' and 'distinctValues'. 'calcdistinct' is still supported as an alias for both options [SOLR-7461](https://issues.apache.org/jira/browse/SOLR-7461) (hossman)
- New file indexing example, under example/files. [SOLR-7465](https://issues.apache.org/jira/browse/SOLR-7465) [SOLR-7610](https://issues.apache.org/jira/browse/SOLR-7610) (Esther Quansah) (Erik Hatcher)
- Kerberos authenticaion plugin for Solr. This would allow running a Kerberized Solr. [SOLR-7468](https://issues.apache.org/jira/browse/SOLR-7468) (Noble Paul) (Ishan Chattopadhyaya) (Gregory Chanan) (Anshum Gupta)
- Facet Module (Json Facet API) range faceting now supports the "mincount" parameter in range facets to supress buckets less than that count. The default for "mincount" remains 0 for range faceting. Example: prices:{ type:range, field:price, mincount:1, start:0, end:100, gap:10 } [SOLR-7473](https://issues.apache.org/jira/browse/SOLR-7473) (yonik)
- Multi-select faceting support for the Facet Module via the "excludeTags" parameter which disregards any matching tagged filters for that facet. Example: & q=shoes & fq={!tag=COLOR}color:blue & json.facet={ colors:{type:terms, field:color, excludeTags=COLOR} } [SOLR-7477](https://issues.apache.org/jira/browse/SOLR-7477) (yonik)
- Facet Module - Implement field/terms faceting over single-valued numeric fields. [SOLR-7522](https://issues.apache.org/jira/browse/SOLR-7522) (yonik)
- bin/post (and SimplePostTool in -Dauto=yes mode) now sends rather than skips files without a known content type, as "application/octet-stream", provided it still is in the allowed filetypes setting. [SOLR-7546](https://issues.apache.org/jira/browse/SOLR-7546) (ehatcher)
- Facet Analytics Module: new "hll" function that uses HyperLogLog to calculate distributed cardinality. The original "unique" function is still available. Example: json.facet={ numProducts : "hll(product_id)" } [SOLR-7553](https://issues.apache.org/jira/browse/SOLR-7553) (yonik)

### Changed (5 changes)

- DefaultSolrHighlighter now re-uses the document's term vectors instance when highlighting more than one field. Applies to the standard and FVH highlighters. [SOLR-5855](https://issues.apache.org/jira/browse/SOLR-5855) (David Smiley) (Daniel Debray)
- IndexFetcher does not need to call isIndexStale if full copy is already needed [SOLR-7324](https://issues.apache.org/jira/browse/SOLR-7324) (Stephan Lagraulet) (Varun Thacker)
- Initialize the highest value for all version buckets with the max value from the index or recent updates to avoid unnecessary lookups to the index to check for reordered updates when processing new documents. [SOLR-7332](https://issues.apache.org/jira/browse/SOLR-7332) (Timothy Potter) (yonik)
- Make the poll queue time a leader uses when distributing updates to replicas configurable and use knowledge that a batch is being processed to poll efficiently. [SOLR-7333](https://issues.apache.org/jira/browse/SOLR-7333) (Timothy Potter)
- Short circuit SolrDisptachFilter for static content request. Right now it creates a new HttpSolrCall object and tries to process it. [SOLR-7547](https://issues.apache.org/jira/browse/SOLR-7547) (Anshum Gupta)

### Fixed (38 changes)

- SolrIndexSearcher makes no DelegatingCollector.finish() call when IndexSearcher throws an expected exception. [SOLR-6087](https://issues.apache.org/jira/browse/SOLR-6087) (Christine Poerschke) (shalin)
- ZkController.publishAndWaitForDownStates can return before all local cores are marked as 'down' if multiple replicas with the same core name exist in the cluster. [SOLR-6665](https://issues.apache.org/jira/browse/SOLR-6665) (shalin)
- Fix QueryResponse to deal with the "expanded" section when using the XMLResponseParser [SOLR-6709](https://issues.apache.org/jira/browse/SOLR-6709) (Varun Thacker) (Joel Bernstein)
- autoAddReplicas feature has bug when selecting replacement nodes. [SOLR-7066](https://issues.apache.org/jira/browse/SOLR-7066) (Mark Miller)
- initParams must support tags other than appends, defaults and, invariants [SOLR-7157](https://issues.apache.org/jira/browse/SOLR-7157) (Noble Paul)
- Fix doc boosts to no longer be multiplied in each field value in multivalued fields that are not used in copyFields [SOLR-7335](https://issues.apache.org/jira/browse/SOLR-7335) (Shingo Sasaki) (hossman)
- AngularJS UI insufficient URLDecoding in cloud/tree view [SOLR-7369](https://issues.apache.org/jira/browse/SOLR-7369) (janhoy)
- FSHDFSUtils#recoverFileLease tries to recover the lease every one second after the first four second wait. [SOLR-7370](https://issues.apache.org/jira/browse/SOLR-7370) (Mark Miller)
- SearchHandler should not try to load runtime components in inform() [SOLR-7380](https://issues.apache.org/jira/browse/SOLR-7380) (Noble Paul)
- The clusterstatus API now returns the config set used to create a collection inside a 'configName' key. [SOLR-7385](https://issues.apache.org/jira/browse/SOLR-7385) (Shai Erera) (shalin)
- Facet Module - distributed search didn't work when sorting terms facet by min, max, avg, or unique functions. [SOLR-7387](https://issues.apache.org/jira/browse/SOLR-7387) (yonik)
- Fix SOLR_JAVA_MEM and SOLR_OPTS customizations in solr.in.sh being ignored [SOLR-7392](https://issues.apache.org/jira/browse/SOLR-7392) (Ramkumar Aiyengar) (Ere Maijala)
- Fixed a NullPointerException when concurrently creating and deleting collections, while accessing other collections. [SOLR-7401](https://issues.apache.org/jira/browse/SOLR-7401) (Shai Erera)
- Listeners set by SolrCores on config directories in ZK could be removed if collections are created/deleted in paralle against the same config set. [SOLR-7408](https://issues.apache.org/jira/browse/SOLR-7408) (Shai Erera) (Anshum Gupta)
- Fixed range.facet.other parameter for distributed requests. [SOLR-7412](https://issues.apache.org/jira/browse/SOLR-7412) (Will Miller) (Tomás Fernández Löbbe)
- Check and raise a SolrException instead of an NPE when an invalid doc id is sent to the MLTQParser. [SOLR-7418](https://issues.apache.org/jira/browse/SOLR-7418) (Anshum Gupta)
- Overseer stats are not reset on loss of ZK connection. [SOLR-7420](https://issues.apache.org/jira/browse/SOLR-7420) (Jessica Cheng) (shalin)
- SolrConfig#getConfigOverlay does not clean up it's resources. [SOLR-7426](https://issues.apache.org/jira/browse/SOLR-7426) (Mark Miller)
- DebugComponent does not return the right requestPurpose for pivot facet refinements. [SOLR-7440](https://issues.apache.org/jira/browse/SOLR-7440) (shalin)
- Implemented range faceting over date fields in the new facet module (JSON Facet API). [SOLR-7443](https://issues.apache.org/jira/browse/SOLR-7443) (yonik)
- solr/server/etc/jetty-https-ssl.xml hard codes the key store file and password rather than pulling them from the sysprops defined in solr/bin/solr.in.{sh,cmd} [SOLR-7449](https://issues.apache.org/jira/browse/SOLR-7449) 
- Fix edge case which could cause `bin/solr stop` to hang forever [SOLR-7450](https://issues.apache.org/jira/browse/SOLR-7450) (Ramkumar Aiyengar)
- Fix check-licenses to correctly detect if start.jar.sha1 is incorrect [SOLR-7469](https://issues.apache.org/jira/browse/SOLR-7469) (hossman)
- Fix sample data to eliminate file order dependency for successful indexing, also fixed SolrCloudExampleTest to help catch this in the future. [SOLR-7470](https://issues.apache.org/jira/browse/SOLR-7470) (hossman)
- SortingResponseWriter does not log fl parameters that don't exist. [SOLR-7472](https://issues.apache.org/jira/browse/SOLR-7472) (Joel Bernstein)
- UpdateLog#close shuts down it's executor with interrupts before running it's close logic, possibly preventing a clean close. [SOLR-7478](https://issues.apache.org/jira/browse/SOLR-7478) (Mark Miller)
- Facet Module - unique() facet function was wildly inaccurate for high cardinality fields. [SOLR-7494](https://issues.apache.org/jira/browse/SOLR-7494) (Andy Crossen) (yonik)
- start script should not try to create configset for .system collection [SOLR-7502](https://issues.apache.org/jira/browse/SOLR-7502) (Noble Paul)
- Recovery after ZK session expiration should happen in parallel for all cores using the thread-pool managed by ZkContainer instead of a single thread. [SOLR-7503](https://issues.apache.org/jira/browse/SOLR-7503) (Jessica Cheng Mallet) (Timothy Potter) (shalin) (Mark Miller)
- SolrClient.getByIds fails with ClassCastException [SOLR-7514](https://issues.apache.org/jira/browse/SOLR-7514) (Tom Farnworth) (Ramkumar Aiyengar)
- config API shows a few keys merged together [SOLR-7531](https://issues.apache.org/jira/browse/SOLR-7531) (Noble Paul)
- Schema API: Can't remove single dynamic copy field directive [SOLR-7542](https://issues.apache.org/jira/browse/SOLR-7542) (Steve Rowe)
- Honour SOLR_HOST parameter with bin/solr{,.cmd} [SOLR-7545](https://issues.apache.org/jira/browse/SOLR-7545) (Ishan Chattopadhyaya) (Ramkumar Aiyengar)
- Fix NoSuchElementException in LFUCache resulting from heavy writes making concurrent put() calls. [SOLR-7585](https://issues.apache.org/jira/browse/SOLR-7585) (Maciej Zasada) (Shawn Heisey)
- Seeding bucket versions from index when the firstSearcher event fires has a race condition that leads to an infinite wait on VersionInfo's ReentrantReadWriteLock because the read-lock acquired during a commit cannot be upgraded to a write-lock needed to block updates; solution is to move the call out of the firstSearcher event path and into the SolrCore constructor. [SOLR-7587](https://issues.apache.org/jira/browse/SOLR-7587) (Timothy Potter)
- Fix VelocityResponseWriter's $resource.locale to accurately report locale in use. [SOLR-7610](https://issues.apache.org/jira/browse/SOLR-7610) (ehatcher)
- Distributed pivot facet refinement was broken due to a single correlation counter used across multiple requests as if it was private to each request. [SOLR-7614](https://issues.apache.org/jira/browse/SOLR-7614) (yonik)
- Ensure that the max value for seeding version buckets is updated after recovery even if the UpdateLog is not replayed. [SOLR-7625](https://issues.apache.org/jira/browse/SOLR-7625) (Timothy Potter)

### Other (34 changes)

- Upgrade Jetty to 9.2.10.v20150310 and restlet-jee to 2.3.0 [SOLR-4839](https://issues.apache.org/jira/browse/SOLR-4839) (Bill Bell) (Timothy Potter) (Uwe Schindler) (Mark Miller) (Steve Rowe) (Steve Davids) (shalin)
- Log when shard splitting unexpectedly leads to documents going to no or multiple shards [SOLR-5213](https://issues.apache.org/jira/browse/SOLR-5213) (Christine Poerschke) (Ramkumar Aiyengar)
- Default highlighter changes: - hl.maxAnalyzedChars now applies cumulatively on a multi-valied field. - fragment ranking on a multi-valued field should be more relevant. - hl.usePhraseHighlighter is now toggleable on a per-field basis. - Much more extensible (get values from another source; return snippet scores and offsets). - When using hl.maxMultiValuedToMatch with hl.preserveMulti, only count matched snippets. [SOLR-6692](https://issues.apache.org/jira/browse/SOLR-6692) (David Smiley)
- Make the number of version buckets used by the UpdateLog configurable as increasing beyond the default 256 has been shown to help with high volume indexing performance in SolrCloud; helps overcome a limitation where Lucene uses the request thread to perform expensive index housekeeping work. [SOLR-6820](https://issues.apache.org/jira/browse/SOLR-6820) (Mark Miller) (yonik) (Timothy Potter)
- Upgrade HttpClient to 4.4.1 [SOLR-6865](https://issues.apache.org/jira/browse/SOLR-6865) (Shawn Heisey)
- Allow symmetric lists of synonyms to be added using the managed synonym REST API to support legacy expand=true type mappings; previously the API only allowed adding explicit mappings, with this feature you can now add a list and have the mappings expanded when the update is applied [SOLR-6878](https://issues.apache.org/jira/browse/SOLR-6878) (Timothy Potter) (Vitaliy Zhovtyuk) (hossman)
- Removed redundant size check and added missing calls to DelegatingCollection.finish inside Grouping code. [SOLR-6886](https://issues.apache.org/jira/browse/SOLR-6886) (Christine Poerschke) (shalin)
- Add new test case to test if create/delete/re-create collections work. [SOLR-7081](https://issues.apache.org/jira/browse/SOLR-7081) (Christine Poerschke) (Ramkumar Aiyengar)
- bin/solr should activate cloud mode if ZK_HOST is set [SOLR-7102](https://issues.apache.org/jira/browse/SOLR-7102) (Timothy Potter)
- Added option to optimize JavaBinCodec to minimize string Object creation [SOLR-7110](https://issues.apache.org/jira/browse/SOLR-7110) (Noble Paul)
- Fix Locale blacklisting for Minikdc based tests. [SOLR-7183](https://issues.apache.org/jira/browse/SOLR-7183) (Ishan Chattopadhyaya) (hossman) (Anshum Gupta)
- CloudSolrClient was always returning SERVER_ERROR for exceptions, even when a more relevant ErrorCode was available, via SolrException. Now the actual ErrorCode is used when available. [SOLR-7243](https://issues.apache.org/jira/browse/SOLR-7243) (Hrishikesh Gadre) (Shawn Heisey)
- Slice.getState() now returns a State enum instead of a String. This helps clarify the states a Slice can be in, as well comparing the state of a Slice. [SOLR-7325](https://issues.apache.org/jira/browse/SOLR-7325) (Shai Erera)
- Added Replica.getState() and removed ZkStateReader state-related constants. You should use Replica.State to compare a replica's state. [SOLR-7336](https://issues.apache.org/jira/browse/SOLR-7336) (Shai Erera)
- TestRestoreCore fails in Windows [SOLR-7358](https://issues.apache.org/jira/browse/SOLR-7358) (Ishan Chattopadhyaya) (Varun Thacker)
- Make DocSet implement Accountable to estimate memory usage. [SOLR-7371](https://issues.apache.org/jira/browse/SOLR-7371) (yonik) (shalin)
- Improve logging by adding node name in MDC in SolrCloud mode and adding MDC to all thread pools. A new MDCAwareThreadPoolExecutor is introduced and usages of Executors#newFixedThreadPool, #newSingleThreadExecutor, #newCachedThreadPool as well as ThreadPoolExecutor directly is now forbidden in Solr. MDC keys are now exposed in thread names automatically so that a thread dump can give hints on what the thread was doing. Uncaught exceptions thrown by tasks in the pool are logged along with submitter's stack trace. [SOLR-7381](https://issues.apache.org/jira/browse/SOLR-7381) (shalin)
- Fix spurious failures in FullSolrCloudDistribCmdsTest. [SOLR-7384](https://issues.apache.org/jira/browse/SOLR-7384) (shalin)
- Use a time based expiration cache for one off HDFS FileSystem instances. [SOLR-7391](https://issues.apache.org/jira/browse/SOLR-7391) (Mark Miller)
- When there are multiple dataimport handlers defined, the admin UI was listing them in a random order. Now they are sorted in a natural order that handles numbers properly. [SOLR-7409](https://issues.apache.org/jira/browse/SOLR-7409) (Jellyfrog) (Shawn Heisey)
- RecoveryAfterSoftCommitTest fails frequently on Jenkins due to full index replication taking longer than 30 seconds. [SOLR-7421](https://issues.apache.org/jira/browse/SOLR-7421) (Timothy Potter) (shalin)
- Improve MDC based logging format. [SOLR-7425](https://issues.apache.org/jira/browse/SOLR-7425) (Mark Miller)
- Make DirectoryFactory publishing MBeanInfo extensible. [SOLR-7457](https://issues.apache.org/jira/browse/SOLR-7457) (Mike Drob) (Mark Miller)
- Stop forcing MergePolicy's "NoCFSRatio" based on the IWC "useCompoundFile" configuration [SOLR-7463](https://issues.apache.org/jira/browse/SOLR-7463) (Tomás Fernández Löbbe)
- Upgrade t-digest to 3.1 [SOLR-7467](https://issues.apache.org/jira/browse/SOLR-7467) (hossman)
- Stop requiring docValues for interval faceting [SOLR-7471](https://issues.apache.org/jira/browse/SOLR-7471) (Tomás Fernández Löbbe)
- Refactor SolrDispatchFilter to extract all Solr specific implementation detail to HttpSolrCall and also extract methods from within the current SDF.doFilter(..) logic making things easier to manage. HttpSolrCall converts the processing to a 3-step process i.e. Construct, Init, and Call so the context of the request would be available after Init and before the actual call operation. [SOLR-7484](https://issues.apache.org/jira/browse/SOLR-7484) (Anshum Gupta) (Noble Paul)
- Fix check-example-lucene-match-version Ant task to check luceneMatchVersion in solr/server/solr/configsets instead of example and harden error checking / validation logic. [SOLR-7487](https://issues.apache.org/jira/browse/SOLR-7487) (hossman) (Timothy Potter)
- Remove pathPrefix from SolrDispatchFilter as Solr no longer runs as a part of a bigger webapp. [SOLR-7500](https://issues.apache.org/jira/browse/SOLR-7500) (Anshum Gupta)
- Removed occurrences of the unused 'commitIntervalLowerBound' property for updateHandler elements from Solr configuration. [SOLR-7532](https://issues.apache.org/jira/browse/SOLR-7532) (Marius Grama) (shalin)
- Removed CollectionsHandler#createNodeIfNotExists. All calls made to this method now call ZkCmdExecutor#ensureExists as they were doing the same thing. Also ZkCmdExecutor#ensureExists now respects the CreateMode passed to it. [SOLR-7541](https://issues.apache.org/jira/browse/SOLR-7541) (Varun Thacker)
- CollectionsHandler refactored to be more modular [SOLR-7544](https://issues.apache.org/jira/browse/SOLR-7544) (Noble Paul)
- Allow auto-commit to be set with system properties in data_driven_schema_configs and enable auto soft-commits for the bin/solr -e cloud example using the Config API. [SOLR-7582](https://issues.apache.org/jira/browse/SOLR-7582) (Timothy Potter)
- Refactored response writing to consolidate the logic in one place [SOLR-7662](https://issues.apache.org/jira/browse/SOLR-7662) (Noble Paul)


[5.1.0] - 2015-04-14
--------------------

### Added (40 changes)

- Add facet.contains and facet.contains.ignoreCase options [SOLR-1387](https://issues.apache.org/jira/browse/SOLR-1387) (Tom Winch) (Alan Woodward)
- Add support for child docs in DocumentObjectBinder [SOLR-1945](https://issues.apache.org/jira/browse/SOLR-1945) (Noble Paul) (Mark Miller)
- CloudSolrClient.connect() throws a more useful exception if the cluster is not ready, and can now take an optional timeout argument to wait for the cluster. [SOLR-4044](https://issues.apache.org/jira/browse/SOLR-4044) (Alan Woodward) (shalin) (yonik) (Mark Miller) (Vitaliy Zhovtyuk)
- Allow fromIndex parameter to JoinQParserPlugin to refer to a single-sharded collection that has a replica on all nodes where there is a replica in the to index [SOLR-4905](https://issues.apache.org/jira/browse/SOLR-4905) (Jack Lo) (Timothy Potter)
- Added a new collection action MODIFYCOLLECTION [SOLR-5132](https://issues.apache.org/jira/browse/SOLR-5132) (Noble Paul)
- Admin UI - Refactoring using AngularJS, first part [SOLR-5507](https://issues.apache.org/jira/browse/SOLR-5507) (Upayavira via Erick Erickson)
- EnumField supports DocValues functionality. [SOLR-5846](https://issues.apache.org/jira/browse/SOLR-5846) (Elran Dvir) (shalin)
- Added payload support for term vectors. New "termPayloads" option for fields / types in the schema, and "tv.payloads" param for the term vector component. [SOLR-5911](https://issues.apache.org/jira/browse/SOLR-5911) (Mike McCandless) (David Smiley)
- Schema API: Remove fields, dynamic fields, field types and copy fields; and replace fields, dynamic fields and field types. [SOLR-6141](https://issues.apache.org/jira/browse/SOLR-6141) (Steve Rowe)
- Added support for stats.field localparams to enable/disable individual stats to limit the amount of computation done and the amount of data returned. eg: stats.field={!min=true max=true}field_name [SOLR-6349](https://issues.apache.org/jira/browse/SOLR-6349) (Tomas Fernandez-Lobbe) (Xu Zhang) (hossman)
- StatsComponent now supports Percentiles [SOLR-6350](https://issues.apache.org/jira/browse/SOLR-6350) (Xu Zhang) (hossman)
- Allow number of logs and records kept by UpdateLog to be configured [SOLR-6359](https://issues.apache.org/jira/browse/SOLR-6359) (Ramkumar Aiyengar)
- Add first class support for Real Time Get in Solrj. [SOLR-6449](https://issues.apache.org/jira/browse/SOLR-6449) (Anurag Sharma) (Steve Davids) (shalin)
- Add support in AnalyzingInfixLookupFactory and BlendedInfixLookupFactory for setting 'highlight' and 'allTermsRequired' in the suggester configuration. [SOLR-6648](https://issues.apache.org/jira/browse/SOLR-6648) (Boon Low) (Varun Thacker) (Tomás Fernández Löbbe)
- Queries be served locally rather than being forwarded to another replica. [SOLR-6832](https://issues.apache.org/jira/browse/SOLR-6832) (Sachin Goyal) (Timothy Potter)
- Visualize lucene segment information in Admin UI. [SOLR-6841](https://issues.apache.org/jira/browse/SOLR-6841) (Alexey Kozhemiakin) (Michal Bienkowski) (hossman) (Shawn Heisey) (Varun Thacker) (shalin)
- Add a “buildOnStartup” option for suggesters. [SOLR-6845](https://issues.apache.org/jira/browse/SOLR-6845) (Tomás Fernández Löbbe)
- Update processors can now be top-level components and they can be specified in request to create a new custom update chain [SOLR-6892](https://issues.apache.org/jira/browse/SOLR-6892) (Noble Paul)
- Extract atomic update handling logic into AtomicUpdateDocumentMerger class and enable subclassing. [SOLR-6909](https://issues.apache.org/jira/browse/SOLR-6909) (Steve Davids) (yonik)
- SolrClient now implements Closeable, and shutdown() has been deprecated in favour of close(). [SOLR-6954](https://issues.apache.org/jira/browse/SOLR-6954) (Mark Miller) (Tomás Fernández Löbbe) (Alan Woodward)
- Spatial 2D heatmap faceting on RPT fields via new facet.heatmap with PNG and 2D int array formats. [SOLR-7005](https://issues.apache.org/jira/browse/SOLR-7005) (David Smiley)
- Support changing field key when using interval faceting. [SOLR-7019](https://issues.apache.org/jira/browse/SOLR-7019) (Tomás Fernández Löbbe)
- Support adding a jar to a collections classpath [SOLR-7073](https://issues.apache.org/jira/browse/SOLR-7073) (Noble Paul)
- Streaming Aggregation for SolrCloud [SOLR-7082](https://issues.apache.org/jira/browse/SOLR-7082) (Joel bernstein) (Yonik Seeley)
- Support managing all named components in solrconfig such as requestHandler, queryParser, queryResponseWriter, valueSourceParser, transformer, queryConverter [SOLR-7083](https://issues.apache.org/jira/browse/SOLR-7083) (Noble Paul)
- You can upload and download configurations via CloudSolrClient [SOLR-7125](https://issues.apache.org/jira/browse/SOLR-7125) [SOLR-7158](https://issues.apache.org/jira/browse/SOLR-7158) (Alan Woodward) (Ishan Chattopadhyaya)
- Secure loading of runtime external jars [SOLR-7126](https://issues.apache.org/jira/browse/SOLR-7126) (Noble Paul)
- All SolrClient methods now take an optional 'collection' argument [SOLR-7155](https://issues.apache.org/jira/browse/SOLR-7155) [SOLR-7201](https://issues.apache.org/jira/browse/SOLR-7201) (Alan Woodward) (Shawn Heisey)
- BBoxField defaults sub fields to not-stored [SOLR-7164](https://issues.apache.org/jira/browse/SOLR-7164) (ryan)
- Allow DIH to extract content from embedded documents via Tika. [SOLR-7189](https://issues.apache.org/jira/browse/SOLR-7189) (Tim Allison) (shalin)
- Parameter substitution / macro expansion across entire request. Substitution can contain further expansions and default values are supported. Example: q=price:[ ${low:0} TO ${high} ]&low=100&high=200 [SOLR-7212](https://issues.apache.org/jira/browse/SOLR-7212) (yonik)
- New Facet module with a JSON API, facet functions, aggregations, and analytics. Any facet type can have sub facets, and facets can be sorted by arbitrary aggregation functions. Examples: json.facet={x:'avg(price)', y:'unique(color)'} json.facet={count1:{query:"price:[10 TO 20]"}, count2:{query:"color:blue AND popularity:[0 TO 50]"} } json.facet={categories:{terms:{field:cat, sort:"x desc", facet:{x:"avg(price)", y:"sum(price)"}}}} [SOLR-7214](https://issues.apache.org/jira/browse/SOLR-7214) (yonik)
- Solr JSON Request API: - HTTP search requests can have a JSON body. - JSON request can also be passed via the "json" parameter. - Smart merging of multiple JSON parameters: ruery parameters starting with "json." will be merged into the JSON request. - Legacy query parameters can also be passed in the "params" block of the JSON request. [SOLR-7216](https://issues.apache.org/jira/browse/SOLR-7216) (yonik)
- HTTP POST body is auto-detected when the client is curl and the content type is form data (curl's default), allowing users to use curl to send JSON or XML without having to specify the content type. [SOLR-7217](https://issues.apache.org/jira/browse/SOLR-7217) (yonik)
- lucene/solr query syntax to give any query clause a constant score. General Form: &lt;clause&gt;^=&lt;constant_score&gt; Example: (color:blue color:green)^=2.0 text:shoes [SOLR-7218](https://issues.apache.org/jira/browse/SOLR-7218) (yonik)
- Make /query/* jmx/* , requestDispatcher/*, &lt;listener&gt; &lt;initParams&gt; properties in solrconfig.xml editable [SOLR-7226](https://issues.apache.org/jira/browse/SOLR-7226) (Noble Paul)
- '/' redirects to '/solr/' for convenience [SOLR-7240](https://issues.apache.org/jira/browse/SOLR-7240) (Martijn Koster) (hossman)
- Temporary ZK election or connection loss should not stall indexing due to leader initiated recovery [SOLR-7245](https://issues.apache.org/jira/browse/SOLR-7245) (Ramkumar Aiyengar)
- Percentiles support for the new facet module. Percentiles can be calculated for all facet buckets and field faceting can sort by percentile values. Examples: json.facet={ median_age : "percentile(age,50)" } json.facet={ salary_percentiles : "percentile(salary,25,50,75)" } [SOLR-7306](https://issues.apache.org/jira/browse/SOLR-7306) (yonik)
- EmbeddedSolrServer can now be started up by passing a path to a solr home directory, or a NodeConfig object [SOLR-7307](https://issues.apache.org/jira/browse/SOLR-7307) (Alan Woodward) (Mike Drob)

### Changed (1 change)

- * SOLR-7049: Move work done by the LIST Collections API call to the Collections Handler (Varun Thacker via Anshum Gupta). * SOLR-7116: Distributed facet refinement requests would needlessly compute other types of faceting that have already been computed. (David Smiley, Hossman) * SOLR-7239: improved performance of min & max in StatsComponent, as well as situations where local params disable all stats (hossman) * SOLR-7050: realtime get should internally load only fields specified in fl. [SOLR-7049](https://issues.apache.org/jira/browse/SOLR-7049) [SOLR-7116](https://issues.apache.org/jira/browse/SOLR-7116) [SOLR-7239](https://issues.apache.org/jira/browse/SOLR-7239) [SOLR-7050](https://issues.apache.org/jira/browse/SOLR-7050) (yonik) (Noble Paul)

### Fixed (41 changes)

- DIH Processed documents counter resets to zero after first entity is processed. [SOLR-4464](https://issues.apache.org/jira/browse/SOLR-4464) (Dave Cook) (Shawn Heisey) (Aaron Greenspan) (Thomas Champagne) (shalin)
- Delete silently fails if not sent to shard where document was added [SOLR-5890](https://issues.apache.org/jira/browse/SOLR-5890) (Ishan Chattopadhyaya) (Noble Paul)
- Snapshots numberToKeep param only keeps n-1 backups. [SOLR-6214](https://issues.apache.org/jira/browse/SOLR-6214) (Mathias H.) (Ramana) (Varun Thacker) (shalin)
- DocumentDictionaryFactory requires weightField to be mandatory, but it shouldn't [SOLR-6657](https://issues.apache.org/jira/browse/SOLR-6657) (Erick Erickson)
- Fix response when using EnumField with StatsComponent [SOLR-6682](https://issues.apache.org/jira/browse/SOLR-6682) (Xu Zhang) (hossman)
- Creating backup snapshot results in null pointer exception. [SOLR-6775](https://issues.apache.org/jira/browse/SOLR-6775) (Ryan Hesson) (Varun Thacker) (shalin)
- The config API forcefully refreshes all replicas in the collection to ensure all are updated [SOLR-6924](https://issues.apache.org/jira/browse/SOLR-6924) (Noble Paul)
- OverseerCollectionProcessor and replicas on the overseer node can sometimes operate on stale cluster state due to overseer holding the state update lock for a long time. [SOLR-6956](https://issues.apache.org/jira/browse/SOLR-6956) (Mark Miller) (shalin)
- NullPointerException when group.function uses query() function. [SOLR-7046](https://issues.apache.org/jira/browse/SOLR-7046) (Jim Musil) (Erick Erickson)
- Multiple mlt.fl does not work. [SOLR-7072](https://issues.apache.org/jira/browse/SOLR-7072) (Constantin Mitocaru) (shalin)
- FreeTextSuggester: Better error message when doing a lookup during dictionary build. Used to be nullpointer [SOLR-7084](https://issues.apache.org/jira/browse/SOLR-7084) (janhoy)
- Stop the HDFS lease recovery retries in HdfsTransactionLog on close and try to avoid lease recovery on closed files. [SOLR-7092](https://issues.apache.org/jira/browse/SOLR-7092) (Mark Miller)
- JmxMonitoredMap can throw an exception in clear when queryNames fails. [SOLR-7101](https://issues.apache.org/jira/browse/SOLR-7101) (Mark Miller) (Wolfgang Hoschek)
- Propagate property prefix parameters for ADDREPLICA Collections API call. [SOLR-7104](https://issues.apache.org/jira/browse/SOLR-7104) (Varun Thacker) (Anshum Gupta)
- Indexing threads stuck during network partition can put leader into down state. [SOLR-7109](https://issues.apache.org/jira/browse/SOLR-7109) (Mark Miller) (Anshum Gupta) (Ramkumar Aiyengar) (yonik) (shalin)
- Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage. [SOLR-7113](https://issues.apache.org/jira/browse/SOLR-7113) (Mark Miller) (Vamsee Yarlagadda)
- Two phase distributed search is fetching extra fields in GET_TOP_IDS phase. [SOLR-7128](https://issues.apache.org/jira/browse/SOLR-7128) (Pablo Queixalos) (shalin)
- Replication can still cause index corruption. [SOLR-7134](https://issues.apache.org/jira/browse/SOLR-7134) (Mark Miller) (shalin) (Mike Drob)
- Fix SolrContentHandler for TIKA to ignore multiple startDocument events. [SOLR-7139](https://issues.apache.org/jira/browse/SOLR-7139) (Chris A. Mattmann) (Uwe Schindler)
- RecoveryStrategy: Raise time that we wait for any updates from the leader before they saw the recovery state to have finished. [SOLR-7141](https://issues.apache.org/jira/browse/SOLR-7141) (Mark Miller)
- BaseDistributedSearchTestCase now clones getSolrHome() for each subclass, and consistently uses getSolrXml(). [SOLR-7171](https://issues.apache.org/jira/browse/SOLR-7171) (hossman)
- OverseerAutoReplicaFailoverThread compares Integer objects using == [SOLR-7178](https://issues.apache.org/jira/browse/SOLR-7178) (shalin)
- Fixed a bug where the bin/solr shell script would incorrectly detect another Solr process listening on the same port number. If the requested listen port was 8983, it would match on another Solr using port 18983 for any purpose. Also escapes the dot character in all grep commands looking for start.jar. [SOLR-7195](https://issues.apache.org/jira/browse/SOLR-7195) (Xu Zhang) (Shawn Heisey)
- MiniSolrCloudCluster wasn't dealing with SSL mode correctly [SOLR-7206](https://issues.apache.org/jira/browse/SOLR-7206) (Alan Woodward)
- /update/json/docs carry forward fields from previous records [SOLR-7209](https://issues.apache.org/jira/browse/SOLR-7209) (Noble Paul)
- In legacyCloud=false mode we should check if the core was hosted on the same node before registering it [SOLR-7248](https://issues.apache.org/jira/browse/SOLR-7248) (Varun Thacker) (Noble Paul) (Mark Miller)
- Make an invalid negative start/rows throw a HTTP 400 error (Bad Request) instead of causing a 500 error. [SOLR-7254](https://issues.apache.org/jira/browse/SOLR-7254) (Ramkumar Aiyengar) (Hrishikesh Gadre) (yonik)
- The IgnoreCommitOptimizeUpdateProcessor blocks commit requests from replicas needing to recover. [SOLR-7266](https://issues.apache.org/jira/browse/SOLR-7266) (Jessica Cheng Mallet) (Timothy Potter)
- HdfsUpdateLog is using hdfs FileSystem.get without turning off the cache. [SOLR-7284](https://issues.apache.org/jira/browse/SOLR-7284) (Mark Miller)
- ActionThrottle will not pause if getNanoTime first returns 0. [SOLR-7285](https://issues.apache.org/jira/browse/SOLR-7285) (Mark Miller) (Gregory Chanan)
- Using HDFS's FileSystem.newInstance does not guarantee a new instance. [SOLR-7286](https://issues.apache.org/jira/browse/SOLR-7286) (Mark Miller)
- Fix bug that Solr server does not listen on IPv6 interfaces by default. [SOLR-7293](https://issues.apache.org/jira/browse/SOLR-7293) (Uwe Schindler) (Sebastian Pesman)
- Migrate API fails with 'Invalid status request: notfoundretried 6times' message. [SOLR-7294](https://issues.apache.org/jira/browse/SOLR-7294) (Jessica Cheng Mallet) (shalin)
- Fix Collections API calls (SolrJ) to not add name parameter when not needed. [SOLR-7298](https://issues.apache.org/jira/browse/SOLR-7298) (Shai Erera) (Anshum Gupta)
- bin\solr.cmd doesn't use jetty SSL configuration. [SOLR-7299](https://issues.apache.org/jira/browse/SOLR-7299) (Steve Rowe)
- BlendedInfixLookupFactory swallows root IOException when it occurs. [SOLR-7305](https://issues.apache.org/jira/browse/SOLR-7305) (Stephan Lagraulet) (shalin)
- Make bin/solr, bin/post work when Solr installation directory contains spaces [SOLR-7309](https://issues.apache.org/jira/browse/SOLR-7309) (Ramkumar Aiyengar) (Martijn Koster)
- Admin UI does not show "Num Docs" and "Deleted Docs". [SOLR-7334](https://issues.apache.org/jira/browse/SOLR-7334) (Erick Erickson) (Timothy Potter)
- A reloaded core will never register itself as active after a ZK session expiration [SOLR-7338](https://issues.apache.org/jira/browse/SOLR-7338) [SOLR-6583](https://issues.apache.org/jira/browse/SOLR-6583) (Mark Miller) (Timothy Potter)
- Can't index example XML docs into the cloud example using bin/post due to regression in ManagedIndexSchema's handling of ResourceLoaderAware objects used by field types [SOLR-7366](https://issues.apache.org/jira/browse/SOLR-7366) (Steve Rowe) (Timothy Potter)
- SolrParams.toMultiMap() does not handle arrays [SOLR-7508](https://issues.apache.org/jira/browse/SOLR-7508) (Thomas Scheffler) (Noble Paul)

### Other (33 changes)

- Improve accuracy of QTime reporting [SOLR-6275](https://issues.apache.org/jira/browse/SOLR-6275) (Ramkumar Aiyengar)
- When performing distributed queries, SearchHandler should use path when no qt or shard.qt parameter is specified; fix also resolves SOLR-4479. [SOLR-6311](https://issues.apache.org/jira/browse/SOLR-6311) [SOLR-4479](https://issues.apache.org/jira/browse/SOLR-4479) (Steve Molloy) (Timothy Potter)
- Update to Hadoop 2.6.0. [SOLR-6414](https://issues.apache.org/jira/browse/SOLR-6414) (Mark Miller)
- Refactor FileFetcher in SnapPuller, add debug logging. [SOLR-6500](https://issues.apache.org/jira/browse/SOLR-6500) (Ramkumar Aiyengar) (Mark Miller)
- MDC based logging of collection, shard, replica, core [SOLR-6673](https://issues.apache.org/jira/browse/SOLR-6673) (Ishan Chattopadhyaya) (Noble Paul)
- Untangle SnapPuller and ReplicationHandler [SOLR-6804](https://issues.apache.org/jira/browse/SOLR-6804) (Ramkumar Aiyengar)
- Use JUnit rules instead of inheritance with distributed Solr tests to allow for multiple tests without the same class. [SOLR-6902](https://issues.apache.org/jira/browse/SOLR-6902) (Ramkumar Aiyengar) (Erick Erickson) (Mike McCandless)
- Collapse identical catch branches in try-catch statements. [SOLR-7014](https://issues.apache.org/jira/browse/SOLR-7014) (shalin)
- Clean up test remnants of old-style solr.xml [SOLR-7032](https://issues.apache.org/jira/browse/SOLR-7032) (Erick Erickson)
- In DIH, TikaEntityProcessor should have support for onError=skip [SOLR-7076](https://issues.apache.org/jira/browse/SOLR-7076) (Noble Paul)
- Better error reporting of JSON parse issues when indexing docs [SOLR-7094](https://issues.apache.org/jira/browse/SOLR-7094) (Ishan Chattopadhyaya) (Timothy Potter)
- Remove unused method params in faceting code. [SOLR-7103](https://issues.apache.org/jira/browse/SOLR-7103) (shalin)
- Fix DeleteInactiveReplicaTest.deleteLiveReplicaTest test failures. [SOLR-7112](https://issues.apache.org/jira/browse/SOLR-7112) (shalin)
- Make stale state notification work without failing the requests [SOLR-7130](https://issues.apache.org/jira/browse/SOLR-7130) (Noble Paul) (shalin)
- Fix TestFaceting.testFacets. [SOLR-7142](https://issues.apache.org/jira/browse/SOLR-7142) (Michal Kroliczek) (shalin)
- SolrRequest is now parametrized by its response type [SOLR-7145](https://issues.apache.org/jira/browse/SOLR-7145) (Alan Woodward)
- Introduce new TrackingShardHandlerFactory for monitoring what requests are sent to shards during tests. [SOLR-7147](https://issues.apache.org/jira/browse/SOLR-7147) (hossman) (shalin)
- SolrClient query methods throw IOException [SOLR-7151](https://issues.apache.org/jira/browse/SOLR-7151) (Alan Woodward)
- Fix test failures due to resource leaks on windows. [SOLR-7156](https://issues.apache.org/jira/browse/SOLR-7156) (Ishan Chattopadhyaya) (shalin)
- Rename ConfigSolr to NodeConfig, and decouple it from xml representation [SOLR-7160](https://issues.apache.org/jira/browse/SOLR-7160) (Alan Woodward)
- Remove unused SolrSortField interface. [SOLR-7162](https://issues.apache.org/jira/browse/SOLR-7162) (yonik) (Connor Warrington) (shalin)
- Encapsulate JettySolrRunner configuration [SOLR-7166](https://issues.apache.org/jira/browse/SOLR-7166) (Alan Woodward)
- Fix ReplicationFactorTest on Windows by adding better retry support after seeing no response exceptions. [SOLR-7173](https://issues.apache.org/jira/browse/SOLR-7173) (Ishan Chattopadhyaya) (Timothy Potter)
- DIH should reset TikaEntityProcessor so that it is capable of re-use [SOLR-7174](https://issues.apache.org/jira/browse/SOLR-7174) (Alexandre Rafalovitch) (Gary Taylor) (Noble Paul)
- JettySolrRunner no longer passes configuration to SolrDispatchFilter via system properties, but instead uses a Properties object in the servlet context [SOLR-7179](https://issues.apache.org/jira/browse/SOLR-7179) (Alan Woodward)
- MiniSolrCloudCluster will startup and shutdown its jetties in parallel [SOLR-7180](https://issues.apache.org/jira/browse/SOLR-7180) (Alan Woodward) (Tomás Fernández Löbbe) (Vamsee Yarlagadda)
- Remove deprecated string action types in Overseer and OverseerCollectionProcessor - "deletecollection", "createcollection", "reloadcollection", "removecollection", "removeshard". [SOLR-7202](https://issues.apache.org/jira/browse/SOLR-7202) (Varun Thacker) (shalin)
- Remove buggy no-op retry code in HttpSolrClient [SOLR-7203](https://issues.apache.org/jira/browse/SOLR-7203) (Alan Woodward) (Mark Miller) (Greg Solovyev)
- Speed up BasicZkTest, TestManagedResourceStorage [SOLR-7246](https://issues.apache.org/jira/browse/SOLR-7246) (Ramkumar Aiyengar)
- Forbid MessageFormat.format and MessageFormat single-arg constructor. [SOLR-7258](https://issues.apache.org/jira/browse/SOLR-7258) (shalin)
- Rename catchall _text field in data_driven_schema_configs to _text_ [SOLR-7290](https://issues.apache.org/jira/browse/SOLR-7290) (Steve Rowe)
- Test indexing on ZK disconnect with ChaosMonkey tests [SOLR-7291](https://issues.apache.org/jira/browse/SOLR-7291) (Ramkumar Aiyengar)
- Stored XSS in Admin UI Schema-Browser page and Analysis page [SOLR-7346](https://issues.apache.org/jira/browse/SOLR-7346) (Mei Wang) (Timothy Potter)


[5.0.0] - 2015-02-20
--------------------

### Added (48 changes)

- Support Distributed IDF [SOLR-1632](https://issues.apache.org/jira/browse/SOLR-1632) (Andrzej Bialecki) (Mark Miller) (Yonik Seeley) (Robert Muir) (Markus Jelsma) (Vitaliy Zhovtyuk) (Anshum Gupta)
- Add a VelocityResponseWriter $resource tool for locale-specific string lookups. [SOLR-2035](https://issues.apache.org/jira/browse/SOLR-2035) (Erik Hatcher)
- Support for protecting content in ZooKeeper. [SOLR-4580](https://issues.apache.org/jira/browse/SOLR-4580) (Per Steffensen) (Mark Miller)
- Add CloudSolrClient constructors which accept a HttpClient instance. [SOLR-4715](https://issues.apache.org/jira/browse/SOLR-4715) (Hardik Upadhyay) (Shawn Heisey) (shalin)
- faster join using join="zipper" aka merge join for nested DIH EntityProcessors [SOLR-4799](https://issues.apache.org/jira/browse/SOLR-4799) (Mikhail Khludnev) (Noble Paul)
- Schema API: Add REST support for adding dynamic fields to the schema. [SOLR-5097](https://issues.apache.org/jira/browse/SOLR-5097) (Steve Rowe)
- Schema API: Add REST support for adding field types to the schema. [SOLR-5098](https://issues.apache.org/jira/browse/SOLR-5098) (Timothy Potter)
- Support child documents in DIH [SOLR-5147](https://issues.apache.org/jira/browse/SOLR-5147) (Vadim Kirilchuk) (Shawn Heisey) (Thomas Champagne) (Mikhail Khludnev) (Noble Paul)
- Split clusterstate.json per collection and watch states selectively [SOLR-5473](https://issues.apache.org/jira/browse/SOLR-5473) (Noble Paul) (Mark Miller) (shalin) (Jessica Cheng Mallet) (Timothy Potter) (Anshum Gupta)
- Support for SOLR-5473 in SolrJ [SOLR-5474](https://issues.apache.org/jira/browse/SOLR-5474) [SOLR-5473](https://issues.apache.org/jira/browse/SOLR-5473) (Timothy Potter) (Noble Paul) (Mark Miller)
- Support for SOLR-5473 in solr admin UI [SOLR-5810](https://issues.apache.org/jira/browse/SOLR-5810) [SOLR-5473](https://issues.apache.org/jira/browse/SOLR-5473) (Timothy Potter) (Noble Paul)
- Don't allow runaway queries from harming Solr cluster health or search performance [SOLR-5986](https://issues.apache.org/jira/browse/SOLR-5986) (Anshum Gupta) (Steve Rowe) (Robert Muir)
- add "removeregex" as an atomic update operation [SOLR-5992](https://issues.apache.org/jira/browse/SOLR-5992) (Vitaliy Zhovtyuk) (Erick Erickson)
- Added DateRangeField for indexing date ranges, especially multi-valued ones. Supports facet.range, DateMath, and is mostly interoperable with TrieDateField. Based on LUCENE-5648. [SOLR-6103](https://issues.apache.org/jira/browse/SOLR-6103) [LUCENE-5648](https://issues.apache.org/jira/browse/LUCENE-5648) (David Smiley)
- MoreLikeThis QParser that accepts a document id and returns documents that have similar content. It works in standalone/cloud mode and shares logic with the Lucene MoreLikeThis class [SOLR-6248](https://issues.apache.org/jira/browse/SOLR-6248) (Anshum Gupta)
- Stats can now be nested under pivot values by adding a 'stats' local param to facet.pivot which refers to a 'tag' local param in one or more stats.field params. [SOLR-6351](https://issues.apache.org/jira/browse/SOLR-6351) (hossman) (Vitaliy Zhovtyuk) (Steve Molloy)
- stats.field can now be used to generate stats over the numeric results of arbitrary functions, ie: stats.field={!func}product(price,popularity) [SOLR-6354](https://issues.apache.org/jira/browse/SOLR-6354) (hossman)
- specify appends, defaults, invariants outside of the request handler. [SOLR-6365](https://issues.apache.org/jira/browse/SOLR-6365) (Noble Paul) (Erik Hatcher) (shalin)
- TransactionLog replay status logging. [SOLR-6403](https://issues.apache.org/jira/browse/SOLR-6403) (Mark Miller)
- Add bin/post script to simplify posting content to Solr [SOLR-6435](https://issues.apache.org/jira/browse/SOLR-6435) (Erik Hatcher)
- Create a bulk mode for schema API [SOLR-6476](https://issues.apache.org/jira/browse/SOLR-6476) (Noble Paul) (Steve Rowe)
- Add an onlyIfDown flag for DELETEREPLICA collections API command [SOLR-6482](https://issues.apache.org/jira/browse/SOLR-6482) (Erick Erickson)
- ReplicationHandler should have an option to throttle the speed of replication [SOLR-6485](https://issues.apache.org/jira/browse/SOLR-6485) (Varun Thacker) (Noble Paul)
- Add a collections API call to add/delete arbitrary properties to a specific replica. Optionally adding sliceUnique=true will remove this property from all other replicas within a particular slice. [SOLR-6512](https://issues.apache.org/jira/browse/SOLR-6512) (Erick Erickson)
- Add a collectionsAPI call BALANCESLICEUNIQUE. Allows the even distribution of custom replica properties across nodes making up a collection, at most one node per slice will have the property. [SOLR-6513](https://issues.apache.org/jira/browse/SOLR-6513) 
- Support editing common solrconfig.xml values [SOLR-6533](https://issues.apache.org/jira/browse/SOLR-6533) (Noble Paul)
- Give HttpSolrClient the ability to send PUT requests [SOLR-6543](https://issues.apache.org/jira/browse/SOLR-6543) (Gregory Chanan)
- SolrRequest support for query params [SOLR-6565](https://issues.apache.org/jira/browse/SOLR-6565) (Gregory Chanan)
- Efficient DocValues support and numeric collapse field implementations for Collapse and Expand [SOLR-6581](https://issues.apache.org/jira/browse/SOLR-6581) (Joel Bernstein)
- RequestHandlers can optionally handle sub paths as well [SOLR-6585](https://issues.apache.org/jira/browse/SOLR-6585) (Noble Paul)
- Make ShardHandlerFactory maxConnections configurable. [SOLR-6605](https://issues.apache.org/jira/browse/SOLR-6605) (Christine Poerschke) (shalin)
- Managing requesthandlers through API [SOLR-6607](https://issues.apache.org/jira/browse/SOLR-6607) (Noble Paul)
- /update/json/docs path will use fully qualified node names by default [SOLR-6617](https://issues.apache.org/jira/browse/SOLR-6617) (Noble Paul)
- /update/json/docs path can now save the underlying json doc asa string field and better support added to the default example [SOLR-6633](https://issues.apache.org/jira/browse/SOLR-6633) (Noble Paul)
- Add optional slow request logging at WARN level [SOLR-6650](https://issues.apache.org/jira/browse/SOLR-6650) (Jessica Cheng Mallet) (Timothy Potter)
- SimplePostTool now features -Dhost, -Dport, and -Dc (for core/collection) properties to allow easier overriding of just the right piece of the Solr URL. [SOLR-6655](https://issues.apache.org/jira/browse/SOLR-6655) (ehatcher)
- change BALANCESLICEUNIQUE to BALANCESHARDUNIQUE. Also, the parameter for ADDREPLICAPROP that used to be sliceUnique is now shardUnique. [SOLR-6670](https://issues.apache.org/jira/browse/SOLR-6670) (Erick Erickson)
- createNodeSet.shuffle=(true|false) support for /admin/collections?action=CREATE. [SOLR-6729](https://issues.apache.org/jira/browse/SOLR-6729) (Christine Poerschke) (Ramkumar Aiyengar) (Mark Miller)
- Ability to ignore commit and/or optimize requests from clients when running in SolrCloud mode using the IgnoreCommitOptimizeUpdateProcessorFactory. [SOLR-6761](https://issues.apache.org/jira/browse/SOLR-6761) (Timothy Potter)
- Expose HdfsDirectoryFactory Block Cache statistics via JMX. [SOLR-6766](https://issues.apache.org/jira/browse/SOLR-6766) (Mike Drob) (Mark Miller)
- Add/edit param sets and use them in Requests [SOLR-6770](https://issues.apache.org/jira/browse/SOLR-6770) (Noble Paul)
- API to manage blobs in Solr [SOLR-6787](https://issues.apache.org/jira/browse/SOLR-6787) (Noble Paul)
- Spatial fields that used to require units=degrees like SpatialRecursivePrefixTreeFieldType (RPT) now take distanceUnits=degrees|kilometers|miles instead. It is applied to nearly all distance measurements involving the field: maxDistErr, distErr, d, geodist, score=distance|area|area2d. score now accepts these units as well. It does NOT affect distances embedded in WKT strings like BUFFER(POINT(200 10),0.2)). [SOLR-6797](https://issues.apache.org/jira/browse/SOLR-6797) (Ishan Chattopadhyaya) (David Smiley)
- Load RequestHandler from blob store [SOLR-6801](https://issues.apache.org/jira/browse/SOLR-6801) (Noble Paul)
- Scripts to support installing and running Solr as a service on Linux [SOLR-6851](https://issues.apache.org/jira/browse/SOLR-6851) (Timothy Potter) (Hossman) (Steve Rowe)
- Have an option to disable autoAddReplicas temporarily for all collections. [SOLR-6879](https://issues.apache.org/jira/browse/SOLR-6879) (Varun Thacker) (Steve Rowe)
- Toggle payload support for the default highlighter via hl.payloads. It's auto enabled when the index has payloads. [SOLR-6916](https://issues.apache.org/jira/browse/SOLR-6916) (David Smiley)
- In schemaless mode ,replace spaces and special characters with underscore [SOLR-6937](https://issues.apache.org/jira/browse/SOLR-6937) (Noble Paul)

### Changed (4 changes)

- Speed up overseer operations avoiding cluster state reads from zookeeper at the start of each loop and instead relying on local state and compare-and-set writes. This change also adds batching for consecutive messages belonging to the same collection with stateFormat=2. [SOLR-6554](https://issues.apache.org/jira/browse/SOLR-6554) (shalin)
- LBHttpSolrClient - lazily allocate skipped-zombie-servers list. [SOLR-6603](https://issues.apache.org/jira/browse/SOLR-6603) (Christine Poerschke) (shalin)
- Dynamic copy fields are considering all dynamic fields, causing a significant performance impact on indexing documents. [SOLR-6666](https://issues.apache.org/jira/browse/SOLR-6666) (Liram Vardi) (Erick Erickson) (Steve Rowe)
- DefaultSolrHighlighter can sometimes avoid CachingTokenFilter with hl.usePhraseHighlighter, and can be more efficient handling data from term vectors. [SOLR-6680](https://issues.apache.org/jira/browse/SOLR-6680) (David Smiley)

### Fixed (66 changes)

- Reproducing TestPolicy failures: NPE and NoClassDefFoundError. [SOLR-12662](https://issues.apache.org/jira/browse/SOLR-12662) (Steve Rowe)
- Solr adds RequestHandler SolrInfoMBeans twice to the JMX server. [SOLR-3774](https://issues.apache.org/jira/browse/SOLR-3774) (Tomás Fernández Löbbe) (hossman) (Mark Miller)
- Avoid OOMs in LanguageIdentifierUpdateProcessor: - Added langid.maxFieldValueChars and langid.maxTotalChars params to limit input, by default 10k and 20k chars, respectively. - Moved input concatenation to Tika implementation; the langdetect implementation instead appends each input piece via the langdetect API. [SOLR-3881](https://issues.apache.org/jira/browse/SOLR-3881) (Vitaliy Zhovtyuk) (Tomás Fernández Löbbe) (Rob Tulloh) (Steve Rowe)
- Fix RawResponseWriter to respect 'base' writer [SOLR-4406](https://issues.apache.org/jira/browse/SOLR-4406) (Steve Davids) (hossman)
- An error should be returned when a rollback is attempted in SolrCloud mode. [SOLR-4895](https://issues.apache.org/jira/browse/SOLR-4895) (Vamsee Yarlagadda) (Mark Miller)
- Admin UI Menu is fixed and doesn't respect smaller viewports. [SOLR-5966](https://issues.apache.org/jira/browse/SOLR-5966) (Aman Tandon) (steffkes) (shalin)
- facet.mincount ignored in range faceting using distributed search NOTE: This does NOT fixed for the (deprecated) facet.date idiom, use facet.range instead. [SOLR-6187](https://issues.apache.org/jira/browse/SOLR-6187) [SOLR-6154](https://issues.apache.org/jira/browse/SOLR-6154) (Erick Erickson) (Zaccheo Bagnati) (Ronald Matamoros) (Vamsee Yalargadda)
- Post soft-commit callbacks are called before soft commit actually happens. [SOLR-6224](https://issues.apache.org/jira/browse/SOLR-6224) (shalin)
- Fix WordBreakSolrSpellChecker to not lose suggestions in shard/cloud environments [SOLR-6297](https://issues.apache.org/jira/browse/SOLR-6297) (James Dyer)
- Atomic update remove does not work for int array or date array [SOLR-6307](https://issues.apache.org/jira/browse/SOLR-6307) (Anurag Sharma) (noble)
- zkcli script put/putfile should allow overwriting an existing znode's data [SOLR-6397](https://issues.apache.org/jira/browse/SOLR-6397) (Timothy Potter)
- The hdfs block cache BLOCKCACHE_WRITE_ENABLED is not defaulting to false like it should. [SOLR-6424](https://issues.apache.org/jira/browse/SOLR-6424) (Mark Miller)
- SolrZkClient clean can fail due to a race with children nodes. [SOLR-6426](https://issues.apache.org/jira/browse/SOLR-6426) (Mark Miller)
- LBHttpSolrClient: ArrayIndexOutOfBoundsException risk if counter overflows [SOLR-6457](https://issues.apache.org/jira/browse/SOLR-6457) (longkey) (Noble Paul)
- bin/solr script should direct stdout/stderr when starting in the background to the solr-PORT-console.log in the logs directory instead of bin. [SOLR-6467](https://issues.apache.org/jira/browse/SOLR-6467) (Timothy Potter)
- CLUSTERSTATUS should check if the node hosting a replica is live when reporting replica status [SOLR-6481](https://issues.apache.org/jira/browse/SOLR-6481) (Timothy Potter)
- SolrCLI's healthcheck action needs to check live nodes as part of reporting the status of a replica [SOLR-6484](https://issues.apache.org/jira/browse/SOLR-6484) (Timothy Potter)
- Log warning about multiple update request handlers [SOLR-6499](https://issues.apache.org/jira/browse/SOLR-6499) (Noble Paul) (Andreas Hubold) (hossman)
- Fixed several bugs involving stats.field used with local params [SOLR-6507](https://issues.apache.org/jira/browse/SOLR-6507) (hossman)
- Fix NPE from strdist() func when doc value source does not exist in a doc [SOLR-6540](https://issues.apache.org/jira/browse/SOLR-6540) (hossman)
- SnapPuller Replication blocks clean shutdown of tomcat [SOLR-6579](https://issues.apache.org/jira/browse/SOLR-6579) (Philip Black-Knight) (Noble Paul)
- Overseer can use stale cluster state and lose updates for collections with stateFormat &gt; 1. [SOLR-6591](https://issues.apache.org/jira/browse/SOLR-6591) (shalin)
- Fix NPE with distrib.singlePass=true and expand component. Increased test coverage of expand component with docValues. [SOLR-6604](https://issues.apache.org/jira/browse/SOLR-6604) [SOLR-6812](https://issues.apache.org/jira/browse/SOLR-6812) (Christine Poerschke) (Per Steffensen) (shalin)
- Spelling mistakes in the Java source [SOLR-6624](https://issues.apache.org/jira/browse/SOLR-6624) (Hrishikesh Gadre)
- NPE in FieldMutatingUpdateProcessor when indexing a doc with null field value [SOLR-6626](https://issues.apache.org/jira/browse/SOLR-6626) (Noble Paul)
- DistributedQueue spinning on calling zookeeper getChildren() [SOLR-6631](https://issues.apache.org/jira/browse/SOLR-6631) (Jessica Cheng Mallet) (Mark Miller) (Timothy Potter)
- Close searchers before rollback and recovery to avoid index corruption. [SOLR-6640](https://issues.apache.org/jira/browse/SOLR-6640) (Robert Muir) (Varun Thacker) (shalin)
- Fix error reporting & logging of low level JVM Errors that occur when loading/reloading a SolrCore [SOLR-6643](https://issues.apache.org/jira/browse/SOLR-6643) (hossman)
- Disabled suggester component from techproduct solrconfig.xml since it caused long startup times on large indexes even when it wasn't used. [SOLR-6679](https://issues.apache.org/jira/browse/SOLR-6679) (yonik) (hossman)
- bin\solr.cmd doesn't support 32-bit JRE/JDK running on Windows due to parenthesis in JAVA_HOME. [SOLR-6693](https://issues.apache.org/jira/browse/SOLR-6693) (Timothy Potter) (Christopher Hewitt) (Jan Høydahl)
- Core discovery was walking paths relative to the Jetty working directory, rather than SOLR_HOME. [SOLR-6718](https://issues.apache.org/jira/browse/SOLR-6718) (Andreas Hubold) (Alan Woodward)
- ZkController.ensureReplicaInLeaderInitiatedRecovery puts replica in local map before writing to ZK. [SOLR-6721](https://issues.apache.org/jira/browse/SOLR-6721) (shalin)
- Make CloneFieldUpdateProcessorFactory null safe [SOLR-6735](https://issues.apache.org/jira/browse/SOLR-6735) (Steve Davids) (ehatcher)
- Admin UI - Escape Data on Plugins-View [SOLR-6738](https://issues.apache.org/jira/browse/SOLR-6738) (steffkes)
- Shard leader elections should not persist across session expiry [SOLR-6763](https://issues.apache.org/jira/browse/SOLR-6763) (Alan Woodward) (Mark Miller)
- Field types need to be re-informed after reloading a managed schema from ZK [SOLR-6764](https://issues.apache.org/jira/browse/SOLR-6764) (Timothy Potter)
- fix /browse for schemaless example [SOLR-6779](https://issues.apache.org/jira/browse/SOLR-6779) (ehatcher)
- Fixed a bug in how default/appends/invariants params were affecting the set of all "keys" found in the request parameters, resulting in some key=value param pairs being duplicated. This was noticeably affecting some areas of the code where iteration was done over the set of all params: - literal.* in ExtractingRequestHandler - facet.* in FacetComponent - spellcheck.[dictionary name].* and spellcheck.collateParam.* in SpellCheckComponent - olap.* in AnalyticsComponent [SOLR-6780](https://issues.apache.org/jira/browse/SOLR-6780) (Alexandre Rafalovitch & hossman)
- ReplicationHandler does not destroy all of it's created SnapPullers. [SOLR-6793](https://issues.apache.org/jira/browse/SOLR-6793) (Mark Miller)
- Direct routing with CloudSolrServer will ignore the Overwrite document option. [SOLR-6839](https://issues.apache.org/jira/browse/SOLR-6839) (Mark Miller)
- LeaderInitiatedRecoveryThread compares wrong replica's state with lirState. [SOLR-6847](https://issues.apache.org/jira/browse/SOLR-6847) (shalin)
- AutoAddReplicas makes a call to wait to see live replicas that times out after 30 milliseconds instead of 30 seconds. [SOLR-6850](https://issues.apache.org/jira/browse/SOLR-6850) (Varun Thacker) (Mark Miller)
- Restore ExtractingRequestHandler's ability to capture all HTML tags when parsing (X)HTML. [SOLR-6856](https://issues.apache.org/jira/browse/SOLR-6856) (hossman) (Uwe Schindler) (ehatcher) (Steve Rowe)
- Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method. Existing components rely on this. [SOLR-6864](https://issues.apache.org/jira/browse/SOLR-6864) (Tomás Fernández Löbbe)
- Lib relative path is incorrect for techproduct configset [SOLR-6873](https://issues.apache.org/jira/browse/SOLR-6873) (Alexandre Rafalovitch) (Erick Erickson)
- There is a race around SocketProxy binding to it's port the way we setup JettySolrRunner and SocketProxy. [SOLR-6874](https://issues.apache.org/jira/browse/SOLR-6874) (Mark Miller) (Timothy Potter)
- Harden ZkStateReader to expect that getCollectionLive may return null as it's contract states. [SOLR-6880](https://issues.apache.org/jira/browse/SOLR-6880) (Mark Miller) (shalin)
- Change public setter for CollectionAdminRequest.action to protected. [SOLR-6899](https://issues.apache.org/jira/browse/SOLR-6899) (Anshum Gupta)
- URLEncode documents directory in MorphlineMapperTest to handle spaces etc. in file name. [SOLR-6907](https://issues.apache.org/jira/browse/SOLR-6907) (Ramkumar Aiyengar) (Erick Erickson)
- A replicated index can end up corrupted when small files end up with the same file name and size. [SOLR-6920](https://issues.apache.org/jira/browse/SOLR-6920) (Varun Thacker) (Mark Miller)
- AutoAddReplicas also consults live_nodes to see if a state change has happened. [SOLR-6923](https://issues.apache.org/jira/browse/SOLR-6923) (Varun Thacker) (Anshum Gupta)
- solr.cmd stop works only in english [SOLR-6928](https://issues.apache.org/jira/browse/SOLR-6928) (john.work) (Jan Høydahl) (Timothy Potter)
- We should do a limited retry when using HttpClient. [SOLR-6931](https://issues.apache.org/jira/browse/SOLR-6931) (Mark Miller) (Hrishikesh Gadre) (Gregory Chanan)
- DistributedQueue#containsTaskWithRequestId can fail with NPE. [SOLR-6941](https://issues.apache.org/jira/browse/SOLR-6941) (Mark Miller)
- Document -p port option for the create_core and create_collection actions in bin/solr [SOLR-6946](https://issues.apache.org/jira/browse/SOLR-6946) (Timothy Potter)
- When opening an HDFSTransactionLog for append we must first attempt to recover it's lease to prevent data loss. [SOLR-6969](https://issues.apache.org/jira/browse/SOLR-6969) (Mark Miller) (Praneeth Varma) (Colin McCabe)
- install_solr_service.sh won't install on RHEL / CentOS [SOLR-6993](https://issues.apache.org/jira/browse/SOLR-6993) (David Anderson) (Timothy Potter)
- Add a missing constructor for CollectionAdminRequest.BalanceShardUnique that sets the collection action. [SOLR-7004](https://issues.apache.org/jira/browse/SOLR-7004) (Anshum Gupta)
- Delete collection returns before collection is actually removed. [SOLR-7011](https://issues.apache.org/jira/browse/SOLR-7011) (Christine Poerschke) (shalin)
- Fix bin\solr.cmd to work in a directory with spaces in the name. [SOLR-7016](https://issues.apache.org/jira/browse/SOLR-7016) (Timothy Potter) (Uwe Schindler)
- Improved error messages when java is not found by the bin/solr shell script, particularly when JAVA_HOME has an invalid location. [SOLR-7024](https://issues.apache.org/jira/browse/SOLR-7024) (Shawn Heisey)
- RecoveryStrategy should not publish any state when closed / cancelled and there should always be a pause between recoveries even when recoveries are rapidly stopped and started as well as when a node attempts to become the leader for a shard. [SOLR-7033](https://issues.apache.org/jira/browse/SOLR-7033) [SOLR-5961](https://issues.apache.org/jira/browse/SOLR-5961) (Mark Miller) (Maxim Novikov)
- bin/solr start -e techproducts -c fails to start Solr in cloud mode [SOLR-7037](https://issues.apache.org/jira/browse/SOLR-7037) (Timothy Potter)
- Validate the presence of configset before trying to create a collection. [SOLR-7038](https://issues.apache.org/jira/browse/SOLR-7038) (Anshum Gupta) (Mark Miller)
- bin/solr won't run under bash 4.2+. [SOLR-7067](https://issues.apache.org/jira/browse/SOLR-7067) (Steve Rowe)
- Collapse on numeric field breaks when min/max values are negative. [SOLR-7068](https://issues.apache.org/jira/browse/SOLR-7068) (Joel Bernstein)

### Other (89 changes)

- Tests can no longer write to CWD. Update log dir is now made relative to the instance dir if it is not an absolute path. [LUCENE-5650](https://issues.apache.org/jira/browse/LUCENE-5650) (Ryan Ernst) (Dawid Weiss)
- Replaced all occurrences of LUCENE_CURRENT with LATEST for luceneMatchVersion. [LUCENE-5901](https://issues.apache.org/jira/browse/LUCENE-5901) (Ryan Ernst)
- VelocityResponseWriter improvements [SOLR-1723](https://issues.apache.org/jira/browse/SOLR-1723) (Erik Hatcher)
- Changes to spellcheck response format [SOLR-3029](https://issues.apache.org/jira/browse/SOLR-3029) (Nalini Kartha) (James Dyer)
- Truncate long strings in /browse field facets [SOLR-3711](https://issues.apache.org/jira/browse/SOLR-3711) (ehatcher)
- Removed RequestHandlerUtils#addExperimentalFormatWarning(), which removes "experimental" warning from two places: replication handler details command and DataImportHandler responses. [SOLR-3957](https://issues.apache.org/jira/browse/SOLR-3957) (ehatcher)
- Hardcoded SolrCloud defaults for hostContext and hostPort that were deprecated in 4.3 have been removed completely. [SOLR-4622](https://issues.apache.org/jira/browse/SOLR-4622) (hossman)
- Stop shipping a .war. [SOLR-4792](https://issues.apache.org/jira/browse/SOLR-4792) (Robert Muir) (Ramkumar Aiyengar) (Mark Miller)
- core discovery can fail w/NPE and no explanation if a non-readable directory exists [SOLR-5322](https://issues.apache.org/jira/browse/SOLR-5322) (Said Chavkin) (Erick Erickson)
- Add CloudSolrClient helper method to connect to a ZK ensemble. [SOLR-5852](https://issues.apache.org/jira/browse/SOLR-5852) (Varun Thacker) (Furkan KAMACI) (Shawn Heisey) (Mark Miller) (Erick Erickson) (shalin)
- Remove previous SolrCore as parameter on reload. [SOLR-5864](https://issues.apache.org/jira/browse/SOLR-5864) (Tomás Fernández Löbbe)
- ant clean does not remove ZooKeeper data [SOLR-5918](https://issues.apache.org/jira/browse/SOLR-5918) (Varun Thacker) (Steve Rowe)
- Add support for adding core properties to SolrJ Collection Admin Request calls. [SOLR-5922](https://issues.apache.org/jira/browse/SOLR-5922) (Varun Thacker) (Anshum Gupta)
- Removed deprecated non-Trie-based numeric & date field types. [SOLR-5936](https://issues.apache.org/jira/browse/SOLR-5936) (Steve Rowe)
- Remove helper methods from CollectionsRequest (SolrJ) for CollectionsAPI calls and move to a builder design for the same. [SOLR-6073](https://issues.apache.org/jira/browse/SOLR-6073) (Varun Thacker) (Anshum Gupta)
- Cleanup enum/string action types in Overseer, OverseerCollectionProcessor and CollectionHandler. [SOLR-6115](https://issues.apache.org/jira/browse/SOLR-6115) (Erick Erickson) (shalin)
- Finish removal of CoreAdminHandler handleAlias action begun in 4.9 [SOLR-6169](https://issues.apache.org/jira/browse/SOLR-6169) (Alan Woodward)
- TrieDateField should directly extend TrieField instead of forwarding to a wrapped TrieField. [SOLR-6215](https://issues.apache.org/jira/browse/SOLR-6215) (Steve Rowe)
- Avoid spurious failures of ChaosMonkeySafeLeaderTest by ensuring there's at least one jetty to kill. [SOLR-6227](https://issues.apache.org/jira/browse/SOLR-6227) (shalin)
- Schema API changes return success before all cores are updated; client application can provide the optional updateTimeoutSecs parameter to cause the server handling the managed schema update to block until all replicas of the same collection have processed the update or until the specified timeout is reached [SOLR-6249](https://issues.apache.org/jira/browse/SOLR-6249) (Timothy Potter)
- Fix child filter query creation to never match parent docs in SolrExampleTests. [SOLR-6295](https://issues.apache.org/jira/browse/SOLR-6295) (Varun Thacker) (Mikhail Khludnev) (shalin)
- Set finite default timeouts for select and update. [SOLR-6324](https://issues.apache.org/jira/browse/SOLR-6324) (Ramkumar Aiyengar) (Mark Miller)
- Allow tests to report/fail on many ZK watches being parallelly requested on the same data [SOLR-6370](https://issues.apache.org/jira/browse/SOLR-6370) (Ramkumar Aiyengar) (Timothy Potter)
- Remove unnecessary checked exception for CloudSolrClient constructors, improve javadocs for CloudSolrClient constructors. [SOLR-6390](https://issues.apache.org/jira/browse/SOLR-6390) (Steve Davids) (Shawn Heisey)
- SolrCloud tests are not properly testing session expiration. [SOLR-6400](https://issues.apache.org/jira/browse/SOLR-6400) (Mark Miller)
- Upgrade Noggit to version 0.6 to support more flexible JSON input [SOLR-6445](https://issues.apache.org/jira/browse/SOLR-6445) (Noble Paul) (Yonik Seeley)
- Add SolrJ support for all current Collection API calls. [SOLR-6448](https://issues.apache.org/jira/browse/SOLR-6448) (Anshum Gupta)
- Stop throwing an error message from Overseer when node exits [SOLR-6453](https://issues.apache.org/jira/browse/SOLR-6453) (Ramkumar Aiyengar) (Noble Paul)
- Suppress EOFExceptions in SolrDispatchFilter. [SOLR-6454](https://issues.apache.org/jira/browse/SOLR-6454) (Ramkumar Aiyengar) (Mark Miller)
- Normalize logging of operations in Overseer and log current queue size. [SOLR-6459](https://issues.apache.org/jira/browse/SOLR-6459) (Ramkumar Aiyengar) (shalin) (Mark Miller)
- Refactor some methods in MiniSolrCloudCluster tests [SOLR-6483](https://issues.apache.org/jira/browse/SOLR-6483) (Steve Davids via Erick Erickson)
- Update to Apache Tika 1.7. This adds support for parsing Outlook PST and Matlab MAT files. Parsing for NetCDF files was removed because of license issues; if you need support for this format, download the parser JAR yourself and add it to contrib/extraction/lib folder: http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/ [SOLR-6488](https://issues.apache.org/jira/browse/SOLR-6488) [SOLR-6991](https://issues.apache.org/jira/browse/SOLR-6991) (Uwe Schindler)
- LBHttpSolrClient stops server retries after the timeAllowed threshold is met. [SOLR-6496](https://issues.apache.org/jira/browse/SOLR-6496) (Steve Davids) (Anshum Gupta)
- Make DirectoryFactory#create() take LockFactory. [SOLR-6519](https://issues.apache.org/jira/browse/SOLR-6519) (Uwe Schindler)
- CloudSolrClient should synchronize cache cluster state loading [SOLR-6521](https://issues.apache.org/jira/browse/SOLR-6521) (Noble Paul) (Jessica Cheng Mallet)
- Provide SolrJ support for specifying stateFormat while creating Collections. [SOLR-6523](https://issues.apache.org/jira/browse/SOLR-6523) (Anshum Gupta)
- Provide simple mechanism for passing additional metadata / context about a server-side SolrException back to the client-side [SOLR-6550](https://issues.apache.org/jira/browse/SOLR-6550) (Timothy Potter)
- Purge termIndexInterval from example/test configs [SOLR-6560](https://issues.apache.org/jira/browse/SOLR-6560) (Tom Burton-West) (hossman)
- Run SolrZkClient session watch asynchronously. [SOLR-6570](https://issues.apache.org/jira/browse/SOLR-6570) (Ramkumar Aiyengar) (Mark Miller)
- Update commons-io dependency to the latest 2.4 version [SOLR-6578](https://issues.apache.org/jira/browse/SOLR-6578) (Steve Rowe) (Shawn Heisey)
- Avoid waiting for the leader to see the down state if that leader is not live. [SOLR-6592](https://issues.apache.org/jira/browse/SOLR-6592) (Timothy Potter)
- SolrIndexConfig parameter in one of the SolrIndexSearcher constructor has been removed. It was just passed and never used via that constructor. [SOLR-6597](https://issues.apache.org/jira/browse/SOLR-6597) (Anshum Gupta)
- SystemInfoHandler should include the zkHost the node is using (when running in solrcloud mode) [SOLR-6641](https://issues.apache.org/jira/browse/SOLR-6641) (Timothy Potter)
- Fix wrong timeout logged in waitForReplicasToComeUp. [SOLR-6651](https://issues.apache.org/jira/browse/SOLR-6651) (shalin)
- bin/solr start scripts allow setting SOLR_OPTS in solr.in.* [SOLR-6697](https://issues.apache.org/jira/browse/SOLR-6697) (janhoy)
- Solr is not consistent wrt ZkCredentialsProvider / ZkCredentialProvider. References to zkCredentialProvider in System properties or configurations should be changed to zkCredentialsProvider. [SOLR-6698](https://issues.apache.org/jira/browse/SOLR-6698) (Gregory Chanan)
- ZkSolrResourceLoader constructors accept a parameter called 'collection' but it should be 'configName'. [SOLR-6715](https://issues.apache.org/jira/browse/SOLR-6715) (shalin)
- Admin UI - Sort list of command line args [SOLR-6739](https://issues.apache.org/jira/browse/SOLR-6739) (steffkes)
- Admin UI - improve Files View [SOLR-6740](https://issues.apache.org/jira/browse/SOLR-6740) (steffkes)
- Add an optional caching option as a workaround for SOLR-6586. [SOLR-6747](https://issues.apache.org/jira/browse/SOLR-6747) [SOLR-6586](https://issues.apache.org/jira/browse/SOLR-6586) (Mark Miller) (Gregory Chanan)
- Exceptions thrown in the analysis chain in DirectUpdateHandler2 should return a BAD_REQUEST status [SOLR-6751](https://issues.apache.org/jira/browse/SOLR-6751) (Alan Woodward)
- Buffer Cache allocate/lost metrics should be exposed. [SOLR-6752](https://issues.apache.org/jira/browse/SOLR-6752) (Mike Drob) (Mark Miller)
- ZkController.publish doesn't use the updateLastState parameter. [SOLR-6754](https://issues.apache.org/jira/browse/SOLR-6754) (shalin)
- Remove the multicore example as the DIH and cloud examples illustrate multicore behavior [SOLR-6773](https://issues.apache.org/jira/browse/SOLR-6773) (hossman) (Timothy Potter)
- deprecate AdminHandlers, Clean up solrconfig.xml of unnecessary plugin definitions, implicit registration of /replication, /get and /admin/* handlers [SOLR-6792](https://issues.apache.org/jira/browse/SOLR-6792) (Noble Paul)
- Update Saxon-HE to 9.6.0-2. [SOLR-6799](https://issues.apache.org/jira/browse/SOLR-6799) (Mark Miller)
- fieldType capitalization is not consistent with the rest of case-sensitive field names. [SOLR-6826](https://issues.apache.org/jira/browse/SOLR-6826) (Alexandre Rafalovitch) (Erick Erickson)
- Update Woodstox to 4.4.1 and StAX to 3.1.4. [SOLR-6830](https://issues.apache.org/jira/browse/SOLR-6830) (ab)
- Examples started with bin/solr -e should use a solr.solr.home directory under the example directory instead of server/solr. [SOLR-6833](https://issues.apache.org/jira/browse/SOLR-6833) (Alexandre Rafalovitch) (Anshum Gupta) (hossman) (Timothy Potter)
- Warn if checkIntegrityAtMerge is configured. This option is no longer meaningful since the checks are done automatically at a very low level in the segment merging. This warning will become an error in Solr 6.0. [SOLR-6834](https://issues.apache.org/jira/browse/SOLR-6834) (hossman)
- Remove support for old-style solr.xml [SOLR-6840](https://issues.apache.org/jira/browse/SOLR-6840) (Erick Erickson) (Alan Woodward)
- HttpSolrClient.RemoteSolrException reports the URL of the remote host where the exception occurred. [SOLR-6849](https://issues.apache.org/jira/browse/SOLR-6849) (Alan Woodward)
- SimplePostTool no longer defaults to collection1 making core/collection/update URL mandatory. [SOLR-6852](https://issues.apache.org/jira/browse/SOLR-6852) (Anshum Gupta)
- bin/solr -e dih launches, but has some path cruft issues preventing some of the imports don't work [SOLR-6855](https://issues.apache.org/jira/browse/SOLR-6855) (Hossman) (Timothy Potter)
- post.sh from exampledocs directory has been removed as there no longer is a default update URL. [SOLR-6861](https://issues.apache.org/jira/browse/SOLR-6861) (Anshum Gupta)
- SolrCLI should check for existence before creating a new core/collection, more user-friendly error reporting (no stack trace), and the ability to pass a directory when using bin/solr to create a core or collection [SOLR-6867](https://issues.apache.org/jira/browse/SOLR-6867) (Timothy Potter)
- Remove unused legacy scripts.conf [SOLR-6876](https://issues.apache.org/jira/browse/SOLR-6876) (Alexandre Rafalovitch) (Erick Erickson)
- Add split.key support for SPLITSHARD via SolrJ [SOLR-6881](https://issues.apache.org/jira/browse/SOLR-6881) (Anshum Gupta)
- Misspelled collection API actions in ReplicaMutator exception messages. [SOLR-6882](https://issues.apache.org/jira/browse/SOLR-6882) (Steve Rowe) (shalin)
- CLUSTERPROP API switch case does not call break. [SOLR-6883](https://issues.apache.org/jira/browse/SOLR-6883) (Varun Thacker) (shalin)
- Add core name to RecoveryThread name. [SOLR-6885](https://issues.apache.org/jira/browse/SOLR-6885) (Christine Poerschke) (shalin)
- SolrServer classes are renamed to *SolrClient. The existing classes still exist, but are deprecated. [SOLR-6895](https://issues.apache.org/jira/browse/SOLR-6895) (Alan Woodward) (Erik Hatcher)
- Speed up tests by dropping SolrJettyRunner thread max idle time [SOLR-6896](https://issues.apache.org/jira/browse/SOLR-6896) (Alan Woodward)
- Nuke non-NRT mode from code and configuration. [SOLR-6897](https://issues.apache.org/jira/browse/SOLR-6897) (Hossman) (shalin)
- Removed deprecated Circle & rect syntax. See upgrading notes. [SOLR-6904](https://issues.apache.org/jira/browse/SOLR-6904) (David Smiley)
- Test pseudo-field retrieval in distributed search. [SOLR-6905](https://issues.apache.org/jira/browse/SOLR-6905) (Ramkumar Aiyengar) (shalin)
- Fix typo bug in DistributedDebugComponentTest.testCompareWithNonDistributedRequest [SOLR-6906](https://issues.apache.org/jira/browse/SOLR-6906) (Ramkumar Aiyengar) (Erick Erickson)
- No need to log exceptions (as warn) generated when creating MBean stats if the core is shutting down [SOLR-6918](https://issues.apache.org/jira/browse/SOLR-6918) (Timothy Potter)
- "ant example" makes no sense anymore - should be "ant server" [SOLR-6926](https://issues.apache.org/jira/browse/SOLR-6926) (Ramkumar Aiyengar) (Timothy Potter)
- All HttpClient ConnectionManagers and SolrJ clients should always be shutdown in tests and regular code. [SOLR-6932](https://issues.apache.org/jira/browse/SOLR-6932) (Mark Miller)
- bin/solr should provide a single "create" action that creates a core or collection depending on whether Solr is running in standalone or cloud mode [SOLR-6933](https://issues.apache.org/jira/browse/SOLR-6933) (Timothy Potter)
- HdfsDirectoryFactory should fall back to system props for most of it's config if it is not found in solrconfig.xml. [SOLR-6943](https://issues.apache.org/jira/browse/SOLR-6943) (Mark Miller) (Mike Drob)
- bin/solr create action should copy configset directory instead of reusing an existing configset in ZooKeeper by default [SOLR-6952](https://issues.apache.org/jira/browse/SOLR-6952) (Timothy Potter)
- Remove classes and methods deprecated in 4.x [SOLR-6976](https://issues.apache.org/jira/browse/SOLR-6976) (Alan Woodward) (Noble Paul) (Chris Hostetter)
- Add a delete action to the bin/solr script to allow deleting of cores / collections (with delete collection config directory from ZK) [SOLR-6981](https://issues.apache.org/jira/browse/SOLR-6981) (Timothy Potter)
- bin/solr and SolrCLI should support SSL-related Java System Properties [SOLR-6982](https://issues.apache.org/jira/browse/SOLR-6982) (Timothy Potter)
- bin/solr stop should stop if there is only one node running or generate an error message prompting the user to be explicit about which of multiple nodes to stop using the -p or -all options [SOLR-7018](https://issues.apache.org/jira/browse/SOLR-7018) (Timothy Potter)
- 'bin/solr start' should automatically use an SSL-enabled alternate jetty configuration file when in SSL mode, eliminating the need for manual jetty.xml edits. [SOLR-7020](https://issues.apache.org/jira/browse/SOLR-7020) (Steve Rowe)
- Fixed a typo in various solrconfig.xml files. (sdumitriu)


[4.10.4] - 2015-03-03
---------------------

### Fixed (23 changes)

- Avoid OOMs in LanguageIdentifierUpdateProcessor: - Added langid.maxFieldValueChars and langid.maxTotalChars params to limit input, by default 10k and 20k chars, respectively. - Moved input concatenation to Tika implementation; the langdetect implementation instead appends each input piece via the langdetect API. [SOLR-3881](https://issues.apache.org/jira/browse/SOLR-3881) (Vitaliy Zhovtyuk) (Tomás Fernández Löbbe) (Rob Tulloh) (Steve Rowe)
- SolrZkClient clean can fail due to a race with children nodes. [SOLR-6426](https://issues.apache.org/jira/browse/SOLR-6426) (Mark Miller)
- LBHttpSolrClient: ArrayIndexOutOfBoundsException risk if counter overflows [SOLR-6457](https://issues.apache.org/jira/browse/SOLR-6457) (longkey) (Noble Paul)
- CLUSTERSTATUS should check if the node hosting a replica is live when reporting replica status [SOLR-6481](https://issues.apache.org/jira/browse/SOLR-6481) (Timothy Potter)
- SnapPuller Replication blocks clean shutdown of tomcat [SOLR-6579](https://issues.apache.org/jira/browse/SOLR-6579) (Philip Black-Knight) (Noble Paul)
- DistributedQueue spinning on calling zookeeper getChildren() [SOLR-6631](https://issues.apache.org/jira/browse/SOLR-6631) (Jessica Cheng Mallet) (Mark Miller) (Timothy Potter)
- bin\solr.cmd doesn't support 32-bit JRE/JDK running on Windows due to parenthesis in JAVA_HOME. [SOLR-6693](https://issues.apache.org/jira/browse/SOLR-6693) (Timothy Potter) (Christopher Hewitt) (Jan Høydahl)
- Shard leader elections should not persist across session expiry [SOLR-6763](https://issues.apache.org/jira/browse/SOLR-6763) (Alan Woodward) (Mark Miller)
- Fixed a bug in how default/appends/invariants params were affecting the set of all "keys" found in the request parameters, resulting in some key=value param pairs being duplicated. This was noticeably affecting some areas of the code where iteration was done over the set of all params: - literal.* in ExtractingRequestHandler - facet.* in FacetComponent - spellcheck.[dictionary name].* and spellcheck.collateParam.* in SpellCheckComponent - olap.* in AnalyticsComponent [SOLR-6780](https://issues.apache.org/jira/browse/SOLR-6780) (Alexandre Rafalovitch & hossman)
- Direct routing with CloudSolrServer will ignore the Overwrite document option. [SOLR-6839](https://issues.apache.org/jira/browse/SOLR-6839) (Mark Miller)
- LeaderInitiatedRecoveryThread compares wrong replica's state with lirState. [SOLR-6847](https://issues.apache.org/jira/browse/SOLR-6847) (shalin)
- AutoAddReplicas makes a call to wait to see live replicas that times out after 30 milliseconds instead of 30 seconds. [SOLR-6850](https://issues.apache.org/jira/browse/SOLR-6850) (Varun Thacker) (Mark Miller)
- Restore ExtractingRequestHandler's ability to capture all HTML tags when parsing (X)HTML. [SOLR-6856](https://issues.apache.org/jira/browse/SOLR-6856) (hossman) (Uwe Schindler) (ehatcher) (Steve Rowe)
- solr.cmd stop works only in english [SOLR-6928](https://issues.apache.org/jira/browse/SOLR-6928) (john.work) (Jan Høydahl) (Timothy Potter)
- We should do a limited retry when using HttpClient. [SOLR-6931](https://issues.apache.org/jira/browse/SOLR-6931) (Mark Miller) (Hrishikesh Gadre) (Gregory Chanan)
- DistributedQueue#containsTaskWithRequestId can fail with NPE. [SOLR-6941](https://issues.apache.org/jira/browse/SOLR-6941) (Mark Miller)
- Delete collection returns before collection is actually removed. [SOLR-7011](https://issues.apache.org/jira/browse/SOLR-7011) (Christine Poerschke) (shalin)
- Fix bin\solr.cmd to work in a directory with spaces in the name. [SOLR-7016](https://issues.apache.org/jira/browse/SOLR-7016) (Timothy Potter) (Uwe Schindler)
- RecoveryStrategy should not publish any state when closed / cancelled and there should always be a pause between recoveries even when recoveries are rapidly stopped and started as well as when a node attempts to become the leader for a shard. [SOLR-7033](https://issues.apache.org/jira/browse/SOLR-7033) [SOLR-5961](https://issues.apache.org/jira/browse/SOLR-5961) (Mark Miller) (Maxim Novikov)
- Validate the presence of configset before trying to create a collection. [SOLR-7038](https://issues.apache.org/jira/browse/SOLR-7038) (Anshum Gupta) (Mark Miller)
- bin/solr won't run under bash 4.2+. [SOLR-7067](https://issues.apache.org/jira/browse/SOLR-7067) (Steve Rowe)
- Two phase distributed search is fetching extra fields in GET_TOP_IDS phase. [SOLR-7128](https://issues.apache.org/jira/browse/SOLR-7128) (Pablo Queixalos) (shalin)
- Fix SolrContentHandler for TIKA to ignore multiple startDocument events. [SOLR-7139](https://issues.apache.org/jira/browse/SOLR-7139) (Chris A. Mattmann) (Uwe Schindler)

### Other (1 change)

- Introduce new TrackingShardHandlerFactory for monitoring what requests are sent to shards during tests. [SOLR-7147](https://issues.apache.org/jira/browse/SOLR-7147) (hossman) (shalin)


[4.10.3] - 2014-12-29
---------------------

### Fixed (19 changes)

- Solr does not unregister all mbeans upon exception in constructor causing memory leaks. [SOLR-2927](https://issues.apache.org/jira/browse/SOLR-2927) (tom liu) (Sharath Babu) (Cyrille Roy) (shalin)
- Suggester crashes when prefixToken is longer than surface form [SOLR-6085](https://issues.apache.org/jira/browse/SOLR-6085) (janhoy)
- ReRankingQParserPlugin cleaner paging and fix bug with fuzzy, range and other queries that need to be re-written. [SOLR-6323](https://issues.apache.org/jira/browse/SOLR-6323) (Adair Kovac) (Joel Bernstein)
- The collapse QParser would throw a NPE when used on a DocValues field on an empty segment/index. [SOLR-6510](https://issues.apache.org/jira/browse/SOLR-6510) (Christine Poerschke) (David Smiley)
- Slow startup of new clusters because ZkController.publishAndWaitForDownStates always times out. [SOLR-6610](https://issues.apache.org/jira/browse/SOLR-6610) (Jessica Cheng Mallet) (shalin) (Noble Paul)
- better validation when parsing command-line options that expect a value [SOLR-6662](https://issues.apache.org/jira/browse/SOLR-6662) (Timothy Potter)
- Fix-up /export JSON. [SOLR-6684](https://issues.apache.org/jira/browse/SOLR-6684) (Joel Bernstein)
- ConcurrentModificationException in Overseer Status API. [SOLR-6685](https://issues.apache.org/jira/browse/SOLR-6685) (shalin)
- bin/solr start script should not enable autoSoftCommit by default [SOLR-6696](https://issues.apache.org/jira/browse/SOLR-6696) (janhoy)
- TrieDateField type drops schema properties in branch 4.10 [SOLR-6704](https://issues.apache.org/jira/browse/SOLR-6704) (Tomás Fernández Löbbe)
- Better strategy for dealing with JVM specific options in the start scripts; remove -XX:+AggressiveOpts and only set -XX:-UseSuperWord for Java 1.7u40 to u51. [SOLR-6705](https://issues.apache.org/jira/browse/SOLR-6705) (Uwe Schindler) (janhoy) (hossman) (Timothy Potter)
- /update/json/docs throws RuntimeException if a nested structure contains a non-leaf float field [SOLR-6706](https://issues.apache.org/jira/browse/SOLR-6706) (Noble Paul) (shalin)
- better strategy for selecting the JMX RMI port based on SOLR_PORT in bin/solr script [SOLR-6726](https://issues.apache.org/jira/browse/SOLR-6726) (Timothy Potter)
- Fix handling of leader-initiated recovery state was String in older versions and is now a JSON map, caused backwards compatibility issues when doing rolling upgrades of a live cluster while indexing [SOLR-6732](https://issues.apache.org/jira/browse/SOLR-6732) (Timothy Potter)
- Transaction log was not flushed at the end of update requests with softCommit specified, which could lead to data loss if the server were killed immediately after the update finished. [SOLR-6776](https://issues.apache.org/jira/browse/SOLR-6776) (Jeffery Yuan) (yonik)
- BBoxField didn't support dynamic fields. [SOLR-6781](https://issues.apache.org/jira/browse/SOLR-6781) (David Smiley)
- BBoxField's 'score' mode should have been optional. [SOLR-6784](https://issues.apache.org/jira/browse/SOLR-6784) (David Smiley)
- distrib.singlePass returns score even though not asked for. [SOLR-6795](https://issues.apache.org/jira/browse/SOLR-6795) (Per Steffensen) (shalin)
- distrib.singlePass does not return correct set of fields for multi-fl-parameter requests. [SOLR-6796](https://issues.apache.org/jira/browse/SOLR-6796) (Per Steffensen) (shalin)

### Other (4 changes)

- bin/solr script should return error code &gt;0 when something fails [SOLR-6653](https://issues.apache.org/jira/browse/SOLR-6653) (janhoy) (Timothy Potter)
- Adjust all example configurations to allow overriding error-prone relative paths for solrconfig.xml &lt;lib&gt; references with solr.install.dir system property; bin/solr scripts will set it appropriately. [SOLR-6661](https://issues.apache.org/jira/browse/SOLR-6661) (ehatcher)
- Auto-detect JAVA_HOME using the Windows registry if it is not set [SOLR-6694](https://issues.apache.org/jira/browse/SOLR-6694) (janhoy) (Timothy Potter)
- Added getter/setter for lastException in DIH's ContextImpl [SOLR-6829](https://issues.apache.org/jira/browse/SOLR-6829) (ehatcher)


[4.10.2] - 2014-10-31
---------------------

### Fixed (10 changes)

- StatsComponent's stat 'missing' will work on fields with docValues=true and indexed=false [SOLR-6452](https://issues.apache.org/jira/browse/SOLR-6452) (Xu Zhang) (Tomás Fernández Löbbe)
- Solr start scripts interactive mode doesn't honor -z argument [SOLR-6509](https://issues.apache.org/jira/browse/SOLR-6509) (Timothy Potter)
- Fencepost error in LeaderInitiatedRecoveryThread [SOLR-6511](https://issues.apache.org/jira/browse/SOLR-6511) (Timothy Potter)
- Collections left in recovery state after node restart because recovery sleep time increases exponentially between retries. [SOLR-6524](https://issues.apache.org/jira/browse/SOLR-6524) (Mark Miller) (shalin)
- Commits under network partitions can put any node in down state. [SOLR-6530](https://issues.apache.org/jira/browse/SOLR-6530) (Ramkumar Aiyengar) (Alan Woodward) (Mark Miller) (shalin)
- Query field list with wild card on dynamic field fails. [SOLR-6545](https://issues.apache.org/jira/browse/SOLR-6545) (Burke Webster) (Xu Zhang) (shalin)
- QueryElevationComponent now works with localParams in the query [SOLR-6573](https://issues.apache.org/jira/browse/SOLR-6573) (janhoy)
- Misleading exception when creating collections in SolrCloud with bad configuration. [SOLR-6587](https://issues.apache.org/jira/browse/SOLR-6587) (Tomás Fernández Löbbe)
- bin/solr start script fails to detect solr on non-default port and then after 30s tails wrong log file [SOLR-6646](https://issues.apache.org/jira/browse/SOLR-6646) (janhoy)
- Bad error message when missing resource from ZK when parsing Schema [SOLR-6647](https://issues.apache.org/jira/browse/SOLR-6647) (janhoy)

### Other (4 changes)

- solr start script can have a debug flag option; use -a to set arbitrary options [SOLR-6486](https://issues.apache.org/jira/browse/SOLR-6486) (Noble Paul) (Timothy Potter)
- Stop command in the start scripts should only stop the instance that it had started. [SOLR-6529](https://issues.apache.org/jira/browse/SOLR-6529) (Varun Thacker) (Timothy Potter)
- bin/solr script should support a -s option to set the -Dsolr.solr.home property. [SOLR-6549](https://issues.apache.org/jira/browse/SOLR-6549) (Timothy Potter)
- Provide simple mechanism for passing additional metadata / context about a server-side SolrException back to the client-side [SOLR-6550](https://issues.apache.org/jira/browse/SOLR-6550) (Timothy Potter)


[4.10.1] - 2014-09-29
---------------------

### Fixed (6 changes)

- CoreContainer reports incorrect & misleading path for solrconfig.xml when there are loading problems [SOLR-5814](https://issues.apache.org/jira/browse/SOLR-5814) (Pradeep) (hossman)
- Fix StatsComponent when using docValues="true" multiValued="true" [SOLR-6024](https://issues.apache.org/jira/browse/SOLR-6024) (Vitaliy Zhovtyuk & Tomas Fernandez-Lobbe) (hossman)
- If using the new global hdfs block cache option, you can end up reading corrupt files on file name reuse. [SOLR-6425](https://issues.apache.org/jira/browse/SOLR-6425) (Mark Miller) (Gregory Chanan)
- bin/solr script needs to pass -DnumShards=1 for boostrapping collection1 when starting Solr in cloud mode. [SOLR-6447](https://issues.apache.org/jira/browse/SOLR-6447) (Timothy Potter)
- Fix fq exclusion via "ex" local param in multivalued stats.field [SOLR-6493](https://issues.apache.org/jira/browse/SOLR-6493) (hossman)
- Binary Response Writer does not return wildcard fields. [SOLR-6501](https://issues.apache.org/jira/browse/SOLR-6501) (Mike Hugo) (Constantin Mitocaru) (sarowe) (shalin)

### Other (1 change)

- Removed support for parsing netcdf files in Solr Cell because of license issues. If you need support for this format, download the parser JAR yourself (version 4.2) and add it to contrib/extraction/lib folder: http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/ [SOLR-6503](https://issues.apache.org/jira/browse/SOLR-6503) (Uwe Schindler)


[4.10.0] - 2014-09-03
---------------------

### Added (22 changes)

- Improvements to the MailEntityProcessor: - Support for server-side date filtering if using GMail; requires new dependency on the Sun Gmail Java mail extensions - Support for using the last_index_time from the previous run as the value for the fetchMailsSince filter. [SOLR-2245](https://issues.apache.org/jira/browse/SOLR-2245) (Peter Sturge) (Timothy Potter)
- Distributed query support for facet.pivot [SOLR-2894](https://issues.apache.org/jira/browse/SOLR-2894) (Dan Cooper) (Erik Hatcher) (Chris Russell) (Andrew Muldowney) (Brett Lucey) (Mark Miller) (hossman)
- bin/solr and bin/solr.cmd scripts for starting, stopping, and running Solr examples [SOLR-3617](https://issues.apache.org/jira/browse/SOLR-3617) (Timothy Potter)
- Exporting Full Sorted Result Sets [SOLR-5244](https://issues.apache.org/jira/browse/SOLR-5244) (Erik Hatcher) (Joel Bernstein)
- Add autoAddReplicas feature for shared file systems. [SOLR-5656](https://issues.apache.org/jira/browse/SOLR-5656) (Mark Miller) (Gregory Chanan)
- Add a distrib.singlePass parameter to make EXECUTE_QUERY phase fetch all fields and skip GET_FIELDS. [SOLR-5768](https://issues.apache.org/jira/browse/SOLR-5768) (Gregg Donovan) (shalin)
- Auto-generate a unique key in schema-less example if data does not have an id field. The UUIDUpdateProcessor was improved to not require a field name in configuration and generate a UUID into the unique Key field. [SOLR-6020](https://issues.apache.org/jira/browse/SOLR-6020) (Vitaliy Zhovtyuk) (hossman) (Steve Rowe) (Erik Hatcher) (shalin)
- The 'clusterstatus' API should return live_nodes as well. [SOLR-6044](https://issues.apache.org/jira/browse/SOLR-6044) (shalin)
- The 'clusterstatus' API should return 'roles' information. [SOLR-6069](https://issues.apache.org/jira/browse/SOLR-6069) (shalin)
- New spatial BBoxField for indexing rectangles with search support for most predicates. It includes extra score relevancy modes in addition to distance: score=overlapRatio|area|area2D. [SOLR-6183](https://issues.apache.org/jira/browse/SOLR-6183) (David Smiley) (Ryan McKinley)
- The overseerstatus collection API instruments amILeader and ZK state update calls. [SOLR-6196](https://issues.apache.org/jira/browse/SOLR-6196) (shalin)
- Better faceting for multiple intervals on DV fields [SOLR-6216](https://issues.apache.org/jira/browse/SOLR-6216) (Tomas Fernandez-Lobbe) (Erick Erickson)
- You can now unload/delete cores that have failed to initialize [SOLR-6232](https://issues.apache.org/jira/browse/SOLR-6232) (Alan Woodward)
- Provide basic command line tools for checking Solr status and health. [SOLR-6233](https://issues.apache.org/jira/browse/SOLR-6233) (Timothy Potter)
- Added onRollback event handler hook to Data Import Handler (DIH). [SOLR-6258](https://issues.apache.org/jira/browse/SOLR-6258) (ehatcher)
- Add DIH handler name to variable resolver as ${dih.handlerName}. [SOLR-6263](https://issues.apache.org/jira/browse/SOLR-6263) (ehatcher)
- Let user override Interval Faceting key with LocalParams [SOLR-6267](https://issues.apache.org/jira/browse/SOLR-6267) (Tomas Fernandez_Lobbe) (Erick Erickson)
- Add support for Interval Faceting in SolrJ. [SOLR-6283](https://issues.apache.org/jira/browse/SOLR-6283) (Tomás Fernández Löbbe)
- Remove the restriction of adding json by only wrapping it in an array in a new path /update/json/docs [SOLR-6294](https://issues.apache.org/jira/browse/SOLR-6294) [SOLR-6437](https://issues.apache.org/jira/browse/SOLR-6437) (Noble Paul) (hossman) (Yonik Seeley) (Steve Rowe)
- UpdateRequestHandlers are registered implicitly /update , /update/json, /update/csv , /update/json/docs [SOLR-6302](https://issues.apache.org/jira/browse/SOLR-6302) (Noble Paul)
- JsonLoader should be able to flatten an input JSON to multiple docs [SOLR-6304](https://issues.apache.org/jira/browse/SOLR-6304) (Noble Paul)
- New "terms" QParser for efficiently filtering documents by a list of values. For many values, it's more appropriate than a boolean query. [SOLR-6318](https://issues.apache.org/jira/browse/SOLR-6318) (David Smiley)

### Changed (4 changes)

- Solr's schema now uses DelegatingAnalyzerWrapper. This uses less heap for cached TokenStreamComponents because it caches per FieldType not per Field, so indexes with many fields of same type just use one TokenStream per thread. [LUCENE-5803](https://issues.apache.org/jira/browse/LUCENE-5803) (Shay Banon) (Uwe Schindler) (Robert Muir)
- BinaryResponseWriter fetches unnecessary stored fields when only pseudo-fields are requested. [SOLR-5968](https://issues.apache.org/jira/browse/SOLR-5968) (Gregg Donovan) (shalin)
- Reduce CPU usage by avoiding repeated costly calls to Document.getField inside DocumentBuilder.toDocument for use-cases with large number of fields and copyFields. [SOLR-6259](https://issues.apache.org/jira/browse/SOLR-6259) (Steven Bower) (shalin)
- Run ZooKeeper watch event callbacks in parallel to the ZooKeeper event thread. [SOLR-6261](https://issues.apache.org/jira/browse/SOLR-6261) (Ramkumar Aiyengar) (Mark Miller)

### Fixed (38 changes)

- Bugs in solr.xml parsing have been fixed to more correctly deal with the various datatypes of options people can specify, additional error handling of duplicated/unidentified options has also been added. [SOLR-5746](https://issues.apache.org/jira/browse/SOLR-5746) (Maciej Zasada) (hossman)
- Fixed data import abort button in admin UI. [SOLR-5847](https://issues.apache.org/jira/browse/SOLR-5847) (ehatcher)
- Fix undesirable edismax query parser effect (introduced in SOLR-2058) in how phrase queries generated from pf, pf2, and pf3 are merged into the main query. [SOLR-6062](https://issues.apache.org/jira/browse/SOLR-6062) [SOLR-2058](https://issues.apache.org/jira/browse/SOLR-2058) (Michael Dodsworth) (ehatcher)
- The 'deletereplica' API should remove the data and instance directory by default. [SOLR-6072](https://issues.apache.org/jira/browse/SOLR-6072) (shalin)
- When using the HDFS block cache, when a file is deleted, its underlying data entries in the block cache are not removed, which is a problem with the global block cache option. [SOLR-6089](https://issues.apache.org/jira/browse/SOLR-6089) (Mark Miller) (Patrick Hunt)
- SolrCloud cluster can end up without an overseer with overseer roles [SOLR-6095](https://issues.apache.org/jira/browse/SOLR-6095) (Noble Paul) (Shalin Mangar)
- ConcurrentUpdateSolrServer includes a Spin Lock [SOLR-6136](https://issues.apache.org/jira/browse/SOLR-6136) (Brandon Chapman) (Timothy Potter)
- Schemaless concurrency improvements: - Fixed an NPE when reloading a managed schema with no dynamic copy fields - Moved parsing and schema fields addition to after the distributed phase - AddSchemaFieldsUpdateProcessor now uses a fixed schema rather than always retrieving the latest, and holds the schema update lock through the entire schema swap-out process [SOLR-6137](https://issues.apache.org/jira/browse/SOLR-6137) (Gregory Chanan) (Steve Rowe)
- A ZooKeeper session expiry during setup can keep LeaderElector from joining elections. [SOLR-6159](https://issues.apache.org/jira/browse/SOLR-6159) (Steven Bower) (shalin)
- Correctly decode special characters in managed stopwords and synonym endpoints. [SOLR-6163](https://issues.apache.org/jira/browse/SOLR-6163) (Vitaliy Zhovtyuk) (Timo Schmidt) (Timothy Potter)
- DataImportHandler should write BigInteger and BigDecimal values as strings. [SOLR-6165](https://issues.apache.org/jira/browse/SOLR-6165) (Anand Sengamalai) (shalin)
- Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock. [SOLR-6180](https://issues.apache.org/jira/browse/SOLR-6180) (Gregory Chanan) (Steve Rowe)
- Avoid publishing the state as down if the node is not live when determining if a replica should be in leader-initiated recovery. [SOLR-6189](https://issues.apache.org/jira/browse/SOLR-6189) (Timothy Potter)
- The MIGRATE collection API doesn't work when legacyCloud=false is set in cluster properties. [SOLR-6197](https://issues.apache.org/jira/browse/SOLR-6197) (shalin)
- The migrate collection API fails on retry if temp collection already exists. [SOLR-6206](https://issues.apache.org/jira/browse/SOLR-6206) (shalin)
- JettySolrRunner QueuedThreadPool's configuration code is never executed. [SOLR-6208](https://issues.apache.org/jira/browse/SOLR-6208) (dweiss) (shalin)
- TrieDateField doesn't default to omitNorms=true. [SOLR-6211](https://issues.apache.org/jira/browse/SOLR-6211) (Michael Ryan) (Steve Rowe)
- SearchComponents may throw NPE when using shards.tolerant and there is a failure in the 'GET_FIELDS/GET_HIGHLIGHTS/GET_DEBUG' phase. [SOLR-6223](https://issues.apache.org/jira/browse/SOLR-6223) (Tomás Fernández Löbbe) (shalin)
- Make SuggestComponent return 400 instead of 500 for bad dictionary selected in request. [SOLR-6229](https://issues.apache.org/jira/browse/SOLR-6229) (Tomás Fernández Löbbe) (shalin)
- Leader initiated recovery should use coreNodeName instead of coreName to avoid marking all replicas having common core name as down. [SOLR-6235](https://issues.apache.org/jira/browse/SOLR-6235) (shalin)
- Socket and Connection configuration are ignored in HttpSolrServer when passing in HttpClient. [SOLR-6245](https://issues.apache.org/jira/browse/SOLR-6245) (Patanachai Tangchaisin) (shalin)
- More than two "!"-s in a doc ID throws an ArrayIndexOutOfBoundsException when using the composite id router. [SOLR-6257](https://issues.apache.org/jira/browse/SOLR-6257) (Steve Rowe)
- Distributed commit and optimize are executed serially across all replicas. [SOLR-6264](https://issues.apache.org/jira/browse/SOLR-6264) (Mark Miller) (Timothy Potter)
- HdfsUpdateLog has a race condition that can expose a closed HDFS FileSystem instance and should close its FileSystem instance if either inherited close method is called. [SOLR-6268](https://issues.apache.org/jira/browse/SOLR-6268) (Mark Miller)
- Fix NPE in OCP when non-existent sliceId is used for a deleteShard request [SOLR-6284](https://issues.apache.org/jira/browse/SOLR-6284) (Ramkumar Aiyengar) (Anshum Gupta)
- Facet counts duplicated in the response if specified more than once on the request. [SOLR-6314](https://issues.apache.org/jira/browse/SOLR-6314) (Vamsee Yarlagadda) (Erick Erickson)
- DistributedQueue can easily create too many ZooKeeper Watches. [SOLR-6336](https://issues.apache.org/jira/browse/SOLR-6336) (Ramkumar Aiyengar) (Mark Miller)
- coreRootDirectory requires trailing slash, or SolrCloud cores are created in wrong location. [SOLR-6338](https://issues.apache.org/jira/browse/SOLR-6338) (Primož Skale) (Erick Erickson)
- DELETEREPLICA throws a NPE while removing the last Replica in a Custom sharded collection. [SOLR-6347](https://issues.apache.org/jira/browse/SOLR-6347) (Anshum Gupta)
- HdfsDirectoryFactory should use supplied Configuration for communicating with secure kerberos. [SOLR-6372](https://issues.apache.org/jira/browse/SOLR-6372) (Gregory Chanan) (Mark Miller)
- Fixed example/example-DIH/ issues with "tika" and "solr" configurations, and tidied up README.txt [SOLR-6378](https://issues.apache.org/jira/browse/SOLR-6378) (Daniel Shchyokin) (ehatcher)
- Added missing context info to log message if IOException occurs in processing tlog [SOLR-6380](https://issues.apache.org/jira/browse/SOLR-6380) (Steven Bower) (hossman)
- RegexTransformer returns no results after replaceAll if regex does not match a value. [SOLR-6383](https://issues.apache.org/jira/browse/SOLR-6383) (Alexander Kingson) (shalin)
- Add better error messages throughout Solr and supply a work around for Java bug #8047340 to SystemInfoHandler: On Turkish default locale, some JVMs fail to fork on MacOSX, BSD, AIX, and Solaris platforms. [SOLR-6387](https://issues.apache.org/jira/browse/SOLR-6387) (hossman) (Uwe Schindler)
- TransactionLog replay performance on HDFS is very poor. [SOLR-6393](https://issues.apache.org/jira/browse/SOLR-6393) (Mark Miller)
- OverseerCollectionProcessor should not exit for ZooKeeper ConnectionLoss. [SOLR-6402](https://issues.apache.org/jira/browse/SOLR-6402) (Jessica Cheng) (Mark Miller)
- ZooKeeper calls can easily not be retried enough on ConnectionLoss. [SOLR-6405](https://issues.apache.org/jira/browse/SOLR-6405) (Jessica Cheng) (Mark Miller)
- Ensure all Lookup instances are closed via CloseHook [SOLR-6410](https://issues.apache.org/jira/browse/SOLR-6410) (hossman) (Areek Zillur) (Ryan Ernst) (Dawid Weiss)

### Other (33 changes)

- Added support for facet.missing in /browse field and pivot faceting. [SOLR-2168](https://issues.apache.org/jira/browse/SOLR-2168) (ehatcher)
- Add a unit test for the case when "spellcheck.maxCollationTries=0" [SOLR-2853](https://issues.apache.org/jira/browse/SOLR-2853) (James Dyer)
- BaseDistributedSearchTestCase should always ignore QTime. [SOLR-3345](https://issues.apache.org/jira/browse/SOLR-3345) (Vamsee Yarlagadda) (Benson Margulies) (Mark Miller)
- When using DIH in SolrCloud-mode, rollback will no longer be called when an error occurs. [SOLR-3622](https://issues.apache.org/jira/browse/SOLR-3622) (ehatcher)
- DIH should not depend on mail.jar,activation.jar [SOLR-3893](https://issues.apache.org/jira/browse/SOLR-3893) (Timothy Potter) (Steve Rowe)
- Added support for multiple spellcheck collations to /browse UI. [SOLR-4702](https://issues.apache.org/jira/browse/SOLR-4702) (ehatcher)
- Set system property zookeeper.forceSync=no for Solr test cases. [SOLR-5596](https://issues.apache.org/jira/browse/SOLR-5596) (shalin)
- Added support for multi-valued field highlighting in /browse UI. [SOLR-5664](https://issues.apache.org/jira/browse/SOLR-5664) (ehatcher)
- Corecontainer level mbeans are not exposed [SOLR-5902](https://issues.apache.org/jira/browse/SOLR-5902) (noble)
- On Windows, when the war is not extracted, the zkcli.bat script will print a helpful message indicating that the war must be unzipped instead of a java error about a missing class. [SOLR-6120](https://issues.apache.org/jira/browse/SOLR-6120) (shalin) (Shawn Heisey)
- CoreContainer.preRegisterInZk() and CoreContainer.register() commands are merged into CoreContainer.create(). [SOLR-6170](https://issues.apache.org/jira/browse/SOLR-6170) (Alan Woodward)
- Remove unused SolrCores coreNameToOrig map [SOLR-6171](https://issues.apache.org/jira/browse/SOLR-6171) (Alan Woodward)
- Fixed wrong failure message in TestDistributedSearch. [SOLR-6173](https://issues.apache.org/jira/browse/SOLR-6173) (shalin)
- Better strategy for handling empty managed data to avoid spurious warning messages in the logs. [SOLR-6179](https://issues.apache.org/jira/browse/SOLR-6179) (Timothy Potter)
- Allow access to DataImporter and DIHConfiguration from DataImportHandler. [SOLR-6194](https://issues.apache.org/jira/browse/SOLR-6194) (Aaron LaBella) (shalin)
- Opened up "public" access to DataSource, DocBuilder, and EntityProcessorWrapper in DIH. [SOLR-6194](https://issues.apache.org/jira/browse/SOLR-6194) (Aaron LaBella) (ehatcher)
- Fixed bug in TestReplicationHandler.doTestIndexAndConfigReplication. [SOLR-6228](https://issues.apache.org/jira/browse/SOLR-6228) (shalin)
- Increased timeouts and hardened the RollingRestartTest. [SOLR-6231](https://issues.apache.org/jira/browse/SOLR-6231) (Noble Paul) (shalin)
- CoreContainer.remove() replaced with CoreContainer.unload(). A call to unload will also close the core. [SOLR-6232](https://issues.apache.org/jira/browse/SOLR-6232) 
- Removed unused coreName parameter in ZkStateReader.getReplicaProps. [SOLR-6240](https://issues.apache.org/jira/browse/SOLR-6240) (shalin)
- Harden the HttpPartitionTest. [SOLR-6241](https://issues.apache.org/jira/browse/SOLR-6241) (shalin)
- A couple of small improvements to UnInvertedField class. [SOLR-6252](https://issues.apache.org/jira/browse/SOLR-6252) (Vamsee Yarlagadda) (Gregory Chanan) (Mark Miller)
- Renamed "rollback" to "error" in DIH internals, including renaming onRollback to onError introduced in SOLR-6258. [SOLR-6269](https://issues.apache.org/jira/browse/SOLR-6269) [SOLR-6258](https://issues.apache.org/jira/browse/SOLR-6258) (ehatcher)
- Increased timeouts for MultiThreadedOCPTest. [SOLR-6270](https://issues.apache.org/jira/browse/SOLR-6270) (shalin)
- UpdateShardHandler should log the params used to configure its HttpClient. [SOLR-6274](https://issues.apache.org/jira/browse/SOLR-6274) (Ramkumar Aiyengar) (Mark Miller)
- Made PostingsSolrHighlighter more configurable via subclass extension. [SOLR-6281](https://issues.apache.org/jira/browse/SOLR-6281) (David Smiley)
- Harden and speed up CollectionsAPIAsyncDistributedZkTest. [SOLR-6290](https://issues.apache.org/jira/browse/SOLR-6290) (Mark Miller) (shalin)
- Increase timeouts for AsyncMigrateRouteKeyTest. [SOLR-6309](https://issues.apache.org/jira/browse/SOLR-6309) (shalin)
- Improve SolrCloud cloud-dev scripts. [SOLR-6313](https://issues.apache.org/jira/browse/SOLR-6313) (Mark Miller) (Vamsee Yarlagadda)
- Remove bogus "Content-Charset" header in HttpSolrServer. [SOLR-6360](https://issues.apache.org/jira/browse/SOLR-6360) (Michael Ryan) (Uwe Schindler)
- Fix bug in TestSqlEntityProcessorDelta. [SOLR-6362](https://issues.apache.org/jira/browse/SOLR-6362) (James Dyer)
- Force upgrade of Apache POI dependency in Solr Cell to version 3.10.1 to fix CVE-2014-3529 and CVE-2014-3574. [SOLR-6388](https://issues.apache.org/jira/browse/SOLR-6388) (Uwe Schindler)
- Improve message for CREATECOLLECTION failure due to missing numShards [SOLR-6391](https://issues.apache.org/jira/browse/SOLR-6391) (Anshum Gupta)


[4.9.1] - 2014-09-22
--------------------

### Other (2 changes)

- Force upgrade of Apache POI dependency in Solr Cell to version 3.10.1 to fix CVE-2014-3529 and CVE-2014-3574. [SOLR-6388](https://issues.apache.org/jira/browse/SOLR-6388) (Uwe Schindler)
- Removed support for parsing netcdf files in Solr Cell because of license issues. If you need support for this format, download the parser JAR yourself (version 4.2) and add it to contrib/extraction/lib folder: http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/ [SOLR-6503](https://issues.apache.org/jira/browse/SOLR-6503) (Uwe Schindler)


[4.9.0] - 2014-06-25
--------------------

### Added (10 changes)

- Added a new [child ...] DocTransformer for optionally including Block-Join descendant documents inline in the results of a search. This works independent of whether the search itself is a block-join related query and is supported by he xml, json, and javabin response formats. [SOLR-5285](https://issues.apache.org/jira/browse/SOLR-5285) (Varun Thacker) (hossman)
- Allow a client application to request the minium achieved replication factor for an update request (single or batch) by sending an optional parameter "min_rf". [SOLR-5468](https://issues.apache.org/jira/browse/SOLR-5468) (Timothy Potter)
- Pluggable Ranking Collectors and Merge Strategies [SOLR-5973](https://issues.apache.org/jira/browse/SOLR-5973) (Joel Bernstein)
- Add checkIntegrityAtMerge support to solrconfig.xml. [SOLR-5999](https://issues.apache.org/jira/browse/SOLR-5999) (Varun Thacker) (Ryan Ernst)
- Add ability to set http headers in solr response [SOLR-6043](https://issues.apache.org/jira/browse/SOLR-6043) (Tomás Fernández Löbbe) (Ryan Ernst)
- DebugComponent track output should be returned as a JSON object rather than a list [SOLR-6064](https://issues.apache.org/jira/browse/SOLR-6064) (Christine Poerschke) (Alan Woodward)
- Add query re-ranking with the ReRankingQParserPlugin [SOLR-6088](https://issues.apache.org/jira/browse/SOLR-6088) (Joel Bernstein)
- Add support for 'addreplica' Collection API in SolrJ. [SOLR-6108](https://issues.apache.org/jira/browse/SOLR-6108) (shalin)
- Allow SolrIndexWriter to close without waiting for merges [SOLR-6125](https://issues.apache.org/jira/browse/SOLR-6125) (Christine Poerschke) (Alan Woodward)
- Add new AnalyticsQuery to support pluggable analytics [SOLR-6150](https://issues.apache.org/jira/browse/SOLR-6150) (Joel Bernstein)

### Changed (1 change)

- Make the processing of Collection API calls multi-threaded. [SOLR-5681](https://issues.apache.org/jira/browse/SOLR-5681) (Anshum Gupta) (shalin) (Noble Paul)

### Fixed (18 changes)

- Fixed a bug in ReverseWildCardFilter that could cause InvalidTokenOffsetsException when highlighting. [SOLR-5426](https://issues.apache.org/jira/browse/SOLR-5426) (Uwe Schindler) (Arun Kumar) (hossman)
- Use coreDescriptor.getInstanceDir() instead of getRawInstanceDir() in the SnapShooter to avoid problems when solr.solr.home is a symbolic link. [SOLR-5956](https://issues.apache.org/jira/browse/SOLR-5956) (Timothy Potter)
- Fix a couple of ugly issues around SolrIndexWriter close and rollback as well as how SolrIndexWriter manages its ref counted directory instance. [SOLR-6002](https://issues.apache.org/jira/browse/SOLR-6002) (Mark Miller) (Gregory Chanan)
- Better way to handle managed synonyms when ignoreCase=true [SOLR-6015](https://issues.apache.org/jira/browse/SOLR-6015) (Timothy Potter)
- Shard splitting doesn't work when legacyCloud=false is set in cluster properties. [SOLR-6101](https://issues.apache.org/jira/browse/SOLR-6101) (shalin)
- The 'addreplica' Collection API does not support 'async' parameter. [SOLR-6104](https://issues.apache.org/jira/browse/SOLR-6104) (shalin)
- The 'deleteshard' collection API should be able to delete a shard in 'construction' state. [SOLR-6111](https://issues.apache.org/jira/browse/SOLR-6111) (shalin)
- 'expand.sort' didn't support function queries. [SOLR-6118](https://issues.apache.org/jira/browse/SOLR-6118) (David Smiley)
- zkcli.sh should expand solr.war automatically instead of throwing ClassNotFoundException. [SOLR-6120](https://issues.apache.org/jira/browse/SOLR-6120) (sebastian badea) (shalin)
- DateFormatTransformer doesn't resolve dateTimeFormat. [SOLR-6129](https://issues.apache.org/jira/browse/SOLR-6129) (Aaron LaBella) (shalin)
- Fix Schema API optimistic concurrency by moving it out of ManagedIndexSchema.add(Copy)Fields() into the consumers of those methods: CopyFieldCollectionResource, FieldCollectionResource, FieldResource, and AddSchemaFieldsUpdateProcessorFactory. [SOLR-6145](https://issues.apache.org/jira/browse/SOLR-6145) (Gregory Chanan) (Alexey Serba) (Steve Rowe)
- Incorrect configuration such as wrong chroot in zk server address can cause CloudSolrServer to leak resources. [SOLR-6146](https://issues.apache.org/jira/browse/SOLR-6146) (Jessica Cheng) (Varun Thacker) (shalin)
- Specifying the query value without any index value does not work in Analysis browser. [SOLR-6149](https://issues.apache.org/jira/browse/SOLR-6149) (Aman Tandon) (shalin)
- Relative configSetBase directories were resolved relative to the container CWD, rather than solr.home. [SOLR-6158](https://issues.apache.org/jira/browse/SOLR-6158) (Simon Endele) (Alan Woodward)
- An error was sometimes possible if a distributed search included grouping with group.facet, faceting on facet.field and either facet.range or facet.query. [SOLR-6160](https://issues.apache.org/jira/browse/SOLR-6160) (David Smiley)
- Copy Fields Schema additions are not distributed to other nodes. [SOLR-6164](https://issues.apache.org/jira/browse/SOLR-6164) (Gregory Chanan) (Steve Rowe)
- DebugComponent throws NPE on shard exceptions when using shards.tolerant. [SOLR-6175](https://issues.apache.org/jira/browse/SOLR-6175) (Tomás Fernández Löbbe) (shalin)
- Data stored by the RestManager could not be reloaded after core restart, causing the core to fail to load; cast the data loaded from storage to the correct data type. [SOLR-6182](https://issues.apache.org/jira/browse/SOLR-6182) (Timothy Potter)

### Other (21 changes)

- Fix DIHWriter interface usage so users may implement writers that output documents to a location external to Solr (ex. a NoSql db). [SOLR-3671](https://issues.apache.org/jira/browse/SOLR-3671) (Roman Chyla) (James Dyer)
- Add remove" as update option for atomically removing a value from a multivalued field [SOLR-3862](https://issues.apache.org/jira/browse/SOLR-3862) (Jim Musli) (Steven Bower) (Alaknantha) (Erick Erickson)
- Add support for named snapshots [SOLR-5340](https://issues.apache.org/jira/browse/SOLR-5340) (Varun Thacker) (Noble Paul)
- Recovery strategy for leader partitioned from replica case. Hardening recovery scenarios after the leader receives an error trying to forward an update request to a replica. [SOLR-5495](https://issues.apache.org/jira/browse/SOLR-5495) (Timothy Potter)
- HttpClient should be configured to use ALLOW_ALL_HOSTNAME hostname verifier to simplify SSL setup. [SOLR-5868](https://issues.apache.org/jira/browse/SOLR-5868) (Steve Davids) (Mark Miller)
- post.jar reports back detailed error in case of error responses. [SOLR-5940](https://issues.apache.org/jira/browse/SOLR-5940) (Sameer Maggon) (shalin) (Uwe Schindler)
- Remove ShardDoc.score and use parent's ScoreDoc.score. [SOLR-5974](https://issues.apache.org/jira/browse/SOLR-5974) (Tomás Fernández Löbbe) (Ryan Ernst)
- AbstractFullDistribZkTestBase#compareResults always returns false for shouldFail. [SOLR-5980](https://issues.apache.org/jira/browse/SOLR-5980) (Mark Miller) (Gregory Chanan)
- Add "collection" to UpdateParams. [SOLR-5987](https://issues.apache.org/jira/browse/SOLR-5987) (Mark Miller) (Greg Solovyev)
- Separate test and compile scope dependencies in the Solrj and Solr contrib ivy.xml files, so that the derived Maven dependencies get filled out properly in the corresponding POMs. [SOLR-6006](https://issues.apache.org/jira/browse/SOLR-6006) (Steven Scott) (Steve Rowe)
- Fix method visibility of Evaluator, refactor DateFormatEvaluator for extensibility. [SOLR-6013](https://issues.apache.org/jira/browse/SOLR-6013) (Aaron LaBella) (shalin)
- Deprecate getAnalyzer() in IndexField and FieldType, and add getIndexAnalyzer(). [SOLR-6022](https://issues.apache.org/jira/browse/SOLR-6022) (Ryan Ernst)
- Replace mentions of CommonsHttpSolrServer with HttpSolrServer and StreamingUpdateSolrServer with ConcurrentUpdateSolrServer. [SOLR-6025](https://issues.apache.org/jira/browse/SOLR-6025) (Ahmet Arslan) (shalin)
- REQUESTSTATUS Collection API now also checks for submitted tasks which are yet to begin execution. [SOLR-6026](https://issues.apache.org/jira/browse/SOLR-6026) 
- Refactor duplicate Collector code in SolrIndexSearcher [SOLR-6067](https://issues.apache.org/jira/browse/SOLR-6067) (Christine Poerschke) (hossman)
- Refactor DocRouter.getDocRouter to accept routerName as a String. [SOLR-6116](https://issues.apache.org/jira/browse/SOLR-6116) (shalin)
- Removed deprecated analysis factories and fieldTypes from the example schema.xml [SOLR-6128](https://issues.apache.org/jira/browse/SOLR-6128) (hossman)
- Added com.uwyn:jhighlight dependency to, and removed asm:asm dependency from the extraction contrib - dependencies weren't fully upgraded with the Tika 1.4-&gt;1.5 upgrade (SOLR-5763). [SOLR-6130](https://issues.apache.org/jira/browse/SOLR-6130) [SOLR-5763](https://issues.apache.org/jira/browse/SOLR-5763) (Steve Rowe)
- ReplicationHandler backup response format should contain backup name. [SOLR-6153](https://issues.apache.org/jira/browse/SOLR-6153) (Varun Thacker) (shalin)
- SolrDispatchFilter should throw java.lang.Error back even if wrapped in another exception. [SOLR-6161](https://issues.apache.org/jira/browse/SOLR-6161) (Miklos Christine) (shalin)
- Remove broken handleAlias action in CoreAdminHandler [SOLR-6169](https://issues.apache.org/jira/browse/SOLR-6169) (Alan Woodward)


[4.8.1] - 2014-05-20
--------------------

### Fixed (10 changes)

- SpellCheckComponent sometimes throws NPE if "spellcheck.alternativeTermCount" is set to zero [SOLR-5090](https://issues.apache.org/jira/browse/SOLR-5090) (James Dyer)
- ElectionContext can cancel an election when it should not if there was an exception while trying to register as the leader. [SOLR-5904](https://issues.apache.org/jira/browse/SOLR-5904) (Mark Miller) (Alan Woodward)
- ZkController can warn about shard leader conflict even after the conflict is resolved. [SOLR-5993](https://issues.apache.org/jira/browse/SOLR-5993) (Gregory Chanan) (shalin)
- Fix SimpleQParser to use query analyzer [SOLR-6017](https://issues.apache.org/jira/browse/SOLR-6017) (Ryan Ernst)
- FieldAnalysisRequestHandler throws NPE if no parameters are supplied. [SOLR-6023](https://issues.apache.org/jira/browse/SOLR-6023) (shalin)
- CollapsingQParserPlugin throws ArrayIndexOutOfBoundsException if elevated doc has been deleted from a segment. [SOLR-6029](https://issues.apache.org/jira/browse/SOLR-6029) (Greg Harris) (Joel Bernstein)
- Use System.nanoTime() instead of currentTimeInMills() in LRUCache.warm. [SOLR-6030](https://issues.apache.org/jira/browse/SOLR-6030) (Tomás Fernández Löbbe) (shalin)
- CloudSolrServer directUpdate routing should use getCoreUrl. [SOLR-6035](https://issues.apache.org/jira/browse/SOLR-6035) (Marvin Justice) (Joel Bernstein)
- Fixed incorrect max/sum/stddev for Date fields in StatsComponent [SOLR-6037](https://issues.apache.org/jira/browse/SOLR-6037) (Brett Lucey) (hossman)
- fixed debug output when no results in response [SOLR-6039](https://issues.apache.org/jira/browse/SOLR-6039) (Tomás Fernández Löbbe) (hossman)


[4.8.0] - 2014-04-28
--------------------

### Added (20 changes)

- Wildcards, ORs etc inside Phrase Queries. [SOLR-1604](https://issues.apache.org/jira/browse/SOLR-1604) (Ahmet Arslan) (Erick Erickson)
- Enable tagging and excluding filters in StatsComponent via the localParams syntax. [SOLR-3177](https://issues.apache.org/jira/browse/SOLR-3177) (Mathias H.) (Nikolai Luthman) (Vitaliy Zhovtyuk) (shalin)
- Allow cores to use configuration from a configsets directory outside their instance directory. [SOLR-4478](https://issues.apache.org/jira/browse/SOLR-4478) (Alan Woodward) (Erick Erickson)
- RegexReplaceProcessorFactory should support pattern capture group substitution in replacement string. [SOLR-4864](https://issues.apache.org/jira/browse/SOLR-4864) (Sunil Srinivasan) (Jack Krupansky) (Steve Rowe)
- Implement addReplica Collections API [SOLR-5130](https://issues.apache.org/jira/browse/SOLR-5130) (Noble Paul)
- JSON updates now support nested child documents using a "_childDocument_" object key. [SOLR-5183](https://issues.apache.org/jira/browse/SOLR-5183) (Varun Thacker) (hossman)
- A new List collections and cluster status API which clients can use to read collection and shard information instead of reading data directly from ZooKeeper. [SOLR-5466](https://issues.apache.org/jira/browse/SOLR-5466) (Dave Seltzer) (Varun Thacker) (Vitaliy Zhovtyuk) (Erick Erickson) (shalin)
- Async execution of OverseerCollectionProcessor(CollectionsAPI) tasks. [SOLR-5477](https://issues.apache.org/jira/browse/SOLR-5477) (Anshum Gupta)
- Create a RestManager to provide REST API endpoints for reconfigurable plugins. [SOLR-5653](https://issues.apache.org/jira/browse/SOLR-5653) (Tim Potter) (Steve Rowe)
- Create a synonym filter factory that is (re)configurable, and capable of reporting its configuration, via REST API. [SOLR-5654](https://issues.apache.org/jira/browse/SOLR-5654) (Tim Potter) (Steve Rowe)
- Create a stopword filter factory that is (re)configurable, and capable of reporting its configuration, via REST API. [SOLR-5655](https://issues.apache.org/jira/browse/SOLR-5655) (Tim Potter) (Steve Rowe)
- You can now use one pool of memory for for the HDFS block cache that all collections share. [SOLR-5714](https://issues.apache.org/jira/browse/SOLR-5714) (Mark Miller) (Gregory Chanan)
- Add ExpandComponent to expand results collapsed by the CollapsingQParserPlugin. [SOLR-5720](https://issues.apache.org/jira/browse/SOLR-5720) (Joel Bernstein)
- A new Overseer status collection API exposes overseer queue sizes, timing statistics, success and error counts and last N failures per operation. [SOLR-5749](https://issues.apache.org/jira/browse/SOLR-5749) (shalin)
- New DocExpirationUpdateProcessorFactory supports computing an expiration date for documents from the "TTL" expression, as well as automatically deleting expired documents on a periodic basis. [SOLR-5795](https://issues.apache.org/jira/browse/SOLR-5795) (hossman)
- Allow ExpandComponent to accept query and filter query parameters [SOLR-5829](https://issues.apache.org/jira/browse/SOLR-5829) (Joel Bernstein)
- Add a hl.qparser parameter to allow you to define a queryparser for hl.q highlight queries. If no queryparser is defined, Solr will use the overall query's defType. [SOLR-5858](https://issues.apache.org/jira/browse/SOLR-5858) (Alan Woodward)
- Use leaderConflictResolveWait in WaitForState during recovery/startup, improve logging and force refresh cluster state every 15 seconds. [SOLR-5860](https://issues.apache.org/jira/browse/SOLR-5860) (Timothy Potter) (shalin)
- Provide a MiniSolrCloudCluster to enable easier testing. [SOLR-5865](https://issues.apache.org/jira/browse/SOLR-5865) (Greg Chanan) (Mark Miller)
- Add support for basic authentication in post.jar tool, e.g.: java -Durl="http://username:password@hostname:8983/solr/update" -jar post.jar sample.xml [SOLR-5960](https://issues.apache.org/jira/browse/SOLR-5960) (Sameer Maggon) (Uwe Schindler)

### Changed (3 changes)

- Distributed Search skips GET_FIELDS stage if EXECUTE_QUERY stage gets all fields. Requests with fl=id or fl=id,score are now single-pass. [SOLR-1880](https://issues.apache.org/jira/browse/SOLR-1880) (Shawn Smith) (Vitaliy Zhovtyuk) (shalin)
- Requests to open a new searcher will now reuse the current registered searcher (w/o additional warming) if possible in situations where the underlying index has not changed. This reduces overhead in situations such as deletes that do not modify the index, and/or redundant commits. [SOLR-5783](https://issues.apache.org/jira/browse/SOLR-5783) (hossman)
- When recovery is cancelled, any call to the leader to wait to see the replica in the right state for recovery should be aborted. [SOLR-5884](https://issues.apache.org/jira/browse/SOLR-5884) (Mark Miller)

### Fixed (6 changes)

- edismax and dismax query parsers can be used for parsing highlight queries. [SOLR-5858](https://issues.apache.org/jira/browse/SOLR-5858) [SOLR-4812](https://issues.apache.org/jira/browse/SOLR-4812) (Alan Woodward) (Tien Nguyen Manh)
- On restarting overseer designate , move itself to front of the queue [SOLR-5893](https://issues.apache.org/jira/browse/SOLR-5893) (Noble Paul)
- Upgraded to jQuery 1.7.2, Solr was previously using 1.4.3, the file was mistakenly named 1.7.2 [SOLR-5897](https://issues.apache.org/jira/browse/SOLR-5897) (steffkes)
- Attempts to specify the parserImpl for solr.PreAnalyzedField fieldtype failed. [SOLR-5915](https://issues.apache.org/jira/browse/SOLR-5915) (Mike McCandless)
- SolrCmdDistributor does not distribute the openSearcher parameter. [SOLR-5943](https://issues.apache.org/jira/browse/SOLR-5943) (ludovic Boutros) (shalin)
- Slower DataImportHandler process caused by not reusing jdbc connections. [SOLR-5954](https://issues.apache.org/jira/browse/SOLR-5954) (Mark Miller) (Paco Garcia) (Raja Nagendra Kumar)

### Other (23 changes)

- IndexWriter.addDocument will now throw an IllegalArgumentException if a Term to be indexed exceeds IndexWriter.MAX_TERM_LENGTH. To recreate previous behavior of silently ignoring these terms, use LengthFilter in your Analyzer. [LUCENE-5472](https://issues.apache.org/jira/browse/LUCENE-5472) (hossman) (Mike McCandless) (Varun Thacker)
- Don't require &lt;field&gt; or &lt;dynamicField&gt; be inside of &lt;fields&gt; -- or that &lt;fieldType&gt; be inside of &lt;types&gt;. [SOLR-5228](https://issues.apache.org/jira/browse/SOLR-5228) (Erick Erickson)
- If legacy mode is disabled don't let cores create slices/replicas/collections . All operations should be performed through collection API [SOLR-5609](https://issues.apache.org/jira/browse/SOLR-5609) (Noble Paul)
- Upgrade to commons-codec 1.9 for better BeiderMorseFilter performance. [SOLR-5613](https://issues.apache.org/jira/browse/SOLR-5613) (Thomas Champagne) (Shawn Heisey) (shalin)
- Upgrade to Tika 1.5 [SOLR-5763](https://issues.apache.org/jira/browse/SOLR-5763) (Vitaliy Zhovtyuk) (Steve Rowe)
- Fix recently added tests to not use absolute paths to load test-files, use SolrTestCaseJ4.getFile() and getResource() instead; fix morphlines/map-reduce to not duplicate test resources and fix dependencies among them. [SOLR-5764](https://issues.apache.org/jira/browse/SOLR-5764) (Uwe Schindler)
- Update to SLF4J 1.7.6. [SOLR-5765](https://issues.apache.org/jira/browse/SOLR-5765) (Mark Miller)
- Add SolrTestCaseJ4.SuppressSSL annotation to disable SSL (instead of static boolean). [SOLR-5771](https://issues.apache.org/jira/browse/SOLR-5771) (Robert Muir)
- CollapsingQParserPlugin should make elevated documents the group head. [SOLR-5773](https://issues.apache.org/jira/browse/SOLR-5773) (David Boychuck) (Joel Bernstein)
- When registering as the leader, if an existing ephemeral registration exists, wait a short time to see if it goes away. [SOLR-5799](https://issues.apache.org/jira/browse/SOLR-5799) (Mark Miller)
- Separate http request creating and execution in SolrJ [SOLR-5825](https://issues.apache.org/jira/browse/SOLR-5825) (Steven Bower) (Erick Erickson)
- Add hashCode/equals to SolrDocument, SolrInputDocument and SolrInputField for testing purposes. [SOLR-5837](https://issues.apache.org/jira/browse/SOLR-5837) (Varun Thacker) (Noble Paul) (Mark Miller)
- Relative SolrHome Path Bug At AbstractFullDistribZkTestBase. [SOLR-5838](https://issues.apache.org/jira/browse/SOLR-5838) (Furkan KAMACI) (shalin)
- The createCollection methods in the test framework now reports result of operation in the returned CollectionAdminResponse [SOLR-5853](https://issues.apache.org/jira/browse/SOLR-5853) (janhoy)
- Upgrade ZooKeeper to 3.4.6 [SOLR-5881](https://issues.apache.org/jira/browse/SOLR-5881) (Shawn Heisey)
- Many tests do not shutdown SolrServer. [SOLR-5883](https://issues.apache.org/jira/browse/SOLR-5883) (Tomás Fernández Löbbe) (Mark Miller)
- Update to latest Kite Morphlines release: Version 0.12.1. [SOLR-5898](https://issues.apache.org/jira/browse/SOLR-5898) (Mark Miller)
- SolrCore implements Closeable, cut over to using try-with-resources where possible. [SOLR-5903](https://issues.apache.org/jira/browse/SOLR-5903) (Alan Woodward)
- Upgrade Carrot2 clustering dependency to 3.9.0. [SOLR-5909](https://issues.apache.org/jira/browse/SOLR-5909) (Dawid Weiss)
- Cleanup and fix Solr's test cleanup code. [SOLR-5914](https://issues.apache.org/jira/browse/SOLR-5914) (Mark Miller) (Uwe Schindler)
- LBHttpSolrServer exception handling improvement and small test improvements. [SOLR-5934](https://issues.apache.org/jira/browse/SOLR-5934) (Gregory Chanan) (Mark Miller)
- Deprecate non-Trie-based numeric & date field types. [SOLR-5936](https://issues.apache.org/jira/browse/SOLR-5936) (Steve Rowe)
- Modernize the DIH example config sets. [SOLR-5937](https://issues.apache.org/jira/browse/SOLR-5937) (Steve Rowe)


[4.7.2] - 2014-04-15
--------------------

### Fixed (2 changes)

- Maven config: make the org.slf4j:slf4j-api dependency transitive (i.e., not optional) in all modules in which it's a dependency, including solrj, except for the WAR, where it will remain optional. [SOLR-5950](https://issues.apache.org/jira/browse/SOLR-5950) (Uwe Schindler) (Steve Rowe)
- Fixed SolrDispatchFilter to throw useful exception on startup if SLF4j logging jars are missing. [SOLR-5951](https://issues.apache.org/jira/browse/SOLR-5951) (Uwe Schindler) (Hossman) (Shawn Heisey)


[4.7.1] - 2014-02-26
--------------------

### Fixed (28 changes)

- CSV output doesn't include function field [SOLR-5423](https://issues.apache.org/jira/browse/SOLR-5423) (Arun Kumar) (hossman) (Steve Rowe)
- shards.info is not returned by a short circuited distributed query. [SOLR-5550](https://issues.apache.org/jira/browse/SOLR-5550) (Timothy Potter) (shalin)
- The lib paths in example-schemaless will now load correctly. [SOLR-5647](https://issues.apache.org/jira/browse/SOLR-5647) (Paul Westin) (Shawn Heisey)
- We should use System.nanoTime rather than System.currentTimeMillis when calculating elapsed time. [SOLR-5734](https://issues.apache.org/jira/browse/SOLR-5734) (Mark Miller) (Ramkumar Aiyengar)
- ConcurrentUpdateSolrServer has a blockUntilFinished call when streamDeletes is true that should be tucked into the if statement below it. [SOLR-5760](https://issues.apache.org/jira/browse/SOLR-5760) (Mark Miller) (Gregory Chanan)
- HttpSolrServer has a few fields that can be set via setters but are not volatile. [SOLR-5761](https://issues.apache.org/jira/browse/SOLR-5761) (Mark Miller) (Gregory Chanan)
- All attempts to match a SolrCore with its state in clusterstate.json should be done with the CoreNodeName. [SOLR-5770](https://issues.apache.org/jira/browse/SOLR-5770) (Steve Davids) (Mark Miller)
- Fix ordering of field values in JSON updates where field name key is repeated [SOLR-5777](https://issues.apache.org/jira/browse/SOLR-5777) (hossman)
- The full MapReduceIndexer help text does not display when using --help. [SOLR-5782](https://issues.apache.org/jira/browse/SOLR-5782) (Mark Miller) (Wolfgang Hoschek)
- Increase how long we are willing to wait for a core to see the ZK advertised leader in its local state. [SOLR-5796](https://issues.apache.org/jira/browse/SOLR-5796) (Timothy Potter) (Mark Miller)
- Admin UI - Analysis form doesn't render results correctly when a CharFilter is used. [SOLR-5800](https://issues.apache.org/jira/browse/SOLR-5800) (steffkes)
- The Overseer will retry work items until success, which is a serious problem if you hit a bad work item. [SOLR-5811](https://issues.apache.org/jira/browse/SOLR-5811) (Mark Miller)
- distrib search with custom comparator does not quite work correctly [SOLR-5818](https://issues.apache.org/jira/browse/SOLR-5818) (Ryan Ernst)
- Merge up Solr MapReduce contrib code to latest external changes. Includes a few minor bug fixes. [SOLR-5824](https://issues.apache.org/jira/browse/SOLR-5824) (Mark Miller)
- Overseer threads are only being interrupted and not closed. [SOLR-5834](https://issues.apache.org/jira/browse/SOLR-5834) (hossman) (Mark Miller)
- ZookeeperInfoServlet does not trim path properly. [SOLR-5839](https://issues.apache.org/jira/browse/SOLR-5839) (Furkan KAMACI) (Mark Miller)
- Recovery should not set onlyIfLeaderActive=true for slice in 'recovery' state. [SOLR-5861](https://issues.apache.org/jira/browse/SOLR-5861) (shalin)
- UpdateShardHandler needs to use the system default scheme registry to properly handle https via javax.net.ssl.* properties. [SOLR-5866](https://issues.apache.org/jira/browse/SOLR-5866) (Steve Davids) (shalin)
- OverseerCollectionProcessor isn't properly generating https urls in some cases. [SOLR-5867](https://issues.apache.org/jira/browse/SOLR-5867) (Steve Davids) (shalin)
- Admin UI - Reload on Core Admin doesn't show errors [SOLR-5870](https://issues.apache.org/jira/browse/SOLR-5870) (steffkes)
- Unsafe cast in CloudSolrServer's RouteException. Change RouteException to handle Throwable rather than Exception. [SOLR-5874](https://issues.apache.org/jira/browse/SOLR-5874) (Mark Miller) (David Arthur)
- QueryComponent.mergeIds() unmarshals all docs' sort field values once per doc instead of once per shard. [SOLR-5875](https://issues.apache.org/jira/browse/SOLR-5875) (Alexey Serba) (hoss) (Martin de Vries) (Steve Rowe)
- JavaBinLoader hides IOExceptions. [SOLR-5895](https://issues.apache.org/jira/browse/SOLR-5895) (Mike Sokolov) (shalin)
- CloudSolrServer's RouteResponse and RouteException should be publicly accessible. [SOLR-5899](https://issues.apache.org/jira/browse/SOLR-5899) (Mark Miller) (shalin)
- CollapsingQParserPlugin throws a NPE if required 'field' param is missing. [SOLR-5905](https://issues.apache.org/jira/browse/SOLR-5905) (Spyros Kapnissis) (shalin)
- Collection create API ignores property.instanceDir parameter. [SOLR-5906](https://issues.apache.org/jira/browse/SOLR-5906) (Varun Thacker) (shalin)
- The hdfs write cache can cause a reader to see a corrupted state. It now defaults to off, and if you were using solr.hdfs.blockcache.write.enabled explicitly, you should set it to false. [SOLR-5907](https://issues.apache.org/jira/browse/SOLR-5907) (Mark Miller)
- Distributed sort on DateField, BoolField and BCD{Int,Long,Str}Field returns string cast exception [SOLR-5920](https://issues.apache.org/jira/browse/SOLR-5920) (Eric Bus) (AJ Lemke) (hossman) (Steve Rowe)

### Other (1 change)

- Make how long we are willing to wait for a core to see the ZK advertised leader in its local state configurable. [SOLR-5796](https://issues.apache.org/jira/browse/SOLR-5796) (Timothy Potter) (Mark Miller)


[4.7.0] - 2014-02-26
--------------------

### Added (32 changes)

- Upgrade to Spatial4j 0.4. Various new options are now exposed automatically for an RPT field type. See Spatial4j CHANGES & javadocs. https://github.com/spatial4j/spatial4j/blob/master/CHANGES.md [LUCENE-5395](https://issues.apache.org/jira/browse/LUCENE-5395) (David Smiley)
- Add a Solr contrib that allows for building Solr indexes via Hadoop's MapReduce. [SOLR-1301](https://issues.apache.org/jira/browse/SOLR-1301) (Matt Revelle) (Alexander Kanarsky) (Steve Rowe) (Mark Miller) (Greg Bowyer) (Jason Rutherglen) (Kris Jirapinyo) (Jason Venner) (Andrzej Bialecki) (Patrick Hunt) (Wolfgang Hoschek) (Roman Shaposhnik) (Eric Wong)
- The 'map' function query accepts a ValueSource as target and default value. [SOLR-1871](https://issues.apache.org/jira/browse/SOLR-1871) (Chris Harris) (shalin)
- SSL support for SolrCloud. [SOLR-3854](https://issues.apache.org/jira/browse/SOLR-3854) (Sami Siren) (hossman) (Steve Davids) (Alexey Serba) (Mark Miller)
- Add support for deleteInstanceDir to be passed from SolrJ for Core Unload action. [SOLR-5023](https://issues.apache.org/jira/browse/SOLR-5023) (Lyubov Romanchuk) (shalin)
- Support for the setting of core.properties key/values at create-time on Collections API [SOLR-5208](https://issues.apache.org/jira/browse/SOLR-5208) (Erick Erickson)
- A new 'migrate' collection API to split all documents with a route key into another collection [SOLR-5308](https://issues.apache.org/jira/browse/SOLR-5308) [SOLR-5601](https://issues.apache.org/jira/browse/SOLR-5601) [SOLR-5710](https://issues.apache.org/jira/browse/SOLR-5710) (shalin)
- Added support for tri-level compositeId routing. [SOLR-5320](https://issues.apache.org/jira/browse/SOLR-5320) (Anshum Gupta) (shalin)
- A new SuggestComponent that fully utilizes the Lucene suggester module and adds pluggable dictionaries, payloads and better distributed support. This is intended to eventually replace the Suggester support through the SpellCheckComponent. [SOLR-5378](https://issues.apache.org/jira/browse/SOLR-5378) [SOLR-5528](https://issues.apache.org/jira/browse/SOLR-5528) (Areek Zillur) (Varun Thacker) (shalin)
- New 'stats.calcdistinct' parameter in StatsComponent returns set of distinct values and their count. This can also be specified per field e.g. 'f.field.stats.calcdistinct'. [SOLR-5428](https://issues.apache.org/jira/browse/SOLR-5428) [SOLR-5690](https://issues.apache.org/jira/browse/SOLR-5690) (Elran Dvir) (shalin)
- Expose number of transaction log files and their size via JMX. [SOLR-5441](https://issues.apache.org/jira/browse/SOLR-5441) (Rafał Kuć) (shalin)
- Add a QParserPlugin for Lucene's SimpleQueryParser. [SOLR-5447](https://issues.apache.org/jira/browse/SOLR-5447) [SOLR-5490](https://issues.apache.org/jira/browse/SOLR-5490) (Jack Conradson) (shalin)
- Admin UI - Added a new "Files" conf directory browser/file viewer. [SOLR-5458](https://issues.apache.org/jira/browse/SOLR-5458) (steffkes)
- new 'cursorMark' request param for deep paging of sorted result sets [SOLR-5463](https://issues.apache.org/jira/browse/SOLR-5463) (sarowe) (hossman)
- Overseer Role for nodes [SOLR-5476](https://issues.apache.org/jira/browse/SOLR-5476) (Noble Paul)
- Return the replica that actually served the query in shards.info response. [SOLR-5492](https://issues.apache.org/jira/browse/SOLR-5492) (shalin)
- Support docValues in CollationField and ICUCollationField. [SOLR-5506](https://issues.apache.org/jira/browse/SOLR-5506) (Robert Muir)
- Add support for queries to use multiple suggesters. [SOLR-5529](https://issues.apache.org/jira/browse/SOLR-5529) (Areek Zillur) (Erick Erickson) (Robert Muir)
- Added a NoOpResponseParser for SolrJ which puts the entire raw response into an entry in the NamedList. [SOLR-5530](https://issues.apache.org/jira/browse/SOLR-5530) (Upayavira) (Vitaliy Zhovtyuk) (shalin)
- Set "partialResults" header for shards that error out if shards.tolerant is specified. [SOLR-5535](https://issues.apache.org/jira/browse/SOLR-5535) (Steve Davids) (shalin)
- Add ValueSource collapse criteria to CollapsingQParsingPlugin [SOLR-5536](https://issues.apache.org/jira/browse/SOLR-5536) (Joel Bernstein)
- Allow QueryElevationComponent to accept elevateIds and excludeIds as http parameters [SOLR-5541](https://issues.apache.org/jira/browse/SOLR-5541) (Joel Bernstein)
- Allow class of CollectionsHandler and InfoHandler to be specified in solr.xml. [SOLR-5556](https://issues.apache.org/jira/browse/SOLR-5556) (Gregory Chanan) (Alan Woodward)
- Give ZkCLI the ability to get files. [SOLR-5581](https://issues.apache.org/jira/browse/SOLR-5581) (Gregory Chanan) (Mark Miller)
- Allow FieldTypes to specify custom PrefixQuery behavior [SOLR-5594](https://issues.apache.org/jira/browse/SOLR-5594) (Anshum Gupta) (hossman)
- Support cluster-wide properties with an API called CLUSTERPROP [SOLR-5610](https://issues.apache.org/jira/browse/SOLR-5610) (Noble Paul)
- Better diagnosis of RuntimeExceptions in analysis [SOLR-5623](https://issues.apache.org/jira/browse/SOLR-5623) (Benson Margulies)
- Add support for Lucene's FreeTextSuggester. [SOLR-5631](https://issues.apache.org/jira/browse/SOLR-5631) (Areek Zillur) (Robert Muir)
- allow _version_ to use DocValues. [SOLR-5670](https://issues.apache.org/jira/browse/SOLR-5670) (Per Steffensen) (yonik)
- Add logParamsList parameter to support reduced logging. [SOLR-5672](https://issues.apache.org/jira/browse/SOLR-5672) (Christine Poerschke) (Mark Miller)
- Make the admin InfoHandler more pluggable / derivable. [SOLR-5682](https://issues.apache.org/jira/browse/SOLR-5682) (Greg Chanan) (Mark Miller)
- Add support for Lucene's BlendedInfixSuggester. [SOLR-5695](https://issues.apache.org/jira/browse/SOLR-5695) (Areek Zillur)

### Changed (8 changes)

- DocSet decoupled from OpenBitSet. DocSetBase moved to use FixedBitSet instead of OpenBitSet. As a result BitDocSet now only works with FixedBitSet. [LUCENE-5440](https://issues.apache.org/jira/browse/LUCENE-5440) (Shai Erera)
- fix DIH XPathEntityProcessor to add the correct number of "null" placeholders for multi-valued fields [SOLR-2960](https://issues.apache.org/jira/browse/SOLR-2960) (Michael Watts) (James Dyer)
- Wrap XML RequestWriter's OutputStreamWriter in a BufferedWriter to avoid frequent converter invocations. [SOLR-4227](https://issues.apache.org/jira/browse/SOLR-4227) (Conrad Herrmann) (shalin)
- Solr 4.x Web UI Log Viewer does not display 'date' column from logs [SOLR-5189](https://issues.apache.org/jira/browse/SOLR-5189) (steffkes)
- Reduce memory usage for shard splitting by merging segments one at a time. [SOLR-5214](https://issues.apache.org/jira/browse/SOLR-5214) (Christine Poerschke) (shalin)
- Eliminate the 1500ms wait in overseer loop as well as polling the ZK distributed queue. [SOLR-5436](https://issues.apache.org/jira/browse/SOLR-5436) (Noble Paul) (Mark Miller)
- Optimize DocValuesFacets. [SOLR-5512](https://issues.apache.org/jira/browse/SOLR-5512) (Robert Muir)
- Enable QueryResultCache for CollapsingQParserPlugin. [SOLR-5624](https://issues.apache.org/jira/browse/SOLR-5624) (David Boychuck) (Joel Bernstein)

### Fixed (52 changes)

- Fixed Solr's Zookeeper Client to copy files to Zookeeper using binary transfer. Previously data was read with default encoding and stored in zookeeper as UTF-8. This bug was found after upgrading to forbidden-apis 1.4. [LUCENE-5347](https://issues.apache.org/jira/browse/LUCENE-5347) (Uwe Schindler)
- Error message is incorrect for linkconfig in ZkCLI. [SOLR-4072](https://issues.apache.org/jira/browse/SOLR-4072) (Vamsee Yarlagadda) (Adam Hahn) (Mark Miller)
- DataImportHandler uses wrong date format for last_index_time if a delta-import is run first before any full-imports. [SOLR-4376](https://issues.apache.org/jira/browse/SOLR-4376) (Sebastien Lorber) (Arcadius Ahouansou) (shalin)
- Admin UI - Analysis Screen contains empty table-columns [SOLR-4612](https://issues.apache.org/jira/browse/SOLR-4612) (steffkes)
- Solr eats OutOfMemoryError exceptions in many cases. [SOLR-4992](https://issues.apache.org/jira/browse/SOLR-4992) (Mark Miller) (Daniel Collins)
- StatsComponent and SpellCheckComponent do not support the shards.tolerant=true parameter. [SOLR-5204](https://issues.apache.org/jira/browse/SOLR-5204) (Anca Kopetz) (shalin)
- Call DelegatingCollector.finish() during grouping. [SOLR-5230](https://issues.apache.org/jira/browse/SOLR-5230) (Joel Bernstein) (ehatcher)
- Distributed sort is broken with CUSTOM FieldType. [SOLR-5354](https://issues.apache.org/jira/browse/SOLR-5354) (Steve Rowe) (hossman) (Robert Muir) (Jessica Cheng)
- sort wouldn't work correctly with distributed searching for some field types such as legacy numeric types [LUCENE-5399](https://issues.apache.org/jira/browse/LUCENE-5399) [SOLR-5354](https://issues.apache.org/jira/browse/SOLR-5354) (Rob Muir) (Mike McCandless)
- Fix bug with compressed files in ExtractingRequestHandler by upgrading commons-compress to 1.7 [SOLR-5365](https://issues.apache.org/jira/browse/SOLR-5365) (Jan Høydahl) (hossman)
- DebugComponent throws NPE when used with grouping. [SOLR-5438](https://issues.apache.org/jira/browse/SOLR-5438) (Tomás Fernández Löbbe) (shalin)
- ShowFileRequestHandler treats everything as Directory, when in Cloud-Mode. [SOLR-5448](https://issues.apache.org/jira/browse/SOLR-5448) (Erick Erickson) (steffkes)
- SyncStrategy closes its http connection manager before the executor that uses it in its close method. [SOLR-5451](https://issues.apache.org/jira/browse/SOLR-5451) (Mark Miller)
- SolrDispatchFilter#sendError can get a SolrCore that it does not close. [SOLR-5460](https://issues.apache.org/jira/browse/SOLR-5460) (Mark Miller)
- Request proxying should only set con.setDoOutput(true) if the request is a post. [SOLR-5461](https://issues.apache.org/jira/browse/SOLR-5461) (Mark Miller)
- SolrCmdDistributor should not let the http client do its own retries. [SOLR-5481](https://issues.apache.org/jira/browse/SOLR-5481) (Mark Miller)
- CoreContainer#remove throws NPE rather than returning null when a SolrCore does not exist in core discovery mode. [SOLR-5494](https://issues.apache.org/jira/browse/SOLR-5494) (Mark Miller)
- NPE when getting stats on date field with empty result on SolrCloud. [SOLR-5515](https://issues.apache.org/jira/browse/SOLR-5515) (Alexander Sagen) (shalin)
- Exception when using Query Function inside Scale Function. [SOLR-5524](https://issues.apache.org/jira/browse/SOLR-5524) (Trey Grainger) (yonik)
- Fixed NPE that could arise when explicitly configuring some built in QParserPlugins [SOLR-5526](https://issues.apache.org/jira/browse/SOLR-5526) (Nikolay Khitrin) (Vitaliy Zhovtyuk) (hossman)
- DIH logs spurious warning for special commands. [SOLR-5527](https://issues.apache.org/jira/browse/SOLR-5527) (shalin)
- Fix implicit DefaultSimilarityFactory initialization in IndexSchema to properly specify discountOverlap option. [SOLR-5561](https://issues.apache.org/jira/browse/SOLR-5561) (Isaac Hebsh) (Ahmet Arslan) (Vitaliy Zhovtyuk) (hossman)
- ConcurrentUpdateSolrServer constructor ignores supplied httpclient. [SOLR-5562](https://issues.apache.org/jira/browse/SOLR-5562) (Kyle Halliday) (Mark Miller)
- ZkController getHostAddress duplicates url prefix. [SOLR-5567](https://issues.apache.org/jira/browse/SOLR-5567) (Kyle Halliday) (Alexey Serba) (shalin)
- Replicas should accept the last updates from a leader that has just lost its connection to ZooKeeper. [SOLR-5593](https://issues.apache.org/jira/browse/SOLR-5593) (Christine Poerschke) (Mark Miller)
- LanguageIdentifierUpdateProcessor ignores all but the first value of multiValued string fields. [SOLR-5598](https://issues.apache.org/jira/browse/SOLR-5598) (Andreas Hubold) (Vitaliy Zhovtyuk) (shalin)
- ZKStateReader.aliases should be volatile to ensure all threads see the latest aliases. [SOLR-5620](https://issues.apache.org/jira/browse/SOLR-5620) (Ramkumar Aiyengar) (Mark Miller)
- SolrJ GroupCommand.getNGroups returns null if group.format=simple and group.ngroups=true. [SOLR-5634](https://issues.apache.org/jira/browse/SOLR-5634) (Artem Lukanin) (shalin)
- ConcurrentUpdateSolrServer will sometimes not spawn a new Runner thread even though there are updates in the queue. [SOLR-5643](https://issues.apache.org/jira/browse/SOLR-5643) (Mark Miller)
- SplitShard does not handle not finding a shard leader well. [SOLR-5644](https://issues.apache.org/jira/browse/SOLR-5644) (Mark Miller) (Anshum Gupta) (shalin)
- Clean up some minor ConnectionManager issues. [SOLR-5649](https://issues.apache.org/jira/browse/SOLR-5649) (Mark Miller) (Gregory Chanan)
- When a replica becomes a leader, only peer sync with other replicas that last published an ACTIVE state. [SOLR-5650](https://issues.apache.org/jira/browse/SOLR-5650) (Mark Miller)
- When a SolrCore starts on HDFS, it should gracefully handle HDFS being in safe mode. [SOLR-5657](https://issues.apache.org/jira/browse/SOLR-5657) (Mark Miller)
- example-DIH uses non-existing column for mapping (case-sensitive) [SOLR-5663](https://issues.apache.org/jira/browse/SOLR-5663) (steffkes)
- Using the hdfs write cache can result in appearance of corrupted index. [SOLR-5666](https://issues.apache.org/jira/browse/SOLR-5666) (Mark Miller)
- Performance problem when not using hdfs block cache. [SOLR-5667](https://issues.apache.org/jira/browse/SOLR-5667) (Mark Miller)
- HTTPSolrServer doesn't set own property correctly in setFollowRedirects. [SOLR-5673](https://issues.apache.org/jira/browse/SOLR-5673) (Frank Wesemann) (shalin)
- cloud-scripts/zkcli.bat: quote option log4j (Günther Ruck via steffkes [SOLR-5675](https://issues.apache.org/jira/browse/SOLR-5675) 
- SolrCloud updates rejected if talking to secure ZooKeeper. [SOLR-5676](https://issues.apache.org/jira/browse/SOLR-5676) (Greg Chanan) (Mark Miller)
- SolrZkClient should throw a SolrException when connect times out rather than a RuntimeException. [SOLR-5678](https://issues.apache.org/jira/browse/SOLR-5678) (Karl Wright) (Anshum Gupta) (Mark Miller)
- Shard splitting fails with ClassCastException on collections upgraded from 4.5 and earlier versions. [SOLR-5679](https://issues.apache.org/jira/browse/SOLR-5679) (Brett Hoerner) (shalin)
- On reconnect, ZkController cancels election on first context rather than latest. [SOLR-5689](https://issues.apache.org/jira/browse/SOLR-5689) (Gregory Chanan) (Mark Miller) (shalin)
- Sharing non thread safe WeakHashMap across thread can cause problems. [SOLR-5691](https://issues.apache.org/jira/browse/SOLR-5691) (Bojan Smid) (Mark Miller)
- Running on HDFS does work correctly with NRT search. [SOLR-5693](https://issues.apache.org/jira/browse/SOLR-5693) (Mark Miller)
- coreRootDirectory was not respected when creating new cores via CoreAdminHandler [SOLR-5704](https://issues.apache.org/jira/browse/SOLR-5704) (Jesse Sipprell) (Alan Woodward)
- Highlighting grouped duplicate docs from different shards with group.limit &gt; 1 throws ArrayIndexOutOfBoundsException. [SOLR-5709](https://issues.apache.org/jira/browse/SOLR-5709) (Steve Rowe)
- Make LBHttpSolrServer zombie checks non-distrib and non-scoring. [SOLR-5718](https://issues.apache.org/jira/browse/SOLR-5718) (Christine Poerschke) (Mark Miller)
- ConnectionManager can become stuck in likeExpired. [SOLR-5721](https://issues.apache.org/jira/browse/SOLR-5721) (Gregory Chanan) (Mark Miller)
- LBHttpSolrServer should only retry on Connection exceptions when sending updates. Affects CloudSolrServer. [SOLR-5727](https://issues.apache.org/jira/browse/SOLR-5727) (Mark Miller)
- In ConnectionManager, we should catch and only log exceptions from BeforeReconnect. [SOLR-5731](https://issues.apache.org/jira/browse/SOLR-5731) (Mark Miller)
- Sub-shards created by shard splitting have their update log set to buffering mode on restarts. [SOLR-5739](https://issues.apache.org/jira/browse/SOLR-5739) (Günther Ruck) (shalin)
- UpdateShardHandler was not correctly setting max total connections on the HttpClient. [SOLR-5741](https://issues.apache.org/jira/browse/SOLR-5741) (Shawn Heisey)

### Other (23 changes)

- change the default of hl.phraseLimit to 5000. [SOLR-2794](https://issues.apache.org/jira/browse/SOLR-2794) (Michael Della Bitta) (Robert Muir) (Koji) (zarni)
- Improved error/warn messages when Update XML contains unexpected XML nodes [SOLR-5257](https://issues.apache.org/jira/browse/SOLR-5257) (Vitaliy Zhovtyuk) (hossman)
- Add distributed request tracking information to DebugComponent [SOLR-5399](https://issues.apache.org/jira/browse/SOLR-5399) (Tomás Fernández Löbbe) (Ryan Ernst)
- The example config references deprecated classes. [SOLR-5404](https://issues.apache.org/jira/browse/SOLR-5404) (Uwe Schindler) (Rafał Kuć) (Mark Miller)
- Remove double set of distrib.from param in processAdd method of DistributedUpdateProcessor. [SOLR-5421](https://issues.apache.org/jira/browse/SOLR-5421) (Anshum Gupta) (shalin)
- Replication factor error message doesn't match constraint. [SOLR-5487](https://issues.apache.org/jira/browse/SOLR-5487) (Patrick Hunt) (shalin)
- Log a warning if /get is not registered when using SolrCloud. [SOLR-5499](https://issues.apache.org/jira/browse/SOLR-5499) (Daniel Collins) (shalin)
- Added a test for tri-level compositeId routing with documents having a "/" in a document id. [SOLR-5502](https://issues.apache.org/jira/browse/SOLR-5502) (Anshum Gupta) (Mark Miller)
- Return HTTP error on POST requests with no Content-Type. [SOLR-5517](https://issues.apache.org/jira/browse/SOLR-5517) (Ryan Ernst) (Uwe Schindler)
- Improve out of the box support for running Solr on hdfs with SolrCloud. [SOLR-5533](https://issues.apache.org/jira/browse/SOLR-5533) (Mark Miller)
- Give DistributedSearchTestCase / JettySolrRunner the ability to specify extra filters. [SOLR-5548](https://issues.apache.org/jira/browse/SOLR-5548) (Greg Chanan) (Mark Miller)
- LBHttpSolrServer and CloudSolrServer constructors don't need to declare MalformedURLExceptions [SOLR-5555](https://issues.apache.org/jira/browse/SOLR-5555) (Sushil Bajracharya) (Alan Woodward)
- Raise default ZooKeeper session timeout to 30 seconds from 15 seconds. [SOLR-5565](https://issues.apache.org/jira/browse/SOLR-5565) (Mark Miller)
- CoreContainer shutdown publishes all nodes as down and waits to see that and then again publishes all nodes as down. [SOLR-5574](https://issues.apache.org/jira/browse/SOLR-5574) (Mark Miller)
- Raise Collections API timeout to 3 minutes from one minute. [SOLR-5585](https://issues.apache.org/jira/browse/SOLR-5585) (Mark Miller)
- Upgrade HttpClient/HttpComponents to 4.3.x. [SOLR-5590](https://issues.apache.org/jira/browse/SOLR-5590) (Karl Wright) (Shawn Heisey)
- SolrIndexSearcher.name should include core name. [SOLR-5629](https://issues.apache.org/jira/browse/SOLR-5629) (Shikhar Bhushan) (shalin)
- Improve response message for reloading a non-existent core. [SOLR-5632](https://issues.apache.org/jira/browse/SOLR-5632) (Anshum Gupta) (Mark Miller)
- HttpShardHandlerFactory should make its http client available to subclasses. [SOLR-5633](https://issues.apache.org/jira/browse/SOLR-5633) (Ryan Ernst)
- Add test for compositeId ending with an '!'. [SOLR-5659](https://issues.apache.org/jira/browse/SOLR-5659) (Markus Jelsma) (Anshum Gupta) (shalin)
- Shutdown SolrServer clients created in BasicDistributedZk2Test and BasicDistributedZkTest. [SOLR-5684](https://issues.apache.org/jira/browse/SOLR-5684) (Tomás Fernández Löbbe) (shalin)
- Improve error handling of remote queries (proxied requests). [SOLR-5700](https://issues.apache.org/jira/browse/SOLR-5700) (Greg Chanan) (Steve Davids) (Mark Miller)
- Log config name found for collection at info level. [SOLR-5702](https://issues.apache.org/jira/browse/SOLR-5702) (Christine Poerschke) (Mark Miller)


[4.6.1] - 2014-01-28
--------------------

### Changed (1 change)

- Improve concurrency when registering and waiting for all SolrCore's to register a DOWN state. [SOLR-5576](https://issues.apache.org/jira/browse/SOLR-5576) (Christine Poerschke) (Mark Miller)

### Fixed (29 changes)

- ConcurrentUpdateSolrServer#blockUntilFinished can return before all previously added updates have finished. This could cause distributed updates meant for replicas to be lost. [SOLR-4260](https://issues.apache.org/jira/browse/SOLR-4260) (Markus Jelsma) (Timothy Potter) (Joel Bernstein) (Mark Miller)
- The core reload after replication if config files have changed can fail due to a race condition. [SOLR-4709](https://issues.apache.org/jira/browse/SOLR-4709) (Mark Miller) (Hossman)
- CollapsingQParserPlugin scores incorrectly when multiple sort criteria are used [SOLR-5408](https://issues.apache.org/jira/browse/SOLR-5408) (Brandon Chapman) (Joel Bernstein)
- CollapsingQParserPlugin breaks Tag/Exclude Faceting [SOLR-5416](https://issues.apache.org/jira/browse/SOLR-5416) (David Boychuck) (Joel Bernstein)
- Python client cannot parse proxied response when served by Tomcat. [SOLR-5442](https://issues.apache.org/jira/browse/SOLR-5442) (Patrick Hunt) (Gregory Chanan) (Vamsee Yarlagadda) (Romain Rigaux) (Mark Miller)
- Proxied responses should propagate all headers rather than the first one for each key. [SOLR-5445](https://issues.apache.org/jira/browse/SOLR-5445) (Patrick Hunt) (Mark Miller)
- SolrCmdDistributor retry logic stops if a leader for the request cannot be found in 1 second. [SOLR-5479](https://issues.apache.org/jira/browse/SOLR-5479) (Mark Miller)
- We should share an http connection manager across non search HttpClients and ensure all http connection managers get shutdown. [SOLR-5496](https://issues.apache.org/jira/browse/SOLR-5496) (Mark Miller)
- Retry 'forward to leader' requests less aggressively - rather than on IOException and status 500, ConnectException. [SOLR-5503](https://issues.apache.org/jira/browse/SOLR-5503) (Mark Miller)
- SolrJ Content-Type validation is too strict for some webcontainers / proxies. [SOLR-5532](https://issues.apache.org/jira/browse/SOLR-5532) (Jakob Furrer) (hossman) (Shawn Heisey) (Uwe Schindler) (Mark Miller)
- HdfsLockFactory should explicitly create the lock parent directory if necessary. [SOLR-5540](https://issues.apache.org/jira/browse/SOLR-5540) (Mark Miller)
- Core swaps resulted in duplicate core entries in solr.xml when using solr.xml persistence. [SOLR-5543](https://issues.apache.org/jira/browse/SOLR-5543) (Bill Bell) (Alan Woodward)
- Creating a collection alias using SolrJ's CollectionAdminRequest sets the alias name and the collections to alias to the same value. [SOLR-5547](https://issues.apache.org/jira/browse/SOLR-5547) (Aaron Schram) (Mark Miller)
- Leader recovery process can select the wrong leader if all replicas for a shard are down and trying to recover as well as lose updates that should have been recovered. [SOLR-5552](https://issues.apache.org/jira/browse/SOLR-5552) (Timothy Potter) (Mark Miller)
- hl.maxAlternateFieldLength should apply to original field when fallback is attempted [SOLR-5564](https://issues.apache.org/jira/browse/SOLR-5564) (janhoy)
- A SolrCore cannot decide to be the leader just because the cluster state says no other SolrCore's are active. [SOLR-5568](https://issues.apache.org/jira/browse/SOLR-5568) (Mark Miller)
- A replica should not try and recover from a leader until it has published that it is ACTIVE. [SOLR-5569](https://issues.apache.org/jira/browse/SOLR-5569) (Mark Miller)
- Likely ZooKeeper expiration should not slow down updates a given amount, but instead cut off updates after a given time. [SOLR-5577](https://issues.apache.org/jira/browse/SOLR-5577) (Mark Miller) (Christine Poerschke) (Ramkumar Aiyengar)
- NPE when creating a core with both explicit shard and coreNodeName. [SOLR-5580](https://issues.apache.org/jira/browse/SOLR-5580) (YouPeng Yang) (Mark Miller)
- ConcurrentUpdateSolrServer#blockUntilFinished may wait forever if the executor service is shutdown. [SOLR-5583](https://issues.apache.org/jira/browse/SOLR-5583) (Mark Miller)
- All ZkCmdExecutor's should be initialized with the zk client timeout. [SOLR-5586](https://issues.apache.org/jira/browse/SOLR-5586) (Mark Miller)
- ElectionContext implementations should use ZkCmdExecutor#ensureExists to ensure their election paths are properly created. [SOLR-5587](https://issues.apache.org/jira/browse/SOLR-5587) (Mark Miller)
- PeerSync doesn't count all connect failures as success. [SOLR-5588](https://issues.apache.org/jira/browse/SOLR-5588) (Mark Miller)
- Don't allow a closed SolrCore to publish state to ZooKeeper. [SOLR-5608](https://issues.apache.org/jira/browse/SOLR-5608) (Mark Miller) (Shawn Heisey)
- Deadlock while trying to recover after a ZK session expiration. [SOLR-5615](https://issues.apache.org/jira/browse/SOLR-5615) (Ramkumar Aiyengar) (Mark Miller)
- Fix false cache hits in queryResultCache when hashCodes are equal and duplicate filter queries exist in one of the requests [SOLR-5618](https://issues.apache.org/jira/browse/SOLR-5618) (hossman)
- SolrRequestParsers does some xpath lookups on every request, which can cause concurrency issues. [SOLR-5636](https://issues.apache.org/jira/browse/SOLR-5636) (Mark Miller)
- A SolrCore reload via the CoreContainer will try and register in zk again with the new SolrCore. [SOLR-5645](https://issues.apache.org/jira/browse/SOLR-5645) (Mark Miller)
- commitWithin and overwrite are not being distributed to replicas now that SolrCloud uses javabin to distribute updates. [SOLR-5658](https://issues.apache.org/jira/browse/SOLR-5658) (Mark Miller) (Varun Thacker) (Elodie Sannier) (shalin)


[4.6.0] - 2013-11-22
--------------------

### Added (13 changes)

- CollapsingQParserPlugin for high performance field collapsing on high cardinality fields. [SOLR-5027](https://issues.apache.org/jira/browse/SOLR-5027) (Joel Bernstein)
- new field type EnumField. [SOLR-5084](https://issues.apache.org/jira/browse/SOLR-5084) (Elran Dvir) (Erick Erickson)
- Add support for AnalyzingInfixSuggester (AnalyzingInfixLookupFactory). [SOLR-5167](https://issues.apache.org/jira/browse/SOLR-5167) (Areek Zillur) (Varun Thacker) (Robert Muir)
- Add Lucene index heap usage to the Solr admin UI. [SOLR-5226](https://issues.apache.org/jira/browse/SOLR-5226) (Areek Zillur) (Robert Muir)
- Shard splitting now supports collections configured with router.field. [SOLR-5246](https://issues.apache.org/jira/browse/SOLR-5246) (shalin)
- Allow JettySolrRunner SSL config to be specified via a constructor. [SOLR-5274](https://issues.apache.org/jira/browse/SOLR-5274) (Mark Miller)
- Shards can be split by specifying arbitrary number of hash ranges within the shard's hash range. [SOLR-5300](https://issues.apache.org/jira/browse/SOLR-5300) (shalin)
- Make sub shard replica recovery and shard state switch asynchronous. [SOLR-5324](https://issues.apache.org/jira/browse/SOLR-5324) (Yago Riveiro) (shalin)
- Split shards by a route key using split.key parameter. [SOLR-5338](https://issues.apache.org/jira/browse/SOLR-5338) (shalin)
- Enhance CoreAdmin api to split a route key's documents from an index and leave behind all other documents. [SOLR-5353](https://issues.apache.org/jira/browse/SOLR-5353) (shalin)
- Extend solrj apis to cover collection management. [SOLR-5392](https://issues.apache.org/jira/browse/SOLR-5392) (Roman Shaposhnik) (Mark Miller)
- Added a RunAlways marker interface for UpdateRequestProcessorFactory implementations indicating that they should not be removed in later stages of distributed updates (usually signalled by the update.distrib parameter) (yonik) * SOLR-5310: Add a collection admin command to remove a replica (noble) * SOLR-5311: Avoid registering replicas which are removed (noble) * SOLR-5406: CloudSolrServer failed to propagate request parameters along with delete updates. (yonik) * SOLR-5374: Support user configured doc-centric versioning rules via the optional DocBasedVersionConstraintsProcessorFactory update processor [SOLR-5395](https://issues.apache.org/jira/browse/SOLR-5395) [SOLR-5310](https://issues.apache.org/jira/browse/SOLR-5310) [SOLR-5311](https://issues.apache.org/jira/browse/SOLR-5311) [SOLR-5406](https://issues.apache.org/jira/browse/SOLR-5406) [SOLR-5374](https://issues.apache.org/jira/browse/SOLR-5374) (Hossman) (yonik)
- Add option to ConcurrentSolrServer to stream pure delete requests. [SOLR-5464](https://issues.apache.org/jira/browse/SOLR-5464) (Mark Miller)

### Changed (4 changes)

- Specialized faceting for fields which are declared as multi-valued in the schema but are actually single-valued. [LUCENE-5300](https://issues.apache.org/jira/browse/LUCENE-5300) [LUCENE-5304](https://issues.apache.org/jira/browse/LUCENE-5304) (Adrien Grand)
- SolrCloud should use the JavaBin binary format for communication by default. [SOLR-5223](https://issues.apache.org/jira/browse/SOLR-5223) (Mark Miller)
- SolrCloud should distribute updates via streaming rather than buffering. [SOLR-5232](https://issues.apache.org/jira/browse/SOLR-5232) (Mark Miller)
- Requests to recover when an update fails should be done in background threads. [SOLR-5370](https://issues.apache.org/jira/browse/SOLR-5370) (Mark Miller)

### Fixed (14 changes)

- MoreLikeThisComponent was using the rows/count value in place of flags, which caused a number of very strange issues, including NPEs and ignoring requests for the results to include the score. [SOLR-5042](https://issues.apache.org/jira/browse/SOLR-5042) (Anshum Gupta) (Mark Miller) (Shawn Heisey)
- Document updates to SolrCloud can cause a distributed deadlock. [SOLR-5216](https://issues.apache.org/jira/browse/SOLR-5216) (Mark Miller)
- Creating a core via the admin API doesn't respect transient property [SOLR-5318](https://issues.apache.org/jira/browse/SOLR-5318) (Olivier Soyez) (Erick Erickson)
- ZooKeeper client is not closed when it fails to connect to an ensemble. [SOLR-5359](https://issues.apache.org/jira/browse/SOLR-5359) (Mark Miller) (Klaus Herrmann)
- Solr doesn't start up properly with Log4J2 [SOLR-5363](https://issues.apache.org/jira/browse/SOLR-5363) (Petar Tahchiev) (Alan Woodward)
- Unmarshalling delete by id commands with JavaBin can lead to class cast exception. [SOLR-5367](https://issues.apache.org/jira/browse/SOLR-5367) (Mark Miller)
- Solr should consistently call SolrServer#shutdown [SOLR-5371](https://issues.apache.org/jira/browse/SOLR-5371) (Mark Miller)
- Using cloudSolrServer.setDefaultCollection(collectionId) does not work as intended for an alias spanning more than 1 collection. [SOLR-5380](https://issues.apache.org/jira/browse/SOLR-5380) (Thomas Egense) (Shawn Heisey) (Mark Miller)
- Creating a new core via the HTTP API that results in a transient being unloaded results in a " Too many close [count:-1]" error. [SOLR-5388](https://issues.apache.org/jira/browse/SOLR-5388) (Olivier Soyez) (Erick Erickson)
- Replication can fail silently in some cases. [SOLR-5397](https://issues.apache.org/jira/browse/SOLR-5397) (Mark Miller)
- Background merge after field removed from solr.xml causes error. [SOLR-5418](https://issues.apache.org/jira/browse/SOLR-5418) (Reported on user's list) (Robert M's patch) (Erick Erickson)
- Do not attempt to proxy internal update requests. [SOLR-5452](https://issues.apache.org/jira/browse/SOLR-5452) (Mark Miller)
- Raise recovery socket read timeouts. [SOLR-5453](https://issues.apache.org/jira/browse/SOLR-5453) (Mark Miller)
- SolrCmdDistributor retry logic has a concurrency race bug. [SOLR-5465](https://issues.apache.org/jira/browse/SOLR-5465) (Mark Miller)

### Security (1 change)

- SolrResourceLoader was restricted to only allow access to resource files below the instance dir. The reason for this is security related: Some Solr components allow to pass in resource paths via REST parameters (e.g. XSL stylesheets, velocity templates,...) and load them via resource loader. For backwards compatibility, this security feature can be disabled by a new system property: solr.allow.unsafe.resourceloading=true [SOLR-4882](https://issues.apache.org/jira/browse/SOLR-4882) (Uwe Schindler)

### Other (8 changes)

- Warn if master or slave replication is enabled in SolrCloud mode. [SOLR-3397](https://issues.apache.org/jira/browse/SOLR-3397) (Erick Erickson)
- Add indexHeapUsageBytes to LukeRequestHandler, indicating how much heap memory is being used by the underlying Lucene index structures. [SOLR-5237](https://issues.apache.org/jira/browse/SOLR-5237) (Areek Zillur) (Robert Muir)
- Fix SimplePostToolTest performance problem - implicit DNS lookups [SOLR-5241](https://issues.apache.org/jira/browse/SOLR-5241) (hossman)
- Move methods for getting config information from FieldMutatingUpdateProcessorFactory to NamedList. [SOLR-5264](https://issues.apache.org/jira/browse/SOLR-5264) (Shawn Heisey)
- Update HttpComponents to 4.2.5 and 4.2.6. [SOLR-5273](https://issues.apache.org/jira/browse/SOLR-5273) (Mark Miller)
- Remove unused and incorrect router name from Collection ZK nodes. [SOLR-5319](https://issues.apache.org/jira/browse/SOLR-5319) (Jessica Cheng) (shalin)
- Remove unnecessary code in Overseer.updateState method which tries to use router name from message where none is ever sent. [SOLR-5321](https://issues.apache.org/jira/browse/SOLR-5321) (shalin)
- SolrResourceLoader logs a warning if a deprecated (factory) class is used in schema or config. [SOLR-5401](https://issues.apache.org/jira/browse/SOLR-5401) (Uwe Schindler)


[4.5.1] - 2013-10-24
--------------------

### Fixed (15 changes)

- HttpSolrServer can leak connections on errors. [SOLR-4327](https://issues.apache.org/jira/browse/SOLR-4327) (Karl Wright) (Mark Miller)
- Collections API should return a nice error when not in SolrCloud mode. [SOLR-4590](https://issues.apache.org/jira/browse/SOLR-4590) (Anshum Gupta) (Mark Miller)
- Remove unnecessary call to fetch and watch live nodes in ZkStateReader cluster watcher. [SOLR-5255](https://issues.apache.org/jira/browse/SOLR-5255) (Jessica Cheng) (shalin)
- Fix CloudSolrServer URL cache update race. [SOLR-5263](https://issues.apache.org/jira/browse/SOLR-5263) (Jessica Cheng) (Mark Miller)
- The CREATESHARD collection API creates maxShardsPerNode number of replicas if replicationFactor is not specified. [SOLR-5295](https://issues.apache.org/jira/browse/SOLR-5295) (Brett Hoerner) (shalin)
- Creating a collection with implicit router adds shard ranges to each shard. [SOLR-5296](https://issues.apache.org/jira/browse/SOLR-5296) (shalin)
- Admin UI - Threads Screen missing Icon [SOLR-5297](https://issues.apache.org/jira/browse/SOLR-5297) (steffkes)
- DELETEALIAS command prints CREATEALIAS in logs [SOLR-5301](https://issues.apache.org/jira/browse/SOLR-5301) (janhoy)
- Admin UI - Reloading System-Information on Dashboard does not work anymore [SOLR-5305](https://issues.apache.org/jira/browse/SOLR-5305) (steffkes)
- Shard split action should use soft commits instead of hard commits to make sub shard data visible. [SOLR-5314](https://issues.apache.org/jira/browse/SOLR-5314) (Kalle Aaltonen) (shalin)
- SolrCore persistence bugs if defining SolrCores in solr.xml. (Mark Miller, Yago Riveiro) * SOLR-5306: Extra collection creation parameters like collection.configName are not being respected. [SOLR-5317](https://issues.apache.org/jira/browse/SOLR-5317) [SOLR-5306](https://issues.apache.org/jira/browse/SOLR-5306) (Mark Miller) (Liang Tianyu) (Nathan Neulinger)
- ZooKeeper connection loss can cause the Overseer to stop processing commands. [SOLR-5325](https://issues.apache.org/jira/browse/SOLR-5325) (Christine Poerschke) (Mark Miller) (Jessica Cheng)
- "The root cause should be returned to the user when a SolrCore create call fails", was reverted. [SOLR-5327](https://issues.apache.org/jira/browse/SOLR-5327) [SOLR-4915](https://issues.apache.org/jira/browse/SOLR-4915) (Mark Miller)
- facet.method=fcs on single values fields could sometimes result in incorrect facet labels. [SOLR-5330](https://issues.apache.org/jira/browse/SOLR-5330) (Michael Froh) (yonik)
- CloudSolrServer - ZK timeout arguments passed to ZkStateReader are flipped. [SOLR-5349](https://issues.apache.org/jira/browse/SOLR-5349) (Ricardo Merizalde) (shalin)

### Other (1 change)

- Disable ClusteringComponent by default in collection1 example. The solr.clustering.enabled system property needs to be set to 'true' to enable the clustering contrib (reverts SOLR-4708). [SOLR-5323](https://issues.apache.org/jira/browse/SOLR-5323) [SOLR-4708](https://issues.apache.org/jira/browse/SOLR-4708) (Dawid Weiss)


[4.5.0] - 2013-10-05
--------------------

### Added (18 changes)

- Enhanced geodist() to work with an RPT field, provided that the field is referenced via 'sfield' and the query point is constant. [SOLR-2345](https://issues.apache.org/jira/browse/SOLR-2345) (David Smiley)
- Allow multiple threads to be specified for faceting. When threading, one can specify facet.threads to parallelize loading the uninverted fields. In at least one extreme case this reduced warmup time from 20 seconds to 3 seconds. [SOLR-2548](https://issues.apache.org/jira/browse/SOLR-2548) (Janne Majaranta) (Gun Akkor) (Erick Erickson) (David Smiley)
- Allow CloudSolrServer and SolrCmdDistributor to use JavaBin. [SOLR-3249](https://issues.apache.org/jira/browse/SOLR-3249) (Mark Miller)
- Custom sharding [SOLR-4221](https://issues.apache.org/jira/browse/SOLR-4221) (Noble Paul)
- create custom sharded collection via collections API [SOLR-4222](https://issues.apache.org/jira/browse/SOLR-4222) (Noble Paul)
- UniqFieldsUpdateProcessorFactory now extends FieldMutatingUpdateProcessorFactory and supports all of its selector options. Use of the "fields" init param is now deprecated in favor of "fieldName" [SOLR-4249](https://issues.apache.org/jira/browse/SOLR-4249) (hossman)
- Allow solr.xml to be stored in ZooKeeper. [SOLR-4718](https://issues.apache.org/jira/browse/SOLR-4718) (Mark Miller) (Erick Erickson)
- Persist and use router,replicationFactor and maxShardsPerNode at Collection and Shard level [SOLR-4808](https://issues.apache.org/jira/browse/SOLR-4808) (Noble Paul) (Shalin Mangar)
- CloudSolrServer can now route updates locally and no longer relies on inter-node update forwarding. [SOLR-4816](https://issues.apache.org/jira/browse/SOLR-4816) (Joel Bernstein) (Shikhar Bhushan) (Stephen Riesenberg) (Mark Miller)
- CREATESHARD command for 'implicit' shards [SOLR-5006](https://issues.apache.org/jira/browse/SOLR-5006) (Noble Paul)
- Allow sharding based on the value of a field [SOLR-5017](https://issues.apache.org/jira/browse/SOLR-5017) (Noble Paul)
- The encoding of URL-encoded query parameters can be changed with the "ie" (input encoding) parameter, e.g. "select?q=m%FCller&ie=ISO-8859-1". The default is UTF-8. To change the encoding of POSTed content, use the "Content-Type" HTTP header. [SOLR-5082](https://issues.apache.org/jira/browse/SOLR-5082) (Uwe Schindler) (Shawn Heisey)
- Update Carrot2 clustering to version 3.8.0, update Morfologik to version 1.7.1 [SOLR-5126](https://issues.apache.org/jira/browse/SOLR-5126) (Dawid Weiss)
- Enhance ZkCLI to allow uploading of arbitrary files to ZK. [SOLR-5156](https://issues.apache.org/jira/browse/SOLR-5156) (Erick Erickson)
- Single-valued docValues fields no longer require a default value. Additionally they work with sortMissingFirst, sortMissingLast, facet.missing, exists() in function queries, etc. [SOLR-5165](https://issues.apache.org/jira/browse/SOLR-5165) (Robert Muir)
- Add NoOpRegenerator, a regenerator for custom per-segment caches where items are preserved across commits. [SOLR-5182](https://issues.apache.org/jira/browse/SOLR-5182) (Robert Muir)
- Support easier overrides of Carrot2 clustering attributes via XML data sets exported from the Workbench. [SOLR-5202](https://issues.apache.org/jira/browse/SOLR-5202) (Dawid Weiss)
- Rewritten selection of the default search and document clustering algorithms. [SOLR-5219](https://issues.apache.org/jira/browse/SOLR-5219) (Dawid Weiss)

### Changed (4 changes)

- Better error messages / Content-Type validation in SolrJ. [SOLR-3530](https://issues.apache.org/jira/browse/SOLR-3530) (Mark Miller) (hossman)
- CloudSolrServer now uses multiple threads to send updates by default. [SOLR-4816](https://issues.apache.org/jira/browse/SOLR-4816) (Joel Bernstein) (Mark Miller)
- Admin UI - Note on Core-Admin about directories while creating core [SOLR-5044](https://issues.apache.org/jira/browse/SOLR-5044) (steffkes)
- Have HdfsIndexOutput extend BufferedIndexOutput. (Mark Miller, Uwe Schindler) * SOLR-5057: QueryResultCache should not related with the order of fq's list [SOLR-5134](https://issues.apache.org/jira/browse/SOLR-5134) [SOLR-5057](https://issues.apache.org/jira/browse/SOLR-5057) (Feihong Huang) (Erick Erickson)

### Fixed (30 changes)

- web UI reports an error if CoreAdminHandler says there are no SolrCores [SOLR-3633](https://issues.apache.org/jira/browse/SOLR-3633) (steffkes)
- Fixed ZookeeperInfoServlet so that the SolrCloud Admin UI pages will work even if ZK contains nodes with data which are not utf8 text. [SOLR-3852](https://issues.apache.org/jira/browse/SOLR-3852) (hossman)
- Fixed QueryElevationComponent sorting when used with Grouping [SOLR-3936](https://issues.apache.org/jira/browse/SOLR-3936) (Michael Garski) (hossman)
- SpellCheckComponent can throw StringIndexOutOfBoundsException when generating collations involving multiple word-break corrections. [SOLR-4489](https://issues.apache.org/jira/browse/SOLR-4489) (James Dyer)
- Text extracted from HTML or PDF files using Solr Cell was missing ignorable whitespace, which is inserted by TIKA for convenience to support plain text extraction without using the HTML elements. This bug resulted in glued words. [SOLR-4679](https://issues.apache.org/jira/browse/SOLR-4679) [SOLR-4908](https://issues.apache.org/jira/browse/SOLR-4908) [SOLR-5124](https://issues.apache.org/jira/browse/SOLR-5124) (hossman) (Uwe Schindler)
- When using NRT, just init the first reader from IndexWriter. [SOLR-4764](https://issues.apache.org/jira/browse/SOLR-4764) (Robert Muir) (Mark Miller)
- Solr should not fall back to the back compat built in solr.xml in SolrCloud mode [SOLR-4817](https://issues.apache.org/jira/browse/SOLR-4817) (Erick Erickson)
- Use DirectoryReader.openIfChanged in non-NRT mode. [SOLR-4909](https://issues.apache.org/jira/browse/SOLR-4909) (Michael Garski) (Robert Muir)
- - CoreAdminHandler.handleMergeAction generating NullPointerException [SOLR-5087](https://issues.apache.org/jira/browse/SOLR-5087) (Patrick Hunt) (Erick Erickson)
- Fixed NPE when using numTerms=0 in LukeRequestHandler [SOLR-5107](https://issues.apache.org/jira/browse/SOLR-5107) (Ahmet Arslan) (hossman)
- Show full message in Admin UI Logging View [SOLR-5112](https://issues.apache.org/jira/browse/SOLR-5112) (Matthew Keeney via steffkes)
- Managed schema problems after adding fields via Schema Rest API. [SOLR-5119](https://issues.apache.org/jira/browse/SOLR-5119) (Nils Kübler) (Steve Rowe)
- zkcli usage help for makepath doesn't match actual command. [SOLR-5121](https://issues.apache.org/jira/browse/SOLR-5121) (Daniel Collins) (Mark Miller)
- Fixed bug in spellcheck.collateMaxCollectDocs. Eliminates risk of divide by zero, and makes estimated hit counts meaningful in non-optimized indexes. [SOLR-5122](https://issues.apache.org/jira/browse/SOLR-5122) (hossman)
- HdfsUpdateLog can fail to close a FileSystem instance if init is called more than once. [SOLR-5133](https://issues.apache.org/jira/browse/SOLR-5133) (Mark Miller)
- Harden Collection API deletion of /collections/$collection ZooKeeper node. [SOLR-5135](https://issues.apache.org/jira/browse/SOLR-5135) (Mark Miller)
- HdfsIndexInput may not fully read requested bytes. [SOLR-5150](https://issues.apache.org/jira/browse/SOLR-5150) (Mark Miller) (Patrick Hunt)
- SOLR Admin gui works in IE9, breaks in IE10. [SOLR-5171](https://issues.apache.org/jira/browse/SOLR-5171) (Joseph L Howard via steffkes)
- Admin UI - Query View doesn't highlight (json) Result if it contains HTML Tags [SOLR-5174](https://issues.apache.org/jira/browse/SOLR-5174) (steffkes)
- SolrEntityProcessor substitutes variables only once in child entities [SOLR-5190](https://issues.apache.org/jira/browse/SOLR-5190) (Harsh Chawla) (shalin)
- Fixed OpenExchangeRatesOrgProvider to use refreshInterval correctly [SOLR-5206](https://issues.apache.org/jira/browse/SOLR-5206) (Catalin) (hossman)
- Fix possibility of deadlock in ZooKeeper ConnectionManager. [SOLR-5215](https://issues.apache.org/jira/browse/SOLR-5215) (Mark Miller) (Ricardo Merizalde)
- Correctly fail schema initialization if a dynamicField is configured to be required, or have a default value. [SOLR-5227](https://issues.apache.org/jira/browse/SOLR-5227) (hossman)
- Fixed a bug with the behavior of BoolField that caused documents w/o a value for the field to act as if the value were true in functions if no other documents in the same index segment had a value of true. [SOLR-5231](https://issues.apache.org/jira/browse/SOLR-5231) (Robert Muir) (hossman) (yonik)
- The "deleteshard" collections API doesn't wait for cluster state to update, can fail if some nodes of the deleted shard were down and had incorrect logging. [SOLR-5233](https://issues.apache.org/jira/browse/SOLR-5233) (Christine Poerschke) (shalin)
- All solr cores will now be loaded in parallel (as opposed to a fixed number) in zookeeper mode to avoid deadlocks due to replicas waiting for other replicas to come up. [SOLR-5240](https://issues.apache.org/jira/browse/SOLR-5240) (yonik)
- Killing a shard in one collection can result in leader election in a different collection if they share the same coreNodeName. [SOLR-5243](https://issues.apache.org/jira/browse/SOLR-5243) (yonik) (Mark Miller)
- Implicit properties don't seem to exist on core RELOAD [SOLR-5279](https://issues.apache.org/jira/browse/SOLR-5279) (elyograg) (hossman) (Steve Rowe)
- IndexSchema log message was printing '[null]' instead of '[&lt;core name&gt;]' [SOLR-5281](https://issues.apache.org/jira/browse/SOLR-5281) (Jun Ohtani) (Steve Rowe)
- Solrj does not propagate the root cause to the user for many errors. [SOLR-5291](https://issues.apache.org/jira/browse/SOLR-5291) (Mark Miller)

### Other (7 changes)

- Enable ClusteringComponent by default in collection1 example. The solr.clustering.enabled system property is set to 'true' by default. [SOLR-4708](https://issues.apache.org/jira/browse/SOLR-4708) (ehatcher) (Dawid Weiss)
- Factor out core list persistence and discovery into a new CoresLocator interface. [SOLR-4914](https://issues.apache.org/jira/browse/SOLR-4914) [SOLR-5162](https://issues.apache.org/jira/browse/SOLR-5162) (Alan Woodward) (Shawn Heisey)
- Better randomization of MergePolicy in Solr tests [SOLR-4951](https://issues.apache.org/jira/browse/SOLR-4951) (hossman)
- Make XML Configuration parsing fail if an xpath matches multiple nodes when only a single value or plugin instance is expected. [SOLR-4953](https://issues.apache.org/jira/browse/SOLR-4953) [SOLR-5108](https://issues.apache.org/jira/browse/SOLR-5108) (hossman)
- The routing parameter "shard.keys" is deprecated as part of SOLR-5017 .The new parameter name is '_route_' . The old parameter should continue to work for another release [SOLR-5017](https://issues.apache.org/jira/browse/SOLR-5017) (Noble Paul)
- Improve type safety of ConfigSolr class. [SOLR-5056](https://issues.apache.org/jira/browse/SOLR-5056) (Alan Woodward)
- Solr-core's Maven configuration includes test-only Hadoop dependencies as indirect compile-time dependencies. [SOLR-5173](https://issues.apache.org/jira/browse/SOLR-5173) (Chris Collins) (Steve Rowe)


[4.4.0] - 2013-07-23
--------------------

### Added (22 changes)

- Block joins. Documents and their sub-documents must be indexed as a block. {!parent which=&lt;allParents&gt;}&lt;someChildren&gt; takes in a query that matches child documents and results in matches on their parents. {!child of=&lt;allParents&gt;}&lt;someParents&gt; takes in a query that matches some parent documents and results in matches on their children. [SOLR-3076](https://issues.apache.org/jira/browse/SOLR-3076) (Mikhail Khludnev) (Vadim Kirilchuk) (Alan Woodward) (Tom Burton-West) (Mike McCandless) (hossman) (yonik)
- Add "spellcheck.collateMaxCollectDocs" option so that when testing potential Collations against the index, SpellCheckComponent will only collect n documents, thereby estimating the hit-count. This is a performance optimization in cases where exact hit-counts are unnecessary. Also, when "collateExtendedResults" is false, this optimization is always made [SOLR-3240](https://issues.apache.org/jira/browse/SOLR-3240) (James Dyer)
- Dynamically add fields to schema. [SOLR-3251](https://issues.apache.org/jira/browse/SOLR-3251) (Steve Rowe) (Robert Muir) (yonik)
- Add findRecursive method to NamedList. [SOLR-4048](https://issues.apache.org/jira/browse/SOLR-4048) (Shawn Heisey)
- SolrJ's SolrPing object has new methods for ping, enable, and disable. [SOLR-4228](https://issues.apache.org/jira/browse/SOLR-4228) (Shawn Heisey) (hossman) (Steve Rowe)
- Add support for binary files in ZooKeeper. [SOLR-4234](https://issues.apache.org/jira/browse/SOLR-4234) (Eric Pugh) (Mark Miller)
- Add option to have Overseer assign generic node names so that new addresses can host shards without naming confusion. [SOLR-4655](https://issues.apache.org/jira/browse/SOLR-4655) (Mark Miller) (Anshum Gupta)
- A "deleteshard" collections API that unloads all replicas of a given shard and then removes it from the cluster state. It will remove only those shards which are INACTIVE or have no range (created for custom sharding). [SOLR-4693](https://issues.apache.org/jira/browse/SOLR-4693) (Anshum Gupta) (shalin)
- Add option to plugin a merged segment warmer into solrconfig.xml. Info about segments warmed in the background is available via infostream. [SOLR-4761](https://issues.apache.org/jira/browse/SOLR-4761) [SOLR-4976](https://issues.apache.org/jira/browse/SOLR-4976) (Mark Miller) (Ryan Ernst) (Mike McCandless) (Robert Muir)
- New MaxScoreQParserPlugin returning max() instead of sum() of terms [SOLR-4785](https://issues.apache.org/jira/browse/SOLR-4785) (janhoy)
- Add FieldMutatingUpdateProcessorFactory subclasses Parse{Date,Integer,Long,Float,Double,Boolean}UpdateProcessorFactory. These factories have a default selector that matches all fields that either don’t match any schema field, or are in the schema with the corresponding typeClass. If they see a value that is not a CharSequence, or can't parse the value, they leave it as is. For multi-valued fields, these processors will not convert any values unless all are first successfully parsed, or already are instances of the target class. Ordering the processors, e.g. [Boolean, Long, Double, Date] will allow e.g. values ["2", "5", "8.6"] to be left alone by the Boolean and Long processors, but then converted by the Double processor. [SOLR-4892](https://issues.apache.org/jira/browse/SOLR-4892) (Steve Rowe) (hossman)
- Extend FieldMutatingUpdateProcessor.ConfigurableFieldNameSelector to enable checking whether a field matches any schema field. To select field names that don't match any fields or dynamic fields in the schema, add &lt;bool name="fieldNameMatchesSchemaField"&gt;false&lt;/bool&gt; to an update processor's configuration in solrconfig.xml. [SOLR-4893](https://issues.apache.org/jira/browse/SOLR-4893) (Steve Rowe) (hossman)
- Add solr/example/example-schemaless/, an example config set for schemaless mode. [SOLR-4897](https://issues.apache.org/jira/browse/SOLR-4897) (Steve Rowe)
- Add support to write and read Solr index files and transaction log files to and from HDFS. [SOLR-4916](https://issues.apache.org/jira/browse/SOLR-4916) (phunt) (Mark Miller) (Gregory Chanan)
- Admin UI now supports adding documents to Solr [SOLR-4921](https://issues.apache.org/jira/browse/SOLR-4921) (gsingers) (steffkes)
- Add a new system wide info admin handler that exposes the system info that could previously only be retrieved using a SolrCore. [SOLR-4943](https://issues.apache.org/jira/browse/SOLR-4943) (Mark Miller)
- Add PUT command to ZkCli tool. [SOLR-4972](https://issues.apache.org/jira/browse/SOLR-4972) (Roman Shaposhnik) (Mark Miller)
- Adding getter method for defaultCollection on CloudSolrServer. [SOLR-4973](https://issues.apache.org/jira/browse/SOLR-4973) (Furkan KAMACI) (Mark Miller)
- Add option to send IndexWriter's infostream to the logging system. [SOLR-4977](https://issues.apache.org/jira/browse/SOLR-4977) (Ryan Ernst) (Robert Muir)
- Register QParserPlugins as SolrInfoMBeans [SOLR-4991](https://issues.apache.org/jira/browse/SOLR-4991) (ehatcher)
- CSV Update Handler supports optionally adding the line number/row id to a document [SOLR-5003](https://issues.apache.org/jira/browse/SOLR-5003) (gsingers)
- Add support for creating copy fields to the Schema REST API [SOLR-5010](https://issues.apache.org/jira/browse/SOLR-5010) (gsingers)

### Changed (9 changes)

- Admin UI - Multiple filter queries are not supported in Query UI [SOLR-3838](https://issues.apache.org/jira/browse/SOLR-3838) (steffkes)
- New parameter langid.lcmap to map detected language code to be placed in "language" field [SOLR-4412](https://issues.apache.org/jira/browse/SOLR-4412) (janhoy)
- Admin UI - Analysis-Urls with empty parameters create empty result table [SOLR-4611](https://issues.apache.org/jira/browse/SOLR-4611) (steffkes)
- Admin UI - Default to wt=json on Query-Screen [SOLR-4719](https://issues.apache.org/jira/browse/SOLR-4719) (steffkes)
- Admin-UI - DIH: Let "commit" be checked by default [SOLR-4815](https://issues.apache.org/jira/browse/SOLR-4815) (steffkes)
- Commit to all nodes in a collection in parallel rather than locally and then to all other nodes. [SOLR-4923](https://issues.apache.org/jira/browse/SOLR-4923) (hossman) (Ricardo Merizalde) (Mark Miller)
- Admin UI - Show address bar on top for Schema + Config [SOLR-4955](https://issues.apache.org/jira/browse/SOLR-4955) (steffkes)
- optimize numDocs(Query,DocSet) when filterCache is null [SOLR-5002](https://issues.apache.org/jira/browse/SOLR-5002) (Robert Muir)
- optimize search with filter when filterCache is null [SOLR-5012](https://issues.apache.org/jira/browse/SOLR-5012) (Robert Muir)

### Fixed (37 changes)

- shards.tolerant=true is broken for group queries [SOLR-3369](https://issues.apache.org/jira/browse/SOLR-3369) (Russell Black) (Martijn van Groningen) (Jabouille jean Charles) (Ryan McKinley) (shalin)
- edismax parser to not double-escape colons if already escaped by the client application [SOLR-4333](https://issues.apache.org/jira/browse/SOLR-4333) (James Dyer) (Robert J. van der Boon)
- Hunspell stemmer should not merge duplicate dictionary entries [SOLR-4452](https://issues.apache.org/jira/browse/SOLR-4452) (janhoy)
- Admin UI: Displays dashboard even if Solr is down [SOLR-4456](https://issues.apache.org/jira/browse/SOLR-4456) (steffkes)
- HitRatio on caches is now exposed over JMX MBeans as a float. [SOLR-4616](https://issues.apache.org/jira/browse/SOLR-4616) (Greg Bowyer)
- Solrj doesn't return "between" count in range facets [SOLR-4776](https://issues.apache.org/jira/browse/SOLR-4776) (Philip K. Warren) (shalin)
- Multiple Entities DIH delta import: dataimporter.[entityName].last_index_time is empty. [SOLR-4788](https://issues.apache.org/jira/browse/SOLR-4788) (chakming wong) (James Dyer) (shalin)
- Throw an error if a core has the same name as another core, both old and new style solr.xml [SOLR-4790](https://issues.apache.org/jira/browse/SOLR-4790) 
- solr.xml sharedLib does not work in 4.3.0 [SOLR-4791](https://issues.apache.org/jira/browse/SOLR-4791) (Ryan Ernst) (Jan Høydahl via Erick Erickson)
- Fixed core discovery mode (ie: new style solr.xml) to treat 'collection1' as the default core name. [SOLR-4803](https://issues.apache.org/jira/browse/SOLR-4803) (hossman)
- SolrCore#reload should not call preRegister and publish a DOWN state to ZooKeeper. [SOLR-4805](https://issues.apache.org/jira/browse/SOLR-4805) (Mark Miller) (Jared Rodriguez)
- If a SolrCore cannot be created it should remove any information it published about itself from ZooKeeper. [SOLR-4814](https://issues.apache.org/jira/browse/SOLR-4814) (Mark Miller)
- Fix facet.field local params from affecting other facet.field's. [SOLR-4842](https://issues.apache.org/jira/browse/SOLR-4842) (ehatcher) (hossman)
- Removed non-existent attribute sourceId from dynamic JMX stats to fix AttributeNotFoundException [SOLR-4863](https://issues.apache.org/jira/browse/SOLR-4863) (suganuma) (hossman) (shalin)
- JsonLoader should preserve field value types from the JSON content stream. [SOLR-4891](https://issues.apache.org/jira/browse/SOLR-4891) (Steve Rowe)
- When reconnecting after ZooKeeper expiration, we need to be willing to wait forever, not just for 30 seconds. [SOLR-4899](https://issues.apache.org/jira/browse/SOLR-4899) (Mark Miller)
- persisting solr.xml is broken. More stringent testing of persistence fixed up a number of issues and several bugs with persistence. Among them are - don't persisting implicit properties - should persist zkHost in the &lt;solr&gt; tag (user's list) - reloading a core that has transient="true" returned an error. reload should load a transient core if it's not yet loaded. - No longer persisting loadOnStartup or transient core properties if they were not specified in the original solr.xml - Testing flushed out the fact that you couldn't swap a core marked transient=true loadOnStartup=false because it hadn't been loaded yet. - SOLR-4862, CREATE fails to persist schema, config, and dataDir - SOLR-4363, not persisting coreLoadThreads in &lt;solr&gt; tag - SOLR-3900, logWatcher properties not persisted - SOLR-4850, cores defined as loadOnStartup=true, transient=false can't be searched [SOLR-4910](https://issues.apache.org/jira/browse/SOLR-4910) [SOLR-4862](https://issues.apache.org/jira/browse/SOLR-4862) [SOLR-4363](https://issues.apache.org/jira/browse/SOLR-4363) [SOLR-3900](https://issues.apache.org/jira/browse/SOLR-3900) [SOLR-4850](https://issues.apache.org/jira/browse/SOLR-4850) (Erick Erickson)
- The root cause should be returned to the user when a SolrCore create call fails. [SOLR-4915](https://issues.apache.org/jira/browse/SOLR-4915) (Mark Miller)
- JdbcDataSource incorrectly suppresses exceptions when retrieving a connection from a JNDI context and falls back to trying to use DriverManager to obtain a connection. Additionally, if a SQLException is thrown while initializing a connection, such as in setAutoCommit(), the connection will not be closed. [SOLR-4920](https://issues.apache.org/jira/browse/SOLR-4920) (Chris Eldredge) (shalin)
- Commits to non leaders as part of a request that also contain updates can execute out of order. [SOLR-4923](https://issues.apache.org/jira/browse/SOLR-4923) (hossman) (Ricardo Merizalde) (Mark Miller)
- Collection create throws NPE when 'numShards' param is missing [SOLR-4925](https://issues.apache.org/jira/browse/SOLR-4925) (Noble Paul)
- Fixed rare replication bug that normally only manifested when using compound file format. [SOLR-4926](https://issues.apache.org/jira/browse/SOLR-4926) (yonik) (Mark Miller)
- persisting solr.xml saves some parameters it shouldn't when they weren't defined in the original. Benign since the default values are saved, but still incorrect. [SOLR-4932](https://issues.apache.org/jira/browse/SOLR-4932) (Erick Erickson) (thanks Shawn Heisey for helping test!)
- Fix handling of &lt;mergePolicy&gt; init arg "useCompoundFile" needed after changes in LUCENE-5038 [SOLR-4934](https://issues.apache.org/jira/browse/SOLR-4934) [SOLR-4941](https://issues.apache.org/jira/browse/SOLR-4941) [LUCENE-5038](https://issues.apache.org/jira/browse/LUCENE-5038) (hossman)
- UI Analysis page dropping characters from input box [SOLR-4949](https://issues.apache.org/jira/browse/SOLR-4949) (steffkes)
- Fix race conditions in shutdown of CoreContainer and getCore that could cause a request to attempt to use a core that has shut down. [SOLR-4960](https://issues.apache.org/jira/browse/SOLR-4960) (yonik)
- Outgrowth of SOLR-4960 that includes transient cores and pending cores [SOLR-4974](https://issues.apache.org/jira/browse/SOLR-4974) [SOLR-4960](https://issues.apache.org/jira/browse/SOLR-4960) (Erick Erickson)
- Time is stripped from datetime column when imported into Solr date field if convertType=true. [SOLR-4978](https://issues.apache.org/jira/browse/SOLR-4978) (Bill Au) (shalin)
- Creating a core while referencing system properties looks like it loses files Actually, instanceDir, config, dataDir and schema are not dereferenced properly when creating cores that reference sys vars (e.g. &dataDir=${dir}). In the dataDir case in particular this leads to the index being put in a directory literally named ${dir} but on restart the sysvar will be properly dereferenced. [SOLR-4982](https://issues.apache.org/jira/browse/SOLR-4982) 
- The splitshard api doesn't call commit on new sub shards before switching shard states. Multiple bugs related to sub shard recovery and replication are also fixed. [SOLR-4997](https://issues.apache.org/jira/browse/SOLR-4997) (shalin)
- ManagedIndexSchema doesn't persist uniqueKey tag after calling addFields method. [SOLR-5000](https://issues.apache.org/jira/browse/SOLR-5000) (Jun Ohtani) (Steve Rowe)
- The Overseer should avoid publishing the state for collections that do not exist under the /collections zk node. [SOLR-5018](https://issues.apache.org/jira/browse/SOLR-5018) (Mark Miller)
- spurious ConcurrentModificationException when spell check component was in use with filters. [SOLR-5019](https://issues.apache.org/jira/browse/SOLR-5019) (yonik)
- ShardHandlerFactory was not being created properly when using new-style solr.xml, and was not being persisted properly when using old-style. [SOLR-5028](https://issues.apache.org/jira/browse/SOLR-5028) [SOLR-5029](https://issues.apache.org/jira/browse/SOLR-5029) (Tomás Fernández Löbbe) (Ryan Ernst) (Alan Woodward)
- A facet.query that parses or analyzes down to a null Query would throw a NPE. Fixed. [SOLR-5034](https://issues.apache.org/jira/browse/SOLR-5034) (David Smiley)
- The CSV loader now accepts field names that are not in the schema. [SOLR-5037](https://issues.apache.org/jira/browse/SOLR-5037) (gsingers) (ehatcher) (Steve Rowe)
- Admin/Schema Browser displays -1 for term counts for multiValued fields. [SOLR-5039](https://issues.apache.org/jira/browse/SOLR-5039) 

### Other (17 changes)

- Properties files by Solr are now written in UTF-8 encoding, Unicode is no longer escaped. Reading of legacy properties files with \u escapes is still possible. [LUCENE-5107](https://issues.apache.org/jira/browse/LUCENE-5107) (Uwe Schindler) (Robert Muir)
- Add option to pass HttpServletRequest in the SolrQueryRequest context map. [SOLR-2079](https://issues.apache.org/jira/browse/SOLR-2079) (Tomás Fernández Löbbe) (Robert Muir)
- Refactor JavaBinCodec input stream definition to enhance reuse. [SOLR-4224](https://issues.apache.org/jira/browse/SOLR-4224) (phunt) (Mark Miller)
- Allow the solr internal load balancer to be more easily pluggable. [SOLR-4448](https://issues.apache.org/jira/browse/SOLR-4448) (Philip Hoy) (Robert Muir)
- Move logging of filenames on commit from INFO to DEBUG. [SOLR-4547](https://issues.apache.org/jira/browse/SOLR-4547) (Shawn Heisey) (hossman)
- Update Guava to 14.0.1 [SOLR-4737](https://issues.apache.org/jira/browse/SOLR-4737) (Mark Miller)
- Update Jetty to 8.1.10.v20130312 [SOLR-4738](https://issues.apache.org/jira/browse/SOLR-4738) (Mark Miller) (Robert Muir)
- Clean up and refactor CoreContainer code around solr.xml and SolrCore management. [SOLR-4749](https://issues.apache.org/jira/browse/SOLR-4749) (Mark Miller)
- Change the example to use the new solr.xml format and core discovery by directory structure. [SOLR-4757](https://issues.apache.org/jira/browse/SOLR-4757) (Mark Miller)
- Velocity (/browse) template cosmetic cleanup. [SOLR-4759](https://issues.apache.org/jira/browse/SOLR-4759) (Mark Bennett) (ehatcher)
- LogWatcher init code moved out of CoreContainer [SOLR-4778](https://issues.apache.org/jira/browse/SOLR-4778) (Alan Woodward)
- Make class LuceneQParser public [SOLR-4784](https://issues.apache.org/jira/browse/SOLR-4784) (janhoy)
- SolrDeletionPolicy onInit and onCommit methods changed to override exact signatures (with generics) from IndexDeletionPolicy [SOLR-4931](https://issues.apache.org/jira/browse/SOLR-4931) (shalin)
- test improvements to randomize use of compound files [SOLR-4942](https://issues.apache.org/jira/browse/SOLR-4942) (hossman)
- Tidied up CoreContainer construction logic. [SOLR-4948](https://issues.apache.org/jira/browse/SOLR-4948) [SOLR-5009](https://issues.apache.org/jira/browse/SOLR-5009) (Alan Woodward) (Uwe Schindler) (Steve Rowe)
- CSS, JS and other files in webapp without license [SOLR-4966](https://issues.apache.org/jira/browse/SOLR-4966) (uschindler) (steffkes)
- Upgrade to Tika 1.4 [SOLR-4986](https://issues.apache.org/jira/browse/SOLR-4986) (Markus Jelsma) (janhoy)


[4.3.1] - 2013-06-18
--------------------

### Fixed (22 changes)

- RSS DIH-example not working [SOLR-4563](https://issues.apache.org/jira/browse/SOLR-4563) (janhoy)
- Leader election fails with an NPE if there is no UpdateLog. [SOLR-4734](https://issues.apache.org/jira/browse/SOLR-4734) (Mark Miller) (Alexander Eibner)
- Deleting a collection should set DELETE_DATA_DIR to true. [SOLR-4741](https://issues.apache.org/jira/browse/SOLR-4741) (Mark Miller)
- Update failure on sub shard is not propagated to clients by parent shard [SOLR-4744](https://issues.apache.org/jira/browse/SOLR-4744) (Anshum Gupta) (yonik) (shalin)
- Fix replication problem of files in sub directory of conf directory. [SOLR-4751](https://issues.apache.org/jira/browse/SOLR-4751) (Minoru Osuka) (Koji)
- There are some minor bugs in the Collections API parameter validation. [SOLR-4752](https://issues.apache.org/jira/browse/SOLR-4752) (Mark Miller)
- Sub shard leader should not accept any updates from parent after it goes active [SOLR-4795](https://issues.apache.org/jira/browse/SOLR-4795) (shalin)
- zkcli.sh should honor JAVA_HOME [SOLR-4796](https://issues.apache.org/jira/browse/SOLR-4796) (Roman Shaposhnik) (Mark Miller)
- Shard splitting creates sub shards which have the wrong hash range in cluster state. This happens when numShards is not a power of two and router is compositeId. [SOLR-4797](https://issues.apache.org/jira/browse/SOLR-4797) (shalin)
- shard splitting does not respect the router for the collection when executing the index split. One effect of this is that documents may be placed in the wrong shard when the default compositeId router is used in conjunction with IDs containing "!". [SOLR-4798](https://issues.apache.org/jira/browse/SOLR-4798) (yonik)
- Shard splitting does not abort if WaitForState times out [SOLR-4806](https://issues.apache.org/jira/browse/SOLR-4806) (shalin)
- The zkcli script now works with log4j. The zkcli.bat script was broken on Windows in 4.3.0, now it works. [SOLR-4807](https://issues.apache.org/jira/browse/SOLR-4807) (Shawn Heisey)
- Fix SynonymFilterFactory to allow init parameters for tokenizer factory used when parsing synonyms file. [SOLR-4813](https://issues.apache.org/jira/browse/SOLR-4813) (Shingo Sasaki) (hossman)
- Fix transaction log leaks (a failure to clean up some old logs) on a shard leader, or when unexpected exceptions are thrown during log recovery. [SOLR-4829](https://issues.apache.org/jira/browse/SOLR-4829) (Steven Bower) (Mark Miller) (yonik)
- Fixed SolrJettyTestBase so it may be reused by end users [SOLR-4853](https://issues.apache.org/jira/browse/SOLR-4853) (hossman)
- DistributedUpdateProcessor doesn't check for peer sync requests [SOLR-4855](https://issues.apache.org/jira/browse/SOLR-4855) (shalin)
- SolrCore reloading was broken when the UpdateLog was enabled. [SOLR-4858](https://issues.apache.org/jira/browse/SOLR-4858) (Hossman) (Anshum Gupta) (Alexey Serba) (Mark Miller) (yonik)
- Admin UI - setting loglevel on root throws RangeError [SOLR-4867](https://issues.apache.org/jira/browse/SOLR-4867) (steffkes)
- Setting the log level for the log4j root category results in adding a new category, the empty string. [SOLR-4868](https://issues.apache.org/jira/browse/SOLR-4868) (Shawn Heisey)
- RecentUpdates.update() does not increment numUpdates loop counter [SOLR-4870](https://issues.apache.org/jira/browse/SOLR-4870) (Alexey Kudinov) (shalin)
- Removed SolrIndexSearcher#getDocSetNC()'s special case for handling TermQuery to prevent NullPointerException if reader does not have fields. [SOLR-4877](https://issues.apache.org/jira/browse/SOLR-4877) [LUCENE-5023](https://issues.apache.org/jira/browse/LUCENE-5023) (Bao Yang Yang) (Uwe Schindler)
- Fix DocumentAnalysisRequestHandler to correctly use EmptyEntityResolver to prevent loading of external entities like UpdateRequestHandler does. [SOLR-4881](https://issues.apache.org/jira/browse/SOLR-4881) (Hossman) (Uwe Schindler)

### Other (1 change)

- Include core name in logs when loading schema. [SOLR-4760](https://issues.apache.org/jira/browse/SOLR-4760) (Shawn Heisey)


[4.3.0] - 2013-05-06
--------------------

### Added (11 changes)

- A new collections api to add additional shards dynamically by splitting existing shards. [SOLR-3755](https://issues.apache.org/jira/browse/SOLR-3755) (yonik) (Anshum Gupta) (shalin)
- HttpSolrServer sends the stream name and exposes 'useMultiPartPost' [SOLR-4358](https://issues.apache.org/jira/browse/SOLR-4358) (Karl Wright) (ryan)
- DIH: Provide configuration to use Tika's IdentityHtmlMapper [SOLR-4530](https://issues.apache.org/jira/browse/SOLR-4530) (Alexandre Rafalovitch) (shalin)
- Provide REST API read access to all elements of the live schema. Add a REST API request to return the entire live schema, in JSON, XML, and schema.xml formats. Move REST API methods from package org.apache.solr.rest to org.apache.solr.rest.schema, and rename base functionality REST API classes to remove the current schema focus, to prepare for other non-schema REST APIs. Change output path for copyFields and dynamicFields from "copyfields" and "dynamicfields" (all lowercase) to "copyFields" and "dynamicFields", respectively, to align with all other REST API outputs, which use camelCase. [SOLR-4623](https://issues.apache.org/jira/browse/SOLR-4623) (Steve Rowe)
- PreAnalyzedUpdateProcessorFactory allows using the functionality of PreAnalyzedField with other field types. See javadoc for details and examples. [SOLR-4648](https://issues.apache.org/jira/browse/SOLR-4648) (Andrzej Bialecki)
- Added two new highlight parameters, hl.maxMultiValuedToMatch and hl.maxMultiValuedToExamine. maxMultiValuedToMatch stops looking for snippets after finding the specified number of matches, no matter how far into the multivalued field you've gone. maxMultiValuedToExamine stops looking for matches after the specified number of multiValued entries have been examined. If both are specified, the limit hit first stops the loop. Also this patch cuts down on the copying of the document entries during highlighting. These optimizations are probably unnoticeable unless there are a large number of entries in the multiValued field. Conspicuously, this will prevent the "best" match from being found if it appears later in the MV list than the cutoff specified by either of these params. [SOLR-4656](https://issues.apache.org/jira/browse/SOLR-4656) (Erick Erickson)
- In preparation for REST API requests that can modify the schema, a "managed schema" is introduced. Add '&lt;schemaFactory class="ManagedSchemaFactory" mutable="true"/&gt;' to solrconfig.xml in order to use it, and to enable schema modifications via REST API requests. [SOLR-4658](https://issues.apache.org/jira/browse/SOLR-4658) (Steve Rowe) (Robert Muir)
- Discover SolrCores by directory structure rather than defining them in solr.xml. Also, change the format of solr.xml to be closer to that of solrconfig.xml. This version of Solr will ship the example in the old style, but you can manually try the new style. Solr 4.4 will ship with the new style, and Solr 5.0 will remove support for the old style. (Erick Erickson, Mark Miller) Additional Work: - SOLR-4347: Ensure that newly-created cores via Admin handler are persisted in solr.xml (Erick Erickson) - SOLR-1905: Cores created by the admin request handler should be persisted to solr.xml. Also fixed a problem whereby properties like solr.solr.datadir would be persisted to solr.xml. Also, cores that didn't happen to be loaded were not persisted. [SOLR-4662](https://issues.apache.org/jira/browse/SOLR-4662) [SOLR-4347](https://issues.apache.org/jira/browse/SOLR-4347) [SOLR-1905](https://issues.apache.org/jira/browse/SOLR-1905) (Erick Erickson)
- CSVResponseWriter now supports pseudo fields. [SOLR-4671](https://issues.apache.org/jira/browse/SOLR-4671) (ryan) (nihed mbarek)
- Improve PostingsSolrHighlighter to support per-field/query-time overrides and add additional configuration parameters. See the javadocs for more details and examples. [SOLR-4675](https://issues.apache.org/jira/browse/SOLR-4675) (Robert Muir)
- /SOLR-1351: SimpleFacets now work with localParams allowing faceting on the same field multiple ways [SOLR-4717](https://issues.apache.org/jira/browse/SOLR-4717) [SOLR-1351](https://issues.apache.org/jira/browse/SOLR-1351) (ryan) (Uri Boness)

### Fixed (23 changes)

- Fixed SpellCheckComponent to work consistently with distributed grouping [SOLR-3758](https://issues.apache.org/jira/browse/SOLR-3758) (James Dyer)
- Fixed group.facet=true to work with negative facet.limit [SOLR-3956](https://issues.apache.org/jira/browse/SOLR-3956) (Chris van der Merwe) (hossman)
- Admin UI - admin-extra files are not rendered into the core-menu [SOLR-4405](https://issues.apache.org/jira/browse/SOLR-4405) (steffkes)
- SolrExceptions thrown by HttpSolrServer will now contain the proper HTTP status code returned by the remote server, even if that status code is not something Solr itself returned -- eg: from the Servlet Container, or an intermediate HTTP Proxy [SOLR-4487](https://issues.apache.org/jira/browse/SOLR-4487) (hossman)
- setting shardHandlerFactory in solr.xml/solr.properties does not work. [SOLR-4543](https://issues.apache.org/jira/browse/SOLR-4543) (Ryan Ernst) (Robert Muir) (Erick Erickson)
- When faceting on numeric fields in Solr 4.2, negative values (constraints) were sorted incorrectly. [SOLR-4581](https://issues.apache.org/jira/browse/SOLR-4581) (Alexander Buhr) (shalin) (yonik)
- Fix scripting engine tests to work with Java 8's "Nashorn" Javascript implementation. [SOLR-4634](https://issues.apache.org/jira/browse/SOLR-4634) (Uwe Schindler)
- If opening a reader fails for some reason when opening a SolrIndexSearcher, a Directory can be left unreleased. [SOLR-4636](https://issues.apache.org/jira/browse/SOLR-4636) (Mark Miller)
- Schema now throws exception on illegal field parameters. [SOLR-4641](https://issues.apache.org/jira/browse/SOLR-4641) (Robert Muir)
- copyField doesn't work with source globs that don't match any explicit or dynamic fields. This regression was introduced in Solr 4.2. [SOLR-4650](https://issues.apache.org/jira/browse/SOLR-4650) (Daniel Collins) (Steve Rowe)
- Fix broken behavior with shared libraries in resource loader for solr.xml plugins. [SOLR-4652](https://issues.apache.org/jira/browse/SOLR-4652) (Ryan Ernst) (Robert Muir) (Uwe Schindler)
- Admin UI Replication details now correctly displays the current replicable generation/version of the master. [SOLR-4661](https://issues.apache.org/jira/browse/SOLR-4661) (hossman)
- ZkStateReader should update aliases on construction. [SOLR-4664](https://issues.apache.org/jira/browse/SOLR-4664) (Mark Miller) (Elodie Sannier)
- Correct example spellcheck configuration's queryAnalyzerFieldType and use "text" field instead of narrower "name" field [SOLR-4680](https://issues.apache.org/jira/browse/SOLR-4680) (ehatcher) (Mark Bennett)
- CoreAdminRequest.mergeIndexes can not merge multiple cores or indexDirs. [SOLR-4682](https://issues.apache.org/jira/browse/SOLR-4682) (Jason.D.Cao) (shalin)
- Fix core admin SPLIT action to be useful with non-cloud setups [SOLR-4695](https://issues.apache.org/jira/browse/SOLR-4695) (shalin)
- The System admin handler should not assume a file system based data directory location. [SOLR-4699](https://issues.apache.org/jira/browse/SOLR-4699) (Mark Miller)
- Fix example /browse "Did you mean?" suggestion feature. [SOLR-4702](https://issues.apache.org/jira/browse/SOLR-4702) (ehatcher) (Mark Bennett)
- Fixed bug causing NPE when querying a single replica in SolrCloud using the shards param [SOLR-4705](https://issues.apache.org/jira/browse/SOLR-4705) (Raintung Li) (hossman)
- You cannot delete a collection fully from ZooKeeper unless all nodes are up and functioning correctly. [SOLR-4710](https://issues.apache.org/jira/browse/SOLR-4710) (Mark Miller)
- SolrCloud request proxying does not work on Tomcat and perhaps other non Jetty containers. [SOLR-4716](https://issues.apache.org/jira/browse/SOLR-4716) [SOLR-4584](https://issues.apache.org/jira/browse/SOLR-4584) (Po Rui) (Yago Riveiro) (Mark Miller)
- LukeRequestHandler: Using a dynamic copyField source that is not also a dynamic field triggers error message 'undefined field: "(glob)"'. [SOLR-4729](https://issues.apache.org/jira/browse/SOLR-4729) (Adam Hahn) (hossman) (Steve Rowe)
- Distributed grouping used a NamedList instead of a SimpleOrderedMap for the top level group commands, causing output formatting differences compared to non-distributed grouping. [SOLR-4746](https://issues.apache.org/jira/browse/SOLR-4746) (yonik)

### Other (11 changes)

- Ship setup to log with log4j. [SOLR-3706](https://issues.apache.org/jira/browse/SOLR-3706) (ryan) (Mark Miller)
- SolrTestCaseJ4: Can't avoid "collection1" convention [SOLR-4317](https://issues.apache.org/jira/browse/SOLR-4317) (Tricia Jenkins) (Erick Erickson)
- Refactor HttpShardHandlerFactory so load-balancing logic can be customized. [SOLR-4544](https://issues.apache.org/jira/browse/SOLR-4544) (Ryan Ernst) (Robert Muir)
- SolrZkClient#setData should return Stat object. [SOLR-4571](https://issues.apache.org/jira/browse/SOLR-4571) (Mark Miller)
- CachingDirectoryFactory should use an IdentityHashMap for byDirectoryCache. [SOLR-4603](https://issues.apache.org/jira/browse/SOLR-4603) (Mark Miller)
- Use noggit 0.5 release jar rather than a forked copy. [SOLR-4607](https://issues.apache.org/jira/browse/SOLR-4607) (Yonik Seeley) (Robert Muir)
- The hardcoded SolrCloud defaults for 'hostContext="solr"' and 'hostPort="8983"' have been deprecated and will be removed in Solr 5.0. Existing solr.xml files that do not have these options explicitly specified should be updated accordingly. [SOLR-4622](https://issues.apache.org/jira/browse/SOLR-4622) (hossman)
- Remove dist-excl-slf4j build target. [SOLR-4651](https://issues.apache.org/jira/browse/SOLR-4651) (Shawn Heisey)
- Solr configuration should log inaccessible/ non-existent relative paths in lib dir=... [SOLR-4653](https://issues.apache.org/jira/browse/SOLR-4653) (Dawid Weiss)
- Requests attempting to use SolrCores which had init failures (that would be reported by CoreAdmin STATUS requests) now result in 500 error responses with the details about the init failure, instead of 404 error responses. [SOLR-4672](https://issues.apache.org/jira/browse/SOLR-4672) (hossman)
- Make the wiki link more prominent in the release documentation. [SOLR-4730](https://issues.apache.org/jira/browse/SOLR-4730) (Uri Laserson) (Robert Muir)


[4.2.1] - 2013-04-03
--------------------

### Changed (2 changes)

- Admin UI - Optimize Caching Behaviour [SOLR-4311](https://issues.apache.org/jira/browse/SOLR-4311) (steffkes)
- waitForReplicasToComeUp should bail right away if it doesn't see the expected slice in the clusterstate rather than waiting. [SOLR-4569](https://issues.apache.org/jira/browse/SOLR-4569) (Mark Miller)

### Fixed (38 changes)

- Grouped faceting (group.facet=true) did not respect filter exclusions. [SOLR-3819](https://issues.apache.org/jira/browse/SOLR-3819) (Petter Remen) (yonik)
- Atomic update request containing null=true sets all subsequent fields to null [SOLR-4297](https://issues.apache.org/jira/browse/SOLR-4297) (Ben Pennell) (Rob) (shalin)
- NPE encountered with querying with wildcards on a field that uses the DefaultAnalyzer (i.e. no analysis chain defined). [SOLR-4318](https://issues.apache.org/jira/browse/SOLR-4318) (Erick Erickson)
- DataImportHandler would throw UnsupportedOperationException if handler-level parameters were specified containing periods in the name [SOLR-4361](https://issues.apache.org/jira/browse/SOLR-4361) (James Dyer)
- Admin UI - Analysis Screen shows empty result [SOLR-4371](https://issues.apache.org/jira/browse/SOLR-4371) (steffkes)
- Fix various places that still assume File based paths even when not using a file based DirectoryFactory. [SOLR-4475](https://issues.apache.org/jira/browse/SOLR-4475) (Mark Miller)
- Date Math expressions were being truncated to 32 characters when used in field:value queries in the lucene QParser. [SOLR-4538](https://issues.apache.org/jira/browse/SOLR-4538) (hossman) (yonik)
- CachingDirectoryFactory needs to create CacheEntry's with the fullpath not path. [SOLR-4551](https://issues.apache.org/jira/browse/SOLR-4551) (Mark Miller)
- When forceNew is used with CachingDirectoryFactory#get, the old CacheValue should give up its path as it will be used by a new Directory instance. [SOLR-4555](https://issues.apache.org/jira/browse/SOLR-4555) (Mark Miller)
- copyField source glob matching explicit field(s) stopped working in Solr 4.2. [SOLR-4567](https://issues.apache.org/jira/browse/SOLR-4567) (Alexandre Rafalovitch) (Steve Rowe)
- The lastPublished state check before becoming a leader is not working correctly. [SOLR-4568](https://issues.apache.org/jira/browse/SOLR-4568) (Mark Miller)
- Even if an explicit shard id is used, ZkController#preRegister should still wait to see the shard id in its current ClusterState. [SOLR-4570](https://issues.apache.org/jira/browse/SOLR-4570) (Mark Miller)
- Accessing Admin UI files in SolrCloud mode logs warnings. [SOLR-4573](https://issues.apache.org/jira/browse/SOLR-4573) (Mark Miller) (Phil John)
- The Collections API will silently return success on an unknown ACTION parameter. [SOLR-4574](https://issues.apache.org/jira/browse/SOLR-4574) (Mark Miller)
- Collections API validation errors should cause an exception on clients and otherwise act as validation errors with the Core Admin API. [SOLR-4576](https://issues.apache.org/jira/browse/SOLR-4576) (Mark Miller)
- The collections API should return responses (success or failure) for each node it attempts to work with. [SOLR-4577](https://issues.apache.org/jira/browse/SOLR-4577) (Mark Miller)
- CoreAdminHandler#handleCreateAction gets a SolrCore and does not close it in SolrCloud mode when a core with the same name already exists. [SOLR-4578](https://issues.apache.org/jira/browse/SOLR-4578) (Mark Miller)
- The Collections API validates numShards with &lt; 0 but should use &lt;= 0. [SOLR-4585](https://issues.apache.org/jira/browse/SOLR-4585) (Mark Miller)
- Fixed CPU spikes and poor performance in lazy field loading of multivalued fields. [SOLR-4589](https://issues.apache.org/jira/browse/SOLR-4589) (hossman)
- DefaultSolrCoreState#doRecovery needs to check the CoreContainer shutdown flag inside the recoveryLock sync block. [SOLR-4592](https://issues.apache.org/jira/browse/SOLR-4592) (Mark Miller)
- StandardDirectoryFactory#remove accesses byDirectoryCache without a lock. [SOLR-4594](https://issues.apache.org/jira/browse/SOLR-4594) (Mark Miller)
- CachingDirectoryFactory#close can throw a concurrent modification exception. [SOLR-4595](https://issues.apache.org/jira/browse/SOLR-4595) (Mark Miller)
- CachingDirectoryFactory#remove should not attempt to empty/remove the index right away but flag for removal after close. [SOLR-4597](https://issues.apache.org/jira/browse/SOLR-4597) (Mark Miller)
- The Core Admin unload command's option 'deleteDataDir', should use the DirectoryFactory API to remove the data dir. [SOLR-4598](https://issues.apache.org/jira/browse/SOLR-4598) (Mark Miller)
- CachingDirectoryFactory calls close(Directory) on forceNew if the Directory has a refCnt of 0, but it should call closeDirectory(CacheValue). [SOLR-4599](https://issues.apache.org/jira/browse/SOLR-4599) (Mark Miller)
- A Collection that is only partially created and then deleted will leave pre allocated shard information in ZooKeeper. [SOLR-4601](https://issues.apache.org/jira/browse/SOLR-4601) (Mark Miller)
- ZkController#unregister should cancel its election participation before asking the Overseer to delete the SolrCore information. [SOLR-4602](https://issues.apache.org/jira/browse/SOLR-4602) (Mark Miller)
- UpdateLog#init is over called on SolrCore#reload. [SOLR-4604](https://issues.apache.org/jira/browse/SOLR-4604) (Mark Miller)
- Rollback does not work correctly. [SOLR-4605](https://issues.apache.org/jira/browse/SOLR-4605) (Mark S) (Mark Miller)
- Update Log replay and PeerSync replay should use the default processor chain to update the index. [SOLR-4608](https://issues.apache.org/jira/browse/SOLR-4608) (Ludovic Boutros) (yonik)
- The Collections API should only send the reload command to ACTIVE cores. [SOLR-4609](https://issues.apache.org/jira/browse/SOLR-4609) (Mark Miller)
- SolrCore#reload needs to pass the deletion policy to the next SolrCore through its constructor rather than setting a field after. [SOLR-4617](https://issues.apache.org/jira/browse/SOLR-4617) (Mark Miller)
- CachingDirectoryFactory does not need to support forceNew any longer and it appears to be causing a missing close directory bug. forceNew is no longer respected and will be removed in 4.3. [SOLR-4624](https://issues.apache.org/jira/browse/SOLR-4624) (Mark Miller)
- The solr (lucene syntax) query parser lost top-level boost values and top-level phrase slops on queries produced by nested sub-parsers. [SOLR-4625](https://issues.apache.org/jira/browse/SOLR-4625) (yonik)
- Replication can sometimes wait until shutdown or core unload until removing some tmp directories. [SOLR-4637](https://issues.apache.org/jira/browse/SOLR-4637) (Mark Miller)
- DefaultSolrCoreState#getIndexWriter(null) is a way to avoid creating the IndexWriter earlier than necessary, but it's not implemented quite right. [SOLR-4638](https://issues.apache.org/jira/browse/SOLR-4638) (Mark Miller)
- CachingDirectoryFactory can fail to close directories in some race conditions. [SOLR-4640](https://issues.apache.org/jira/browse/SOLR-4640) (Mark Miller)
- QueryResultKey is not calculating the correct hashCode for filters. [SOLR-4642](https://issues.apache.org/jira/browse/SOLR-4642) (Joel Bernstein) (Mark Miller)

### Other (2 changes)

- Clean up schema information REST API. [SOLR-4537](https://issues.apache.org/jira/browse/SOLR-4537) (Steve Rowe)
- DistributedQueue should ensure its full path exists in the constructor. [SOLR-4596](https://issues.apache.org/jira/browse/SOLR-4596) (Mark Miller)


[4.2.0] - 2013-03-11
--------------------

### Added (15 changes)

- New SweetSpotSimilarityFactory allows customizable TF/IDF based Similarity when you know the optimal "Sweet Spot" of values for the field length and TF scoring factors. [SOLR-1365](https://issues.apache.org/jira/browse/SOLR-1365) (hossman)
- RegexpBoost Update Processor [SOLR-2827](https://issues.apache.org/jira/browse/SOLR-2827) (janhoy)
- Doc values support. [SOLR-3855](https://issues.apache.org/jira/browse/SOLR-3855) [SOLR-4490](https://issues.apache.org/jira/browse/SOLR-4490) (Adrien Grand) (Robert Muir)
- Add ability to get success/failure responses from Collections API. [SOLR-4043](https://issues.apache.org/jira/browse/SOLR-4043) (Raintung Li) (Mark Miller)
- Allow custom naming of SolrCloud nodes so that a new host:port combination can take over for a previous shard. [SOLR-4078](https://issues.apache.org/jira/browse/SOLR-4078) (Mark Miller)
- CurrencyField fields can now be used in a ValueSources to get the "raw" value (using the default number of fractional digits) in the default currency of the field type. There is also a new currency(field,[CODE]) function for generating a ValueSource of the "natural" value, converted to an optionally specified currency to override the default for the field type. [SOLR-4138](https://issues.apache.org/jira/browse/SOLR-4138) (hossman)
- Requests to a Collection that does not exist on the receiving node should be proxied to a suitable node. [SOLR-4210](https://issues.apache.org/jira/browse/SOLR-4210) (Mark Miller) (Po Rui) (yonik)
- Allow configuring commitWithin to do hard commits. [SOLR-4370](https://issues.apache.org/jira/browse/SOLR-4370) (Mark Miller) (Senthuran Sivananthan)
- Reopen the IndexWriter on SolrCore reload. [SOLR-4417](https://issues.apache.org/jira/browse/SOLR-4417) (Mark Miller)
- SolrJ, and SolrCloud internals, now use SystemDefaultHttpClient under the covers -- allowing many HTTP connection related properties to be controlled via 'standard' java system properties. [SOLR-4451](https://issues.apache.org/jira/browse/SOLR-4451) (hossman)
- Add support for queries (match-only) against docvalues fields. [SOLR-4477](https://issues.apache.org/jira/browse/SOLR-4477) (Robert Muir)
- SwitchQParserPlugin registered by default as 'switch' using syntax: {!switch case=XXX case.foo=YYY case.bar=ZZZ default=QQQ}foo [SOLR-4481](https://issues.apache.org/jira/browse/SOLR-4481) (hossman)
- Return slave replication details for a master if the master has also acted like a slave. [SOLR-4488](https://issues.apache.org/jira/browse/SOLR-4488) (Mark Miller)
- Add list command to ZkCLI that prints out the contents of ZooKeeper. [SOLR-4498](https://issues.apache.org/jira/browse/SOLR-4498) (Roman Shaposhnik) (Mark Miller)
- Add REST API methods, via Restlet integration, for reading schema elements, at /schema/fields/, /schema/dynamicfields/, /schema/fieldtypes/, and /schema/copyfields/. [SOLR-4503](https://issues.apache.org/jira/browse/SOLR-4503) (Steve Rowe)

### Changed (10 changes)

- Color Legend for Cloud UI [SOLR-3915](https://issues.apache.org/jira/browse/SOLR-3915) (steffkes)
- Admin UI - make core list scrollable separate from the rest of the UI [SOLR-4284](https://issues.apache.org/jira/browse/SOLR-4284) (steffkes)
- Utilize indexInfo=false when gathering core names in UI [SOLR-4306](https://issues.apache.org/jira/browse/SOLR-4306) (steffkes)
- Admin UI - Display Field-Flags on Schema-Browser [SOLR-4339](https://issues.apache.org/jira/browse/SOLR-4339) (steffkes)
- Admin UI - Analysis's Button Spinner goes wild [SOLR-4340](https://issues.apache.org/jira/browse/SOLR-4340) (steffkes)
- Admin UI - Plugins/Stats Page contains loooong Values which result in horizontal Scrollbar [SOLR-4341](https://issues.apache.org/jira/browse/SOLR-4341) (steffkes)
- Admin UI - Locale based number formatting [SOLR-4364](https://issues.apache.org/jira/browse/SOLR-4364) (steffkes)
- Stop using the 'force' option for recovery replication. This will keep some less common unnecessary replications from happening. [SOLR-4521](https://issues.apache.org/jira/browse/SOLR-4521) (Mark Miller) (Simon Scofield)
- Admin UI depends on optional system info [SOLR-4526](https://issues.apache.org/jira/browse/SOLR-4526) (Felix Buenemann via steffkes)
- Improve Admin UI Dashboard legibility [SOLR-4529](https://issues.apache.org/jira/browse/SOLR-4529) (Felix Buenemann via steffkes)

### Fixed (34 changes)

- Do not refine facets when minCount == 1 [SOLR-2850](https://issues.apache.org/jira/browse/SOLR-2850) (Matt Smith) (lundgren) (Adrien Grand)
- A restarted node can briefly appear live and active before it really is in some cases. [SOLR-3655](https://issues.apache.org/jira/browse/SOLR-3655) (Mark Miller)
- Fix copyField implementation in IndexSchema to handle dynamic field references that aren't string-equal to the name of the referenced dynamic field. [SOLR-3798](https://issues.apache.org/jira/browse/SOLR-3798) (Steve Rowe)
- Solr should support better way of finding active sorts [SOLR-3926](https://issues.apache.org/jira/browse/SOLR-3926) (Eirik Lygre via Erick Erickson)
- langid.enforceSchema option checks source field instead of target field [SOLR-3967](https://issues.apache.org/jira/browse/SOLR-3967) (janhoy)
- Term info page under schema browser shows incorrect count of terms [SOLR-4225](https://issues.apache.org/jira/browse/SOLR-4225) (steffkes)
- /browse: Improve JQuery autosuggest behavior [SOLR-4309](https://issues.apache.org/jira/browse/SOLR-4309) (janhoy)
- Collections API will sometimes use a node more than once, even when more unused nodes are available. [SOLR-4321](https://issues.apache.org/jira/browse/SOLR-4321) (Eric Falcao) (Brett Hoerner) (Mark Miller)
- group.sort is ignored when using group.truncate and ex/tag local params together [SOLR-4330](https://issues.apache.org/jira/browse/SOLR-4330) (koji)
- Fix DataImportHandler stats to be a proper Map [SOLR-4342](https://issues.apache.org/jira/browse/SOLR-4342) (hossman)
- Solr Admin UI doesn't work in IE 10 [SOLR-4345](https://issues.apache.org/jira/browse/SOLR-4345) (steffkes)
- Admin UI - Query Interface does not work in IE [SOLR-4349](https://issues.apache.org/jira/browse/SOLR-4349) (steffkes)
- /browse pagination now supports and preserves sort context [SOLR-4352](https://issues.apache.org/jira/browse/SOLR-4352) (Eric Spiegelberg) (Erik Hatcher)
- The RecentUpdates#update method should treat a problem reading the next record the same as a problem parsing the record - log the exception and break. [SOLR-4359](https://issues.apache.org/jira/browse/SOLR-4359) (Mark Miller)
- Fix concurrency issue in NamedSPILoader and AnalysisSPILoader when doing concurrent core loads in multicore Solr configs. [LUCENE-4796](https://issues.apache.org/jira/browse/LUCENE-4796) [SOLR-4373](https://issues.apache.org/jira/browse/SOLR-4373) (Uwe Schindler) (Hossman)
- Replicate after startup option would not replicate until the IndexWriter was lazily opened. [SOLR-4380](https://issues.apache.org/jira/browse/SOLR-4380) (Mark Miller) (Gregg Donovan)
- Deadlock can occur in a rare race between committing and closing a SolrIndexWriter. [SOLR-4400](https://issues.apache.org/jira/browse/SOLR-4400) (Erick Erickson) (Mark Miller)
- Fix SolrCore#getIndexDir() to return the current index directory. [SOLR-4413](https://issues.apache.org/jira/browse/SOLR-4413) (Gregg Donovan) (Mark Miller)
- On CoreContainer shutdown, all SolrCores should publish their state as DOWN. [SOLR-4421](https://issues.apache.org/jira/browse/SOLR-4421) [SOLR-4165](https://issues.apache.org/jira/browse/SOLR-4165) (Mark Miller) (Markus Jelsma)
- NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &lt;directoryFactory&gt; is not present in solrconfig.xml [SOLR-4426](https://issues.apache.org/jira/browse/SOLR-4426) (Jack Krupansky) (shalin)
- The Replication 'index move' rather than copy optimization doesn't kick in when using NRTCachingDirectory or the rate limiting feature. [SOLR-4459](https://issues.apache.org/jira/browse/SOLR-4459) (Mark Miller)
- Fix SolrCoreState reference counting. [SOLR-4463](https://issues.apache.org/jira/browse/SOLR-4463) (Mark Miller)
- Ephemeral directory implementations may not recover correctly because the code to clear the tlog files on startup is off. [SOLR-4467](https://issues.apache.org/jira/browse/SOLR-4467) (Mark Miller)
- A new IndexWriter must be opened on SolrCore reload when the index directory has changed and the previous SolrCore's state should not be propagated. [SOLR-4469](https://issues.apache.org/jira/browse/SOLR-4469) (Mark Miller) (Gregg Donovan)
- Replication occurs even when a slave is already up to date. [SOLR-4471](https://issues.apache.org/jira/browse/SOLR-4471) (Mark Miller) (Andre Charton)
- A trailing + or - caused the edismax parser to throw an exception. [SOLR-4480](https://issues.apache.org/jira/browse/SOLR-4480) (Fiona Tay) (Jan Høydahl) (yonik)
- ReplicationHandler#loadReplicationProperties still uses Files rather than the Directory to try and read the replication properties files. [SOLR-4484](https://issues.apache.org/jira/browse/SOLR-4484) (Mark Miller)
- Collection Aliasing. [SOLR-4497](https://issues.apache.org/jira/browse/SOLR-4497) (Mark Miller)
- Fixed CurrencyField range queries to correctly exclude documents w/o values [SOLR-4504](https://issues.apache.org/jira/browse/SOLR-4504) (hossman)
- Possible deadlock around SolrCoreState update lock. [SOLR-4505](https://issues.apache.org/jira/browse/SOLR-4505) (Erick Erickson) (Mark Miller)
- The Cloud tab does not show up in the Admin UI if you set zkHost in solr.xml. [SOLR-4507](https://issues.apache.org/jira/browse/SOLR-4507) (Alfonso Presa) (Mark Miller)
- When a new index is replicated into place, we need to update the most recent replicatable index point without doing a commit. This is important for repeater use cases, as well as when nodes may switch master/slave roles. [SOLR-4511](https://issues.apache.org/jira/browse/SOLR-4511) (Mark Miller) (Raúl Grande)
- CurrencyField's OpenExchangeRatesOrgProvider now requires a ratesFileLocation init param, since the previous global default no longer works [SOLR-4515](https://issues.apache.org/jira/browse/SOLR-4515) (hossman)
- Improved CurrencyField error messages when attempting to use a Currency that is not supported by the current JVM. [SOLR-4518](https://issues.apache.org/jira/browse/SOLR-4518) (hossman)

### Other (15 changes)

- Added more tests for VelocityResponseWriter [SOLR-2470](https://issues.apache.org/jira/browse/SOLR-2470) 
- A bare * without a field specification is treated as *:* by the lucene and edismax query parsers. [SOLR-2996](https://issues.apache.org/jira/browse/SOLR-2996) (hossman) (Jan Høydahl) (Alan Woodward) (yonik)
- SurroundQParserPlugin highlighting tests [SOLR-3060](https://issues.apache.org/jira/browse/SOLR-3060) (Ahmet Arslan) (hossman)
- Include lucene codecs jar and enable per-field postings and docvalues support in the schema.xml [SOLR-3843](https://issues.apache.org/jira/browse/SOLR-3843) (Robert Muir) (Steve Rowe)
- Reduce INFO level logging from CachingDirectoryFactory [SOLR-4200](https://issues.apache.org/jira/browse/SOLR-4200) (Shawn Heisey) (hossman)
- Carrot2 dependency should be declared on the mini version, not the core. [SOLR-4259](https://issues.apache.org/jira/browse/SOLR-4259) (Dawid Weiss)
- Make the lock type configurable by system property by default. [SOLR-4348](https://issues.apache.org/jira/browse/SOLR-4348) (Mark Miller)
- Renamed example jetty context file to reduce confusion [SOLR-4353](https://issues.apache.org/jira/browse/SOLR-4353) (hossman)
- Make post.jar report timing information [SOLR-4384](https://issues.apache.org/jira/browse/SOLR-4384) (Upayavira) (janhoy)
- Tests and example configs demonstrating SSL with both server and client certs [SOLR-4394](https://issues.apache.org/jira/browse/SOLR-4394) (hossman)
- Add 'state' to shards (default to 'active') and read/write them to ZooKeeper [SOLR-4415](https://issues.apache.org/jira/browse/SOLR-4415) (Anshum Gupta) (shalin)
- Upgrade to Tika 1.3. [SOLR-4416](https://issues.apache.org/jira/browse/SOLR-4416) (Markus Jelsma) (Mark Miller)
- Sort directions (asc, desc) are now case insensitive [SOLR-4458](https://issues.apache.org/jira/browse/SOLR-4458) (Shawn Heisey) (hossman)
- Improve and clean up TestReplicationHandler. [SOLR-4471](https://issues.apache.org/jira/browse/SOLR-4471) (Amit Nithian) (Mark Miller)
- Add new test for 'repeater' replication node. [SOLR-4511](https://issues.apache.org/jira/browse/SOLR-4511) (Mark Miller)


[4.1.0] - 2013-01-22
--------------------

### Added (35 changes)

- The ability to specify "transient" and "loadOnStartup" as a new properties of &lt;core&gt; tags in solr.xml. Can specify "transientCacheSize" in the &lt;cores&gt; tag. Together these allow cores to be loaded only when needed and only transientCacheSize transient cores will be loaded at a time, the rest aged out on an LRU basis. [SOLR-1028](https://issues.apache.org/jira/browse/SOLR-1028) 
- Add extra statistics to RequestHandlers - 5 & 15-minute reqs/sec rolling averages; median, 75th, 95th, 99th, 99.9th percentile request times [SOLR-1972](https://issues.apache.org/jira/browse/SOLR-1972) (Alan Woodward) (Shawn Heisey) (Adrien Grand) (Uwe Schindler)
- DIH's "formatDate" function now supports a timezone as an optional fourth parameter [SOLR-2201](https://issues.apache.org/jira/browse/SOLR-2201) (James Dyer) (Mark Waddle)
- Enhanced pivot faceting to use local-params in the same way that regular field value faceting can. This means support for excluding a filter query, using a different output key, and specifying 'threads' to do facet.method=fcs concurrently. PivotFacetHelper now extends SimpleFacet and the getFacetImplementation() extension hook was removed. [SOLR-2255](https://issues.apache.org/jira/browse/SOLR-2255) (dsmiley)
- Collection specific document routing. The "compositeId" router is the default for collections with hash based routing (i.e. when numShards=N is specified on collection creation). Documents with ids sharing the same domain (prefix) will be routed to the same shard, allowing for efficient querying. Example: The following two documents will be indexed to the same shard since they share the same domain "customerB!". &lt;code&gt; {"id" : "customerB!doc1" [...] } {"id" : "customerB!doc2" [...] } &lt;/code&gt; At query time, one can specify a "shard.keys" parameter that lists what shards the query should cover. http://.../query?q=my_query&shard.keys=customerB! Collections that do not specify numShards at collection creation time use custom sharding and default to the "implicit" router. Document updates received by a shard will be indexed to that shard, unless a "_shard_" parameter or document field names a different shard. [SOLR-2592](https://issues.apache.org/jira/browse/SOLR-2592) (Michael Garski) (Dan Rosher) (yonik)
- Allowing configuring maxMergeSizeMB and maxCachedMB when using NRTCachingDirectoryFactory. [SOLR-3531](https://issues.apache.org/jira/browse/SOLR-3531) (Andy Laird) (Mark Miller)
- A highlighter parameter "hl.preserveMulti" to return all of the values of a multiValued field in their original order when highlighting. [SOLR-3897](https://issues.apache.org/jira/browse/SOLR-3897) (Joel Bernstein) (yonik)
- Add support for AnalyzingSuggester (LUCENE-3842), where the underlying analyzed form used for suggestions is separate from the returned text. [SOLR-3906](https://issues.apache.org/jira/browse/SOLR-3906) [LUCENE-3842](https://issues.apache.org/jira/browse/LUCENE-3842) (Robert Muir)
- Make Directory and DirectoryFactory first class so that the majority of Solr's features work with any custom implementations. (Mark Miller) Additional Work: - SOLR-4032: Files larger than an internal buffer size fail to replicate. (Mark Miller, Markus Jelsma) - SOLR-4033: Consistently use the solrconfig.xml lockType everywhere. (Mark Miller, Markus Jelsma) - SOLR-4144: Replication using too much RAM. (yonik, Markus Jelsma) - SOLR-4187: NPE on Directory release [SOLR-3911](https://issues.apache.org/jira/browse/SOLR-3911) [SOLR-4032](https://issues.apache.org/jira/browse/SOLR-4032) [SOLR-4033](https://issues.apache.org/jira/browse/SOLR-4033) [SOLR-4144](https://issues.apache.org/jira/browse/SOLR-4144) [SOLR-4187](https://issues.apache.org/jira/browse/SOLR-4187) (Mark Miller) (Markus Jelsma)
- Support configuring IndexWriter max thread count in solrconfig. [SOLR-3929](https://issues.apache.org/jira/browse/SOLR-3929) (phunt) (Mark Miller)
- Calculate/display deleted documents in admin interface. [SOLR-3948](https://issues.apache.org/jira/browse/SOLR-3948) (Shawn Heisey) (Mark Miller)
- SystemInfoHandler now exposes more details about the JRE/VM/Java version in use. [SOLR-3970](https://issues.apache.org/jira/browse/SOLR-3970) (hossman)
- ExternalFileField caches can be reloaded on firstSearcher/ newSearcher events using the ExternalFileFieldReloader [SOLR-3985](https://issues.apache.org/jira/browse/SOLR-3985) (Alan Woodward)
- When using ZK chroot, it would be nice if Solr would create the initial path when it doesn't exist. [SOLR-4028](https://issues.apache.org/jira/browse/SOLR-4028) (Tomás Fernández Löbbe) (Mark Miller)
- Allow rate limiting Directory IO based on the IO context. [SOLR-4030](https://issues.apache.org/jira/browse/SOLR-4030) (Mark Miller) (Radim Kolar)
- Add &lt;propertyWriter /&gt; element to DIH's data-config.xml file, allowing the user to specify the location, filename and Locale for the "data-config.properties" file. Alternatively, users can specify their own property writer implementation for greater control. This new configuration element is optional, and defaults mimic prior behavior. The one exception is that the "root" locale is default. Previously it was the machine's default locale. [SOLR-4051](https://issues.apache.org/jira/browse/SOLR-4051) (James Dyer)
- Add FuzzyLookupFactory, which is like AnalyzingSuggester except that it can tolerate typos in the input. [SOLR-4084](https://issues.apache.org/jira/browse/SOLR-4084) (Areek Zillur) (Robert Muir)
- Add MAX_DOC_FREQ option to MoreLikeThis. [SOLR-4087](https://issues.apache.org/jira/browse/SOLR-4087) (Andrew Janowczyk) (Mark Miller)
- New and improved auto host detection strategy for SolrCloud. [SOLR-4088](https://issues.apache.org/jira/browse/SOLR-4088) (Raintung Li) (Mark Miller)
- Solr QParsers may now be directly invoked in the lucene query syntax without the _query_ magic field hack. Example: foo AND {!term f=myfield v=$qq} [SOLR-4093](https://issues.apache.org/jira/browse/SOLR-4093) (yonik)
- Add support for storing term offsets in the index via a 'storeOffsetsWithPositions' flag on field definitions in the schema. [SOLR-4101](https://issues.apache.org/jira/browse/SOLR-4101) (Tom Winch) (Alan Woodward)
- Configurable Content-Type headers for PHPResponseWriters and PHPSerializedResponseWriter. [SOLR-4110](https://issues.apache.org/jira/browse/SOLR-4110) (Dominik Siebel) (Mark Miller)
- Allow creating more than one shard per instance with the Collection API. [SOLR-4114](https://issues.apache.org/jira/browse/SOLR-4114) (Per Steffensen) (Mark Miller)
- Fix replicationFactor to align with industry usage. replicationFactor now means the total number of copies of a document stored in the collection (or the total number of physical indexes for a single logical slice of the collection). For example if replicationFactor=3 then for a given shard there will be a total of 3 replicas (one of which will normally be designated as the leader.) [SOLR-4118](https://issues.apache.org/jira/browse/SOLR-4118) (yonik)
- Collection API: Support for specifying a list of Solr addresses to spread a new collection across. [SOLR-4120](https://issues.apache.org/jira/browse/SOLR-4120) (Per Steffensen) (Mark Miller)
- You should be able to set the update log directory with the CoreAdmin API the same way as the data directory. [SOLR-4124](https://issues.apache.org/jira/browse/SOLR-4124) (Mark Miller)
- Allow access to the collections API through CloudSolrServer without referencing an existing collection. [SOLR-4140](https://issues.apache.org/jira/browse/SOLR-4140) (Per Steffensen) (Mark Miller)
- LBHttpSolrServer ignores ResponseParser passed in constructor. [SOLR-4166](https://issues.apache.org/jira/browse/SOLR-4166) (Steve Molloy) (Mark Miller)
- The new Solr 4 spatial fields now work with the {!geofilt} and {!bbox} query parsers. The score local-param works too. [SOLR-4230](https://issues.apache.org/jira/browse/SOLR-4230) (David Smiley)
- When update.distrib is set to skip update processors before the distributed update processor, always include the log update processor so forwarded updates will still be logged. [SOLR-4246](https://issues.apache.org/jira/browse/SOLR-4246) (yonik)
- The new Solr 4 spatial fields now have a 'filter' boolean local-param that can be set to false to not filter. It's useful when there is already a spatial filter query but you also need to sort or boost by distance. [SOLR-4255](https://issues.apache.org/jira/browse/SOLR-4255) (David Smiley)
- Solr now parses request parameters (in URL or sent with POST using content-type application/x-www-form-urlencoded) in its dispatcher code. It no longer relies on special configuration settings in Tomcat or other web containers to enable UTF-8 encoding, which is mandatory for correct Solr behaviour. Query strings passed in via the URL need to be properly-%-escaped, UTF-8 encoded bytes, otherwise Solr refuses to handle the request. The maximum length of x-www-form-urlencoded POST parameters can now be configured through the requestDispatcher/requestParsers/@formdataUploadLimitInKB setting in solrconfig.xml (defaults to 2 MiB). Solr now works out of the box with e.g. Tomcat, JBoss,... [SOLR-4265](https://issues.apache.org/jira/browse/SOLR-4265) [SOLR-4283](https://issues.apache.org/jira/browse/SOLR-4283) (Uwe Schindler) (Dawid Weiss) (Alex Rocher)
- Add support for PostingsHighlighter. [SOLR-4271](https://issues.apache.org/jira/browse/SOLR-4271) (Robert Muir)
- New parameter 'indexInfo' (defaults to true) in CoreAdmin STATUS command can be used to omit index specific information [SOLR-4302](https://issues.apache.org/jira/browse/SOLR-4302) (Shahar Davidson) (shalin)
- Distributed search support for MLT. [SOLR-788](https://issues.apache.org/jira/browse/SOLR-788) (Matthew Woytowitz) (Mike Anderson) (Jamie Johnson) (Mark Miller)

### Changed (15 changes)

- Allow multiple Items to stay open on Plugins-Page [SOLR-3458](https://issues.apache.org/jira/browse/SOLR-3458) (steffkes)
- Fix XML parsing in XPathEntityProcessor to correctly expand named entities, but ignore external entities. [SOLR-3614](https://issues.apache.org/jira/browse/SOLR-3614) (uschindler) (hossman)
- Improve Schema-Browser Handling for CopyField using dynamicField's [SOLR-3734](https://issues.apache.org/jira/browse/SOLR-3734) (steffkes)
- Admin Cores UI should redirect to newly created core details [SOLR-3788](https://issues.apache.org/jira/browse/SOLR-3788) (steffkes)
- XML query response display is unreadable in Solr Admin Query UI [SOLR-3840](https://issues.apache.org/jira/browse/SOLR-3840) (steffkes)
- create a new core/delete an existing core should also update the main/left list of cores on the admin UI [SOLR-3851](https://issues.apache.org/jira/browse/SOLR-3851) (steffkes)
- XML and XSLT UpdateRequestHandler should not try to resolve external entities. This improves speed of loading e.g. XSL-transformed XHTML documents. [SOLR-3895](https://issues.apache.org/jira/browse/SOLR-3895) (Martin Herfurt) (uschindler) (hossman)
- The "commitOnLeader" part of distributed recovery can use openSearcher=false. [SOLR-3941](https://issues.apache.org/jira/browse/SOLR-3941) (Tomás Fernández Löbbe) (Mark Miller)
- Admin UI: Various Dataimport Improvements [SOLR-3982](https://issues.apache.org/jira/browse/SOLR-3982) (steffkes)
- Allow CoreContainer to load multiple SolrCores in parallel rather than just serially. [SOLR-4063](https://issues.apache.org/jira/browse/SOLR-4063) (Mark Miller)
- When doing zk retries due to connection loss, rather than just retrying for 2 minutes, retry in proportion to the session timeout. [SOLR-4199](https://issues.apache.org/jira/browse/SOLR-4199) (Mark Miller)
- Percentage Infos on Dashboard have a fixed width [SOLR-4261](https://issues.apache.org/jira/browse/SOLR-4261) (steffkes)
- Replication Icon on Dashboard does not reflect Master-/Slave- State [SOLR-4262](https://issues.apache.org/jira/browse/SOLR-4262) (steffkes)
- Missing Error-Screen on UI's Cloud-Page [SOLR-4264](https://issues.apache.org/jira/browse/SOLR-4264) (steffkes)
- Admin UI: Improve Dataimport Auto-Refresh [SOLR-4296](https://issues.apache.org/jira/browse/SOLR-4296) (steffkes)

### Fixed (83 changes)

- Databases that require a commit to be issued before closing the connection on a non-read-only database leak connections. Also expanded the SqlEntityProcessor test to sometimes use Derby as well as HSQLDB (Derby is one db affected by this bug). [SOLR-2045](https://issues.apache.org/jira/browse/SOLR-2045) (Fenlor Sebastia) (James Dyer)
- Updated JavaDoc for SolrDocument.addField and SolrInputDocument.addField to have more information on name and value parameters. [SOLR-2298](https://issues.apache.org/jira/browse/SOLR-2298) (Siva Natarajan)
- Fixed a bug that prevented omitNorms and omitTermFreqAndPositions options from being respected in some &lt;fieldType/&gt; declarations [SOLR-2890](https://issues.apache.org/jira/browse/SOLR-2890) (hossman)
- Handle different types of Exception Messages for Logging UI [SOLR-3560](https://issues.apache.org/jira/browse/SOLR-3560) (steffkes)
- Edismax parser does not honor mm parameter if analyzer splits a token. [SOLR-3589](https://issues.apache.org/jira/browse/SOLR-3589) (Tom Burton-West) (Robert Muir)
- Commit Status at Core-Admin UI is always false [SOLR-3637](https://issues.apache.org/jira/browse/SOLR-3637) (steffkes)
- Solr Admin Query form is missing some edismax request parameters [SOLR-3820](https://issues.apache.org/jira/browse/SOLR-3820) (steffkes)
- Admin UI Logging events broken if schema.xml defines a catch-all dynamicField with type ignored [SOLR-3829](https://issues.apache.org/jira/browse/SOLR-3829) (steffkes)
- DIH would not populate multivalued fields if the column name derives from a resolved variable [SOLR-3842](https://issues.apache.org/jira/browse/SOLR-3842) (James Dyer)
- Solr Admin UI is completely dysfunctional on IE 9 [SOLR-3876](https://issues.apache.org/jira/browse/SOLR-3876) (steffkes)
- Partial State on Schema-Browser UI is not defined for Dynamic Fields & Types [SOLR-3917](https://issues.apache.org/jira/browse/SOLR-3917) (steffkes)
- Fixed the 'dist-war-excl-slf4j' ant target to exclude all slf4j jars, so that the resulting war is usable as is provided the servlet container includes the correct slf4j api and impl jars. [SOLR-3918](https://issues.apache.org/jira/browse/SOLR-3918) (Shawn Heisey) (hossman)
- Fix server list caching in CloudSolrServer when using more than one collection list with the same instance. [SOLR-3920](https://issues.apache.org/jira/browse/SOLR-3920) (Grzegorz Sobczyk) (Mark Miller)
- Distributed commits are not guaranteed to be ordered within a request. [SOLR-3933](https://issues.apache.org/jira/browse/SOLR-3933) (Mark Miller)
- prepareCommit command omits commitData causing a failure to trigger replication to slaves. [SOLR-3938](https://issues.apache.org/jira/browse/SOLR-3938) (yonik)
- An empty or just replicated index cannot become the leader of a shard after a leader goes down. [SOLR-3939](https://issues.apache.org/jira/browse/SOLR-3939) (Joel Bernstein) (yonik) (Mark Miller)
- Consider a sync attempt from leader to replica that fails due to 404 a success. [SOLR-3939](https://issues.apache.org/jira/browse/SOLR-3939) (Mark Miller) (Joel Bernstein)
- Rejoining the leader election incorrectly triggers the code path for a fresh cluster start rather than fail over. [SOLR-3940](https://issues.apache.org/jira/browse/SOLR-3940) (Mark Miller)
- Ensure the internal comma separator of poly fields is escaped for CSVResponseWriter. [SOLR-3959](https://issues.apache.org/jira/browse/SOLR-3959) (Areek Zillur) (Robert Muir)
- Fixed a bug where Distributed Grouping ignored PostFilters [SOLR-3960](https://issues.apache.org/jira/browse/SOLR-3960) (Nathan Visagan) (hossman)
- Fixed error using LimitTokenCountFilterFactory [SOLR-3961](https://issues.apache.org/jira/browse/SOLR-3961) (Jack Krupansky) (hossman)
- A collection that is created with numShards=1 turns into a numShards=2 collection after starting up a second core and not specifying numShards. [SOLR-3971](https://issues.apache.org/jira/browse/SOLR-3971) (Mark Miller)
- Fix ShowFileRequestHandler to not log a warning in the (expected) situation of a file not found. [SOLR-3972](https://issues.apache.org/jira/browse/SOLR-3972) (hossman)
- Fixed bug that resulted in document boosts being compounded in &lt;copyField/&gt; destination fields. [SOLR-3981](https://issues.apache.org/jira/browse/SOLR-3981) (hossman)
- Fixed SolrTestCaseJ4.adoc(SolrInputDocument) to respect field and document boosts [SOLR-3988](https://issues.apache.org/jira/browse/SOLR-3988) (hossman)
- SolrZkClient constructor dropped exception cause when throwing a new RuntimeException. [SOLR-3989](https://issues.apache.org/jira/browse/SOLR-3989) (Colin Bartolome) (yonik)
- QuerySenderListener doesn't populate document cache. [SOLR-3992](https://issues.apache.org/jira/browse/SOLR-3992) (Shotaro Kamio) (yonik)
- If multiple SolrCore's for a shard coexist on a node, on cluster restart, leader election would stall until timeout, waiting to see all of the replicas come up. [SOLR-3993](https://issues.apache.org/jira/browse/SOLR-3993) (Mark Miller) (Alexey Kudinov)
- Recovery may never finish on SolrCore shutdown if the last reference to a SolrCore is closed by the recovery process. [SOLR-3995](https://issues.apache.org/jira/browse/SOLR-3995) (Mark Miller)
- Atomic update on uniqueKey field itself causes duplicate document. [SOLR-3998](https://issues.apache.org/jira/browse/SOLR-3998) (Eric Spencer) (yonik)
- In CachingDirectoryFactory#close, if there are still refs for a Directory outstanding, we need to wait for them to be released before closing. [SOLR-4001](https://issues.apache.org/jira/browse/SOLR-4001) (Mark Miller)
- The SolrZKClient clean method should not try and clear zk paths that start with /zookeeper, as this can fail and stop the removal of further nodes. [SOLR-4003](https://issues.apache.org/jira/browse/SOLR-4003) (Mark Miller)
- If CoreContainer fails to register a created core, it should close it. [SOLR-4005](https://issues.apache.org/jira/browse/SOLR-4005) (Mark Miller)
- Morfologik dictionaries not available in Solr field type due to class loader lookup problems. [SOLR-4007](https://issues.apache.org/jira/browse/SOLR-4007) (Lance Norskog) (Dawid Weiss)
- OverseerCollectionProcessor is not resilient to many error conditions and can stop running on errors. [SOLR-4009](https://issues.apache.org/jira/browse/SOLR-4009) (Raintung Li) (milesli) (Mark Miller)
- Log stack traces for 503/Service Unavailable SolrException if not thrown by PingRequestHandler. Do not log exceptions if a user tries to view a hidden file using ShowFileRequestHandler. [SOLR-4019](https://issues.apache.org/jira/browse/SOLR-4019) (Tomás Fernández Löbbe) (James Dyer)
- Upgrade to Jetty 8.1.7 to fix a bug where in very rare occasions the content of two concurrent requests get mixed up. [SOLR-4031](https://issues.apache.org/jira/browse/SOLR-4031) (Per Steffensen) (yonik)
- Check if a collection already exists before trying to create a new one. [SOLR-4034](https://issues.apache.org/jira/browse/SOLR-4034) (Po Rui) (Mark Miller)
- field aliases in fl should not cause properties of target field to be used. [SOLR-4036](https://issues.apache.org/jira/browse/SOLR-4036) (Martin Koch) (yonik)
- SOLR admin page returns HTTP 404 on core names containing a '.' (dot) [SOLR-4045](https://issues.apache.org/jira/browse/SOLR-4045) (steffkes)
- Fix a thread safety issue with the Collections API that could cause actions to be targeted at the wrong SolrCores. [SOLR-4055](https://issues.apache.org/jira/browse/SOLR-4055) (Raintung Li) (Per Steffensen) (Mark Miller)
- ReplicationHandler can try and do a snappull and open a new IndexWriter after shutdown has already occurred, leaving an IndexWriter that is not closed. [SOLR-4060](https://issues.apache.org/jira/browse/SOLR-4060) (Mark Miller)
- When there is an unexpected exception while trying to run the new leader process, the SolrCore will not correctly rejoin the election. [SOLR-4064](https://issues.apache.org/jira/browse/SOLR-4064) (Po Rui) (Mark Miller)
- Validate that name is pass to Collections API create, and behave the same way as on startup when collection.configName is not explicitly passed. [SOLR-4071](https://issues.apache.org/jira/browse/SOLR-4071) (Po Rui) (Mark Miller)
- A logical shard that has had all of its SolrCores unloaded should be removed from the cluster state. [SOLR-4075](https://issues.apache.org/jira/browse/SOLR-4075) (Mark Miller) (Gilles Comeau)
- SolrQueryParser should run fuzzy terms through MultiTermAwareComponents to ensure that (for example) a fuzzy query of foobar~2 is equivalent to FooBar~2 on a field that includes lowercasing. [SOLR-4076](https://issues.apache.org/jira/browse/SOLR-4076) (yonik)
- Long core names break web gui appearance and functionality [SOLR-4079](https://issues.apache.org/jira/browse/SOLR-4079) (steffkes)
- QueryParsing.toString, used during debugQuery=true, did not correctly handle ExtendedQueries such as WrappedQuery (used when cache=false), spatial queries, and frange queries. [SOLR-4081](https://issues.apache.org/jira/browse/SOLR-4081) (Eirik Lygre) (yonik)
- Race can cause NPE in logging line on first cluster state update. [SOLR-4097](https://issues.apache.org/jira/browse/SOLR-4097) (Mark Miller)
- Allow the collection api work queue to make forward progress even when its watcher is not fired for some reason. [SOLR-4099](https://issues.apache.org/jira/browse/SOLR-4099) (Raintung Li) (Mark Miller)
- Fix UI javascript error if canonical hostname can not be resolved [SOLR-4102](https://issues.apache.org/jira/browse/SOLR-4102) (steffkes) (hossman)
- Fixed DataImportHandler ZKAwarePropertiesWriter implementation so import works fine with SolrCloud clusters [SOLR-4112](https://issues.apache.org/jira/browse/SOLR-4112) (Deniz Durmus) (James Dyer) (Erick Erickson) (shalin)
- Retrieving the size of the index may use the wrong index dir if you are replicating. [SOLR-4117](https://issues.apache.org/jira/browse/SOLR-4117) (Mark Miller) (Markus Jelsma)
- Added explicit error message if users attempt Atomic document updates with either updateLog or DistribUpdateProcessor. [SOLR-4127](https://issues.apache.org/jira/browse/SOLR-4127) (hossman)
- Cannot "set" field to null with partial updates when using the standard RequestWriter. [SOLR-4133](https://issues.apache.org/jira/browse/SOLR-4133) (Will Butler) (shalin)
- Standard (XML) request writer cannot "set" multiple values into multivalued field with partial updates. [SOLR-4134](https://issues.apache.org/jira/browse/SOLR-4134) (Luis Cappa Banda) (Will Butler) (shalin)
- Fix SolrCloud behavior when using "hostContext" containing "_" or"/" characters. This fix also makes SolrCloud more accepting of hostContext values with leading/trailing slashes. [SOLR-4136](https://issues.apache.org/jira/browse/SOLR-4136) (hossman)
- When a core is registering in ZooKeeper it may not wait long enough to find the leader due to how long the potential leader waits to see replicas. [SOLR-4158](https://issues.apache.org/jira/browse/SOLR-4158) (Mark Miller) (Alain Rogister)
- When we are starting a shard from rest, a potential leader should not consider its last published state when deciding if it can be the new leader. [SOLR-4159](https://issues.apache.org/jira/browse/SOLR-4159) (Mark Miller)
- ZkCli usage examples are not correct because the zkhost parameter is not present and it is mandatory for all commands. [SOLR-4162](https://issues.apache.org/jira/browse/SOLR-4162) (Tomás Fernández Löbbe) (Mark Miller)
- Ensure we are using the absolute latest index dir when getting list of files for replication. [SOLR-4168](https://issues.apache.org/jira/browse/SOLR-4168) (Mark Miller)
- The 'backup' ReplicationHandler command can sometimes use a stale index directory rather than the current one. [SOLR-4170](https://issues.apache.org/jira/browse/SOLR-4170) (Mark Miller) (Marcin Rzewucki)
- CachingDirectoryFactory should not return any directories after it has been closed. [SOLR-4171](https://issues.apache.org/jira/browse/SOLR-4171) (Mark Miller)
- SearchComponent chain can't contain two components of the same class and use debugQuery. [SOLR-4175](https://issues.apache.org/jira/browse/SOLR-4175) (Tomás Fernández Löbbe) (ehatcher)
- analysis ui: javascript not properly handling URL decoding of input [SOLR-4176](https://issues.apache.org/jira/browse/SOLR-4176) (steffkes)
- ReplicationHandler should abort any current pulls and wait for its executor to stop during core close. [SOLR-4178](https://issues.apache.org/jira/browse/SOLR-4178) (Mark Miller)
- OverseerCollectionProcessor should implement ClosableThread. [SOLR-4198](https://issues.apache.org/jira/browse/SOLR-4198) (Mark Miller)
- Directories that are not shutdown until DirectoryFactory#close do not have close listeners called on them. [SOLR-4213](https://issues.apache.org/jira/browse/SOLR-4213) (Mark Miller)
- post.jar no longer ignores -Dparams when -Durl is used. [SOLR-4217](https://issues.apache.org/jira/browse/SOLR-4217) (Alexandre Rafalovitch) (ehatcher)
- "maxFormContentSize" in jetty.xml is not picked up by jetty 8 so set it via solr webapp context file. [SOLR-4223](https://issues.apache.org/jira/browse/SOLR-4223) (shalin)
- Fix jetty example requestLog config [SOLR-4238](https://issues.apache.org/jira/browse/SOLR-4238) (jm) (hossman)
- When coming back from session expiration we should not wait for the leader to see us in the down state if we are the node that must become the leader. [SOLR-4244](https://issues.apache.org/jira/browse/SOLR-4244) (Mark Miller)
- When a core is registering with ZooKeeper, the timeout to find the leader in the cluster state is 30 seconds rather than leaderVoteWait + extra time. [SOLR-4245](https://issues.apache.org/jira/browse/SOLR-4245) (Mark Miller)
- Fix SynonymFilterFactory when an optional tokenizerFactory is supplied. [SOLR-4251](https://issues.apache.org/jira/browse/SOLR-4251) (Chris Bleakley) (rmuir)
- Misleading resource loading warning from Carrot2 clustering component fixed [SOLR-4253](https://issues.apache.org/jira/browse/SOLR-4253) (Stanisław Osiński)
- PeerSync updates and Log Replay updates should not wait for a ZooKeeper connection in order to proceed. [SOLR-4257](https://issues.apache.org/jira/browse/SOLR-4257) (yonik)
- Incorrect Link from Schema-Browser to Query From for Top-Terms [SOLR-4263](https://issues.apache.org/jira/browse/SOLR-4263) (steffkes)
- HttpSolrServer does not release connection properly on exception when no response parser is used. [SOLR-4266](https://issues.apache.org/jira/browse/SOLR-4266) (Steve Molloy) (Mark Miller)
- Fix TrieTokenizer to no longer throw StringIndexOutOfBoundsException in admin UI / AnalysisRequestHandler when you enter no number to tokenize. [SOLR-4275](https://issues.apache.org/jira/browse/SOLR-4275) (Uwe Schindler)
- Wrong exception message if _version_ field is multivalued [SOLR-4279](https://issues.apache.org/jira/browse/SOLR-4279) (shalin)
- Improve logging for FileDataSource (basePath, relative resources). [SOLR-4288](https://issues.apache.org/jira/browse/SOLR-4288) (Dawid Weiss)
- Harden the Overseer work queue thread loop. [SOLR-4291](https://issues.apache.org/jira/browse/SOLR-4291) (Mark Miller)
- On replication, if the generation of the master is lower than the slave we need to force a full copy of the index. [SOLR-4303](https://issues.apache.org/jira/browse/SOLR-4303) (Mark Miller) (Gregg Donovan)

### Other (29 changes)

- DIH to not use Lucene-forbidden Java APIs (default encoding, locale, etc.) [SOLR-1916](https://issues.apache.org/jira/browse/SOLR-1916) (James Dyer) (Robert Muir)
- Better test coverage for Evaluators [SOLR-2141](https://issues.apache.org/jira/browse/SOLR-2141) (James Dyer)
- Add MoreLikeThis to warning about features that require uniqueKey. Also, change the warning to warn log level. [SOLR-2986](https://issues.apache.org/jira/browse/SOLR-2986) (Shawn Heisey) (Mark Miller)
- Upgrade Carrot2 to 3.6.2 [SOLR-3279](https://issues.apache.org/jira/browse/SOLR-3279) (Stanisław Osiński)
- Update ZooKeeper to 3.4.5 [SOLR-3602](https://issues.apache.org/jira/browse/SOLR-3602) (Mark Miller)
- Relocate the example mime-to-extension mapping, and upgrade Velocity Engine to 1.7 [SOLR-3735](https://issues.apache.org/jira/browse/SOLR-3735) (ehatcher)
- New tests for SqlEntityProcessor/CachedSqlEntityProcessor [SOLR-3856](https://issues.apache.org/jira/browse/SOLR-3856) (James Dyer)
- Refactor SolrCoreState so that it's managed by SolrCore. [SOLR-3861](https://issues.apache.org/jira/browse/SOLR-3861) (Mark Miller) (hossman)
- SolrCore should not log at warning level when the index directory changes - it's an info event. [SOLR-3899](https://issues.apache.org/jira/browse/SOLR-3899) (Tobias Bergman) (Mark Miller)
- SolrCmdDistributorTest either takes 3 seconds or 3 minutes. [SOLR-3932](https://issues.apache.org/jira/browse/SOLR-3932) (yonik) (Mark Miller)
- Eliminate superfluous warning from LanguageIdentifierUpdateProcessor [SOLR-3966](https://issues.apache.org/jira/browse/SOLR-3966) (Markus Jelsma) (hossman)
- Deduplication does not work with atomic/partial updates so disallow atomic update requests which change signature generating fields. [SOLR-4016](https://issues.apache.org/jira/browse/SOLR-4016) (Joel Nothman) (yonik) (shalin)
- The update log location in solrconfig.xml should default to ${solr.ulog.dir} rather than ${solr.data.dir:} [SOLR-4062](https://issues.apache.org/jira/browse/SOLR-4062) (Mark Miller)
- ZkStateReader#getLeaderProps should not return props for a leader that it does not think is live. [SOLR-4067](https://issues.apache.org/jira/browse/SOLR-4067) (Mark Miller)
- Raise default ramBufferSizeMB to 100 from 32. [SOLR-4074](https://issues.apache.org/jira/browse/SOLR-4074) (yonik) (Mark Miller)
- DIH refactor of VariableResolver and Evaluator. VariableResolver and each built-in Evaluator are separate concrete classes. DateFormatEvaluator now defaults with the ROOT Locale. However, users may specify a different Locale using an optional new third parameter. [SOLR-4086](https://issues.apache.org/jira/browse/SOLR-4086) (James Dyer)
- DIH NumberFormatTransformer & DateFormatTransformer default to the ROOT Locale if none is specified. These previously used the machine's default. [SOLR-4095](https://issues.apache.org/jira/browse/SOLR-4095) (James Dyer)
- DIH FileDataSource & FieldReaderDataSource default to UTF-8 encoding if none is specified. These previously used the machine's default. [SOLR-4096](https://issues.apache.org/jira/browse/SOLR-4096) (James Dyer)
- Javac/ ivy path warnings with morfologik fixed by upgrading to Morfologik 1.5.5 [SOLR-4106](https://issues.apache.org/jira/browse/SOLR-4106) (Robert Muir) (Dawid Weiss)
- SpellCheckCollatorTest#testContextSensitiveCollate to test against both DirectSolrSpellChecker & IndexBasedSpellChecker [SOLR-4111](https://issues.apache.org/jira/browse/SOLR-4111) (Tomás Fernández Löbbe) (James Dyer)
- Update Guava to 13.0.1 [SOLR-4119](https://issues.apache.org/jira/browse/SOLR-4119) (Mark Miller)
- Upgrade Jetty to 8.1.8. [SOLR-4155](https://issues.apache.org/jira/browse/SOLR-4155) (Robert Muir)
- README improvements [SOLR-4163](https://issues.apache.org/jira/browse/SOLR-4163) (Shawn Heisey) (hossman)
- ExtendedDismaxQParserPlugin has been refactored to make subclassing easier. [SOLR-4208](https://issues.apache.org/jira/browse/SOLR-4208) (Tomás Fernández Löbbe) (hossman)
- Extract fl parsing code out of ReturnFields constructor. [SOLR-4226](https://issues.apache.org/jira/browse/SOLR-4226) (Ryan Ernst) (Robert Muir)
- "ant eclipse" should declare .svn directories as derived. [SOLR-4248](https://issues.apache.org/jira/browse/SOLR-4248) (Shawn Heisey) (Mark Miller)
- Harden the 'leader requests replica to recover' code path. [SOLR-4254](https://issues.apache.org/jira/browse/SOLR-4254) (Mark Miller) (yonik)
- Removed "apache-" prefix from Solr distribution and artifact filenames. [SOLR-4287](https://issues.apache.org/jira/browse/SOLR-4287) (Ryan Ernst) (Robert Muir) (Steve Rowe)
- Remove the problematic and now unnecessary log4j-over-slf4j. [SOLR-4308](https://issues.apache.org/jira/browse/SOLR-4308) (Mark Miller)


[4.0.0] - 2012-10-12
--------------------

### Added (83 changes)

- Migrated Solr's Tokenizer-, TokenFilter-, and CharFilterFactories to the lucene-analysis module. To add new analysis modules to Solr (like ICU, SmartChinese, Morfologik,...), just drop in the JAR files from Lucene's binary distribution into your Solr instance's lib folder. The factories are automatically made available with SPI. [LUCENE-2510](https://issues.apache.org/jira/browse/LUCENE-2510) [LUCENE-4044](https://issues.apache.org/jira/browse/LUCENE-4044) (Chris Male) (Robert Muir) (Uwe Schindler)
- Added JapaneseIterationMarkCharFilterFactory to normalize Japanese iteration marks. [LUCENE-4201](https://issues.apache.org/jira/browse/LUCENE-4201) (Robert Muir) (Christian Moen)
- CSV handler now supports "literal.field_name=value" parameters. [SOLR-1032](https://issues.apache.org/jira/browse/SOLR-1032) (Simon Rosenthal) (ehatcher)
- Added commented-out example of the new script update processor to the example configuration. [SOLR-1280](https://issues.apache.org/jira/browse/SOLR-1280) (ehatcher)
- Return FunctionQuery as pseudo field. The solr 'fl' param now supports functions. For example: fl=id,sum(x,y) -- NOTE: only functions with fast random access are recommended. [SOLR-1298](https://issues.apache.org/jira/browse/SOLR-1298) (yonik) (ryan)
- Change to updateable documents to create the document if it doesn't already exist. To assert that the document must exist, use the optimistic concurrency feature by specifying a _version_ of 1. [SOLR-139](https://issues.apache.org/jira/browse/SOLR-139) (yonik)
- Updateable documents. JSON Example: {"id":"mydoc", "f1":{"set":10}, "f2":{"add":20}} will result in field "f1" being set to 10, "f2" having an additional value of 20 added, and all other existing fields unchanged. All source fields must be stored for this feature to work correctly. [SOLR-139](https://issues.apache.org/jira/browse/SOLR-139) (Ryan McKinley) (Erik Hatcher) (yonik)
- PreAnalyzedField type provides a functionality to index (and optionally store) field content that was already processed and split into tokens using some external processing chain. Serialization format is pluggable, and defaults to JSON. [SOLR-1535](https://issues.apache.org/jira/browse/SOLR-1535) (ab)
- Transforming documents in the ResponseWriters. This will allow for more complex results in responses and open the door for function queries as results. (ryan with patches from grant, noble, cmale, yonik, Jan Høydahl, Arul Kalaipandian, Luca Cavanna, hossman) - SOLR-2037: Thanks to SOLR-1566, documents boosted by the QueryElevationComponent can be marked as boosted. [SOLR-1566](https://issues.apache.org/jira/browse/SOLR-1566) [SOLR-2037](https://issues.apache.org/jira/browse/SOLR-2037) (gsingers) (ryan) (yonik)
- Add debug component options for timings, results and query info only [SOLR-1665](https://issues.apache.org/jira/browse/SOLR-1665) (gsingers) (hossman) (yonik)
- StatelessScriptUpdateProcessorFactory allows users to implement the full ScriptUpdateProcessor API using any scripting language with a javax.script.ScriptEngineFactory [SOLR-1725](https://issues.apache.org/jira/browse/SOLR-1725) (Uri Boness) (ehatcher) (Simon Rosenthal) (hossman)
- In Solr Cell, literals should override Tika-parsed values. Patch adds a param "literalsOverride" which defaults to true, but can be set to "false" to let Tika-parsed values be appended to literal values [SOLR-1856](https://issues.apache.org/jira/browse/SOLR-1856) (Chris Harris) (janhoy)
- SolrCloud - added shared/central config and core/shard management via zookeeper, built-in load balancing, and distributed indexing. (Jamie Johnson, Sami Siren, Ted Dunning, yonik, Mark Miller) Additional Work: - SOLR-2324: SolrCloud solr.xml parameters are not persisted by CoreContainer. (Massimo Schiavon, Mark Miller) - SOLR-2287: Allow users to query by multiple, compatible collections with SolrCloud. (Soheb Mahmood, Alex Cowell, Mark Miller) - SOLR-2622: ShowFileRequestHandler does not work in SolrCloud mode. (Stefan Matheis, Mark Miller) - SOLR-3108: Error in SolrCloud's replica lookup code when replica's are hosted in same Solr instance. (Bruno Dumon, Sami Siren, Mark Miller) - SOLR-3080: Remove shard info from zookeeper when SolrCore is explicitly unloaded. (yonik, Mark Miller, siren) - SOLR-3437: Recovery issues a spurious commit to the cluster. (Trym R. Møller via Mark Miller) - SOLR-2822: Skip update processors already run on other nodes [SOLR-1873](https://issues.apache.org/jira/browse/SOLR-1873) [SOLR-2358](https://issues.apache.org/jira/browse/SOLR-2358) [SOLR-2324](https://issues.apache.org/jira/browse/SOLR-2324) [SOLR-2287](https://issues.apache.org/jira/browse/SOLR-2287) [SOLR-2622](https://issues.apache.org/jira/browse/SOLR-2622) [SOLR-3108](https://issues.apache.org/jira/browse/SOLR-3108) [SOLR-3080](https://issues.apache.org/jira/browse/SOLR-3080) [SOLR-3437](https://issues.apache.org/jira/browse/SOLR-3437) [SOLR-2822](https://issues.apache.org/jira/browse/SOLR-2822) (hossman)
- Index encrypted documents with ExtractingUpdateRequestHandler. By supplying resource.password=&lt;mypw&gt; or specifying an external file with regular expressions matching file names, Solr will decrypt and index PDFs and DOCX formats. [SOLR-1929](https://issues.apache.org/jira/browse/SOLR-1929) (janhoy) (Yiannis Pericleous)
- New relevancy function queries: termfreq, tf, docfreq, idf norm, maxdoc, numdocs. [SOLR-1932](https://issues.apache.org/jira/browse/SOLR-1932) (yonik)
- Added the ability to select postings format per fieldType in schema.xml as well as support custom Codecs in solrconfig.xml. [SOLR-1942](https://issues.apache.org/jira/browse/SOLR-1942) (simonw)
- Edismax query parser to allow "phrase slop" to be specified per-field on the pf/pf2/pf3 parameters using optional "FieldName~slop^boost" syntax. The prior "FieldName^boost" syntax is still accepted. In such cases the value on the "ps" parameter serves as the default slop. [SOLR-2058](https://issues.apache.org/jira/browse/SOLR-2058) (Ron Mayer)
- Solrj API now supports streaming results. [SOLR-2112](https://issues.apache.org/jira/browse/SOLR-2112) (ryan)
- Trie* fields should support sortMissingLast=true, and deprecate Sortable* Field Types [SOLR-2134](https://issues.apache.org/jira/browse/SOLR-2134) (Ryan McKinley) (Mike McCandless) (Uwe Schindler) (Erick Erickson)
- Boolean type added to function queries, along with new functions exists(), if(), and(), or(), xor(), not(), def(), and true and false constants. [SOLR-2136](https://issues.apache.org/jira/browse/SOLR-2136) (yonik)
- You may now specify a 'soft' commit when committing. This will use Lucene's NRT feature to avoid guaranteeing documents are on stable storage in exchange for faster reopen times. There is also a new 'soft' autocommit tracker that can be configured. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) (Mark Miller) (Robert Muir)
- Pseudo-join queries / filters. Examples: - To restrict to the set of parents with at least one blue-eyed child: fq={!join from=parent to=name}eyes:blue - To restrict to the set of children with at least one blue-eyed parent: fq={!join from=name to=parent}eyes:blue [SOLR-2272](https://issues.apache.org/jira/browse/SOLR-2272) (yonik)
- New 'field("...")' function syntax for referring to complex field names (containing whitespace or special characters) in functions. [SOLR-2335](https://issues.apache.org/jira/browse/SOLR-2335) 
- Add support for using &lt;similarity/&gt; in a schema's fieldType, for customizing scoring on a per-field basis. [SOLR-2338](https://issues.apache.org/jira/browse/SOLR-2338) (hossman) (yonik) (rmuir)
- /browse improvements: generalize range and date facet display [SOLR-2383](https://issues.apache.org/jira/browse/SOLR-2383) (Jan Høydahl)
- Add CollationField, which is much more efficient than the Solr 3.x CollationKeyFilterFactory, and also supports Locale-sensitive range queries. [SOLR-2396](https://issues.apache.org/jira/browse/SOLR-2396) (rmuir)
- Add ICUCollationField to contrib/analysis-extras, which is much more efficient than the Solr 3.x ICUCollationKeyFilterFactory, and also supports Locale-sensitive range queries. [SOLR-2396](https://issues.apache.org/jira/browse/SOLR-2396) (rmuir)
- Updated Solr Admin interface. New look and feel with per core administration and many new options. [SOLR-2399](https://issues.apache.org/jira/browse/SOLR-2399) (Stefan Matheis)
- Add explain info directly to return documents using ?fl=id,[explain] [SOLR-2417](https://issues.apache.org/jira/browse/SOLR-2417) (ryan)
- added MultiTermAwareComponent to the various classes to allow automatic lowercasing for multiterm queries (wildcards, regex, prefix, range, etc). You can now optionally specify a "multiterm" analyzer in our schema.xml, but Solr should "do the right thing" if you don't specify &lt;analyzer type="multiterm"&gt; [SOLR-2438](https://issues.apache.org/jira/browse/SOLR-2438) (Pete Sturge Erick Erickson) (Mentoring from Seeley and Muir)
- Expose LogLevel selection with a RequestHandler rather then servlet [SOLR-2459](https://issues.apache.org/jira/browse/SOLR-2459) (Stefan Matheis) (Upayavira) (ryan)
- Add support for commitWithin in DataImportHandler [SOLR-2481](https://issues.apache.org/jira/browse/SOLR-2481) (Sami Siren)
- Add support for using spellcheck collation in conjunction with grouping. Note that the number of hits returned for collations is the number of ungrouped hits. [SOLR-2491](https://issues.apache.org/jira/browse/SOLR-2491) (James Dyer)
- Converted ValueSource.ValueSourceSortField over to new rewriteable Lucene SortFields. ValueSourceSortField instances must be rewritten before they can be used. This is done by SolrIndexSearcher when necessary. [SOLR-2533](https://issues.apache.org/jira/browse/SOLR-2533) (Chris Male)
- Added DirectSolrSpellChecker, which uses Lucene's DirectSpellChecker to retrieve correction candidates directly from the term dictionary using levenshtein automata. [LUCENE-2507](https://issues.apache.org/jira/browse/LUCENE-2507) [SOLR-2571](https://issues.apache.org/jira/browse/SOLR-2571) [SOLR-2576](https://issues.apache.org/jira/browse/SOLR-2576) (James Dyer) (rmuir)
- Context-Sensitive Spelling Suggestions & Collations. This adds support for the "spellcheck.alternativeTermCount" & "spellcheck.maxResultsForSuggest" parameters, letting users receive suggestions even when all the queried terms exist in the dictionary. This differs from "spellcheck.onlyMorePopular" in that the suggestions need not consist entirely of terms with a greater document frequency than the queried terms. [SOLR-2585](https://issues.apache.org/jira/browse/SOLR-2585) (James Dyer)
- CloneFieldUpdateProcessorFactory provides similar functionality to schema.xml's &lt;copyField/&gt; declaration but as an update processor that can be combined with other processors in any order. [SOLR-2599](https://issues.apache.org/jira/browse/SOLR-2599) (Jan Høydahl & hossman)
- Include a sample java util logging configuration file. [SOLR-2616](https://issues.apache.org/jira/browse/SOLR-2616) (David Smiley) (Mark Miller)
- realtime-get, efficiently retrieves the latest stored fields for specified documents, even if they are not yet searchable (i.e. without reopening a searcher) [SOLR-2656](https://issues.apache.org/jira/browse/SOLR-2656) (yonik)
- New support for a "TZ" request param which overrides the TimeZone used when rounding Dates in DateMath expressions for the entire request (all date range queries and date faceting is affected). The default TZ is still UTC. [SOLR-2690](https://issues.apache.org/jira/browse/SOLR-2690) (David Schlotfeldt) (hossman)
- The default directory factory was changed to NRTCachingDirectoryFactory which wraps the StandardDirectoryFactory and caches small files for improved Near Real-time (NRT) performance. [SOLR-2702](https://issues.apache.org/jira/browse/SOLR-2702) (Mark Miller) (yonik)
- Added support for Lucene's "surround" query parser. [SOLR-2703](https://issues.apache.org/jira/browse/SOLR-2703) (Simon Rosenthal) (ehatcher)
- Added factories for several ranking algorithms: - BM25SimilarityFactory: Okapi BM25 - DFRSimilarityFactory: Divergence from Randomness models - IBSimilarityFactory: Information-based models - LMDirichletSimilarity: LM with Dirichlet smoothing - LMJelinekMercerSimilarity: LM with Jelinek-Mercer smoothing [SOLR-2754](https://issues.apache.org/jira/browse/SOLR-2754) (David Mark Nemeskey) (Robert Muir)
- new "mod(x,y)" function for computing the modulus of two value sources. [SOLR-2768](https://issues.apache.org/jira/browse/SOLR-2768) (hossman)
- New FieldMutatingUpdateProcessor and Factory to simplify the development of UpdateProcessors that modify field values of documents as they are indexed. Also includes several useful new implementations: - RemoveBlankFieldUpdateProcessorFactory - TrimFieldUpdateProcessorFactory - HTMLStripFieldUpdateProcessorFactory - RegexReplaceProcessorFactory - FieldLengthUpdateProcessorFactory - ConcatFieldUpdateProcessorFactory - FirstFieldValueUpdateProcessorFactory - LastFieldValueUpdateProcessorFactory - MinFieldValueUpdateProcessorFactory - MaxFieldValueUpdateProcessorFactory - TruncateFieldUpdateProcessorFactory - IgnoreFieldUpdateProcessorFactory [SOLR-2802](https://issues.apache.org/jira/browse/SOLR-2802) (hossman) (janhoy)
- Support XML,CSV,JSON, and javabin in a single RequestHandler and choose the correct ContentStreamLoader based on Content-Type header. This also deprecates the existing [Xml,JSON,CSV,Binary,Xslt]UpdateRequestHandler. [SOLR-2857](https://issues.apache.org/jira/browse/SOLR-2857) (ryan)
- Support grouped faceting. (Martijn van Groningen) Additional Work: - SOLR-3406: Extended grouped faceting support to facet.query and facet.range parameters. [SOLR-2898](https://issues.apache.org/jira/browse/SOLR-2898) [SOLR-3406](https://issues.apache.org/jira/browse/SOLR-3406) (David Boychuck) (Martijn van Groningen)
- Added LFU cache options to Solr. [SOLR-2906](https://issues.apache.org/jira/browse/SOLR-2906) (Shawn Heisey)
- QueryElevationComponent is now supported with distributed search. [SOLR-2949](https://issues.apache.org/jira/browse/SOLR-2949) (Mark Miller) (yonik)
- Add support for IndexWriter.prepareCommit() via prepareCommit=true on update URLs. [SOLR-2992](https://issues.apache.org/jira/browse/SOLR-2992) (yonik)
- Add WordBreakSolrSpellChecker to offer suggestions by combining adjacent query terms and/or breaking terms into multiple words. This spellchecker can be configured with a traditional checker (ie: DirectSolrSpellChecker). The results are combined and collations can contain a mix of corrections from both spellcheckers. [SOLR-2993](https://issues.apache.org/jira/browse/SOLR-2993) (James Dyer)
- Ability to add openSearcher=false to not open a searcher when doing a hard commit. commitWithin now only invokes a softCommit. [SOLR-3069](https://issues.apache.org/jira/browse/SOLR-3069) (yonik)
- Optional post filtering for spatial queries bbox and geofilt for LatLonType. [SOLR-3120](https://issues.apache.org/jira/browse/SOLR-3120) (yonik)
- Include shard info in distributed response when shards.info=true [SOLR-3134](https://issues.apache.org/jira/browse/SOLR-3134) (Russell Black) (ryan)
- Optimistic locking. If a _version_ is provided with an update that does not match the version in the index, an HTTP 409 error (Conflict) will result. [SOLR-3178](https://issues.apache.org/jira/browse/SOLR-3178) (Per Steffensen) (yonik)
- Allow parameter overrides in conjunction with "spellcheck.maxCollationTries". To do so, use parameters starting with "spellcheck.collateParam." For instance, to override the "mm" parameter, specify "spellcheck.collateParam.mm". This is helpful in cases where testing spellcheck collations for result counts should use different parameters from the main query [SOLR-3211](https://issues.apache.org/jira/browse/SOLR-3211) (James Dyer)
- Added the ability to directly configure aspects of the concurrency and thread-pooling used within distributed search in solr. This allows for finer grained controlled and can be tuned by end users to target their own specific requirements. This builds on the work of the HttpCommComponent and uses the same configuration block to configure the thread pool. The default configuration has the same behaviour as solr 3.5, favouring throughput over latency. More information can be found on the wiki (http://wiki.apache.org/solr/SolrConfigXml) [SOLR-3221](https://issues.apache.org/jira/browse/SOLR-3221) (Greg Bowyer)
- Numerous small improvements to the Admin UI [SOLR-3238](https://issues.apache.org/jira/browse/SOLR-3238) (steffkes)
- OpenExchangeRates.Org Exchange Rate Provider for CurrencyField [SOLR-3255](https://issues.apache.org/jira/browse/SOLR-3255) (janhoy)
- Solr filter factory for MorfologikFilter (Polish lemmatisation). [SOLR-3272](https://issues.apache.org/jira/browse/SOLR-3272) (Rafał Kuć) (Steven Rowe) (Uwe Schindler)
- Negative boost support to the Extended Dismax Query Parser Boost Query (bq). [SOLR-3278](https://issues.apache.org/jira/browse/SOLR-3278) (James Dyer)
- Added Solr adapters for Lucene 4's new spatial module. With SpatialRecursivePrefixTreeFieldType ("location_rpt" in example schema), it is possible to index a variable number of points per document (and sort on them), index not just points but any Spatial4j supported shape such as polygons, and to query on these shapes too. Polygons requires adding JTS to the classpath. [SOLR-3304](https://issues.apache.org/jira/browse/SOLR-3304) (David Smiley)
- eDismax: ps2 and ps3 params [SOLR-3351](https://issues.apache.org/jira/browse/SOLR-3351) (janhoy)
- Logging events are captured and available from the /admin/logging request handler. [SOLR-3358](https://issues.apache.org/jira/browse/SOLR-3358) (ryan)
- Consolidated Exceptions in Analysis Factories so they only throw InitializationExceptions [SOLR-3363](https://issues.apache.org/jira/browse/SOLR-3363) (Chris Male)
- Analysis Factories are now configured with their Lucene Version throw setLuceneMatchVersion, rather than through the Map passed to init. Parsing and simple error checking for the Version is now done inside the code that creates the Analysis Factories. [SOLR-3402](https://issues.apache.org/jira/browse/SOLR-3402) (Chris Male)
- Add cloud-scripts directory and a zkcli.sh|bat tool for easy scripting and interaction with ZooKeeper. [SOLR-3460](https://issues.apache.org/jira/browse/SOLR-3460) (Mark Miller)
- Added a Collection management API for SolrCloud. [SOLR-3488](https://issues.apache.org/jira/browse/SOLR-3488) (Tommaso Teofili) (Sami Siren) (yonik) (Mark Miller)
- New UpdateProcessors have been added to create default values for configured fields. These works similarly to the &lt;field default="..."/&gt; option in schema.xml, but are applied in the UpdateProcessorChain, so they may be used prior to other UpdateProcessors, or to generate a uniqueKey field value when using the DistributedUpdateProcessor (ie: SolrCloud) TimestampUpdateProcessorFactory UUIDUpdateProcessorFactory DefaultValueUpdateProcessorFactory [SOLR-3495](https://issues.apache.org/jira/browse/SOLR-3495) (hossman)
- Simplify JSON update format for deletes as well as allow version specification for optimistic locking. Examples: - {"delete":"myid"} - {"delete":["id1","id2","id3"]} - {"delete":{"id":"myid", "_version_":123456789}} [SOLR-3508](https://issues.apache.org/jira/browse/SOLR-3508) (yonik)
- Add WeightedFragListBuilder for FVH and set it to default fragListBuilder in example solrconfig.xml. [SOLR-3542](https://issues.apache.org/jira/browse/SOLR-3542) (Sebastian Lutze) (koji)
- Full deleteByQuery support with SolrCloud distributed indexing. All replicas of a shard will be consistent, even if updates arrive in a different order on different replicas. [SOLR-3559](https://issues.apache.org/jira/browse/SOLR-3559) (yonik)
- Add options to remove instance dir or data dir on core unload. [SOLR-3562](https://issues.apache.org/jira/browse/SOLR-3562) (Mark Miller) (Per Steffensen)
- seems like a lot of wasted whitespace at the top of the admin screens [SOLR-3597](https://issues.apache.org/jira/browse/SOLR-3597) (steffkes)
- CoreContainer and CoreAdminHandler will now remember and report back information about failures to initialize SolrCores. These failures will be accessible from the web UI and CoreAdminHandler STATUS command until they are "reset" by creating/renaming a SolrCore with the same name. [SOLR-3634](https://issues.apache.org/jira/browse/SOLR-3634) [SOLR-3635](https://issues.apache.org/jira/browse/SOLR-3635) (hossman) (steffkes)
- New CountFieldValuesUpdateProcessorFactory makes it easy to index the number of values in another field for later use at query time. [SOLR-3670](https://issues.apache.org/jira/browse/SOLR-3670) (hossman)
- SimplePostTool: Improvements for posting files Support for auto mode, recursive and wildcards [SOLR-3672](https://issues.apache.org/jira/browse/SOLR-3672) (janhoy)
- Added 'df' to the UI Query form [SOLR-3821](https://issues.apache.org/jira/browse/SOLR-3821) (steffkes)
- Added hover titles to the edismax params on the UI Query form [SOLR-3822](https://issues.apache.org/jira/browse/SOLR-3822) (steffkes)
- Added optional capability to log what ids are in a response [SOLR-3825](https://issues.apache.org/jira/browse/SOLR-3825) (Scott Stults) (gsingers)
- The autowarmCount for LRUCaches (LRUCache and FastLRUCache) now supports "percentages" which get evaluated relative the current size of the cache when warming happens. [SOLR-571](https://issues.apache.org/jira/browse/SOLR-571) (Tomás Fernández Löbbe and hossman)
- Optionally return shard info with each document in distributed search. Use fl=id,[shard] to return the shard url. [SOLR-705](https://issues.apache.org/jira/browse/SOLR-705) (ryan)
- Adding PivotFacetComponent for Hierarchical faceting [SOLR-792](https://issues.apache.org/jira/browse/SOLR-792) (ehatcher) (Jeremy Hinegardner) (Thibaut Lassalle) (ryan)

### Changed (11 changes)

- Per-segment field faceting for single valued string fields. Enable with facet.method=fcs, control the number of threads used with the "threads" local param on the facet.field param. This algorithm will only be faster in the presence of rapid index changes. [SOLR-1875](https://issues.apache.org/jira/browse/SOLR-1875) (yonik)
- When facet.enum.cache.minDf &gt; 0 and the base doc set is a SortedIntSet, convert to HashDocSet for better performance. [SOLR-1904](https://issues.apache.org/jira/browse/SOLR-1904) (yonik)
- Speed up single-valued and multi-valued "fc" faceting. Typical improvement is 5%, but can be much greater (up to 10x faster) when facet.offset is very large (deep paging). [SOLR-2092](https://issues.apache.org/jira/browse/SOLR-2092) (yonik)
- The default Solr update handler has been improved so that it uses fewer locks, keeps the IndexWriter open rather than closing it on each commit (ie commits no longer wait for background merges to complete), works with SolrCore to provide faster 'soft' commits, and has an improved API that requires less instanceof special casing. (Mark Miller, Robert Muir) Additional Work: - SOLR-2697: commit and autocommit operations don't reset DirectUpdateHandler2.numDocsPending stats attribute. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) [SOLR-2697](https://issues.apache.org/jira/browse/SOLR-2697) (Alexey Serba) (Mark Miller)
- The QueryElevationComponent now avoids using the FieldCache and looking up every document id [SOLR-2950](https://issues.apache.org/jira/browse/SOLR-2950) (gsingers) (yonik)
- Add hashCode to ClusterState so that structures built based on the ClusterState can be easily cached. [SOLR-3708](https://issues.apache.org/jira/browse/SOLR-3708) (Mark Miller)
- Cache the url list created from the ClusterState in CloudSolrServer on each request. [SOLR-3709](https://issues.apache.org/jira/browse/SOLR-3709) (Mark Miller)
- Change CloudSolrServer so that update requests are only sent to leaders by default. [SOLR-3710](https://issues.apache.org/jira/browse/SOLR-3710) (Mark Miller)
- improve concurrency of the transaction log by removing synchronization around log record serialization. [SOLR-3715](https://issues.apache.org/jira/browse/SOLR-3715) (yonik)
- Currently during recovery we pause for a number of seconds after waiting for the leader to see a recovering state so that any previous updates will have finished before our commit on the leader - we don't need this wait for peersync. [SOLR-3807](https://issues.apache.org/jira/browse/SOLR-3807) (Mark Miller)
- When a leader is elected and asks replicas to sync back to him and that fails, we should ask those nodes to recovery asynchronously rather than synchronously. [SOLR-3837](https://issues.apache.org/jira/browse/SOLR-3837) (Mark Miller)

### Fixed (121 changes)

- Cleaner path usage in TestXPathEntityProcessor [LUCENE-4075](https://issues.apache.org/jira/browse/LUCENE-4075) (Greg Bowyer)
- Fix a bug where CharFilters were wrongly being applied twice. [LUCENE-4185](https://issues.apache.org/jira/browse/LUCENE-4185) (Michael Froh) (rmuir)
- QueryElevationComponent now supports non-string ids [SOLR-1520](https://issues.apache.org/jira/browse/SOLR-1520) (gsingers)
- Made it clearer when a core failed to load as well as better logging when the QueryElevationComponent fails to properly initialize [SOLR-1730](https://issues.apache.org/jira/browse/SOLR-1730) (gsingers)
- Replication index directories not always cleaned up. [SOLR-1781](https://issues.apache.org/jira/browse/SOLR-1781) (Markus Jelsma) (Terje Sten Bjerkseth) (Mark Miller)
- IndexSchema will now fail to initialize if there is a problem initializing one of the fields or field types. [SOLR-1824](https://issues.apache.org/jira/browse/SOLR-1824) (hossman)
- Fixed SignatureUpdateProcessor to fail to initialize on invalid config. Specifically: a signatureField that does not exist, or overwriteDupes=true with a signatureField that is not indexed. [SOLR-1908](https://issues.apache.org/jira/browse/SOLR-1908) (hossman)
- TermsComponent didn't correctly break ties for non-text fields sorted by count. [SOLR-1928](https://issues.apache.org/jira/browse/SOLR-1928) (yonik)
- When using the MailEntityProcessor, import would fail if fetchMailsSince was not specified. [SOLR-1958](https://issues.apache.org/jira/browse/SOLR-1958) (Max Lynch)
- SolrCore#initIndex should not use a mix of indexPath and newIndexPath [SOLR-1962](https://issues.apache.org/jira/browse/SOLR-1962) (Mark Miller)
- MoreLikeThisHandler doesn't work with alternate qparsers. [SOLR-2107](https://issues.apache.org/jira/browse/SOLR-2107) (yonik)
- Fixed false positives when using wildcard queries on fields with reversed wildcard support. For example, a query of *zemog* would match documents that contain 'gomez'. [SOLR-2108](https://issues.apache.org/jira/browse/SOLR-2108) (Landon Kuhn)
- SolrCores now properly share IndexWriters across SolrCore reloads. (Mark Miller, Robert Muir) Additional Work: - SOLR-2705: On reload, IndexWriterProvider holds onto the initial SolrCore it was created with. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) [SOLR-2651](https://issues.apache.org/jira/browse/SOLR-2651) [SOLR-2705](https://issues.apache.org/jira/browse/SOLR-2705) (Yury Kats) (Mark Miller)
- fix DisMax 'mm' parsing to be tolerant of whitespace [SOLR-2275](https://issues.apache.org/jira/browse/SOLR-2275) (Erick Erickson)
- Fixed TermVectorComponent so that it will not fail if the fl param contains globs or pseudo-fields [SOLR-2352](https://issues.apache.org/jira/browse/SOLR-2352) (hossman)
- StringIndexOutOfBoundsException in the spellchecker collate when the term contains a hyphen. [SOLR-2509](https://issues.apache.org/jira/browse/SOLR-2509) (Thomas Gambier caught the bug) (Steffen Godskesen did the patch) (Erick Erickson)
- fixed tracking of the 'defaultCoreName' in CoreContainer so that CoreAdminHandler could return consistent information regardless of whether there is a a default core name or not. [SOLR-2605](https://issues.apache.org/jira/browse/SOLR-2605) (steffkes) (hossman)
- Directorys used by a SolrCore are now closed when they are no longer used. [SOLR-2654](https://issues.apache.org/jira/browse/SOLR-2654) (Mark Miller)
- Remove addException() in SimpleFacet. FacetComponent no longer catches and embeds exceptions occurred during facet processing, it throws HTTP 400 or 500 exceptions instead. [SOLR-2682](https://issues.apache.org/jira/browse/SOLR-2682) (koji)
- Bugs in facet range display in trunk [SOLR-2741](https://issues.apache.org/jira/browse/SOLR-2741) (janhoy)
- FSTLookup could return duplicate results or one results less than requested. [SOLR-2762](https://issues.apache.org/jira/browse/SOLR-2762) (David Smiley) (Dawid Weiss)
- Fix problem with false-positives due to incorrect equals methods. [SOLR-2829](https://issues.apache.org/jira/browse/SOLR-2829) (Yonik Seeley) (Hossman) (Erick Erickson. Marc Tinnemeyer caught the bug)
- Removed 'instanceof AbstractLuceneSpellChecker' hacks from distributed spellchecking code, and added a merge() method to SolrSpellChecker instead. Previously if you extended SolrSpellChecker your spellchecker would not work in distributed fashion. [SOLR-2848](https://issues.apache.org/jira/browse/SOLR-2848) (James Dyer)
- Now load URL content stream data (via stream.url) when called for during request handling, rather than loading URL content streams automatically regardless of use. [SOLR-2854](https://issues.apache.org/jira/browse/SOLR-2854) (David Smiley and Ryan McKinley)
- IllegalArgumentException when using useFilterForSortedQuery on an empty index. [SOLR-2923](https://issues.apache.org/jira/browse/SOLR-2923) (Adrien Grand)
- Fixed StatsComponent to no longer return duplicated information when requesting multiple stats.facet fields. [SOLR-2981](https://issues.apache.org/jira/browse/SOLR-2981) (Roman Kliewer) (hossman)
- When using binary format in solrj the codec screws up parameters [SOLR-3037](https://issues.apache.org/jira/browse/SOLR-3037) (Sami Siren) (Jörg Maier)
- A join in the main query was not respecting any filters pushed down to it via acceptDocs since LUCENE-1536. [SOLR-3062](https://issues.apache.org/jira/browse/SOLR-3062) [LUCENE-1536](https://issues.apache.org/jira/browse/LUCENE-1536) (Mike Hugo) (yonik)
- Occasional NPE in ThreadDumpHandler [SOLR-3068](https://issues.apache.org/jira/browse/SOLR-3068) (siren)
- Fixed DOMUtil so that code doing attribute validation will automatically ignore nodes in the reserved "xml" prefix - in particular this fixes some bugs related to xinclude and fieldTypes. [SOLR-3087](https://issues.apache.org/jira/browse/SOLR-3087) (Amit Nithian) (hossman)
- Make ConcurrentUpdateSolrServer send UpdateRequest.getParams() as HTTP request params [SOLR-3139](https://issues.apache.org/jira/browse/SOLR-3139) (siren)
- Cannot use DIH in Solrcloud + Zookeeper [SOLR-3165](https://issues.apache.org/jira/browse/SOLR-3165) (Alexey Serba) (Mark Miller) (siren)
- If you use multiple fl entries rather than a comma separated list, all but the first entry can be ignored if you are using distributed search. [SOLR-3214](https://issues.apache.org/jira/browse/SOLR-3214) (Tomás Fernández Löbbe)
- Fixed TermVectorComponent to work with distributed search [SOLR-3229](https://issues.apache.org/jira/browse/SOLR-3229) (Hang Xie) (hossman)
- eDismax: pf2 should kick in for a query with 2 terms [SOLR-3352](https://issues.apache.org/jira/browse/SOLR-3352) (janhoy)
- ReplicationHandler "maxNumberOfBackups" doesn't work if backups are triggered on commit [SOLR-3361](https://issues.apache.org/jira/browse/SOLR-3361) (James Dyer) (Tomás Fernández Löbbe)
- fixed CSVResponseWriter to respect globs in the 'fl' param [SOLR-3370](https://issues.apache.org/jira/browse/SOLR-3370) (Keith Fligg)
- edismax fails to correctly parse a fielded query wrapped by parens. This regression was introduced in 3.6. [SOLR-3377](https://issues.apache.org/jira/browse/SOLR-3377) (Bernd Fehling) (Jan Høydahl) (yonik)
- SolrCmdDistributor flushAdds/flushDeletes can cause repeated adds/deletes to be sent [SOLR-3428](https://issues.apache.org/jira/browse/SOLR-3428) (Mark Miller) (Per Steffensen)
- Added a new DIH test against a real SQL database. Fixed problems revealed by this new test related to the expanded cache support added to 3.6/SOLR-2382 [SOLR-3430](https://issues.apache.org/jira/browse/SOLR-3430) [SOLR-2382](https://issues.apache.org/jira/browse/SOLR-2382) (James Dyer)
- Group count incorrect when not all shards are queried in the second pass. [SOLR-3436](https://issues.apache.org/jira/browse/SOLR-3436) (Francois Perron) (Martijn van Groningen)
- Better errors when PatternTokenizerFactory is configured with an invalid pattern, and include the 'name' whenever possible in plugin init error messages. [SOLR-3446](https://issues.apache.org/jira/browse/SOLR-3446) (hossman)
- Exception when using result grouping with main=true and using wt=javabin. [SOLR-3454](https://issues.apache.org/jira/browse/SOLR-3454) (Ludovic Boutros) (Martijn van Groningen)
- Replication causes two searcher warmups. [SOLR-3465](https://issues.apache.org/jira/browse/SOLR-3465) (Michael Garski) (Mark Miller)
- ExtendedDismax escaping is missing several reserved characters [SOLR-3467](https://issues.apache.org/jira/browse/SOLR-3467) (Michael Dodsworth)
- contrib/clustering: custom Carrot2 tokenizer and stemmer factories are respected now [SOLR-3470](https://issues.apache.org/jira/browse/SOLR-3470) (Stanislaw Osinski) (Dawid Weiss)
- Include final 'hits' in log information when aggregating a distributed request [SOLR-3518](https://issues.apache.org/jira/browse/SOLR-3518) (Markus Jelsma) (hossman)
- fixed parsing of the 'literal()' function [SOLR-3522](https://issues.apache.org/jira/browse/SOLR-3522) (hossman)
- SolrCmdDistributor drops some of the important commit attributes (maxOptimizeSegments, softCommit, expungeDeletes) when sending a commit to replicas. [SOLR-3527](https://issues.apache.org/jira/browse/SOLR-3527) (Andy Laird) (Tomás Fernández Löbbe) (Mark Miller)
- add missing solrj dependencies to binary packages. [SOLR-3541](https://issues.apache.org/jira/browse/SOLR-3541) (Thijs Vonk)
- Fixed a bug in the cachability of queries using the {!join} parser or the strdist() function, as well as some minor improvements to the hashCode implementation of {!bbox} and {!geofilt} queries. [SOLR-3548](https://issues.apache.org/jira/browse/SOLR-3548) (hossman)
- Fixed debug output on distributed requests when there are no results found. [SOLR-3569](https://issues.apache.org/jira/browse/SOLR-3569) (David Bowen) (hossman)
- Our ZooKeeper watchers respond to session events as if they are change events, creating undesirable side effects. [SOLR-3582](https://issues.apache.org/jira/browse/SOLR-3582) (Trym R. Møller) (Mark Miller)
- After reloading a SolrCore, the original Analyzer is still used rather than a new one. [SOLR-3587](https://issues.apache.org/jira/browse/SOLR-3587) (Alexey Serba) (yonik) (rmuir) (Mark Miller)
- CurrencyField now generates an appropriate error on schema init if it is configured as multiValued - this has never been properly supported, but previously failed silently in odd ways. [SOLR-3595](https://issues.apache.org/jira/browse/SOLR-3595) (hossman)
- After reloading a core, indexing would fail on any newly added fields to the schema. [SOLR-3610](https://issues.apache.org/jira/browse/SOLR-3610) (Brent Mills) (rmuir)
- We do not show ZooKeeper data in the UI for a node that has children. [SOLR-3611](https://issues.apache.org/jira/browse/SOLR-3611) (Mark Miller)
- Fix rare concurrency issue when opening a new IndexWriter for replication or rollback. [SOLR-3621](https://issues.apache.org/jira/browse/SOLR-3621) (Mark Miller)
- Fixed inconsistent treatment of third-party dependencies for solr contribs analysis-extras & uima [SOLR-3623](https://issues.apache.org/jira/browse/SOLR-3623) (hossman)
- SolrInputField and SolrInputDocument are now consistently backed by Collections passed in to setValue/setField, and defensively copy values from Collections passed to addValue/addField [SOLR-3628](https://issues.apache.org/jira/browse/SOLR-3628) (Tom Switzer) (hossman)
- Typo in solr.xml persistence when overriding the solrconfig.xml file name using the "config" attribute prevented the override file from being used. [SOLR-3629](https://issues.apache.org/jira/browse/SOLR-3629) (Ryan Zezeski) (hossman)
- Update ZooKeeper to 3.3.6 for a variety of bug fixes. [SOLR-3639](https://issues.apache.org/jira/browse/SOLR-3639) (Mark Miller)
- CoreContainer is not persisting roles core attribute. [SOLR-3641](https://issues.apache.org/jira/browse/SOLR-3641) (hossman) (Mark Miller)
- Correct broken check for multivalued fields in stats.facet [SOLR-3642](https://issues.apache.org/jira/browse/SOLR-3642) (Yandong Yao) (hossman)
- /terms should default to distrib=false. [SOLR-3645](https://issues.apache.org/jira/browse/SOLR-3645) (Nick Cotton) (Mark Miller)
- DistributedQueue should use our Solr zk client rather than the std zk client. ZooKeeper expiration can be permanent otherwise. [SOLR-3647](https://issues.apache.org/jira/browse/SOLR-3647) (Mark Miller)
- Fixed VelocityResponseWriter template loading in SolrCloud mode. For the example configuration, this means /browse now works with SolrCloud. [SOLR-3648](https://issues.apache.org/jira/browse/SOLR-3648) (janhoy) (ehatcher)
- Fixed bug in JavabinLoader that caused deleteById(List&lt;String&gt; ids) to not work in SolrJ [SOLR-3649](https://issues.apache.org/jira/browse/SOLR-3649) (siren)
- Fixed range faceting to error instead of looping infinitely when 'gap' is zero -- or effectively zero due to floating point arithmetic underflow. [SOLR-3652](https://issues.apache.org/jira/browse/SOLR-3652) (hossman)
- A core reload now always uses the same dataDir. [SOLR-3656](https://issues.apache.org/jira/browse/SOLR-3656) (Mark Miller) (yonik)
- Adding thousands of docs with one UpdateProcessorChain instance can briefly create spikes of threads in the thousands. [SOLR-3658](https://issues.apache.org/jira/browse/SOLR-3658) (yonik) (Mark Miller)
- Velocity: Link to admin page broken [SOLR-3660](https://issues.apache.org/jira/browse/SOLR-3660) (janhoy)
- Core reload bugs: a reload always obtained a non-NRT searcher, which could go back in time with respect to the previous core's NRT searcher. Versioning did not work correctly across a core reload, and update handler synchronization was changed to synchronize on core state since more than on update handler can coexist for a single index during a reload. [SOLR-3662](https://issues.apache.org/jira/browse/SOLR-3662) (yonik)
- There are a couple of bugs in the sync process when a leader goes down and a new leader is elected. [SOLR-3663](https://issues.apache.org/jira/browse/SOLR-3663) (Mark Miller)
- DataImport : Specifying Custom Parameters [SOLR-3668](https://issues.apache.org/jira/browse/SOLR-3668) (steffkes)
- Fixed misleading error message in web ui to distinguish between no SolrCores loaded vs. no /admin/ handler available. [SOLR-3677](https://issues.apache.org/jira/browse/SOLR-3677) (hossman) (steffkes)
- Core Admin UI gives no feedback if "Add Core" fails [SOLR-3679](https://issues.apache.org/jira/browse/SOLR-3679) (steffkes) (hossman)
- Solr Cloud sometimes skipped peersync attempt and replicated instead due to tlog flags not being cleared when no updates were buffered during a previous replication. [SOLR-3685](https://issues.apache.org/jira/browse/SOLR-3685) (Markus Jelsma) (Mark Miller) (yonik)
- Fixed some Directory leaks when there were errors during SolrCore or SolrIndexWriter initialization. [SOLR-3699](https://issues.apache.org/jira/browse/SOLR-3699) (hossman)
- Fix bug that could theoretically allow multiple recoveries to run briefly at the same time if the recovery thread join call was interrupted. [SOLR-3721](https://issues.apache.org/jira/browse/SOLR-3721) (Per Steffensen) (Mark Miller)
- Fixed package-local-src-tgz target to not bring in unnecessary jars and binary contents. [SOLR-3725](https://issues.apache.org/jira/browse/SOLR-3725) (Michael Dodsworth) (rmuir)
- Rollback is not implemented quite right and can cause corner case fails in SolrCloud tests. [SOLR-3730](https://issues.apache.org/jira/browse/SOLR-3730) (rmuir) (Mark Miller)
- Fixed issues with atomic updates and optimistic concurrency in conjunction with stored copyField targets by making real-time get never return copyField targets. [SOLR-3743](https://issues.apache.org/jira/browse/SOLR-3743) (yonik)
- Proper error reporting if SolrCloud mode is used w/o necessary "_version_" field in schema.xml [SOLR-3745](https://issues.apache.org/jira/browse/SOLR-3745) (hossman)
- Proper error reporting if updateLog is configured w/o necessary "_version_" field in schema.xml [SOLR-3746](https://issues.apache.org/jira/browse/SOLR-3746) (hossman)
- If we are elected the leader of a shard, but we fail to publish this for any reason, we should clean up and re trigger a leader election. [SOLR-3756](https://issues.apache.org/jira/browse/SOLR-3756) (Mark Miller)
- Various fixes to the example-DIH configs [SOLR-3759](https://issues.apache.org/jira/browse/SOLR-3759) (Ahmet Arslan) (hossman)
- Overseer may lose updates to cluster state [SOLR-3770](https://issues.apache.org/jira/browse/SOLR-3770) (siren)
- On cluster startup, we should wait until we see all registered replicas before running the leader process - or if they all do not come up, N amount of time. [SOLR-3772](https://issues.apache.org/jira/browse/SOLR-3772) (Mark Miller)
- Dataimport-UI does not send unchecked checkboxes [SOLR-3777](https://issues.apache.org/jira/browse/SOLR-3777) (Glenn MacStravic) (steffkes)
- DataImportHandler's LineEntityProcessor when used in conjunction with FileListEntityProcessor would only process the first file. [SOLR-3779](https://issues.apache.org/jira/browse/SOLR-3779) (Ahmet Arslan) (James Dyer)
- A leader going down while updates are coming in can cause shard inconsistency. [SOLR-3782](https://issues.apache.org/jira/browse/SOLR-3782) (Mark Miller)
- Fixed Pivot Faceting to work with facet.missing=true [SOLR-3783](https://issues.apache.org/jira/browse/SOLR-3783) (hossman)
- Fix bug in SnapPuller that caused "internal" compression to fail. [SOLR-3789](https://issues.apache.org/jira/browse/SOLR-3789) (siren)
- ConcurrentModificationException could be thrown when using hl.fl=*. Fixed in r1231606. [SOLR-3790](https://issues.apache.org/jira/browse/SOLR-3790) (yonik) (koji)
- CachedSqlEntityProcessor would throw a NullPointerException when a query returns a row with a NULL key. [SOLR-3791](https://issues.apache.org/jira/browse/SOLR-3791) (Steffen Moelter) (James Dyer)
- UnInvertedField faceting cached big terms in the filter cache that ignored deletions, leading to duplicate documents in search later when a filter of the same term was specified. [SOLR-3793](https://issues.apache.org/jira/browse/SOLR-3793) (Günter Hipler) (hossman) (yonik)
- Fixed LukeRequestHandler response to correctly return field name strings in copyDests and copySources arrays [SOLR-3795](https://issues.apache.org/jira/browse/SOLR-3795) (hossman)
- Fixed config file replication when subdirectories are used [SOLR-3809](https://issues.apache.org/jira/browse/SOLR-3809) (Emmanuel Espina) (hossman)
- Query Form using wrong values for dismax, edismax [SOLR-3811](https://issues.apache.org/jira/browse/SOLR-3811) (steffkes)
- ConnectionLoss during recovery can cause lost updates, leading to shard inconsistency. [SOLR-3812](https://issues.apache.org/jira/browse/SOLR-3812) (Mark Miller)
- When a new leader syncs, we need to ask all shards to sync back, not just those that are active. [SOLR-3813](https://issues.apache.org/jira/browse/SOLR-3813) (Mark Miller)
- Fix 'bq' parsing in edismax. Please note that this required reverting the negative boost support added by SOLR-3278 [SOLR-3823](https://issues.apache.org/jira/browse/SOLR-3823) [SOLR-3278](https://issues.apache.org/jira/browse/SOLR-3278) (hossman)
- Fix shareSchema=true in solr.xml [SOLR-3827](https://issues.apache.org/jira/browse/SOLR-3827) (Tomás Fernández Löbbe) (hossman)
- Fixed QueryElevationComponent so that using 'markExcludes' does not modify the result set or ranking of 'excluded' documents relative to not using elevation at all. [SOLR-3828](https://issues.apache.org/jira/browse/SOLR-3828) (Alexey Serba) (hossman)
- Atomic updates do not distribute correctly to other nodes. [SOLR-3831](https://issues.apache.org/jira/browse/SOLR-3831) (Jim Musil) (Mark Miller)
- When a election is started because a leader went down, the new leader candidate should decline if the last state they published was not active. [SOLR-3833](https://issues.apache.org/jira/browse/SOLR-3833) (yonik) (Mark Miller)
- A new leader on cluster startup should also run the leader sync process in case there was a bad cluster shutdown. [SOLR-3834](https://issues.apache.org/jira/browse/SOLR-3834) (Mark Miller)
- In our leader election algorithm, if on connection loss we found we did not create our election node, we should retry, not throw an exception. [SOLR-3835](https://issues.apache.org/jira/browse/SOLR-3835) (Mark Miller)
- When doing peer sync, we should only count sync attempts that cannot reach the given host as success when the candidate leader is syncing with the replicas - not when replicas are syncing to the leader. [SOLR-3836](https://issues.apache.org/jira/browse/SOLR-3836) (Mark Miller)
- SolrCore reload can fail because it tries to remove the index write lock while already holding it. [SOLR-3844](https://issues.apache.org/jira/browse/SOLR-3844) (Mark Miller)
- DataImportHandler "cacheKey" parameter was incorrectly renamed "cachePk" [SOLR-3850](https://issues.apache.org/jira/browse/SOLR-3850) (James Dyer)
- A PeerSync attempt to its replicas by a candidate leader should not fail on o.a.http.conn.ConnectTimeoutException. [SOLR-3869](https://issues.apache.org/jira/browse/SOLR-3869) (Mark Miller)
- Fixed index boosts on multi-valued fields when docBoost is used [SOLR-3875](https://issues.apache.org/jira/browse/SOLR-3875) (hossman)
- Exception when using open-ended range query with CurrencyField [SOLR-3878](https://issues.apache.org/jira/browse/SOLR-3878) (janhoy)
- Distributed indexing forwards non-applicable request params. [SOLR-3883](https://issues.apache.org/jira/browse/SOLR-3883) (Dan Sutton) (Per Steffensen) (yonik) (Mark Miller)
- CacheValue in CachingDirectoryFactory cannot be used outside of solr.core package. [SOLR-3891](https://issues.apache.org/jira/browse/SOLR-3891) (phunt) (Mark Miller)
- Inconsistent locking when accessing cache in CachingDirectoryFactory from RAMDirectoryFactory and MockDirectoryFactory. [SOLR-3892](https://issues.apache.org/jira/browse/SOLR-3892) (phunt) (Mark Miller)
- Fixed MissingFormatArgumentException in ConcurrentUpdateSolrServer [SOLR-3903](https://issues.apache.org/jira/browse/SOLR-3903) (hossman)
- Fixed whitespace bug in parsing the fl param [SOLR-3916](https://issues.apache.org/jira/browse/SOLR-3916) (hossman)
- Admin UI - JVM memory bar - dark grey "used" width is too small [SOLR-4289](https://issues.apache.org/jira/browse/SOLR-4289) (steffkes) (elyograg)

### Other (81 changes)

- FunctionQuery, DocValues (and its impls), ValueSource (and its impls) and BoostedQuery have been consolidated into the queries module. They can now be found at o.a.l.queries.function. [LUCENE-2883](https://issues.apache.org/jira/browse/LUCENE-2883) 
- Moved some spellchecker and suggest APIs to modules/suggest: HighFrequencyDictionary, SortedIterator, TermFreqIterator, and the suggester APIs and implementations. [LUCENE-2995](https://issues.apache.org/jira/browse/LUCENE-2995) (rmuir)
- Moved MutableValue classes to new 'common' module. [LUCENE-3232](https://issues.apache.org/jira/browse/LUCENE-3232) (Chris Male)
- 'luke' ant target has been disabled due to incompatibilities with XML queryparser location [LUCENE-3286](https://issues.apache.org/jira/browse/LUCENE-3286) (Chris Male)
- Changed JSONResponseWriter to now use application/json as its Content-Type by default. However the Content-Type can be overwritten and is set to text/plain in the example configuration. [SOLR-1123](https://issues.apache.org/jira/browse/SOLR-1123) (Uri Boness) (Chris Male)
- PingRequestHandler is now directly configured with a "healthcheckFile" instead of looking for the legacy &lt;admin&gt;&lt;healthcheck/&gt;&lt;/admin&gt; syntax. Filenames specified as relative paths have been fixed so that they are resolved against the data dir instead of the CWD of the java process. [SOLR-1258](https://issues.apache.org/jira/browse/SOLR-1258) (hossman)
- Move the default core instance directory into a collection1 folder. [SOLR-1770](https://issues.apache.org/jira/browse/SOLR-1770) (Mark Miller)
- SolrQuery.addFacetQuery now enables facets automatically, like addFacetField [SOLR-1825](https://issues.apache.org/jira/browse/SOLR-1825) (Chris Male)
- Eliminate support for the abortOnConfigurationError option. It has never worked very well, and in recent versions of Solr hasn't worked at all. [SOLR-1846](https://issues.apache.org/jira/browse/SOLR-1846) (hossman)
- The default logic for the 'mm' param of DismaxQParser and ExtendedDismaxQParser has been changed to be determined based on the effective value of the 'q.op' param [SOLR-1889](https://issues.apache.org/jira/browse/SOLR-1889) (hossman)
- Refactored some common code from LRUCache and FastLRUCache into SolrCacheBase [SOLR-1893](https://issues.apache.org/jira/browse/SOLR-1893) (Tomás Fernández Löbbe)
- The data dir from the core descriptor should override the data dir from the solrconfig.xml rather than the other way round. [SOLR-1897](https://issues.apache.org/jira/browse/SOLR-1897) (Mark Miller)
- Misc improvements to the SystemInfoHandler: /admin/system [SOLR-1946](https://issues.apache.org/jira/browse/SOLR-1946) (hossman)
- FacetField.getValues() now returns an empty list if there are no values, instead of null [SOLR-2027](https://issues.apache.org/jira/browse/SOLR-2027) (Chris Male)
- Remove support for deprecated "update.processor" (since 3.2), in favor of "update.chain" [SOLR-2105](https://issues.apache.org/jira/browse/SOLR-2105) (janhoy)
- DIH no longer requires the "config" parameter to be specified in solrconfig.xml. Instead, the configuration is loaded and parsed with every import. This allows the use of a different configuration with each import, and makes correcting configuration errors simpler. Also, the configuration itself can be passed using the "dataConfig" parameter rather than using a file (this previously worked in debug mode only). When configuration errors are encountered, the error message is returned in XML format. [SOLR-2115](https://issues.apache.org/jira/browse/SOLR-2115) (James Dyer)
- Improved README info on solr.solr.home in examples [SOLR-2232](https://issues.apache.org/jira/browse/SOLR-2232) (Eric Pugh and hossman)
- Small tweaks to eliminate compiler warnings. primarily using Generics where applicable in method/object declarations, and adding @SuppressWarnings("unchecked") when appropriate [SOLR-2288](https://issues.apache.org/jira/browse/SOLR-2288) (hossman)
- Tweak spatial coords for example docs so they are a bit more spread out [SOLR-2289](https://issues.apache.org/jira/browse/SOLR-2289) (Erick Erickson)
- Refactor CoreContainer's SolrXML serialization code and improve testing [SOLR-2331](https://issues.apache.org/jira/browse/SOLR-2331) [SOLR-2691](https://issues.apache.org/jira/browse/SOLR-2691) (Yury Kats) (hossman) (Mark Miller)
- Suggester Lookup implementations now store trie data and load it back on init. This means that large tries don't have to be rebuilt on every commit or core reload. [SOLR-2375](https://issues.apache.org/jira/browse/SOLR-2375) (ab)
- Support for returning multi-valued fields w/o &lt;arr&gt; tag in the XMLResponseWriter was removed. XMLResponseWriter only no longer work with values less then 2.2 [SOLR-2413](https://issues.apache.org/jira/browse/SOLR-2413) (ryan)
- FieldType argument changed from String to Object Conversion from SolrInputDocument &gt; Object &gt; Fieldable is now managed by FieldType rather then DocumentBuilder. [SOLR-2423](https://issues.apache.org/jira/browse/SOLR-2423) (ryan)
- QuerySenderListener and AbstractSolrEventListener are now public [SOLR-2461](https://issues.apache.org/jira/browse/SOLR-2461) (hossman)
- Remove deprecated SpellingResult.add(Token, int). [SOLR-2576](https://issues.apache.org/jira/browse/SOLR-2576) (James Dyer)
- Moved VelocityResponseWriter back to contrib module in order to remove it as a mandatory core dependency. [SOLR-2588](https://issues.apache.org/jira/browse/SOLR-2588) (ehatcher)
- Removed deprecated client/ruby directory, which included solr-ruby and flare. [SOLR-2607](https://issues.apache.org/jira/browse/SOLR-2607) (ehatcher)
- Removed obsolete client/ folder [SOLR-2607](https://issues.apache.org/jira/browse/SOLR-2607) (ehatcher) (Eric Pugh) (janhoy)
- The same Directory instance is now always used across a SolrCore so that it's easier to add other DirectoryFactory's without static caching hacks. [SOLR-2654](https://issues.apache.org/jira/browse/SOLR-2654) (Mark Miller)
- FieldTypePluginLoader has been refactored out of IndexSchema and made public. [SOLR-2663](https://issues.apache.org/jira/browse/SOLR-2663) (hossman)
- Enhance CoreAdmin STATUS command to return index size. [SOLR-2698](https://issues.apache.org/jira/browse/SOLR-2698) (Yury Kats) (hossman) (Mark Miller)
- Updated changes2html.pl to handle Solr's CHANGES.txt; added target 'changes-to-html' to solr/build.xml. [SOLR-2747](https://issues.apache.org/jira/browse/SOLR-2747) (Steve Rowe) (Robert Muir)
- Maven configuration: Excluded transitive stax:stax-api dependency from org.codehaus.woodstox:wstx-asl dependency. [SOLR-2756](https://issues.apache.org/jira/browse/SOLR-2756) (David Smiley)
- Due to low level changes to support SolrCloud, the uniqueKey field can no longer be populated via &lt;copyField/&gt; or &lt;field default=...&gt; in the schema.xml. [SOLR-2796](https://issues.apache.org/jira/browse/SOLR-2796) 
- The /update/json and /update/csv URLs were restored to aid in the migration of existing clients. [SOLR-2857](https://issues.apache.org/jira/browse/SOLR-2857) (yonik)
- More explicit lexical resources location logged if Carrot2 clustering extension is used. Fixed solr. impl. of IResource and IResourceLookup. [SOLR-2862](https://issues.apache.org/jira/browse/SOLR-2862) (Dawid Weiss)
- Default QueryResponseWriters are now initialized via init() with an empty NamedList. [SOLR-3005](https://issues.apache.org/jira/browse/SOLR-3005) (Gasol Wu) (Chris Male)
- logOnce from SolrException logOnce and all the supporting structure is gone. abortOnConfigurationError is also gone as it is no longer referenced. Errors should be caught and logged at the top-most level or logged and NOT propagated up the chain. [SOLR-3032](https://issues.apache.org/jira/browse/SOLR-3032) (Erick Erickson)
- JMX beans now report Numbers as numeric values rather then String [SOLR-3083](https://issues.apache.org/jira/browse/SOLR-3083) (Tagged Siteops) (Greg Bowyer)
- Upgrade example and tests to run with Jetty 8 [SOLR-3159](https://issues.apache.org/jira/browse/SOLR-3159) (ryan)
- Dropping Support for JSP. New Admin UI is all client side [SOLR-3202](https://issues.apache.org/jira/browse/SOLR-3202) [SOLR-3244](https://issues.apache.org/jira/browse/SOLR-3244) (ryan) (Aliaksandr Zhuhrou) (Uwe Schindler)
- Clone SolrInputDocument when distrib indexing so that update processors after the distrib update process do not process the document twice. [SOLR-3215](https://issues.apache.org/jira/browse/SOLR-3215) (Mark Miller)
- Upgrade Solr to Tika 1.1 [SOLR-3254](https://issues.apache.org/jira/browse/SOLR-3254) (janhoy)
- The "threads" feature of DIH is removed (deprecated in Solr 3.6) [SOLR-3262](https://issues.apache.org/jira/browse/SOLR-3262) (James Dyer)
- Upgraded SLF4j to version 1.6.4 [SOLR-3302](https://issues.apache.org/jira/browse/SOLR-3302) (hossman)
- web.xml now specifies metadata-complete=true (which requires Servlet 2.5) to prevent servlet containers from scanning class annotations on startup. This allows for faster startup times on some servlet containers. [SOLR-3309](https://issues.apache.org/jira/browse/SOLR-3309) (Bill Bell) (hossman)
- Add more context to IndexReaderFactory.newReader [SOLR-3322](https://issues.apache.org/jira/browse/SOLR-3322) (ab)
- Dropped getSourceID() from SolrInfoMBean and using getClass().getPackage().getSpecificationVersion() for Version. [SOLR-3329](https://issues.apache.org/jira/browse/SOLR-3329) (ryan)
- Moved FastWriter, FileUtils, RegexFileFilter, RTimer and SystemIdResolver from org.apache.solr.common to org.apache.solr.util [SOLR-3343](https://issues.apache.org/jira/browse/SOLR-3343) (Chris Male)
- Add shard and collection to SolrCore statistics. [SOLR-3355](https://issues.apache.org/jira/browse/SOLR-3355) (Michael Garski) (Mark Miller)
- ResourceLoader.newInstance now accepts a Class representation of the expected instance type [SOLR-3357](https://issues.apache.org/jira/browse/SOLR-3357) (Chris Male)
- HTTP caching is now disabled by default for RequestUpdateHandlers. [SOLR-3388](https://issues.apache.org/jira/browse/SOLR-3388) (ryan)
- Deprecated Analysis Factories now log their own deprecation messages. No logging support is provided by Factory parent classes. [SOLR-3403](https://issues.apache.org/jira/browse/SOLR-3403) (Chris Male)
- Refactored DIH internal data classes. All entities in data-config.xml must have a name [SOLR-3422](https://issues.apache.org/jira/browse/SOLR-3422) (James Dyer)
- Make SolrCell easier to use out of the box. Also improves "/browse" to display rich-text documents correctly, along with facets for author and content_type. With the new "content" field, highlighting of body is supported. See also SOLR-3672 for easier posting of a whole directory structure. [SOLR-3439](https://issues.apache.org/jira/browse/SOLR-3439) [SOLR-3672](https://issues.apache.org/jira/browse/SOLR-3672) (Jack Krupansky) (janhoy)
- Make discarding punctuation configurable in JapaneseTokenizerFactory. The default is to discard punctuation, but this is overridable as an expert option. [SOLR-3524](https://issues.apache.org/jira/browse/SOLR-3524) (Kazuaki Hiraga) (Jun Ohtani)
- The Dismax and eDismax query parsers will fall back on the 'df' parameter when 'qf' is absent. And if neither is present nor the schema default search field then an exception will be thrown now. [SOLR-3534](https://issues.apache.org/jira/browse/SOLR-3534) (dsmiley)
- Unloading all cores in a SolrCloud collection will now cause the removal of that collection's meta data from ZooKeeper. [SOLR-3563](https://issues.apache.org/jira/browse/SOLR-3563) (Mark Miller) (Per Steffensen)
- solr.xml should default to persist=true [SOLR-3575](https://issues.apache.org/jira/browse/SOLR-3575) (Mark Miller)
- SolrCloud view should default to the graph view rather than tree view. [SOLR-3579](https://issues.apache.org/jira/browse/SOLR-3579) (steffkes) (Mark Miller)
- Add zkClientTimeout to solr.xml so that it's obvious how to change it and so that you can change it with a system property. [SOLR-3599](https://issues.apache.org/jira/browse/SOLR-3599) (Mark Miller)
- Raise the default zkClientTimeout from 10 seconds to 15 seconds. [SOLR-3600](https://issues.apache.org/jira/browse/SOLR-3600) (Mark Miller)
- Change Solr's expanded webapp directory to be at a consistent path called solr-webapp rather than a temporary directory. [SOLR-3609](https://issues.apache.org/jira/browse/SOLR-3609) (Mark Miller)
- Fail to parse schema.xml if uniqueKeyField is multivalued [SOLR-3682](https://issues.apache.org/jira/browse/SOLR-3682) (hossman)
- Improved error handling if an &lt;analyzer&gt; contains both an explicit class attribute, as well as nested factories. [SOLR-3683](https://issues.apache.org/jira/browse/SOLR-3683) (hossman)
- Fixed binary release packages to include dependencies needed for the solr-test-framework [SOLR-3690](https://issues.apache.org/jira/browse/SOLR-3690) (hossman)
- SimplePostTool: Mode for crawling/posting web pages See https://solr.apache.org/guide/solr/latest/indexing-guide/post-tool.html for examples [SOLR-3691](https://issues.apache.org/jira/browse/SOLR-3691) (janhoy)
- Upgrade Solr to Tika 1.2 [SOLR-3707](https://issues.apache.org/jira/browse/SOLR-3707) (janhoy)
- Allow default UpdateLog syncLevel to be configured by solrconfig.xml [SOLR-3749](https://issues.apache.org/jira/browse/SOLR-3749) (Raintung Li) (Mark Miller)
- Optionally, on session expiration, we can explicitly wait some time before running the leader sync process so that we are sure every node participates. [SOLR-3750](https://issues.apache.org/jira/browse/SOLR-3750) (Per Steffensen) (Mark Miller)
- Add defensive checks for SolrCloud updates and requests that ensure the local state matches what we can tell the request expected. [SOLR-3751](https://issues.apache.org/jira/browse/SOLR-3751) (Mark Miller)
- When a leader goes down, have the Overseer clear the leader state in cluster.json [SOLR-3752](https://issues.apache.org/jira/browse/SOLR-3752) (Mark Miller)
- Optionally, on cluster startup, we can wait until we see all registered replicas before running the leader process - or if they all do not come up, N amount of time. [SOLR-3772](https://issues.apache.org/jira/browse/SOLR-3772) (Jan Høydahl) (Per Steffensen) (Mark Miller)
- Hash based on the external String id rather than the indexed representation for distributed updates. [SOLR-3773](https://issues.apache.org/jira/browse/SOLR-3773) (Michael Garski) (yonik) (Mark Miller)
- Maven build: Make solrj tests run separately from solr-core. [SOLR-3780](https://issues.apache.org/jira/browse/SOLR-3780) (Steve Rowe)
- SolrCloud - Add properties such as "range" to shards, which changes the clusterstate.json and puts the shard replicas under "replicas". [SOLR-3815](https://issues.apache.org/jira/browse/SOLR-3815) (yonik)
- Velocity: Error messages from search not displayed [SOLR-3824](https://issues.apache.org/jira/browse/SOLR-3824) (janhoy)
- Test framework improvements for specifying coreName on initCore [SOLR-3826](https://issues.apache.org/jira/browse/SOLR-3826) (Amit Nithian) (hossman)
- Rename numReplicas to replicationFactor in Collections API. [SOLR-3845](https://issues.apache.org/jira/browse/SOLR-3845) (yonik) (Mark Miller)
- SyncStrategy should have a close so it can abort earlier on shutdown. [SOLR-3870](https://issues.apache.org/jira/browse/SOLR-3870) (Mark Miller)
- SyncStrategy should use an executor for the threads it creates to request recoveries. [SOLR-3871](https://issues.apache.org/jira/browse/SOLR-3871) (Mark Miller)


[4.0.0-BETA] - 2012-08-13
-------------------------

### Added (15 changes)

- Migrated Solr's Tokenizer-, TokenFilter-, and CharFilterFactories to the lucene-analysis module. To add new analysis modules to Solr (like ICU, SmartChinese, Morfologik,...), just drop in the JAR files from Lucene's binary distribution into your Solr instance's lib folder. The factories are automatically made available with SPI. [LUCENE-2510](https://issues.apache.org/jira/browse/LUCENE-2510) [LUCENE-4044](https://issues.apache.org/jira/browse/LUCENE-4044) (Chris Male) (Robert Muir) (Uwe Schindler)
- Added JapaneseIterationMarkCharFilterFactory to normalize Japanese iteration marks. [LUCENE-4201](https://issues.apache.org/jira/browse/LUCENE-4201) (Robert Muir) (Christian Moen)
- Added commented-out example of the new script update processor to the example configuration. [SOLR-1280](https://issues.apache.org/jira/browse/SOLR-1280) (ehatcher)
- Change to updateable documents to create the document if it doesn't already exist. To assert that the document must exist, use the optimistic concurrency feature by specifying a _version_ of 1. [SOLR-139](https://issues.apache.org/jira/browse/SOLR-139) (yonik)
- StatelessScriptUpdateProcessorFactory allows users to implement the full ScriptUpdateProcessor API using any scripting language with a javax.script.ScriptEngineFactory [SOLR-1725](https://issues.apache.org/jira/browse/SOLR-1725) (Uri Boness) (ehatcher) (Simon Rosenthal) (hossman)
- In Solr Cell, literals should override Tika-parsed values. Patch adds a param "literalsOverride" which defaults to true, but can be set to "false" to let Tika-parsed values be appended to literal values [SOLR-1856](https://issues.apache.org/jira/browse/SOLR-1856) (Chris Harris) (janhoy)
- Index encrypted documents with ExtractingUpdateRequestHandler. By supplying resource.password=&lt;mypw&gt; or specifying an external file with regular expressions matching file names, Solr will decrypt and index PDFs and DOCX formats. [SOLR-1929](https://issues.apache.org/jira/browse/SOLR-1929) (janhoy) (Yiannis Pericleous)
- Include a sample java util logging configuration file. [SOLR-2616](https://issues.apache.org/jira/browse/SOLR-2616) (David Smiley) (Mark Miller)
- The default directory factory was changed to NRTCachingDirectoryFactory which wraps the StandardDirectoryFactory and caches small files for improved Near Real-time (NRT) performance. [SOLR-2702](https://issues.apache.org/jira/browse/SOLR-2702) (Mark Miller) (yonik)
- Add cloud-scripts directory and a zkcli.sh|bat tool for easy scripting and interaction with ZooKeeper. [SOLR-3460](https://issues.apache.org/jira/browse/SOLR-3460) (Mark Miller)
- Added a Collection management API for SolrCloud. [SOLR-3488](https://issues.apache.org/jira/browse/SOLR-3488) (Tommaso Teofili) (Sami Siren) (yonik) (Mark Miller)
- Full deleteByQuery support with SolrCloud distributed indexing. All replicas of a shard will be consistent, even if updates arrive in a different order on different replicas. [SOLR-3559](https://issues.apache.org/jira/browse/SOLR-3559) (yonik)
- Add options to remove instance dir or data dir on core unload. [SOLR-3562](https://issues.apache.org/jira/browse/SOLR-3562) (Mark Miller) (Per Steffensen)
- CoreContainer and CoreAdminHandler will now remember and report back information about failures to initialize SolrCores. These failures will be accessible from the web UI and CoreAdminHandler STATUS command until they are "reset" by creating/renaming a SolrCore with the same name. [SOLR-3634](https://issues.apache.org/jira/browse/SOLR-3634) [SOLR-3635](https://issues.apache.org/jira/browse/SOLR-3635) (hossman) (steffkes)
- SimplePostTool: Improvements for posting files Support for auto mode, recursive and wildcards [SOLR-3672](https://issues.apache.org/jira/browse/SOLR-3672) (janhoy)

### Changed (3 changes)

- Add hashCode to ClusterState so that structures built based on the ClusterState can be easily cached. [SOLR-3708](https://issues.apache.org/jira/browse/SOLR-3708) (Mark Miller)
- Cache the url list created from the ClusterState in CloudSolrServer on each request. [SOLR-3709](https://issues.apache.org/jira/browse/SOLR-3709) (Mark Miller) (yonik)
- Change CloudSolrServer so that update requests are only sent to leaders by default. [SOLR-3710](https://issues.apache.org/jira/browse/SOLR-3710) (Mark Miller)

### Fixed (22 changes)

- Fix a bug where CharFilters were wrongly being applied twice. [LUCENE-4185](https://issues.apache.org/jira/browse/LUCENE-4185) (Michael Froh) (rmuir)
- Replication index directories not always cleaned up. [SOLR-1781](https://issues.apache.org/jira/browse/SOLR-1781) (Markus Jelsma) (Terje Sten Bjerkseth) (Mark Miller)
- edismax fails to correctly parse a fielded query wrapped by parens. This regression was introduced in 3.6. [SOLR-3377](https://issues.apache.org/jira/browse/SOLR-3377) (Bernd Fehling) (Jan Høydahl) (yonik)
- SolrCmdDistributor flushAdds/flushDeletes can cause repeated adds/deletes to be sent [SOLR-3428](https://issues.apache.org/jira/browse/SOLR-3428) (Mark Miller) (Per Steffensen)
- ExtendedDismax escaping is missing several reserved characters [SOLR-3467](https://issues.apache.org/jira/browse/SOLR-3467) (Michael Dodsworth) (janhoy)
- Our ZooKeeper watchers respond to session events as if they are change events, creating undesirable side effects. [SOLR-3582](https://issues.apache.org/jira/browse/SOLR-3582) (Trym R. Møller) (Mark Miller)
- After reloading a SolrCore, the original Analyzer is still used rather than a new one. [SOLR-3587](https://issues.apache.org/jira/browse/SOLR-3587) (Alexey Serba) (yonik) (rmuir) (Mark Miller)
- After reloading a core, indexing would fail on any newly added fields to the schema. [SOLR-3610](https://issues.apache.org/jira/browse/SOLR-3610) (Brent Mills) (rmuir)
- Fix rare concurrency issue when opening a new IndexWriter for replication or rollback. [SOLR-3621](https://issues.apache.org/jira/browse/SOLR-3621) (Mark Miller)
- Fixed inconsistent treatment of third-party dependencies for solr contribs analysis-extras & uima [SOLR-3623](https://issues.apache.org/jira/browse/SOLR-3623) (hossman)
- Typo in solr.xml persistence when overriding the solrconfig.xml file name using the "config" attribute prevented the override file from being used. [SOLR-3629](https://issues.apache.org/jira/browse/SOLR-3629) (Ryan Zezeski) (hossman)
- Update ZooKeeper to 3.3.6 for a variety of bug fixes. [SOLR-3639](https://issues.apache.org/jira/browse/SOLR-3639) (Mark Miller)
- Correct broken check for multivalued fields in stats.facet [SOLR-3642](https://issues.apache.org/jira/browse/SOLR-3642) (Yandong Yao) (hossman)
- DistributedQueue should use our Solr zk client rather than the std zk client. ZooKeeper expiration can be permanent otherwise. [SOLR-3647](https://issues.apache.org/jira/browse/SOLR-3647) (Mark Miller)
- Fixed VelocityResponseWriter template loading in SolrCloud mode. For the example configuration, this means /browse now works with SolrCloud. [SOLR-3648](https://issues.apache.org/jira/browse/SOLR-3648) (janhoy) (ehatcher)
- Fixed range faceting to error instead of looping infinitely when 'gap' is zero -- or effectively zero due to floating point arithmetic underflow. [SOLR-3652](https://issues.apache.org/jira/browse/SOLR-3652) (hossman)
- A core reload now always uses the same dataDir. [SOLR-3656](https://issues.apache.org/jira/browse/SOLR-3656) (Mark Miller) (yonik)
- Adding thousands of docs with one UpdateProcessorChain instance can briefly create spikes of threads in the thousands. [SOLR-3658](https://issues.apache.org/jira/browse/SOLR-3658) (yonik) (Mark Miller)
- Velocity: Link to admin page broken [SOLR-3660](https://issues.apache.org/jira/browse/SOLR-3660) (janhoy)
- Core reload bugs: a reload always obtained a non-NRT searcher, which could go back in time with respect to the previous core's NRT searcher. Versioning did not work correctly across a core reload, and update handler synchronization was changed to synchronize on core state since more than on update handler can coexist for a single index during a reload. [SOLR-3662](https://issues.apache.org/jira/browse/SOLR-3662) (yonik)
- There are a couple of bugs in the sync process when a leader goes down and a new leader is elected. [SOLR-3663](https://issues.apache.org/jira/browse/SOLR-3663) (Mark Miller)
- Fixed misleading error message in web ui to distinguish between no SolrCores loaded vs. no /admin/ handler available. [SOLR-3677](https://issues.apache.org/jira/browse/SOLR-3677) (hossman) (steffkes)

### Other (14 changes)

- Move the default core instance directory into a collection1 folder. [SOLR-1770](https://issues.apache.org/jira/browse/SOLR-1770) (Mark Miller)
- DIH no longer requires the "config" parameter to be specified in solrconfig.xml. Instead, the configuration is loaded and parsed with every import. This allows the use of a different configuration with each import, and makes correcting configuration errors simpler. Also, the configuration itself can be passed using the "dataConfig" parameter rather than using a file (this previously worked in debug mode only). When configuration errors are encountered, the error message is returned in XML format. [SOLR-2115](https://issues.apache.org/jira/browse/SOLR-2115) (James Dyer)
- Clone SolrInputDocument when distrib indexing so that update processors after the distrib update process do not process the document twice. [SOLR-3215](https://issues.apache.org/jira/browse/SOLR-3215) (Mark Miller)
- Add shard and collection to SolrCore statistics. [SOLR-3355](https://issues.apache.org/jira/browse/SOLR-3355) (Michael Garski) (Mark Miller)
- Make SolrCell easier to use out of the box. Also improves "/browse" to display rich-text documents correctly, along with facets for author and content_type. With the new "content" field, highlighting of body is supported. See also SOLR-3672 for easier posting of a whole directory structure. [SOLR-3439](https://issues.apache.org/jira/browse/SOLR-3439) [SOLR-3672](https://issues.apache.org/jira/browse/SOLR-3672) (Jack Krupansky) (janhoy)
- Make discarding punctuation configurable in JapaneseTokenizerFactory. The default is to discard punctuation, but this is overridable as an expert option. [SOLR-3524](https://issues.apache.org/jira/browse/SOLR-3524) (Kazuaki Hiraga) (Jun Ohtani) (Christian Moen)
- Unloading all cores in a SolrCloud collection will now cause the removal of that collection's meta data from ZooKeeper. [SOLR-3563](https://issues.apache.org/jira/browse/SOLR-3563) (Mark Miller) (Per Steffensen)
- solr.xml should default to persist=true [SOLR-3575](https://issues.apache.org/jira/browse/SOLR-3575) (Mark Miller)
- SolrCloud view should default to the graph view rather than tree view. [SOLR-3579](https://issues.apache.org/jira/browse/SOLR-3579) (steffkes) (Mark Miller)
- Add zkClientTimeout to solr.xml so that it's obvious how to change it and so that you can change it with a system property. [SOLR-3599](https://issues.apache.org/jira/browse/SOLR-3599) (Mark Miller)
- Raise the default zkClientTimeout from 10 seconds to 15 seconds. [SOLR-3600](https://issues.apache.org/jira/browse/SOLR-3600) (Mark Miller)
- Change Solr's expanded webapp directory to be at a consistent path called solr-webapp rather than a temporary directory. [SOLR-3609](https://issues.apache.org/jira/browse/SOLR-3609) (Mark Miller)
- Fail to parse schema.xml if uniqueKeyField is multivalued [SOLR-3682](https://issues.apache.org/jira/browse/SOLR-3682) (hossman)
- Improved error handling if an &lt;analyzer&gt; contains both an explicit class attribute, as well as nested factories. [SOLR-3683](https://issues.apache.org/jira/browse/SOLR-3683) (hossman)


[4.0.0-ALPHA] - 2012-07-03
--------------------------

### Added (60 changes)

- CSV handler now supports "literal.field_name=value" parameters. [SOLR-1032](https://issues.apache.org/jira/browse/SOLR-1032) (Simon Rosenthal) (ehatcher)
- Return FunctionQuery as pseudo field. The solr 'fl' param now supports functions. For example: fl=id,sum(x,y) -- NOTE: only functions with fast random access are recommended. [SOLR-1298](https://issues.apache.org/jira/browse/SOLR-1298) (yonik) (ryan)
- Updateable documents. JSON Example: {"id":"mydoc", "f1":{"set":10}, "f2":{"add":20}} will result in field "f1" being set to 10, "f2" having an additional value of 20 added, and all other existing fields unchanged. All source fields must be stored for this feature to work correctly. [SOLR-139](https://issues.apache.org/jira/browse/SOLR-139) (Ryan McKinley) (Erik Hatcher) (yonik)
- PreAnalyzedField type provides a functionality to index (and optionally store) field content that was already processed and split into tokens using some external processing chain. Serialization format is pluggable, and defaults to JSON. [SOLR-1535](https://issues.apache.org/jira/browse/SOLR-1535) (ab)
- Transforming documents in the ResponseWriters. This will allow for more complex results in responses and open the door for function queries as results. (ryan with patches from grant, noble, cmale, yonik, Jan Høydahl, Arul Kalaipandian, Luca Cavanna, hossman) - SOLR-2037: Thanks to SOLR-1566, documents boosted by the QueryElevationComponent can be marked as boosted. [SOLR-1566](https://issues.apache.org/jira/browse/SOLR-1566) [SOLR-2037](https://issues.apache.org/jira/browse/SOLR-2037) (gsingers) (ryan) (yonik)
- Add debug component options for timings, results and query info only [SOLR-1665](https://issues.apache.org/jira/browse/SOLR-1665) (gsingers) (hossman) (yonik)
- SolrCloud - added shared/central config and core/shard management via zookeeper, built-in load balancing, and distributed indexing. (Jamie Johnson, Sami Siren, Ted Dunning, yonik, Mark Miller) Additional Work: - SOLR-2324: SolrCloud solr.xml parameters are not persisted by CoreContainer. (Massimo Schiavon, Mark Miller) - SOLR-2287: Allow users to query by multiple, compatible collections with SolrCloud. (Soheb Mahmood, Alex Cowell, Mark Miller) - SOLR-2622: ShowFileRequestHandler does not work in SolrCloud mode. (Stefan Matheis, Mark Miller) - SOLR-3108: Error in SolrCloud's replica lookup code when replica's are hosted in same Solr instance. (Bruno Dumon, Sami Siren, Mark Miller) - SOLR-3080: Remove shard info from zookeeper when SolrCore is explicitly unloaded. (yonik, Mark Miller, siren) - SOLR-3437: Recovery issues a spurious commit to the cluster. (Trym R. Møller via Mark Miller) - SOLR-2822: Skip update processors already run on other nodes [SOLR-1873](https://issues.apache.org/jira/browse/SOLR-1873) [SOLR-2358](https://issues.apache.org/jira/browse/SOLR-2358) [SOLR-2324](https://issues.apache.org/jira/browse/SOLR-2324) [SOLR-2287](https://issues.apache.org/jira/browse/SOLR-2287) [SOLR-2622](https://issues.apache.org/jira/browse/SOLR-2622) [SOLR-3108](https://issues.apache.org/jira/browse/SOLR-3108) [SOLR-3080](https://issues.apache.org/jira/browse/SOLR-3080) [SOLR-3437](https://issues.apache.org/jira/browse/SOLR-3437) [SOLR-2822](https://issues.apache.org/jira/browse/SOLR-2822) (hossman)
- New relevancy function queries: termfreq, tf, docfreq, idf norm, maxdoc, numdocs. [SOLR-1932](https://issues.apache.org/jira/browse/SOLR-1932) (yonik)
- Added the ability to select postings format per fieldType in schema.xml as well as support custom Codecs in solrconfig.xml. [SOLR-1942](https://issues.apache.org/jira/browse/SOLR-1942) (simonw) (rmuir)
- Edismax query parser to allow "phrase slop" to be specified per-field on the pf/pf2/pf3 parameters using optional "FieldName~slop^boost" syntax. The prior "FieldName^boost" syntax is still accepted. In such cases the value on the "ps" parameter serves as the default slop. [SOLR-2058](https://issues.apache.org/jira/browse/SOLR-2058) (Ron Mayer) (James Dyer)
- Solrj API now supports streaming results. [SOLR-2112](https://issues.apache.org/jira/browse/SOLR-2112) (ryan)
- Trie* fields should support sortMissingLast=true, and deprecate Sortable* Field Types [SOLR-2134](https://issues.apache.org/jira/browse/SOLR-2134) (Ryan McKinley) (Mike McCandless) (Uwe Schindler) (Erick Erickson)
- Boolean type added to function queries, along with new functions exists(), if(), and(), or(), xor(), not(), def(), and true and false constants. [SOLR-2136](https://issues.apache.org/jira/browse/SOLR-2136) (yonik)
- You may now specify a 'soft' commit when committing. This will use Lucene's NRT feature to avoid guaranteeing documents are on stable storage in exchange for faster reopen times. There is also a new 'soft' autocommit tracker that can be configured. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) (Mark Miller) (Robert Muir)
- Pseudo-join queries / filters. Examples: - To restrict to the set of parents with at least one blue-eyed child: fq={!join from=parent to=name}eyes:blue - To restrict to the set of children with at least one blue-eyed parent: fq={!join from=name to=parent}eyes:blue [SOLR-2272](https://issues.apache.org/jira/browse/SOLR-2272) (yonik)
- New 'field("...")' function syntax for referring to complex field names (containing whitespace or special characters) in functions. [SOLR-2335](https://issues.apache.org/jira/browse/SOLR-2335) 
- Add support for using &lt;similarity/&gt; in a schema's fieldType, for customizing scoring on a per-field basis. [SOLR-2338](https://issues.apache.org/jira/browse/SOLR-2338) (hossman) (yonik) (rmuir)
- /browse improvements: generalize range and date facet display [SOLR-2383](https://issues.apache.org/jira/browse/SOLR-2383) (Jan Høydahl) (yonik)
- Add CollationField, which is much more efficient than the Solr 3.x CollationKeyFilterFactory, and also supports Locale-sensitive range queries. [SOLR-2396](https://issues.apache.org/jira/browse/SOLR-2396) (rmuir)
- Add ICUCollationField to contrib/analysis-extras, which is much more efficient than the Solr 3.x ICUCollationKeyFilterFactory, and also supports Locale-sensitive range queries. [SOLR-2396](https://issues.apache.org/jira/browse/SOLR-2396) (rmuir)
- Updated Solr Admin interface. New look and feel with per core administration and many new options. [SOLR-2399](https://issues.apache.org/jira/browse/SOLR-2399) (Stefan Matheis) (ryan)
- Add explain info directly to return documents using ?fl=id,[explain] [SOLR-2417](https://issues.apache.org/jira/browse/SOLR-2417) (ryan)
- added MultiTermAwareComponent to the various classes to allow automatic lowercasing for multiterm queries (wildcards, regex, prefix, range, etc). You can now optionally specify a "multiterm" analyzer in our schema.xml, but Solr should "do the right thing" if you don't specify &lt;analyzer type="multiterm"&gt; [SOLR-2438](https://issues.apache.org/jira/browse/SOLR-2438) (Pete Sturge Erick Erickson) (Mentoring from Seeley and Muir)
- Expose LogLevel selection with a RequestHandler rather then servlet [SOLR-2459](https://issues.apache.org/jira/browse/SOLR-2459) (Stefan Matheis) (Upayavira) (ryan)
- Add support for commitWithin in DataImportHandler [SOLR-2481](https://issues.apache.org/jira/browse/SOLR-2481) (Sami Siren) (yonik)
- Add support for using spellcheck collation in conjunction with grouping. Note that the number of hits returned for collations is the number of ungrouped hits. [SOLR-2491](https://issues.apache.org/jira/browse/SOLR-2491) (James Dyer) (rmuir)
- Converted ValueSource.ValueSourceSortField over to new rewriteable Lucene SortFields. ValueSourceSortField instances must be rewritten before they can be used. This is done by SolrIndexSearcher when necessary. [SOLR-2533](https://issues.apache.org/jira/browse/SOLR-2533) (Chris Male)
- Added DirectSolrSpellChecker, which uses Lucene's DirectSpellChecker to retrieve correction candidates directly from the term dictionary using levenshtein automata. [LUCENE-2507](https://issues.apache.org/jira/browse/LUCENE-2507) [SOLR-2571](https://issues.apache.org/jira/browse/SOLR-2571) [SOLR-2576](https://issues.apache.org/jira/browse/SOLR-2576) (James Dyer) (rmuir)
- Context-Sensitive Spelling Suggestions & Collations. This adds support for the "spellcheck.alternativeTermCount" & "spellcheck.maxResultsForSuggest" parameters, letting users receive suggestions even when all the queried terms exist in the dictionary. This differs from "spellcheck.onlyMorePopular" in that the suggestions need not consist entirely of terms with a greater document frequency than the queried terms. [SOLR-2585](https://issues.apache.org/jira/browse/SOLR-2585) (James Dyer)
- CloneFieldUpdateProcessorFactory provides similar functionality to schema.xml's &lt;copyField/&gt; declaration but as an update processor that can be combined with other processors in any order. [SOLR-2599](https://issues.apache.org/jira/browse/SOLR-2599) (Jan Høydahl & hossman)
- realtime-get, efficiently retrieves the latest stored fields for specified documents, even if they are not yet searchable (i.e. without reopening a searcher) [SOLR-2656](https://issues.apache.org/jira/browse/SOLR-2656) (yonik)
- New support for a "TZ" request param which overrides the TimeZone used when rounding Dates in DateMath expressions for the entire request (all date range queries and date faceting is affected). The default TZ is still UTC. [SOLR-2690](https://issues.apache.org/jira/browse/SOLR-2690) (David Schlotfeldt) (hossman)
- Added support for Lucene's "surround" query parser. [SOLR-2703](https://issues.apache.org/jira/browse/SOLR-2703) (Simon Rosenthal) (ehatcher)
- Added factories for several ranking algorithms: - BM25SimilarityFactory: Okapi BM25 - DFRSimilarityFactory: Divergence from Randomness models - IBSimilarityFactory: Information-based models - LMDirichletSimilarity: LM with Dirichlet smoothing - LMJelinekMercerSimilarity: LM with Jelinek-Mercer smoothing [SOLR-2754](https://issues.apache.org/jira/browse/SOLR-2754) (David Mark Nemeskey) (Robert Muir)
- New FieldMutatingUpdateProcessor and Factory to simplify the development of UpdateProcessors that modify field values of documents as they are indexed. Also includes several useful new implementations: - RemoveBlankFieldUpdateProcessorFactory - TrimFieldUpdateProcessorFactory - HTMLStripFieldUpdateProcessorFactory - RegexReplaceProcessorFactory - FieldLengthUpdateProcessorFactory - ConcatFieldUpdateProcessorFactory - FirstFieldValueUpdateProcessorFactory - LastFieldValueUpdateProcessorFactory - MinFieldValueUpdateProcessorFactory - MaxFieldValueUpdateProcessorFactory - TruncateFieldUpdateProcessorFactory - IgnoreFieldUpdateProcessorFactory [SOLR-2802](https://issues.apache.org/jira/browse/SOLR-2802) (hossman) (janhoy)
- Support XML,CSV,JSON, and javabin in a single RequestHandler and choose the correct ContentStreamLoader based on Content-Type header. This also deprecates the existing [Xml,JSON,CSV,Binary,Xslt]UpdateRequestHandler. [SOLR-2857](https://issues.apache.org/jira/browse/SOLR-2857) (ryan)
- Support grouped faceting. (Martijn van Groningen) Additional Work: - SOLR-3406: Extended grouped faceting support to facet.query and facet.range parameters. [SOLR-2898](https://issues.apache.org/jira/browse/SOLR-2898) [SOLR-3406](https://issues.apache.org/jira/browse/SOLR-3406) (David Boychuck) (Martijn van Groningen)
- Added LFU cache options to Solr. [SOLR-2906](https://issues.apache.org/jira/browse/SOLR-2906) (Shawn Heisey) (Erick Erickson)
- QueryElevationComponent is now supported with distributed search. [SOLR-2949](https://issues.apache.org/jira/browse/SOLR-2949) (Mark Miller) (yonik)
- Add support for IndexWriter.prepareCommit() via prepareCommit=true on update URLs. [SOLR-2992](https://issues.apache.org/jira/browse/SOLR-2992) (yonik)
- Add WordBreakSolrSpellChecker to offer suggestions by combining adjacent query terms and/or breaking terms into multiple words. This spellchecker can be configured with a traditional checker (ie: DirectSolrSpellChecker). The results are combined and collations can contain a mix of corrections from both spellcheckers. [SOLR-2993](https://issues.apache.org/jira/browse/SOLR-2993) (James Dyer)
- Ability to add openSearcher=false to not open a searcher when doing a hard commit. commitWithin now only invokes a softCommit. [SOLR-3069](https://issues.apache.org/jira/browse/SOLR-3069) (yonik)
- Optional post filtering for spatial queries bbox and geofilt for LatLonType. [SOLR-3120](https://issues.apache.org/jira/browse/SOLR-3120) (yonik)
- Include shard info in distributed response when shards.info=true [SOLR-3134](https://issues.apache.org/jira/browse/SOLR-3134) (Russell Black) (ryan)
- Optimistic locking. If a _version_ is provided with an update that does not match the version in the index, an HTTP 409 error (Conflict) will result. [SOLR-3178](https://issues.apache.org/jira/browse/SOLR-3178) (Per Steffensen) (yonik)
- Allow parameter overrides in conjunction with "spellcheck.maxCollationTries". To do so, use parameters starting with "spellcheck.collateParam." For instance, to override the "mm" parameter, specify "spellcheck.collateParam.mm". This is helpful in cases where testing spellcheck collations for result counts should use different parameters from the main query [SOLR-3211](https://issues.apache.org/jira/browse/SOLR-3211) (James Dyer)
- Added the ability to directly configure aspects of the concurrency and thread-pooling used within distributed search in solr. This allows for finer grained controlled and can be tuned by end users to target their own specific requirements. This builds on the work of the HttpCommComponent and uses the same configuration block to configure the thread pool. The default configuration has the same behaviour as solr 3.5, favouring throughput over latency. More information can be found on the wiki (http://wiki.apache.org/solr/SolrConfigXml) [SOLR-3221](https://issues.apache.org/jira/browse/SOLR-3221) (Greg Bowyer)
- OpenExchangeRates.Org Exchange Rate Provider for CurrencyField [SOLR-3255](https://issues.apache.org/jira/browse/SOLR-3255) (janhoy)
- Solr filter factory for MorfologikFilter (Polish lemmatisation). [SOLR-3272](https://issues.apache.org/jira/browse/SOLR-3272) (Rafał Kuć) (Dawid Weiss) (Steven Rowe) (Uwe Schindler)
- Negative boost support to the Extended Dismax Query Parser Boost Query (bq). [SOLR-3278](https://issues.apache.org/jira/browse/SOLR-3278) (James Dyer)
- eDismax: ps2 and ps3 params [SOLR-3351](https://issues.apache.org/jira/browse/SOLR-3351) (janhoy)
- Logging events are captured and available from the /admin/logging request handler. [SOLR-3358](https://issues.apache.org/jira/browse/SOLR-3358) (ryan)
- Consolidated Exceptions in Analysis Factories so they only throw InitializationExceptions [SOLR-3363](https://issues.apache.org/jira/browse/SOLR-3363) (Chris Male)
- Analysis Factories are now configured with their Lucene Version throw setLuceneMatchVersion, rather than through the Map passed to init. Parsing and simple error checking for the Version is now done inside the code that creates the Analysis Factories. [SOLR-3402](https://issues.apache.org/jira/browse/SOLR-3402) (Chris Male)
- New UpdateProcessors have been added to create default values for configured fields. These works similarly to the &lt;field default="..."/&gt; option in schema.xml, but are applied in the UpdateProcessorChain, so they may be used prior to other UpdateProcessors, or to generate a uniqueKey field value when using the DistributedUpdateProcessor (ie: SolrCloud) TimestampUpdateProcessorFactory UUIDUpdateProcessorFactory DefaultValueUpdateProcessorFactory [SOLR-3495](https://issues.apache.org/jira/browse/SOLR-3495) (hossman)
- Simplify JSON update format for deletes as well as allow version specification for optimistic locking. Examples: - {"delete":"myid"} - {"delete":["id1","id2","id3"]} - {"delete":{"id":"myid", "_version_":123456789}} [SOLR-3508](https://issues.apache.org/jira/browse/SOLR-3508) (yonik)
- Add WeightedFragListBuilder for FVH and set it to default fragListBuilder in example solrconfig.xml. [SOLR-3542](https://issues.apache.org/jira/browse/SOLR-3542) (Sebastian Lutze) (koji)
- The autowarmCount for LRUCaches (LRUCache and FastLRUCache) now supports "percentages" which get evaluated relative the current size of the cache when warming happens. [SOLR-571](https://issues.apache.org/jira/browse/SOLR-571) (Tomás Fernández Löbbe and hossman)
- Optionally return shard info with each document in distributed search. Use fl=id,[shard] to return the shard url. [SOLR-705](https://issues.apache.org/jira/browse/SOLR-705) (ryan)
- Adding PivotFacetComponent for Hierarchical faceting [SOLR-792](https://issues.apache.org/jira/browse/SOLR-792) (ehatcher) (Jeremy Hinegardner) (Thibaut Lassalle) (ryan)

### Changed (5 changes)

- Per-segment field faceting for single valued string fields. Enable with facet.method=fcs, control the number of threads used with the "threads" local param on the facet.field param. This algorithm will only be faster in the presence of rapid index changes. [SOLR-1875](https://issues.apache.org/jira/browse/SOLR-1875) (yonik)
- When facet.enum.cache.minDf &gt; 0 and the base doc set is a SortedIntSet, convert to HashDocSet for better performance. [SOLR-1904](https://issues.apache.org/jira/browse/SOLR-1904) (yonik)
- Speed up single-valued and multi-valued "fc" faceting. Typical improvement is 5%, but can be much greater (up to 10x faster) when facet.offset is very large (deep paging). [SOLR-2092](https://issues.apache.org/jira/browse/SOLR-2092) (yonik)
- The default Solr update handler has been improved so that it uses fewer locks, keeps the IndexWriter open rather than closing it on each commit (ie commits no longer wait for background merges to complete), works with SolrCore to provide faster 'soft' commits, and has an improved API that requires less instanceof special casing. (Mark Miller, Robert Muir) Additional Work: - SOLR-2697: commit and autocommit operations don't reset DirectUpdateHandler2.numDocsPending stats attribute. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) [SOLR-2697](https://issues.apache.org/jira/browse/SOLR-2697) (Alexey Serba) (Mark Miller)
- The QueryElevationComponent now avoids using the FieldCache and looking up every document id [SOLR-2950](https://issues.apache.org/jira/browse/SOLR-2950) (gsingers) (yonik)

### Fixed (41 changes)

- Cleaner path usage in TestXPathEntityProcessor [LUCENE-4075](https://issues.apache.org/jira/browse/LUCENE-4075) (Greg Bowyer) (hossman)
- QueryElevationComponent now supports non-string ids [SOLR-1520](https://issues.apache.org/jira/browse/SOLR-1520) (gsingers)
- Made it clearer when a core failed to load as well as better logging when the QueryElevationComponent fails to properly initialize [SOLR-1730](https://issues.apache.org/jira/browse/SOLR-1730) (gsingers)
- IndexSchema will now fail to initialize if there is a problem initializing one of the fields or field types. [SOLR-1824](https://issues.apache.org/jira/browse/SOLR-1824) (hossman)
- Fixed SignatureUpdateProcessor to fail to initialize on invalid config. Specifically: a signatureField that does not exist, or overwriteDupes=true with a signatureField that is not indexed. [SOLR-1908](https://issues.apache.org/jira/browse/SOLR-1908) (hossman)
- TermsComponent didn't correctly break ties for non-text fields sorted by count. [SOLR-1928](https://issues.apache.org/jira/browse/SOLR-1928) (yonik)
- When using the MailEntityProcessor, import would fail if fetchMailsSince was not specified. [SOLR-1958](https://issues.apache.org/jira/browse/SOLR-1958) (Max Lynch) (James Dyer)
- SolrCore#initIndex should not use a mix of indexPath and newIndexPath [SOLR-1962](https://issues.apache.org/jira/browse/SOLR-1962) (Mark Miller)
- MoreLikeThisHandler doesn't work with alternate qparsers. [SOLR-2107](https://issues.apache.org/jira/browse/SOLR-2107) (yonik)
- Fixed false positives when using wildcard queries on fields with reversed wildcard support. For example, a query of *zemog* would match documents that contain 'gomez'. [SOLR-2108](https://issues.apache.org/jira/browse/SOLR-2108) (Landon Kuhn) (Robert Muir)
- SolrCores now properly share IndexWriters across SolrCore reloads. (Mark Miller, Robert Muir) Additional Work: - SOLR-2705: On reload, IndexWriterProvider holds onto the initial SolrCore it was created with. [SOLR-2193](https://issues.apache.org/jira/browse/SOLR-2193) [SOLR-2565](https://issues.apache.org/jira/browse/SOLR-2565) [SOLR-2651](https://issues.apache.org/jira/browse/SOLR-2651) [SOLR-2705](https://issues.apache.org/jira/browse/SOLR-2705) (Yury Kats) (Mark Miller)
- fix DisMax 'mm' parsing to be tolerant of whitespace [SOLR-2275](https://issues.apache.org/jira/browse/SOLR-2275) (Erick Erickson) (hossman)
- Fixed TermVectorComponent so that it will not fail if the fl param contains globs or pseudo-fields [SOLR-2352](https://issues.apache.org/jira/browse/SOLR-2352) (hossman)
- StringIndexOutOfBoundsException in the spellchecker collate when the term contains a hyphen. [SOLR-2509](https://issues.apache.org/jira/browse/SOLR-2509) (Thomas Gambier caught the bug) (Steffen Godskesen did the patch) (Erick Erickson)
- fixed tracking of the 'defaultCoreName' in CoreContainer so that CoreAdminHandler could return consistent information regardless of whether there is a a default core name or not. [SOLR-2605](https://issues.apache.org/jira/browse/SOLR-2605) (steffkes) (hossman)
- Directorys used by a SolrCore are now closed when they are no longer used. [SOLR-2654](https://issues.apache.org/jira/browse/SOLR-2654) (Mark Miller)
- Remove addException() in SimpleFacet. FacetComponent no longer catches and embeds exceptions occurred during facet processing, it throws HTTP 400 or 500 exceptions instead. [SOLR-2682](https://issues.apache.org/jira/browse/SOLR-2682) (koji)
- Bugs in facet range display in trunk [SOLR-2741](https://issues.apache.org/jira/browse/SOLR-2741) (janhoy)
- FSTLookup could return duplicate results or one results less than requested. [SOLR-2762](https://issues.apache.org/jira/browse/SOLR-2762) (David Smiley) (Dawid Weiss)
- Fix problem with false-positives due to incorrect equals methods. [SOLR-2829](https://issues.apache.org/jira/browse/SOLR-2829) (Yonik Seeley) (Hossman) (Erick Erickson. Marc Tinnemeyer caught the bug)
- Removed 'instanceof AbstractLuceneSpellChecker' hacks from distributed spellchecking code, and added a merge() method to SolrSpellChecker instead. Previously if you extended SolrSpellChecker your spellchecker would not work in distributed fashion. [SOLR-2848](https://issues.apache.org/jira/browse/SOLR-2848) (James Dyer) (rmuir)
- Now load URL content stream data (via stream.url) when called for during request handling, rather than loading URL content streams automatically regardless of use. [SOLR-2854](https://issues.apache.org/jira/browse/SOLR-2854) (David Smiley and Ryan McKinley) (ehatcher)
- IllegalArgumentException when using useFilterForSortedQuery on an empty index. [SOLR-2923](https://issues.apache.org/jira/browse/SOLR-2923) (Adrien Grand) (Mark Miller)
- When using binary format in solrj the codec screws up parameters [SOLR-3037](https://issues.apache.org/jira/browse/SOLR-3037) (Sami Siren) (Jörg Maier) (yonik)
- A join in the main query was not respecting any filters pushed down to it via acceptDocs since LUCENE-1536. [SOLR-3062](https://issues.apache.org/jira/browse/SOLR-3062) [LUCENE-1536](https://issues.apache.org/jira/browse/LUCENE-1536) (Mike Hugo) (yonik)
- Occasional NPE in ThreadDumpHandler [SOLR-3068](https://issues.apache.org/jira/browse/SOLR-3068) (siren)
- Make ConcurrentUpdateSolrServer send UpdateRequest.getParams() as HTTP request params [SOLR-3139](https://issues.apache.org/jira/browse/SOLR-3139) (siren)
- Cannot use DIH in Solrcloud + Zookeeper [SOLR-3165](https://issues.apache.org/jira/browse/SOLR-3165) (Alexey Serba) (Mark Miller) (siren)
- If you use multiple fl entries rather than a comma separated list, all but the first entry can be ignored if you are using distributed search. [SOLR-3214](https://issues.apache.org/jira/browse/SOLR-3214) (Tomás Fernández Löbbe) (Mark Miller)
- eDismax: pf2 should kick in for a query with 2 terms [SOLR-3352](https://issues.apache.org/jira/browse/SOLR-3352) (janhoy)
- ReplicationHandler "maxNumberOfBackups" doesn't work if backups are triggered on commit [SOLR-3361](https://issues.apache.org/jira/browse/SOLR-3361) (James Dyer) (Tomás Fernández Löbbe)
- fixed CSVResponseWriter to respect globs in the 'fl' param [SOLR-3370](https://issues.apache.org/jira/browse/SOLR-3370) (Keith Fligg) (hossman)
- Added a new DIH test against a real SQL database. Fixed problems revealed by this new test related to the expanded cache support added to 3.6/SOLR-2382 [SOLR-3430](https://issues.apache.org/jira/browse/SOLR-3430) [SOLR-2382](https://issues.apache.org/jira/browse/SOLR-2382) (James Dyer)
- Group count incorrect when not all shards are queried in the second pass. [SOLR-3436](https://issues.apache.org/jira/browse/SOLR-3436) (Francois Perron) (Martijn van Groningen)
- Better errors when PatternTokenizerFactory is configured with an invalid pattern, and include the 'name' whenever possible in plugin init error messages. [SOLR-3446](https://issues.apache.org/jira/browse/SOLR-3446) (hossman)
- Exception when using result grouping with main=true and using wt=javabin. [SOLR-3454](https://issues.apache.org/jira/browse/SOLR-3454) (Ludovic Boutros) (Martijn van Groningen)
- contrib/clustering: custom Carrot2 tokenizer and stemmer factories are respected now [SOLR-3470](https://issues.apache.org/jira/browse/SOLR-3470) (Stanislaw Osinski) (Dawid Weiss)
- fixed parsing of the 'literal()' function [SOLR-3522](https://issues.apache.org/jira/browse/SOLR-3522) (hossman)
- add missing solrj dependencies to binary packages. [SOLR-3541](https://issues.apache.org/jira/browse/SOLR-3541) (Thijs Vonk) (siren)
- Fixed a bug in the cachability of queries using the {!join} parser or the strdist() function, as well as some minor improvements to the hashCode implementation of {!bbox} and {!geofilt} queries. [SOLR-3548](https://issues.apache.org/jira/browse/SOLR-3548) (hossman)
- Admin UI - JVM memory bar - dark grey "used" width is too small [SOLR-4289](https://issues.apache.org/jira/browse/SOLR-4289) (steffkes) (elyograg)

### Other (49 changes)

- FunctionQuery, DocValues (and its impls), ValueSource (and its impls) and BoostedQuery have been consolidated into the queries module. They can now be found at o.a.l.queries.function. [LUCENE-2883](https://issues.apache.org/jira/browse/LUCENE-2883) 
- Moved some spellchecker and suggest APIs to modules/suggest: HighFrequencyDictionary, SortedIterator, TermFreqIterator, and the suggester APIs and implementations. [LUCENE-2995](https://issues.apache.org/jira/browse/LUCENE-2995) (rmuir)
- Moved MutableValue classes to new 'common' module. [LUCENE-3232](https://issues.apache.org/jira/browse/LUCENE-3232) (Chris Male)
- 'luke' ant target has been disabled due to incompatibilities with XML queryparser location [LUCENE-3286](https://issues.apache.org/jira/browse/LUCENE-3286) (Chris Male)
- Changed JSONResponseWriter to now use application/json as its Content-Type by default. However the Content-Type can be overwritten and is set to text/plain in the example configuration. [SOLR-1123](https://issues.apache.org/jira/browse/SOLR-1123) (Uri Boness) (Chris Male)
- PingRequestHandler is now directly configured with a "healthcheckFile" instead of looking for the legacy &lt;admin&gt;&lt;healthcheck/&gt;&lt;/admin&gt; syntax. Filenames specified as relative paths have been fixed so that they are resolved against the data dir instead of the CWD of the java process. [SOLR-1258](https://issues.apache.org/jira/browse/SOLR-1258) (hossman)
- SolrQuery.addFacetQuery now enables facets automatically, like addFacetField [SOLR-1825](https://issues.apache.org/jira/browse/SOLR-1825) (Chris Male)
- Eliminate support for the abortOnConfigurationError option. It has never worked very well, and in recent versions of Solr hasn't worked at all. [SOLR-1846](https://issues.apache.org/jira/browse/SOLR-1846) (hossman)
- The default logic for the 'mm' param of DismaxQParser and ExtendedDismaxQParser has been changed to be determined based on the effective value of the 'q.op' param [SOLR-1889](https://issues.apache.org/jira/browse/SOLR-1889) (hossman)
- Refactored some common code from LRUCache and FastLRUCache into SolrCacheBase [SOLR-1893](https://issues.apache.org/jira/browse/SOLR-1893) (Tomás Fernández Löbbe) (hossman)
- The data dir from the core descriptor should override the data dir from the solrconfig.xml rather than the other way round. [SOLR-1897](https://issues.apache.org/jira/browse/SOLR-1897) (Mark Miller)
- Misc improvements to the SystemInfoHandler: /admin/system [SOLR-1946](https://issues.apache.org/jira/browse/SOLR-1946) (hossman)
- FacetField.getValues() now returns an empty list if there are no values, instead of null [SOLR-2027](https://issues.apache.org/jira/browse/SOLR-2027) (Chris Male)
- Remove support for deprecated "update.processor" (since 3.2), in favor of "update.chain" [SOLR-2105](https://issues.apache.org/jira/browse/SOLR-2105) (janhoy)
- Improved README info on solr.solr.home in examples [SOLR-2232](https://issues.apache.org/jira/browse/SOLR-2232) (Eric Pugh and hossman)
- Small tweaks to eliminate compiler warnings. primarily using Generics where applicable in method/object declarations, and adding @SuppressWarnings("unchecked") when appropriate [SOLR-2288](https://issues.apache.org/jira/browse/SOLR-2288) (hossman)
- Tweak spatial coords for example docs so they are a bit more spread out [SOLR-2289](https://issues.apache.org/jira/browse/SOLR-2289) (Erick Erickson) (hossman)
- Refactor CoreContainer's SolrXML serialization code and improve testing [SOLR-2331](https://issues.apache.org/jira/browse/SOLR-2331) [SOLR-2691](https://issues.apache.org/jira/browse/SOLR-2691) (Yury Kats) (hossman) (Mark Miller)
- Suggester Lookup implementations now store trie data and load it back on init. This means that large tries don't have to be rebuilt on every commit or core reload. [SOLR-2375](https://issues.apache.org/jira/browse/SOLR-2375) (ab)
- Support for returning multi-valued fields w/o &lt;arr&gt; tag in the XMLResponseWriter was removed. XMLResponseWriter only no longer work with values less then 2.2 [SOLR-2413](https://issues.apache.org/jira/browse/SOLR-2413) (ryan)
- FieldType argument changed from String to Object Conversion from SolrInputDocument &gt; Object &gt; Fieldable is now managed by FieldType rather then DocumentBuilder. [SOLR-2423](https://issues.apache.org/jira/browse/SOLR-2423) (ryan)
- QuerySenderListener and AbstractSolrEventListener are now public [SOLR-2461](https://issues.apache.org/jira/browse/SOLR-2461) (hossman)
- Remove deprecated SpellingResult.add(Token, int). [SOLR-2576](https://issues.apache.org/jira/browse/SOLR-2576) (James Dyer) (rmuir)
- Moved VelocityResponseWriter back to contrib module in order to remove it as a mandatory core dependency. [SOLR-2588](https://issues.apache.org/jira/browse/SOLR-2588) (ehatcher)
- Removed deprecated client/ruby directory, which included solr-ruby and flare. [SOLR-2607](https://issues.apache.org/jira/browse/SOLR-2607) (ehatcher)
- Removed obsolete client/ folder [SOLR-2607](https://issues.apache.org/jira/browse/SOLR-2607) (ehatcher) (Eric Pugh) (janhoy)
- The same Directory instance is now always used across a SolrCore so that it's easier to add other DirectoryFactory's without static caching hacks. [SOLR-2654](https://issues.apache.org/jira/browse/SOLR-2654) (Mark Miller)
- FieldTypePluginLoader has been refactored out of IndexSchema and made public. [SOLR-2663](https://issues.apache.org/jira/browse/SOLR-2663) (hossman)
- Enhance CoreAdmin STATUS command to return index size. [SOLR-2698](https://issues.apache.org/jira/browse/SOLR-2698) (Yury Kats) (hossman) (Mark Miller)
- Maven configuration: Excluded transitive stax:stax-api dependency from org.codehaus.woodstox:wstx-asl dependency. [SOLR-2756](https://issues.apache.org/jira/browse/SOLR-2756) (David Smiley) (Steve Rowe)
- Due to low level changes to support SolrCloud, the uniqueKey field can no longer be populated via &lt;copyField/&gt; or &lt;field default=...&gt; in the schema.xml. [SOLR-2796](https://issues.apache.org/jira/browse/SOLR-2796) 
- More explicit lexical resources location logged if Carrot2 clustering extension is used. Fixed solr. impl. of IResource and IResourceLookup. [SOLR-2862](https://issues.apache.org/jira/browse/SOLR-2862) (Dawid Weiss)
- Default QueryResponseWriters are now initialized via init() with an empty NamedList. [SOLR-3005](https://issues.apache.org/jira/browse/SOLR-3005) (Gasol Wu) (Chris Male)
- logOnce from SolrException logOnce and all the supporting structure is gone. abortOnConfigurationError is also gone as it is no longer referenced. Errors should be caught and logged at the top-most level or logged and NOT propagated up the chain. [SOLR-3032](https://issues.apache.org/jira/browse/SOLR-3032) (Erick Erickson)
- JMX beans now report Numbers as numeric values rather then String [SOLR-3083](https://issues.apache.org/jira/browse/SOLR-3083) (Tagged Siteops) (Greg Bowyer) (ryan)
- Upgrade example and tests to run with Jetty 8 [SOLR-3159](https://issues.apache.org/jira/browse/SOLR-3159) (ryan)
- Dropping Support for JSP. New Admin UI is all client side [SOLR-3202](https://issues.apache.org/jira/browse/SOLR-3202) [SOLR-3244](https://issues.apache.org/jira/browse/SOLR-3244) (ryan) (Aliaksandr Zhuhrou) (Uwe Schindler)
- Upgrade Solr to Tika 1.1 [SOLR-3254](https://issues.apache.org/jira/browse/SOLR-3254) (janhoy)
- The "threads" feature of DIH is removed (deprecated in Solr 3.6) [SOLR-3262](https://issues.apache.org/jira/browse/SOLR-3262) (James Dyer)
- Upgraded SLF4j to version 1.6.4 [SOLR-3302](https://issues.apache.org/jira/browse/SOLR-3302) (hossman)
- web.xml now specifies metadata-complete=true (which requires Servlet 2.5) to prevent servlet containers from scanning class annotations on startup. This allows for faster startup times on some servlet containers. [SOLR-3309](https://issues.apache.org/jira/browse/SOLR-3309) (Bill Bell) (hossman)
- Add more context to IndexReaderFactory.newReader [SOLR-3322](https://issues.apache.org/jira/browse/SOLR-3322) (ab)
- Dropped getSourceID() from SolrInfoMBean and using getClass().getPackage().getSpecificationVersion() for Version. [SOLR-3329](https://issues.apache.org/jira/browse/SOLR-3329) (ryan)
- Moved FastWriter, FileUtils, RegexFileFilter, RTimer and SystemIdResolver from org.apache.solr.common to org.apache.solr.util [SOLR-3343](https://issues.apache.org/jira/browse/SOLR-3343) (Chris Male)
- ResourceLoader.newInstance now accepts a Class representation of the expected instance type [SOLR-3357](https://issues.apache.org/jira/browse/SOLR-3357) (Chris Male)
- HTTP caching is now disabled by default for RequestUpdateHandlers. [SOLR-3388](https://issues.apache.org/jira/browse/SOLR-3388) (ryan)
- Deprecated Analysis Factories now log their own deprecation messages. No logging support is provided by Factory parent classes. [SOLR-3403](https://issues.apache.org/jira/browse/SOLR-3403) (Chris Male)
- Refactored DIH internal data classes. All entities in data-config.xml must have a name [SOLR-3422](https://issues.apache.org/jira/browse/SOLR-3422) (James Dyer)
- The Dismax and eDismax query parsers will fall back on the 'df' parameter when 'qf' is absent. And if neither is present nor the schema default search field then an exception will be thrown now. [SOLR-3534](https://issues.apache.org/jira/browse/SOLR-3534) (dsmiley)


[3.6.2] - 2012-12-25
--------------------

### Fixed (2 changes)

- Edismax parser does not honor mm parameter if analyzer splits a token. [SOLR-3589](https://issues.apache.org/jira/browse/SOLR-3589) (Tom Burton-West) (Robert Muir)
- ConcurrentModificationException could be thrown when using hl.fl=*. [SOLR-3790](https://issues.apache.org/jira/browse/SOLR-3790) (yonik) (koji)


[3.6.1] - 2012-07-22
--------------------

### Fixed (11 changes)

- Throw IAE on bad arguments that could cause confusing errors in PatternTokenizer. CommonGrams populates PositionLengthAttribute correctly. [LUCENE-3969](https://issues.apache.org/jira/browse/LUCENE-3969) (Uwe Schindler) (Mike McCandless) (Robert Muir)
- SolrEntityProcessor substitutes most variables at query time. [SOLR-3336](https://issues.apache.org/jira/browse/SOLR-3336) (Michael Kroh) (Lance Norskog) (Martijn van Groningen)
- More DIH bug fixes for the deprecated "threads" parameter. [SOLR-3360](https://issues.apache.org/jira/browse/SOLR-3360) (Mikhail Khludnev) (Claudio R) (James Dyer)
- ReplicationHandler "maxNumberOfBackups" doesn't work if backups are triggered on commit [SOLR-3361](https://issues.apache.org/jira/browse/SOLR-3361) (James Dyer) (Tomás Fernández Löbbe)
- Fix charset problems with HttpSolrServer [SOLR-3375](https://issues.apache.org/jira/browse/SOLR-3375) (Roger Håkansson) (yonik) (siren)
- Added a new DIH test against a real SQL database. Fixed problems revealed by this new test related to the expanded cache support added to 3.6/SOLR-2382 [SOLR-3430](https://issues.apache.org/jira/browse/SOLR-3430) [SOLR-2382](https://issues.apache.org/jira/browse/SOLR-2382) (James Dyer)
- Group count incorrect when not all shards are queried in the second pass. [SOLR-3436](https://issues.apache.org/jira/browse/SOLR-3436) (Francois Perron) (Martijn van Groningen)
- Exception when using result grouping with main=true and using wt=javabin. [SOLR-3454](https://issues.apache.org/jira/browse/SOLR-3454) (Ludovic Boutros) (Martijn van Groningen)
- contrib/clustering: custom Carrot2 tokenizer and stemmer factories are respected now [SOLR-3470](https://issues.apache.org/jira/browse/SOLR-3470) (Stanislaw Osinski) (Dawid Weiss)
- SOLR does not start up when no cores are defined [SOLR-3477](https://issues.apache.org/jira/browse/SOLR-3477) (Tomás Fernández Löbbe) (tommaso)
- Config file replication less error prone [SOLR-3489](https://issues.apache.org/jira/browse/SOLR-3489) (Jochen Just) (janhoy)


[3.6.0] - 2012-04-12
--------------------

### Added (31 changes)

- Add WFSTLookupFactory, a suggester that uses a weighted FST for more fine-grained suggestions. [LUCENE-3714](https://issues.apache.org/jira/browse/LUCENE-3714) (Mike McCandless) (Dawid Weiss) (Robert Muir)
- Added SolrEntityProcessor that imports data from another Solr core or instance based on a specified query. [SOLR-1499](https://issues.apache.org/jira/browse/SOLR-1499) (Lance Norskog) (Erik Hatcher) (Pulkit Singhal) (Ahmet Arslan) (Luca Cavanna) (Martijn van Groningen)
- StreamingUpdateSolrServer supports RequestWriter API and therefore, javabin update format [SOLR-1565](https://issues.apache.org/jira/browse/SOLR-1565) (shalin)
- Distributed support for Date and Numeric Range Faceting [SOLR-1709](https://issues.apache.org/jira/browse/SOLR-1709) (Peter Sturge) (David Smiley) (hossman) (Simon Willnauer)
- Evaluation of NOW for date math is done only once per request for consistency, and is also propagated to shards in distributed search. Adding a parameter NOW=&lt;time_in_ms&gt; to the request will override the current time. [SOLR-1729](https://issues.apache.org/jira/browse/SOLR-1729) (Peter Sturge) (yonik) (Simon Willnauer)
- A new "rootName" attribute is now available when configuring &lt;jmx/&gt; in solrconfig.xml. If this attribute is set, Solr will use it as the root name for all MBeans Solr exposes via JMX. The default root name is "solr" followed by the core name. [SOLR-1843](https://issues.apache.org/jira/browse/SOLR-1843) (Constantijn Visinescu) (hossman)
- StopFilterFactory, CommonGramsFilterFactory, and CommonGramsQueryFilterFactory can optionally read stopwords in Snowball format (specify format="snowball"). [SOLR-1860](https://issues.apache.org/jira/browse/SOLR-1860) (Robert Muir)
- The query component will substitute an empty query that matches no documents if the query parser returns null. This also prevents an exception from being thrown by the default parser if "q" is missing. (yonik) - SOLR-435: if q is "" then it's also acceptable. [SOLR-2001](https://issues.apache.org/jira/browse/SOLR-2001) [SOLR-435](https://issues.apache.org/jira/browse/SOLR-435) (dsmiley) (hoss)
- Add Java client that uses Apache Http Components http client (4.x). [SOLR-2020](https://issues.apache.org/jira/browse/SOLR-2020) (Chantal Ackermann) (Ryan McKinley) (Yonik Seeley) (siren)
- Currency FieldType, whith support for currencies and exchange rates [SOLR-2202](https://issues.apache.org/jira/browse/SOLR-2202) (Greg Fodor & Andrew Morrison) (janhoy) (rmuir) (Uwe Schindler)
- Add a chance to set content encoding explicitly via content type of stream for extracting request handler. This is convenient when Tika's auto detector cannot detect encoding, especially the text file is too short to detect encoding. [SOLR-2346](https://issues.apache.org/jira/browse/SOLR-2346) (koji)
- Added pluggable cache support to DIH so that any Entity can be made cache-able by adding the "cacheImpl" parameter. Include "SortedMapBackedCache" to provide in-memory caching (as previously this was the only option when using CachedSqlEntityProcessor). Users can provide their own implementations of DIHCache for other caching strategies. Deprecate CachedSqlEntityProcessor in favor of specifing "cacheImpl" with SqlEntityProcessor. Make SolrWriter implement DIHWriter and allow the possibility of pluggable Writers (DIH writing to something other than Solr). [SOLR-2382](https://issues.apache.org/jira/browse/SOLR-2382) (James Dyer) (Noble Paul)
- added MultiTermAwareComponent to the various classes to allow automatic lowercasing for multiterm queries (wildcards, regex, prefix, range, etc). You can now optionally specify a "multiterm" analyzer in our schema.xml, but Solr should "do the right thing" if you don't specify &lt;fieldType="multiterm"&gt; [SOLR-2438](https://issues.apache.org/jira/browse/SOLR-2438) (Pete Sturge Erick Erickson) (Mentoring from Seeley and Muir)
- Add the encoding function for alternate fields in highlighting. [SOLR-2603](https://issues.apache.org/jira/browse/SOLR-2603) (Massimo Schiavon) (koji)
- Create a NorwegianLightStemmer and NorwegianMinimalStemmer [SOLR-2764](https://issues.apache.org/jira/browse/SOLR-2764) (janhoy)
- URLClassify Update Processor [SOLR-2826](https://issues.apache.org/jira/browse/SOLR-2826) (janhoy)
- Now load URL content stream data (via stream.url) when called for during request handling, rather than loading URL content streams automatically regardless of use. [SOLR-2854](https://issues.apache.org/jira/browse/SOLR-2854) (David Smiley and Ryan McKinley) (ehatcher)
- BinaryUpdateRequestHandler should be able to accept multiple update requests from a stream [SOLR-2904](https://issues.apache.org/jira/browse/SOLR-2904) (shalin)
- Added LFU cache options to Solr. [SOLR-2906](https://issues.apache.org/jira/browse/SOLR-2906) (Shawn Heisey) (Erick Erickson)
- Added parametric tailoring options to ICUCollationKeyFilterFactory. These can be used to customize range query/sort behavior, for example to support numeric collation, ignore punctuation/whitespace, ignore accents but not case, control whether upper/lowercase values are sorted first, etc. [SOLR-2919](https://issues.apache.org/jira/browse/SOLR-2919) (rmuir)
- Added support for localized range queries when the analysis chain uses CollationKeyFilter or ICUCollationKeyFilter. [SOLR-2919](https://issues.apache.org/jira/browse/SOLR-2919) (Michael Sokolov) (rmuir)
- Added BeiderMorseFilterFactory for Beider-Morse (BMPM) phonetic encoder. Upgrades commons-codec to version 1.6 [SOLR-2982](https://issues.apache.org/jira/browse/SOLR-2982) (Brooke Schreier Ganz) (rmuir)
- eDismax: Locking down which fields can be explicitly queried (user fields aka uf) [SOLR-3026](https://issues.apache.org/jira/browse/SOLR-3026) (janhoy) (hossmann) (Tomás Fernández Löbbe)
- ReplicationHandler's backup command now supports a 'maxNumberOfBackups' init param that can be used to delete all but the most recent N backups. [SOLR-3033](https://issues.apache.org/jira/browse/SOLR-3033) (Torsten Krah) (James Dyer)
- Ability to specify overwrite=false on the URL for XML updates. [SOLR-3036](https://issues.apache.org/jira/browse/SOLR-3036) (Sami Siren) (yonik)
- Add TypeTokenFilterFactory that creates TypeTokenFilter that filters tokens based on their TypeAttribute. [SOLR-3054](https://issues.apache.org/jira/browse/SOLR-3054) [LUCENE-3671](https://issues.apache.org/jira/browse/LUCENE-3671) (Tommaso Teofili via Uwe Schindler)
- Added Kuromoji morphological analyzer for Japanese. See the 'text_ja' fieldtype in the example to get started. [LUCENE-3305](https://issues.apache.org/jira/browse/LUCENE-3305) [SOLR-3056](https://issues.apache.org/jira/browse/SOLR-3056) (Christian Moen) (Masaru Hasegawa) (Robert Muir)
- ElisionFilterFactory optionally allows the parameter ignoreCase (default=false). [SOLR-3105](https://issues.apache.org/jira/browse/SOLR-3105) (Robert Muir)
- Add SuggestQueryConverter, a QueryConverter intended for auto-suggesters. [SOLR-3143](https://issues.apache.org/jira/browse/SOLR-3143) (Robert Muir)
- Minor improvements to SolrEntityProcessor. Add more consistency between solr parameters and parameters used in SolrEntityProcessor and ability to specify a custom HttpClient instance. [SOLR-3190](https://issues.apache.org/jira/browse/SOLR-3190) (Luca Cavanna) (Martijn van Groningen)
- Added the ability to directly configure aspects of the concurrency and thread-pooling used within distributed search in solr. This allows for finer grained controlled and can be tuned by end users to target their own specific requirements. This builds on the work of the HttpCommComponent and uses the same configuration block to configure the thread pool. The default configuration has the same behaviour as solr 3.5, favouring throughput over latency. More information can be found on the wiki (http://wiki.apache.org/solr/SolrConfigXml) [SOLR-3221](https://issues.apache.org/jira/browse/SOLR-3221) (Greg Bowyer)

### Changed (3 changes)

- Speedup for LukeRequestHandler and admin/schema browser. New parameter reportDocCount defaults to 'false'. Old behavior still possible by specifying this as 'true' [SOLR-1931](https://issues.apache.org/jira/browse/SOLR-1931) (Erick Erickson)
- FSTSuggester refactoring: internal storage is now UTF-8, external sorting (on disk) prevents OOMs even with large data sets (the bottleneck is now FST construction), code cleanups and API cleanups. [SOLR-2888](https://issues.apache.org/jira/browse/SOLR-2888) (Dawid Weiss) (Robert Muir)
- Move System.getProperty("type") in postData() to main() and add type argument so that the client applications of SimplePostTool can set content type via method argument. [SOLR-3012](https://issues.apache.org/jira/browse/SOLR-3012) (koji)

### Fixed (43 changes)

- Fixed offset bugs in TrimFilter, WordDelimiterFilter, and HyphenatedWordsFilter where they would create invalid offsets in some situations, leading to problems in highlighting. [LUCENE-3717](https://issues.apache.org/jira/browse/LUCENE-3717) (Robert Muir)
- Fixed invalid position indexes by reimplementing PatternReplaceCharFilter. This change also drops real support for boundary characters -- all input is prebuffered for pattern matching. [LUCENE-3820](https://issues.apache.org/jira/browse/LUCENE-3820) (Dawid Weiss)
- QueryElevationComponent now supports non-string ids [SOLR-1520](https://issues.apache.org/jira/browse/SOLR-1520) (gsingers)
- Made it clearer when a core failed to load as well as better logging when the QueryElevationComponent fails to properly initialize [SOLR-1730](https://issues.apache.org/jira/browse/SOLR-1730) (gsingers)
- Do not log stack traces for "Service Disabled" / 503 Exceptions (PingRequestHandler, etc) [SOLR-2124](https://issues.apache.org/jira/browse/SOLR-2124) (James Dyer) (others)
- commitWithin ignored for a delete query [SOLR-2280](https://issues.apache.org/jira/browse/SOLR-2280) (Juan Grande) (janhoy)
- fix JSONWriter to respect field list when writing SolrDocuments [SOLR-2291](https://issues.apache.org/jira/browse/SOLR-2291) (Ahmet Arslan) (hossman)
- StringIndexOutOfBoundsException in the spellchecker collate when the term contains a hyphen. [SOLR-2509](https://issues.apache.org/jira/browse/SOLR-2509) (Thomas Gambier caught the bug) (Steffen Godskesen did the patch) (Erick Erickson)
- Fixed DIH Context variables which were broken for all scopes other then SCOPE_ENTITY [SOLR-2542](https://issues.apache.org/jira/browse/SOLR-2542) (Linbin Chen & Frank Wesemann) (hossman)
- Improved speed of parsing hex entities in HTMLStripCharFilter [SOLR-2819](https://issues.apache.org/jira/browse/SOLR-2819) (Bernhard Berger) (hossman)
- Add support for ResourceLoaderAware tokenizerFactories in synonym filter factories. [SOLR-2909](https://issues.apache.org/jira/browse/SOLR-2909) (Tom Klonikowski) (Jun Ohtani) (Koji Sekiguchi)
- Fixed File descriptor leak in ShowFileRequestHandler [SOLR-2912](https://issues.apache.org/jira/browse/SOLR-2912) (Michael Ryan) (shalin)
- Configuring the number of contextual snippets used for search results clustering. The hl.snippets parameter is now respected by the clustering plugin, can be overridden by carrot.summarySnippets if needed [SOLR-2937](https://issues.apache.org/jira/browse/SOLR-2937) (Stanislaw Osinski)
- Clustering on multiple fields. The carrot.title and carrot.snippet can now take comma- or space-separated lists of field names to cluster [SOLR-2938](https://issues.apache.org/jira/browse/SOLR-2938) (Stanislaw Osinski)
- Clustering of multilingual search results. The document's language field be passed in the carrot.lang parameter, the carrot.lcmap parameter enables mapping of language codes to ISO 639 [SOLR-2939](https://issues.apache.org/jira/browse/SOLR-2939) (Stanislaw Osinski)
- Passing values for custom Carrot2 fields to Clustering component. The custom field mapping are defined using the carrot.custom parameter [SOLR-2940](https://issues.apache.org/jira/browse/SOLR-2940) (Stanislaw Osinski)
- NullPointerException on clustering component initialization when schema does not have a unique key field [SOLR-2941](https://issues.apache.org/jira/browse/SOLR-2941) (Stanislaw Osinski)
- ClassCastException when passing non-textual fields to clustering component [SOLR-2942](https://issues.apache.org/jira/browse/SOLR-2942) (Stanislaw Osinski)
- Fixed IllegalStateException when querying with group.sort=score desc in sharded environment. [SOLR-2955](https://issues.apache.org/jira/browse/SOLR-2955) (Steffen Elberg Godskesen) (Martijn van Groningen)
- Fixed inconsistencies in the flags (and flag key) reported by the LukeRequestHandler [SOLR-2956](https://issues.apache.org/jira/browse/SOLR-2956) (hossman)
- edismax now respects the magic fields '_val_' and '_query_' [SOLR-2959](https://issues.apache.org/jira/browse/SOLR-2959) (Michael Watts) (hossman)
- CSV ResponseWriter returns fields defined as stored=false in schema [SOLR-2970](https://issues.apache.org/jira/browse/SOLR-2970) (janhoy)
- hitGrouped.vm isn't shipped with 3.x [SOLR-3009](https://issues.apache.org/jira/browse/SOLR-3009) (ehatcher) (janhoy)
- Fixed JSONTestUtil.matchObj, in previous releases it was not respecting the 'delta' arg [SOLR-3024](https://issues.apache.org/jira/browse/SOLR-3024) (David Smiley) (hossman)
- Fixed Maven Jetty plugin configuration. [SOLR-3042](https://issues.apache.org/jira/browse/SOLR-3042) (David Smiley) (Steve Rowe)
- Fix whitespace typo in DIH response "Time taken" [SOLR-3046](https://issues.apache.org/jira/browse/SOLR-3046) (hossman)
- Fixed typo in distributed grouping parameters. [SOLR-3052](https://issues.apache.org/jira/browse/SOLR-3052) (Martijn van Groningen) (Grant Ingersoll)
- Fixed NPE in ThreadDumpHandler [SOLR-3068](https://issues.apache.org/jira/browse/SOLR-3068) (siren)
- Fixed 'Invalid UUID string' error when having an UUID field as the unique key and executing a distributed grouping request. [SOLR-3073](https://issues.apache.org/jira/browse/SOLR-3073) (Devon Krisman) (Martijn van Groningen)
- fix SolrPluginUtils.docListToSolrDocumentList to respect the list of fields specified. This fix also deprecates DocumentBuilder.loadStoredFields which is not used anywhere in Solr, and was fundamentally broken/bizarre. [SOLR-3074](https://issues.apache.org/jira/browse/SOLR-3074) (hossman) (Ahmet Arslan)
- Fixed initialization error when using &lt;queryResponseWriter default="true" ... /&gt; [SOLR-3084](https://issues.apache.org/jira/browse/SOLR-3084) (Bernd Fehling and hossman)
- contrib/langid: When using the LangDetect implementation of langid, set the random seed to 0, so that the same document is detected as the same language with the same probability every time. [SOLR-3107](https://issues.apache.org/jira/browse/SOLR-3107) (Christian Moen) (rmuir)
- Fixed numerous redundant shard requests when using distributed grouping. [SOLR-3109](https://issues.apache.org/jira/browse/SOLR-3109) (rblack) (Martijn van Groningen)
- ReplicationHandler "numberToKeep" & "maxNumberOfBackups" parameters would keep only 1 backup, even if more than 1 was specified [SOLR-3168](https://issues.apache.org/jira/browse/SOLR-3168) (Neil Hooey) (James Dyer)
- SystemInfoHandler leaks filehandles [SOLR-3187](https://issues.apache.org/jira/browse/SOLR-3187) (siren)
- timeAllowed is ignored for grouping queries [SOLR-3195](https://issues.apache.org/jira/browse/SOLR-3195) (Russell Black) (Martijn van Groningen)
- Fix SignatureUpdateProcessor "all fields" mode to use all fields of each document instead of the fields specified by the first document indexed [SOLR-3200](https://issues.apache.org/jira/browse/SOLR-3200) (Spyros Kapnissis) (hossman)
- Fix SignatureUpdateProcessor to no longer ignore non-String field values [SOLR-3226](https://issues.apache.org/jira/browse/SOLR-3226) (Spyros Kapnissis) (hossman)
- DataImportHandler: ScriptTransformer gives better error messages when problems arise on initialization (no Script Engine, invalid script, etc). [SOLR-3260](https://issues.apache.org/jira/browse/SOLR-3260) (James Dyer)
- Fix edismax to respect query operators when literal colons are used in query string. [SOLR-3261](https://issues.apache.org/jira/browse/SOLR-3261) (Juan Grande) (hossman)
- Fix CoreContainer and SolrResourceLoader logging to be more clear about when SolrCores are being created, and stop misleading people about SolrCore instanceDir's being the "Solr Home Dir" [SOLR-3264](https://issues.apache.org/jira/browse/SOLR-3264) (hossman)
- Distributed grouping failed when rows parameter was set to 0 and sometimes returned a wrong hit count as matches. [SOLR-3316](https://issues.apache.org/jira/browse/SOLR-3316) (Cody Young) (Martijn van Groningen)
- Re-implemented HTMLStripCharFilter as a JFlex-generated scanner and moved it to lucene/contrib/analyzers/common/. See below for a list of bug fixes and other changes. To get the same behavior as HTMLStripCharFilter in Solr version 3.5 and earlier (including the bugs), use LegacyHTMLStripCharFilter, which is the previous implementation. Behavior changes from the previous version: - Known offset bugs are fixed. - The "Mark invalid" exceptions reported in SOLR-1283 are no longer triggered (the bug is still present in LegacyHTMLStripCharFilter). - The character entity "&apos;" is now always properly decoded. - More cases of &lt;script&gt; tags are now properly stripped. - CDATA sections are now handled properly. - Valid tag name characters now include the supplementary Unicode characters from Unicode character classes [:ID_Start:] and [:ID_Continue:]. - Uppercase character entities "&QUOT;", "&COPY;", "&GT;", "&LT;", "&REG;", and "&AMP;" are now recognized and handled as if they were in lowercase. - The REPLACEMENT CHARACTER U+FFFD is now used to replace numeric character entities for unpaired UTF-16 low and high surrogates (in the range [U+D800-U+DFFF]). - Properly paired numeric character entities for UTF-16 surrogates are now converted to the corresponding code units. - Opening tags with unbalanced quotation marks are now properly stripped. - Literal "&lt;" and "&gt;" characters in opening tags, regardless of whether they appear inside quotation marks, now inhibit recognition (and stripping) of the tags. The only exception to this is for values of event-handler attributes, e.g. "onClick", "onLoad", "onSelect". - A newline '\n' is substituted instead of a space for stripped HTML markup. - Nothing is substituted for opening and closing inline tags - they are simply removed. The list of inline tags is (case insensitively): &lt;a&gt;, &lt;abbr&gt;, &lt;acronym&gt;, &lt;b&gt;, &lt;basefont&gt;, &lt;bdo&gt;, &lt;big&gt;, &lt;cite&gt;, &lt;code&gt;, &lt;dfn&gt;, &lt;em&gt;, &lt;font&gt;, &lt;i&gt;, &lt;img&gt;, &lt;input&gt;, &lt;kbd&gt;, &lt;label&gt;, &lt;q&gt;, &lt;s&gt;, &lt;samp&gt;, &lt;select&gt;, &lt;small&gt;, &lt;span&gt;, &lt;strike&gt;, &lt;strong&gt;, &lt;sub&gt;, &lt;sup&gt;, &lt;textarea&gt;, &lt;tt&gt;, &lt;u&gt;, and &lt;var&gt;. - HTMLStripCharFilterFactory now handles HTMLStripCharFilter's "escapedTags" feature: opening and closing tags with the given names, including any attributes and their values, are left intact in the output. [LUCENE-3690](https://issues.apache.org/jira/browse/LUCENE-3690) [LUCENE-2208](https://issues.apache.org/jira/browse/LUCENE-2208) [SOLR-882](https://issues.apache.org/jira/browse/SOLR-882) [SOLR-42](https://issues.apache.org/jira/browse/SOLR-42) [SOLR-1283](https://issues.apache.org/jira/browse/SOLR-1283) (Steve Rowe)

### Other (21 changes)

- Restructure the Solr build system. [LUCENE-3753](https://issues.apache.org/jira/browse/LUCENE-3753) (Steve Rowe)
- Changed build system to use Apache Ivy for retrival of 3rd party JAR files. Please review README.txt for instructions. [LUCENE-3930](https://issues.apache.org/jira/browse/LUCENE-3930) (Robert Muir) (Chris Male) (Uwe Schindler) (Steven Rowe) (Hossman)
- Deprecated &lt;indexDefaults&gt; and &lt;mainIndex&gt; in solrconfig.xml From now, all settings go in the new &lt;indexConfig&gt; tag, and some defaults are changed: useCompoundFile=false, ramBufferSizeMB=32, lockType=native, so that the effect of NOT specifying &lt;indexConfig&gt; at all gives same result as the example config used to give in 3.5 [SOLR-1052](https://issues.apache.org/jira/browse/SOLR-1052) (janhoy) (gsingers)
- Add build target to package war without slf4j jars [SOLR-2487](https://issues.apache.org/jira/browse/SOLR-2487) (janhoy)
- expecting fl=score to return all fields is now deprecated. In solr 4.0, this will only return the score. [SOLR-2712](https://issues.apache.org/jira/browse/SOLR-2712) (ryan)
- Add ability to lazy load response writers, defined with startup="lazy". [SOLR-2718](https://issues.apache.org/jira/browse/SOLR-2718) (ehatcher)
- Upgrade Solr to Tika 1.0 [SOLR-2901](https://issues.apache.org/jira/browse/SOLR-2901) (janhoy)
- Refactor frequent conditional use of DefaultSolrParams and AppendedSolrParams into factory methods. [SOLR-2920](https://issues.apache.org/jira/browse/SOLR-2920) (David Smiley) (hossman)
- Upgrade commons-io and commons-lang to 2.1 and 2.6, respectively. [SOLR-2922](https://issues.apache.org/jira/browse/SOLR-2922) (koji)
- Default QueryResponseWriters are now initialized via init() with an empty NamedList. [SOLR-3005](https://issues.apache.org/jira/browse/SOLR-3005) (Gasol Wu) (Chris Male)
- Deprecate logOnce from SolrException logOnce and all the supporting structure will disappear in 4.0. Errors should be caught and logged at the top-most level or logged and NOT propagated up the chain. [SOLR-3032](https://issues.apache.org/jira/browse/SOLR-3032) (Erick Erickson)
- Example XSL stylesheet for indexing query result XML [SOLR-3059](https://issues.apache.org/jira/browse/SOLR-3059) (janhoy)
- Better error messages when attempting to use "blank" field names [SOLR-3077](https://issues.apache.org/jira/browse/SOLR-3077) (Antony Stubbs) (hossman)
- Add analysis configurations for different languages to the example. [SOLR-3097](https://issues.apache.org/jira/browse/SOLR-3097) [SOLR-3105](https://issues.apache.org/jira/browse/SOLR-3105) (Christian Moen) (Robert Muir)
- Fix tests not to write to src/test-files [SOLR-3112](https://issues.apache.org/jira/browse/SOLR-3112) (Luca Cavanna) (Robert Muir)
- Upgrade schema version to 1.5, where omitNorms defaults to "true" for all primitive (non-analyzed) field types such as int, float, date, bool, string.. [SOLR-3140](https://issues.apache.org/jira/browse/SOLR-3140) (janhoy)
- DIH Imports no longer default optimize to true, instead false. If you want to force all segments to be merged into one, you can specify this parameter yourself. NOTE: this can be very expensive operation and usually does not make sense for delta-imports. [SOLR-3142](https://issues.apache.org/jira/browse/SOLR-3142) (Robert Muir)
- Check for Lucene directory locks at startup. In previous versions this check was only performed during modifying (e.g. adding and deleting documents) the index. [SOLR-3156](https://issues.apache.org/jira/browse/SOLR-3156) (Luca Cavanna) (Martijn van Groningen)
- The packaged pre-release artifact of Commons CSV used the original package name (org.apache.commons.csv). This created a compatibility issue as the Apache Commons team works toward an official release of Commons CSV. The source of Commons CSV was added under a separate package name to the Solr source code. [SOLR-3204](https://issues.apache.org/jira/browse/SOLR-3204) (Uwe Schindler) (Chris Male) (Emmanuel Bourg)
- In contrib/clustering/lib/, replaced the manually retrowoven Java 1.5-compatible carrot2-core-3.5.0.jar (which is not publicly available, except from the Solr Subversion repository), with newly released Java 1.5-compatible carrot2-core-3.5.0.1.jar (hosted on the Maven Central repository). Also updated dependencies jackson-core-asl and jackson-mapper-asl (both v1.5.2 -&gt; v1.7.4). [SOLR-3294](https://issues.apache.org/jira/browse/SOLR-3294) (Dawid Weiss) (Steve Rowe)
- netcdf jar is excluded from the binary release (and disabled in ivy.xml) because it requires java 6. If you want to parse this content with extracting request handler and are willing to use java 6, just add the jar. [SOLR-3295](https://issues.apache.org/jira/browse/SOLR-3295) (rmuir)


[3.5.0] - 2011-11-11
--------------------

### Added (11 changes)

- StatsComponent now supports date fields and string fields. [SOLR-1023](https://issues.apache.org/jira/browse/SOLR-1023) (Chris Male) (Mark Holland) (Gunnlaugur Thor Briem) (Ryan McKinley)
- Add hl.q parameter. [SOLR-1926](https://issues.apache.org/jira/browse/SOLR-1926) (koji)
- New contrib "langid". Adds language identification capabilities as an Update Processor, using Tika's LanguageIdentifier or Cybozu language-detection library [SOLR-1979](https://issues.apache.org/jira/browse/SOLR-1979) (janhoy) (Tommaso Teofili) (gsingers)
- Added support for distributed grouping. [SOLR-2066](https://issues.apache.org/jira/browse/SOLR-2066) [SOLR-2776](https://issues.apache.org/jira/browse/SOLR-2776) (Martijn van Groningen) (Jasper van Veghel) (Matt Beaumont)
- Add support for cologne phonetic to PhoneticFilterFactory. [SOLR-2276](https://issues.apache.org/jira/browse/SOLR-2276) (Marc Pompl) (rmuir)
- ReplicationHandler's backup command now supports a 'numberToKeep' request param that can be used to delete all but the most recent N backups. [SOLR-2578](https://issues.apache.org/jira/browse/SOLR-2578) (James Dyer) (hossman)
- Add boundary scanners for FastVectorHighlighter. &lt;boundaryScanner/&gt; can be specified with a name in solrconfig.xml, and use hl.boundaryScanner=name parameter to specify the named &lt;boundaryScanner/&gt;. [SOLR-2749](https://issues.apache.org/jira/browse/SOLR-2749) (koji)
- Added factory for the new Hunspell stemmer capable of doing stemming for 99 languages [SOLR-2769](https://issues.apache.org/jira/browse/SOLR-2769) (janhoy) (cmale)
- Added before/after count response parsing support for range facets in SolrJ. [SOLR-2818](https://issues.apache.org/jira/browse/SOLR-2818) (Bernhard Frauendienst) (Martijn van Groningen)
- Add alternative implementation to contrib/langid supporting 53 languages, based on http://code.google.com/p/language-detection/ [SOLR-2839](https://issues.apache.org/jira/browse/SOLR-2839) (rmuir)
- Numeric types now support sortMissingFirst/Last. This includes Trie and date types [SOLR-2881](https://issues.apache.org/jira/browse/SOLR-2881) (Ryan McKinley) (Mike McCandless) (Uwe Schindler) (Erick Erickson)

### Changed (1 change)

- SolrJ: Provide commitWithinMs as optional parameter for all add() methods, making the feature more conveniently accessible for developers [SOLR-2742](https://issues.apache.org/jira/browse/SOLR-2742) (janhoy)

### Fixed (11 changes)

- Fixed NullPointerException when using spellcheck.q with Suggester. [SOLR-2726](https://issues.apache.org/jira/browse/SOLR-2726) (Bernd Fehling) (valentin) (rmuir)
- The CommitTracker used for commitWith or autoCommit by maxTime could commit too frequently and could block adds until a new searcher was registered. [SOLR-2748](https://issues.apache.org/jira/browse/SOLR-2748) (yonik)
- Extracting update request handler throws exception and returns 400 when zero-length file posted using multipart form post [SOLR-2763](https://issues.apache.org/jira/browse/SOLR-2763) (janhoy)
- Fixed Date parsing/formatting of years 0001-1000 [SOLR-2772](https://issues.apache.org/jira/browse/SOLR-2772) (hossman)
- Fixed issue where multi select facets didn't respect group.truncate parameter. [SOLR-2780](https://issues.apache.org/jira/browse/SOLR-2780) (Martijn van Groningen) (Ramzi Alqrainy)
- Replication: abortfetch command is broken if replication was started by fetchindex command instead of a regular poll [SOLR-2791](https://issues.apache.org/jira/browse/SOLR-2791) (Yury Kats) (shalin)
- In rare cases (most likely during shutdown), a SolrIndexSearcher can be left open if the executor rejects a task. [SOLR-2793](https://issues.apache.org/jira/browse/SOLR-2793) (Mark Miller)
- Fix HTTP error codes returned when requests contain strings that can not be parsed as numbers for Trie fields. [SOLR-2813](https://issues.apache.org/jira/browse/SOLR-2813) (Jeff Crump and hossman)
- Fix extremely rare race condition on commit that can result in a NPE [SOLR-2861](https://issues.apache.org/jira/browse/SOLR-2861) (yonik)
- Fix the incorrect url in DIH example tika-data-config.xml [SOLR-2875](https://issues.apache.org/jira/browse/SOLR-2875) (Shinichiro Abe) (koji)
- List of collations are wrong parsed in SpellCheckResponse causing a wrong number of collation results in the response. [SOLR-2902](https://issues.apache.org/jira/browse/SOLR-2902) (Bastiaan Verhoef) (James Dyer) (Simon Willnauer)

### Other (13 changes)

- Deprecated the WordDelimiterFilter constructors accepting multiple ints masquerading as booleans. Preferred constructor now accepts a single int bitfield [LUCENE-3410](https://issues.apache.org/jira/browse/LUCENE-3410) (Chris Male)
- Upgrade commons-compress to 1.2 [LUCENE-3457](https://issues.apache.org/jira/browse/LUCENE-3457) (Doron Cohen)
- Upgrade Solr to Tika 0.10 [SOLR-2372](https://issues.apache.org/jira/browse/SOLR-2372) (janhoy)
- Remove commitLockTimeout option from solrconfig.xml [SOLR-2591](https://issues.apache.org/jira/browse/SOLR-2591) (Luca Cavanna) (Martijn van Groningen)
- Upgraded UIMA dependencies from *-2.3.1-SNAPSHOT.jar to *-2.3.1.jar. [SOLR-2746](https://issues.apache.org/jira/browse/SOLR-2746) 
- Make both "update.chain" and the deprecated "update.param" work consistently everywhere; see also SOLR-2105. [SOLR-2750](https://issues.apache.org/jira/browse/SOLR-2750) [SOLR-2105](https://issues.apache.org/jira/browse/SOLR-2105) (Mark Miller) (janhoy)
- min() and max() functions now support an arbitrary number of ValueSources [SOLR-2757](https://issues.apache.org/jira/browse/SOLR-2757) (Bill Bell) (hossman)
- Moved ConcurrentLRUCache from o.a.s.common.util package in the solrj module to the o.a.s.util package in the Solr core module. [SOLR-2758](https://issues.apache.org/jira/browse/SOLR-2758) (David Smiley) (Steve Rowe)
- Package individual javadoc sites for solrj and test-framework. [SOLR-2766](https://issues.apache.org/jira/browse/SOLR-2766) (Steve Rowe) (Mike McCandless)
- Solr modules' tests should not depend on solr-core test classes; move BufferingRequestProcessor from solr-core tests to test-framework so that the Solr Cell module can use it. [SOLR-2771](https://issues.apache.org/jira/browse/SOLR-2771) (janhoy) (Steve Rowe)
- Allow case insensitive Hunspell stemming [SOLR-2792](https://issues.apache.org/jira/browse/SOLR-2792) (janhoy) (rmuir)
- Fix dependencies in Maven POMs. [SOLR-2849](https://issues.apache.org/jira/browse/SOLR-2849) (David Smiley) (Steve Rowe)
- More explicit lexical resources location logged if Carrot2 clustering extension is used. Fixed solr. impl. of IResource and IResourceLookup. [SOLR-2862](https://issues.apache.org/jira/browse/SOLR-2862) (Dawid Weiss)


[3.4.0] - 2011-09-15
--------------------

### Added (14 changes)

- Added omitPositions to the schema, so you can omit position information while still indexing term frequencies. [LUCENE-2048](https://issues.apache.org/jira/browse/LUCENE-2048) (rmuir)
- add a new parameter hl.phraseLimit for FastVectorHighlighter speed up. [LUCENE-3234](https://issues.apache.org/jira/browse/LUCENE-3234) (Mike Sokolov) (koji)
- Ability to add cache=false to queries and query filters to avoid using the filterCache or queryCache. A cost may also be specified and is used to order the evaluation of non-cached filters from least to greatest cost . For very expensive query filters (cost &gt;= 100) if the query implements the PostFilter interface, it will be used to obtain a Collector that is checked only for documents that match the main query and all other filters. The "frange" query now implements the PostFilter interface. [SOLR-2429](https://issues.apache.org/jira/browse/SOLR-2429) (yonik)
- post.jar enhanced to handle JSON, CSV and &lt;optimize&gt; [SOLR-2458](https://issues.apache.org/jira/browse/SOLR-2458) (janhoy)
- Added support in SolrJ to easily interact with range facets. The range facet response can be parsed and is retrievable from the QueryResponse class. The SolrQuery class has convenient methods for using range facets. [SOLR-2523](https://issues.apache.org/jira/browse/SOLR-2523) (Martijn van Groningen)
- CommitWithin as an Update Request parameter You can now specify &commitWithin=N (ms) on the update request [SOLR-2540](https://issues.apache.org/jira/browse/SOLR-2540) (janhoy)
- add UniqFieldsUpdateProcessor that removes duplicate values in the specified fields. [SOLR-2584](https://issues.apache.org/jira/browse/SOLR-2584) (Elmer Garduno) (koji)
- Log individual updates (adds and deletes) at the FINE level before adding to the index. Fix a null pointer exception in logging when there was no unique key. [SOLR-2615](https://issues.apache.org/jira/browse/SOLR-2615) (David Smiley) (yonik)
- Added new XsltUpdateRequestHandler that works like XmlUpdateRequestHandler but allows to transform the POSTed XML document using XSLT. This allows to POST arbitrary XML documents to the update handler, as long as you also provide a XSL to transform them to a valid Solr input document. [SOLR-2630](https://issues.apache.org/jira/browse/SOLR-2630) (Upayavira) (Uwe Schindler)
- Added support for group result parsing in SolrJ. [SOLR-2637](https://issues.apache.org/jira/browse/SOLR-2637) (Tao Cheng) (Martijn van Groningen)
- Added post group faceting. Facet counts are based on the most relevant document of each group matching the query. This feature has the same impact on the StatsComponent. [SOLR-2665](https://issues.apache.org/jira/browse/SOLR-2665) (Martijn van Groningen)
- Added NIOFSDirectoryFactory [SOLR-2670](https://issues.apache.org/jira/browse/SOLR-2670) (yonik)
- CoreAdminHandler now allows arbitrary properties to be specified when CREATEing a new SolrCore using property.* request params. [SOLR-2675](https://issues.apache.org/jira/browse/SOLR-2675) (Yury Kats) (hossman)
- JSON update format - "null" field values are now dropped instead of causing an exception. [SOLR-2714](https://issues.apache.org/jira/browse/SOLR-2714) (Trygve Laugstøl) (yonik)

### Changed (1 change)

- Improved memory usage, build time, and performance of SynonymFilterFactory. [LUCENE-3233](https://issues.apache.org/jira/browse/LUCENE-3233) (Mike McCandless) (Robert Muir)

### Fixed (24 changes)

- DataImportHandler's multi-threaded option throws NPE [SOLR-2186](https://issues.apache.org/jira/browse/SOLR-2186) (Lance Norskog) (Frank Wesemann) (shalin)
- CommonsHttpSolrServer.addFile could not be used to send multiple files in a single request. [SOLR-2230](https://issues.apache.org/jira/browse/SOLR-2230) (Stephan Günther) (hossman)
- DIH does not commit if only deletes are processed [SOLR-2492](https://issues.apache.org/jira/browse/SOLR-2492) (James Dyer) (shalin)
- REGRESSION: in Solr 3.x and trunk the admin/file handler fails to show directory listings [SOLR-2535](https://issues.apache.org/jira/browse/SOLR-2535) (David Smiley) (Peter Wolanin) (Erick Erickson)
- Range Faceting on long/double fields could overflow if values bigger then the max int/float were used. [SOLR-2538](https://issues.apache.org/jira/browse/SOLR-2538) (Erbi Hanka) (hossman)
- PluginInfos was not correctly parsing &lt;long/&gt; tags when initializing plugins [SOLR-2541](https://issues.apache.org/jira/browse/SOLR-2541) (Frank Wesemann) (hossman)
- ExternalFileField file parsing would fail if any key contained an "=" character. It now only looks for the last "=" delimiter prior to the float value. [SOLR-2545](https://issues.apache.org/jira/browse/SOLR-2545) (Markus Jelsma) (hossman)
- Fixed ArrayIndexOutOfBoundsException when using simple format and start &gt; 0 [SOLR-2564](https://issues.apache.org/jira/browse/SOLR-2564) (Martijn van Groningen) (Matteo Melli)
- Fixed sort parsing of fields containing punctuation that failed due to sort by function changes introduced in SOLR-1297 [SOLR-2606](https://issues.apache.org/jira/browse/SOLR-2606) [SOLR-1297](https://issues.apache.org/jira/browse/SOLR-1297) (Mitsu Hadeishi) (hossman)
- Solr JMX MBeans do not survive core reloads [SOLR-2623](https://issues.apache.org/jira/browse/SOLR-2623) (Alexey Serba) (shalin)
- TermVectorComponent throws NPE if TF-IDF option is used without DF option. [SOLR-2625](https://issues.apache.org/jira/browse/SOLR-2625) (Daniel Erenrich) (Simon Willnauer)
- PingRequestHandler should not allow to ping itself using "qt" param to prevent infinite loop. [SOLR-2631](https://issues.apache.org/jira/browse/SOLR-2631) (Edoardo Tosca) (Uwe Schindler)
- Fix explain functionality for negative queries. [SOLR-2636](https://issues.apache.org/jira/browse/SOLR-2636) (Tom Hill) (yonik)
- Fixed sorting by function when using grouping. [SOLR-2642](https://issues.apache.org/jira/browse/SOLR-2642) (Thomas Heigl) (Martijn van Groningen)
- When using DIH with threads=2 the default logging is set too high [SOLR-2644](https://issues.apache.org/jira/browse/SOLR-2644) (Bill Bell) (shalin)
- DIH multi threaded mode does not resolve attributes correctly [SOLR-2655](https://issues.apache.org/jira/browse/SOLR-2655) (Frank Wesemann) (shalin)
- When Solr is configured to have no queryResultCache, the "start" parameter was not honored and the documents returned were 0 through start+offset. [SOLR-2662](https://issues.apache.org/jira/browse/SOLR-2662) (Markus Jelsma) (yonik)
- DIH multithreaded mode does not rollback on errors from EntityProcessor [SOLR-2668](https://issues.apache.org/jira/browse/SOLR-2668) (Frank Wesemann) (shalin)
- Fix backwards validation of field properties in SchemaField.calcProps [SOLR-2669](https://issues.apache.org/jira/browse/SOLR-2669) (hossman)
- Add "welcome-file-list" to solr.war so admin UI works correctly in servlet containers such as WebSphere that do not use a default list [SOLR-2676](https://issues.apache.org/jira/browse/SOLR-2676) (Jay R. Jaeger) (hossman)
- contrib/clustering: Typo in param name fixed: "carrot.fragzise" changed to "carrot.fragSize" [SOLR-2692](https://issues.apache.org/jira/browse/SOLR-2692) (Stanislaw Osinski)
- DIH: Documents are collected in unsynchronized list in multi-threaded debug mode [SOLR-2695](https://issues.apache.org/jira/browse/SOLR-2695) (Michael McCandless) (shalin)
- contrib/clustering: The carrot.lexicalResourcesDir parameter now works with absolute directories [SOLR-2706](https://issues.apache.org/jira/browse/SOLR-2706) (Stanislaw Osinski)
- Fixed grouping bug when start is bigger than rows and format is simple that zero documents are returned even if there are documents to display. (Martijn van Groningen) (Nikhil Chhaochharia)

### Other (4 changes)

- Add ant target 'package-local-src-tgz' to Lucene and Solr to package sources from the local working copy. [LUCENE-3406](https://issues.apache.org/jira/browse/LUCENE-3406) (Seung-Yeoul Yang) (Steve Rowe)
- Rewrote the Solr build system: - Integrated more fully with the Lucene build system: generalized the Lucene build system and eliminated duplication. - Converted all Solr contribs to the Lucene/Solr conventional src/ layout: java/, resources/, test/, and test-files/&lt;contrib-name&gt;. - Created a new Solr-internal module named "core" by moving the java/, test/, and test-files/ directories from solr/src/ to solr/core/src/. - Merged solr/src/webapp/src/ into solr/core/src/java/. - Eliminated solr/src/ by moving all its directories up one level; renamed solr/src/site/ to solr/site-src/ because solr/site/ already exists. - Merged solr/src/common/ into solr/solrj/src/java/. - Moved o.a.s.client.solrj.* and o.a.s.common.* tests from solr/src/test/ to solr/solrj/src/test/. - Made the solrj tests not depend on the solr core tests by moving some classes from solr/src/test/ to solr/test-framework/src/java/. - Each internal module (core/, solrj/, test-framework/, and webapp/) now has its own build.xml, from which it is possible to run module-specific targets. solr/build.xml delegates all build tasks (via &lt;ant dir="internal-module-dir"&gt; calls) to these modules' build.xml files. [SOLR-2452](https://issues.apache.org/jira/browse/SOLR-2452) [SOLR-2653](https://issues.apache.org/jira/browse/SOLR-2653) [LUCENE-3323](https://issues.apache.org/jira/browse/LUCENE-3323) [SOLR-2659](https://issues.apache.org/jira/browse/SOLR-2659) [LUCENE-3329](https://issues.apache.org/jira/browse/LUCENE-3329) [SOLR-2666](https://issues.apache.org/jira/browse/SOLR-2666) (Steve Rowe) (Robert Muir)
- Eliminate deprecation warnings in some JSPs. [SOLR-2629](https://issues.apache.org/jira/browse/SOLR-2629) (Bernd Fehling) (hossman)
- Remove commons logging from contrib/extraction. [SOLR-2743](https://issues.apache.org/jira/browse/SOLR-2743) (koji)


[3.3.0] - 2011-07-10
--------------------

### Added (7 changes)

- -- Added a srcCore parameter to CoreAdminHandler's mergeindexes action to merge one or more cores' indexes to a target core [SOLR-1331](https://issues.apache.org/jira/browse/SOLR-1331) (shalin)
- A new, automaton-based, implementation of suggest (autocomplete) component, offering an order of magnitude smaller memory consumption compared to ternary trees and jaspell and very fast lookups at runtime. [SOLR-2378](https://issues.apache.org/jira/browse/SOLR-2378) (Dawid Weiss)
- Field- and DocumentAnalysisRequestHandler now provide a position history for each token, so you can follow the token through all analysis stages. The output contains a separate int[] attribute containing all positions from previous Tokenizers/TokenFilters (called "positionHistory"). [SOLR-2400](https://issues.apache.org/jira/browse/SOLR-2400) (Uwe Schindler)
- Add ignoreTikaException flag to the extraction request handler so that users can ignore TikaException but index meta data. [SOLR-2480](https://issues.apache.org/jira/browse/SOLR-2480) (Shinichiro Abe) (koji)
- Grouping / Field collapsing using the Lucene grouping contrib. The search result can be grouped by field and query. [SOLR-2524](https://issues.apache.org/jira/browse/SOLR-2524) [SOLR-236](https://issues.apache.org/jira/browse/SOLR-236) [SOLR-237](https://issues.apache.org/jira/browse/SOLR-237) [SOLR-1773](https://issues.apache.org/jira/browse/SOLR-1773) [SOLR-1311](https://issues.apache.org/jira/browse/SOLR-1311) (Martijn van Groningen) (Emmanuel Keller) (Shalin Shekhar Mangar) (Koji Sekiguchi) (Iván de Prado) (Ryan McKinley) (Marc Sturlese) (Peter Karich) (Bojan Smid) (Charles Hornberger) (Dieter Grad) (Dmitry Lihachev) (Doug Steigerwald) (Karsten Sperling) (Michael Gundlach) (Oleg Gnatovskiy) (Thomas Traeger) (Harish Agarwal) (yonik) (Michael McCandless) (Bill Bell)
- Use uniqueKey for error log in UIMAUpdateRequestProcessor. [SOLR-2582](https://issues.apache.org/jira/browse/SOLR-2582) (Tommaso Teofili) (koji)
- -- Add an option to delete index through CoreAdmin UNLOAD action [SOLR-2610](https://issues.apache.org/jira/browse/SOLR-2610) (shalin)

### Changed (1 change)

- Solr now defaults to TieredMergePolicy. See http://s.apache.org/merging for more information. [SOLR-2567](https://issues.apache.org/jira/browse/SOLR-2567) (rmuir)

### Fixed (5 changes)

- Fix extremely high memory usage problems with spellcheck.collate. Separately, an additional spellcheck.maxCollationEvaluations (default=10000) parameter is added to avoid excessive CPU time in extreme cases (e.g. long queries with many misspelled words). [SOLR-2462](https://issues.apache.org/jira/browse/SOLR-2462) (James Dyer) (rmuir)
- Improve text_* fieldTypes in example schema.xml: improve cross-language defaults for text_general; break out separate English-specific fieldTypes [SOLR-2519](https://issues.apache.org/jira/browse/SOLR-2519) (Jan Høydahl) (hossman) (Robert Muir) (yonik) (Mike McCandless)
- Check dataimport.properties for write access (if delta-import is supported in DIH configuration) before starting an import [SOLR-2551](https://issues.apache.org/jira/browse/SOLR-2551) (C S) (shalin)
- UIMAUpdateRequestProcessor ignore error fails if text.length() &lt; 100. [SOLR-2579](https://issues.apache.org/jira/browse/SOLR-2579) (Elmer Garduno) (koji)
- UIMAToSolrMapper wrongly instantiates Type with reflection. [SOLR-2581](https://issues.apache.org/jira/browse/SOLR-2581) (Tommaso Teofili) (koji)

### Other (5 changes)

- The maven-ant-tasks jar is now included in the source tree; users of the generate-maven-artifacts target no longer have to manually place this jar in the Ant classpath. NOTE: when Ant looks for the maven-ant-tasks jar, it looks first in its pre-existing classpath, so any copies it finds will be used instead of the copy included in the Lucene/Solr source tree. For this reason, it is recommeded to remove any copies of the maven-ant-tasks jar in the Ant classpath, e.g. under ~/.ant/lib/ or under the Ant installation's lib/ directory. [LUCENE-3204](https://issues.apache.org/jira/browse/LUCENE-3204) (Steve Rowe)
- Add a commented out example of the spellchecker's thresholdTokenFrequency parameter to the example solrconfig.xml, and also add a unit test for this feature. [SOLR-2571](https://issues.apache.org/jira/browse/SOLR-2571) (James Dyer) (rmuir)
- Upgrade slf4j to v1.6.1 [SOLR-2574](https://issues.apache.org/jira/browse/SOLR-2574) (shalin)
- Deprecate SpellingResult.add(Token token, int docFreq), please use SpellingResult.addFrequency(Token token, int docFreq) instead. [SOLR-2576](https://issues.apache.org/jira/browse/SOLR-2576) (James Dyer) (rmuir)
- Fix typos in the example configuration [SOLR-2611](https://issues.apache.org/jira/browse/SOLR-2611) (Eric Pugh) (rmuir)


[3.2.0] - 2011-06-03
--------------------

### Added (6 changes)

- DebugComponent now supports using a NamedList to model Explanation objects in its responses instead of Explanation.toString [SOLR-1915](https://issues.apache.org/jira/browse/SOLR-1915) (hossman)
- Add TermQParserPlugin, registered as "term". This is useful when generating filter queries from terms returned from field faceting or the terms component. Example: fq={!term f=weight}1.5 [SOLR-2113](https://issues.apache.org/jira/browse/SOLR-2113) (hossman) (yonik)
- Search results clustering updates: bisecting k-means clustering algorithm added, loading of Carrot2 stop words from &lt;solr.home&gt;/conf/carrot2 (SOLR-2449), using Solr's stopwords.txt for clustering (SOLR-2450), output of cluster scores (SOLR-2505) [SOLR-2448](https://issues.apache.org/jira/browse/SOLR-2448) [SOLR-2449](https://issues.apache.org/jira/browse/SOLR-2449) [SOLR-2450](https://issues.apache.org/jira/browse/SOLR-2450) [SOLR-2505](https://issues.apache.org/jira/browse/SOLR-2505) (Stanislaw Osinski) (Dawid Weiss)
- Add ability to specify overwrite and commitWithin as request parameters (e.g. specified in the URL) when using the JSON update format, and added a simplified format for specifying multiple documents. Example: [{"id":"doc1"},{"id":"doc2"}] [SOLR-2496](https://issues.apache.org/jira/browse/SOLR-2496) (yonik)
- extend UIMAUpdateRequestProcessorFactory mapping function to map feature value to dynamicField. [SOLR-2503](https://issues.apache.org/jira/browse/SOLR-2503) (koji)
- add ignoreErrors flag to UIMAUpdateRequestProcessorFactory so that users can ignore exceptions in AE. [SOLR-2512](https://issues.apache.org/jira/browse/SOLR-2512) (Tommaso Teofili) (koji)

### Fixed (17 changes)

- The "rename" core admin action does not persist the new name to solr.xml [SOLR-2333](https://issues.apache.org/jira/browse/SOLR-2333) (Rasmus Hahn) (Paul R. Brown) (Mark Miller)
- Performance of usePhraseHighlighter is terrible on very large Documents, regardless of hl.maxDocCharsToAnalyze. [SOLR-2390](https://issues.apache.org/jira/browse/SOLR-2390) (Mark Miller)
- facet.sort=index reported incorrect results for distributed search in a number of scenarios when facet.mincount&gt;0. This patch also adds some performance/algorithmic improvements when (facet.sort=count && facet.mincount=1 && facet.limit=-1) and when (facet.sort=index && facet.mincount&gt;0) [SOLR-2403](https://issues.apache.org/jira/browse/SOLR-2403) (yonik)
- edismax parser - treat the text of a fielded query as a literal if the fieldname does not exist. For example Mission: Impossible should not search on the "Mission" field unless it's a valid field in the schema. [SOLR-2409](https://issues.apache.org/jira/browse/SOLR-2409) (Ryan McKinley) (yonik)
- Change the default qt to blank in form.jsp, because there is no "standard" request handler unless you have it in your solrconfig.xml explicitly. [SOLR-2445](https://issues.apache.org/jira/browse/SOLR-2445) (koji)
- Prevent double submit of forms in admin interface. [SOLR-2455](https://issues.apache.org/jira/browse/SOLR-2455) (Jeffrey Chang) (uschindler)
- Fix potential slowness in QueryValueSource (the query() function) when the query is very sparse and may not match any documents in a segment. [SOLR-2464](https://issues.apache.org/jira/browse/SOLR-2464) (yonik)
- SolrJ's CommonsHttpSolrServer would retry requests on failure, regardless of the configured maxRetries, due to HttpClient having its own retry mechanism by default. The retryCount of HttpClient is now set to 0, and SolrJ does the retry. [SOLR-2466](https://issues.apache.org/jira/browse/SOLR-2466) (yonik)
- Fix &lt;analyzer class="..." /&gt; initialization so any errors are logged properly. [SOLR-2467](https://issues.apache.org/jira/browse/SOLR-2467) (hossman)
- When using java replication with replicateAfter=startup, the first commit point on server startup is never removed. [SOLR-2469](https://issues.apache.org/jira/browse/SOLR-2469) (yonik)
- The helper TokenStreams in analysis.jsp and AnalysisRequestHandlerBase did not clear all attributes so they displayed incorrect attribute values for tokens in later filter stages. [SOLR-2474](https://issues.apache.org/jira/browse/SOLR-2474) (uschindler) (rmuir) (yonik)
- SolrQueryParser was fixed to not parse the SolrConfig DOM tree on each instantiation which is a huge slowdown. [SOLR-2493](https://issues.apache.org/jira/browse/SOLR-2493) (Stephane Bailliez) (uschindler)
- The JSON parser could hang on corrupted input and could fail to detect numbers that were too large to fit in a long. [SOLR-2495](https://issues.apache.org/jira/browse/SOLR-2495) (yonik)
- Make JSON response format escape \u2029 as well as \u2028 in strings since those characters are not valid in javascript strings (although they are valid in JSON strings). [SOLR-2520](https://issues.apache.org/jira/browse/SOLR-2520) (yonik)
- Add ReloadCacheRequestHandler to fix ExternalFileField bug (if reopenReaders set to true and no index segments have been changed, commit cannot trigger reload external file). [SOLR-2536](https://issues.apache.org/jira/browse/SOLR-2536) (koji)
- VectorValueSource.floatVal incorrectly used byteVal on sub-sources. [SOLR-2539](https://issues.apache.org/jira/browse/SOLR-2539) (Tom Liu) (yonik)
- RandomSortField didn't work when used in a function query. [SOLR-2554](https://issues.apache.org/jira/browse/SOLR-2554) (yonik)

### Other (8 changes)

- Building javadocs will fail on warnings by default. Override with -Dfailonjavadocwarning=false [LUCENE-3006](https://issues.apache.org/jira/browse/LUCENE-3006) (sarowe) (gsingers)
- Pull base tests out into a new Solr Test Framework module, and publish binary, javadoc, and source test-framework jars. [SOLR-2061](https://issues.apache.org/jira/browse/SOLR-2061) (Drew Farris) (Robert Muir) (Steve Rowe)
- Rename RequestHandler param 'update.processor' to 'update.chain'. [SOLR-2105](https://issues.apache.org/jira/browse/SOLR-2105) (Jan Høydahl) (Mark Miller)
- add mock annotators for improved testing in contrib/uima, [SOLR-2387](https://issues.apache.org/jira/browse/SOLR-2387) (Tommaso Teofili) (rmuir)
- move uimaConfig to under the uima's update processor in solrconfig.xml. [SOLR-2436](https://issues.apache.org/jira/browse/SOLR-2436) (Tommaso Teofili) (koji)
- Enhance assertJQ to allow individual tests to specify the tolerance delta used in numeric equalities. This allows for slight variance in asserting score comparisons in unit tests. [SOLR-2451](https://issues.apache.org/jira/browse/SOLR-2451) (David Smiley) (Chris Hostetter)
- Deprecate BaseResponseWriter, GenericBinaryResponseWriter, and GenericTextResponseWriter. These classes will be removed in 4.0. [SOLR-2485](https://issues.apache.org/jira/browse/SOLR-2485) (ryan)
- Remove default="true" from HtmlEncoder in example solrconfig.xml, because html encoding confuses non-ascii users. [SOLR-2528](https://issues.apache.org/jira/browse/SOLR-2528) (koji)


[3.1.0] - 2011-03-31
--------------------

### Added (169 changes)

- Add protected words support to SnowballPorterFilterFactory [SOLR-1026](https://issues.apache.org/jira/browse/SOLR-1026) (ehatcher)
- Enhance CommonsHttpSolrServer to add docs in batch using an iterator API [SOLR-1038](https://issues.apache.org/jira/browse/SOLR-1038) (Noble Paul) (shalin)
- Nested query support for the function query parser and lucene query parser (the latter existed as an undocumented feature in 1.3) [SOLR-1046](https://issues.apache.org/jira/browse/SOLR-1046) (yonik)
- Support the merge of multiple indexes as a CoreAdmin and an update command [SOLR-1051](https://issues.apache.org/jira/browse/SOLR-1051) (Ning Li) (shalin)
- Add PathHierarchyTokenizerFactory. [SOLR-1057](https://issues.apache.org/jira/browse/SOLR-1057) (ryan) (koji)
- Fixed performance problem in the StopFilterFactory and simplified code. Added tests as well. [SOLR-1095](https://issues.apache.org/jira/browse/SOLR-1095) (gsingers)
- Introduced httpConnTimeout and httpReadTimeout in replication slave configuration to avoid stalled replication. [SOLR-1096](https://issues.apache.org/jira/browse/SOLR-1096) (Jeff Newburn) (Noble Paul) (shalin)
- A FieldAnalysisRequestHandler which provides the analysis functionality of the web admin page as a service. The AnalysisRequestHandler is renamed to DocumentAnalysisRequestHandler which is enhanced with query analysis and showMatch support. AnalysisRequestHandler is now deprecated. Support for both FieldAnalysisRequestHandler and DocumentAnalysisRequestHandler is also provided in the Solrj client. [SOLR-1099](https://issues.apache.org/jira/browse/SOLR-1099) (Uri Boness) (shalin)
- Made CoreAdminHandler Actions pluggable so that additional actions may be plugged in or the existing ones can be overridden if needed. [SOLR-1106](https://issues.apache.org/jira/browse/SOLR-1106) (Kay Kay) (Noble Paul) (shalin)
- Support sorting on trie fields with Distributed Search. [SOLR-1110](https://issues.apache.org/jira/browse/SOLR-1110) (Mark Miller) (Uwe Schindler) (shalin)
- &lt;bool&gt;on&lt;/bool&gt; and &lt;bool&gt;yes&lt;/bool&gt; work as expected in solrconfig.xml. [SOLR-1115](https://issues.apache.org/jira/browse/SOLR-1115) (koji)
- Add a Binary FieldType [SOLR-1116](https://issues.apache.org/jira/browse/SOLR-1116) (noble)
- CoreAdminhandler should not need a core . This makes it possible to start a Solr server w/o a core .(noble) [SOLR-1121](https://issues.apache.org/jira/browse/SOLR-1121) 
- Add a top() function query that causes its argument to have its values derived from the top level IndexReader, even when invoked from a sub-reader. top() is implicitly used for the ord() and rord() functions. [SOLR-1124](https://issues.apache.org/jira/browse/SOLR-1124) (yonik)
- Added metadata output to extraction request handler "extract only" option. [SOLR-1128](https://issues.apache.org/jira/browse/SOLR-1128) (gsingers)
- FieldTypes can now output multiple Fields per Type and still be searched. This can be handy for hiding the details of a particular implementation such as in the spatial case. [SOLR-1131](https://issues.apache.org/jira/browse/SOLR-1131) (Chris Mattmann) (shalin) (noble) (gsingers) (yonik)
- Add TermsComponent Query and Response Support in SolrJ [SOLR-1139](https://issues.apache.org/jira/browse/SOLR-1139) (Matt Weber) (shalin)
- Add capability to specify an infoStream log file for the underlying Lucene IndexWriter in solrconfig.xml. This is an advanced debug log file that can be used to aid developers in fixing IndexWriter bugs. See the commented out example in the example solrconfig.xml under the indexDefaults section. [SOLR-1145](https://issues.apache.org/jira/browse/SOLR-1145) (Chris Harris) (Mark Miller)
- Snapshoot on ReplicationHandler should accept location as a request parameter [SOLR-1152](https://issues.apache.org/jira/browse/SOLR-1152) (shalin)
- Sort TermsComponent results by frequency [SOLR-1156](https://issues.apache.org/jira/browse/SOLR-1156) (Matt Weber) (yonik)
- Solr Config now supports XInclude for XML engines that can support it. [SOLR-1167](https://issues.apache.org/jira/browse/SOLR-1167) (Bryan Talbot) (gsingers)
- disable/enable replication on master side. added two commands 'enableReplication' and 'disableReplication' [SOLR-1175](https://issues.apache.org/jira/browse/SOLR-1175) (noble)
- Distributed Search support for TermsComponent [SOLR-1177](https://issues.apache.org/jira/browse/SOLR-1177) (Matt Weber) (shalin)
- DocSets can now be used as Lucene Filters via DocSet.getTopFilter() [SOLR-1179](https://issues.apache.org/jira/browse/SOLR-1179) (yonik)
- Support providing username and password for basic HTTP authentication in Java replication [SOLR-1189](https://issues.apache.org/jira/browse/SOLR-1189) (Matthew Gregg) (shalin)
- Enhance SpellingQueryConverter to handle UTF-8 instead of ASCII only. Use the NMTOKEN syntax for matching field names. [SOLR-1204](https://issues.apache.org/jira/browse/SOLR-1204) (Michael Ludwig) (shalin)
- differentiate between solr home and instanceDir .deprecates the method SolrResourceLoader#locateInstanceDir() and it is renamed to locateSolrHome [SOLR-1214](https://issues.apache.org/jira/browse/SOLR-1214) (noble)
- disambiguate the replication command names. 'snappull' becomes 'fetchindex' 'abortsnappull' becomes 'abortfetch' [SOLR-1216](https://issues.apache.org/jira/browse/SOLR-1216) (noble)
- firstSearcher and newSearcher can now be identified via the CommonParams.EVENT (evt) parameter in a request. This allows a RequestHandler or SearchComponent to know when a newSearcher or firstSearcher event happened. QuerySenderListender is the only implementation in Solr that implements this, but outside implementations may wish to. See the AbstractSolrEventListener for a helper method. [SOLR-1237](https://issues.apache.org/jira/browse/SOLR-1237) (gsingers)
- "Range Faceting" has been added. This is a generalization of the existing "Date Faceting" logic so that it now supports any all stock numeric field types that support range queries in addition to dates. facet.date is now deprecated in favor of this generalized mechanism. [SOLR-1240](https://issues.apache.org/jira/browse/SOLR-1240) (Gijs Kunze) (hossman)
- Show the output of CharFilters in analysis.jsp. [SOLR-1256](https://issues.apache.org/jira/browse/SOLR-1256) (koji)
- Added stemEnglishPossessive option (default=true) to WordDelimiterFilter that allows disabling of english possessive stemming (removal of trailing 's from tokens) [SOLR-1266](https://issues.apache.org/jira/browse/SOLR-1266) (Robert Muir) (yonik)
- Incorporate FastVectorHighlighter [SOLR-1268](https://issues.apache.org/jira/browse/SOLR-1268) (koji)
- Added text serialization output for extractOnly [SOLR-1274](https://issues.apache.org/jira/browse/SOLR-1274) (Peter Wolanin) (gsingers)
- Add expungeDeletes to DirectUpdateHandler2 [SOLR-1275](https://issues.apache.org/jira/browse/SOLR-1275) (noble)
- Add FieldCache introspection to stats.jsp and JMX Monitoring via a new SolrFieldCacheMBean. [SOLR-1292](https://issues.apache.org/jira/browse/SOLR-1292) (hossman)
- Add sort by Function capability [SOLR-1297](https://issues.apache.org/jira/browse/SOLR-1297) (gsingers) (yonik)
- Added several new distance based functions, including Great Circle (haversine), Manhattan, Euclidean and String (using the StringDistance methods in the Lucene spellchecker). Also added geohash(), deg() and rad() convenience functions. See https://solr.apache.org/guide/solr/latest/query-guide/function-queries.html [SOLR-1302](https://issues.apache.org/jira/browse/SOLR-1302) (gsingers)
- Create autosuggest component. [SOLR-1316](https://issues.apache.org/jira/browse/SOLR-1316) (Ankul Garg) (Jason Rutherglen) (Shalin Shekhar Mangar) (Grant Ingersoll) (Robert Muir) (ab)
- Add better support for efficient wildcard handling [SOLR-1321](https://issues.apache.org/jira/browse/SOLR-1321) (Andrzej Bialecki) (Robert Muir) (gsingers)
- New interface PluginInfoInitialized for all types of plugin [SOLR-1326](https://issues.apache.org/jira/browse/SOLR-1326) (noble)
- load core properties from a properties file [SOLR-1335](https://issues.apache.org/jira/browse/SOLR-1335) (noble)
- Add SmartChinese (word segmentation for Simplified Chinese) tokenizer and filters to contrib/analysis-extras [SOLR-1336](https://issues.apache.org/jira/browse/SOLR-1336) (rmuir)
- Added HTMLStripCharFilter and marked HTMLStripReader, HTMLStripWhitespaceTokenizerFactory and HTMLStripStandardTokenizerFactory deprecated. To strip HTML tags, HTMLStripCharFilter can be used with an arbitrary Tokenizer. [SOLR-1343](https://issues.apache.org/jira/browse/SOLR-1343) (koji)
- Multi-threaded implementation of DIH [SOLR-1352](https://issues.apache.org/jira/browse/SOLR-1352) (noble)
- Integration of Tika and DataImportHandler [SOLR-1358](https://issues.apache.org/jira/browse/SOLR-1358) (Akshay Ukey) (noble)
- Add ms() function query for getting milliseconds from dates and for high precision date subtraction, add sub() for subtracting other arguments. [SOLR-1368](https://issues.apache.org/jira/browse/SOLR-1368) (yonik)
- Show the output of CharFilters in FieldAnalysisRequestHandler [SOLR-1370](https://issues.apache.org/jira/browse/SOLR-1370) (koji)
- Enhance FieldAnalysisRequestHandler to accept field value from content stream [SOLR-1372](https://issues.apache.org/jira/browse/SOLR-1372) (ehatcher)
- Add Filter query to admin/form.jsp [SOLR-1373](https://issues.apache.org/jira/browse/SOLR-1373) (Jason Rutherglen) (hossman)
- Add RAMDirectoryFactory for non-persistent in memory index storage. [SOLR-1379](https://issues.apache.org/jira/browse/SOLR-1379) (Alex Baranov) (yonik)
- Add an 'enable' attribute to all plugins [SOLR-1385](https://issues.apache.org/jira/browse/SOLR-1385) (noble)
- implicit core properties are not set for single core [SOLR-1414](https://issues.apache.org/jira/browse/SOLR-1414) (noble)
- Simple property injection. &lt;mergePolicy&gt; & &lt;mergeScheduler&gt; syntaxes are now deprecated [SOLR-1447](https://issues.apache.org/jira/browse/SOLR-1447) (Jason Rutherglen) (noble)
- Add &lt;lib&gt; elements to solrconfig.xml to specifying additional classpath directories and regular expressions. [SOLR-1449](https://issues.apache.org/jira/browse/SOLR-1449) (hossman) (yonik)
- Enable sort by Lucene docid. [SOLR-1478](https://issues.apache.org/jira/browse/SOLR-1478) (ehatcher)
- allow DIH to refer to core properties [SOLR-1525](https://issues.apache.org/jira/browse/SOLR-1525) (noble)
- Allow StreamingUpdateSolrServer to use a provided HttpClient [SOLR-1532](https://issues.apache.org/jira/browse/SOLR-1532) (Gabriele Renzi) (shalin)
- DIH TemplateTransformer copy objects more intelligently when the template is a single variable [SOLR-1547](https://issues.apache.org/jira/browse/SOLR-1547) (noble)
- New dismax parser implementation (accessible as "edismax") that supports full lucene syntax, improved reserved char escaping, fielded queries, improved proximity boosting, and improved stopword handling. Note: status is experimental for now. [SOLR-1553](https://issues.apache.org/jira/browse/SOLR-1553) (yonik)
- TermVectorComponent now supports per field overrides. Also, it now throws an error if passed in fields do not exist and warnings if fields that do not have term vector options (termVectors, offsets, positions) that align with the schema declaration. It also will now return warnings about [SOLR-1556](https://issues.apache.org/jira/browse/SOLR-1556) (gsingers)
- Added "native" filtering support for PointType, GeohashField. Added LatLonType with filtering support too. See http://wiki.apache.org/solr/SpatialSearch and the example. Refactored some items in Lucene spatial. Removed SpatialTileField as the underlying CartesianTier is broken beyond repair and is going to be moved. [SOLR-1568](https://issues.apache.org/jira/browse/SOLR-1568) (gsingers)
- Allow functions to take in literal strings by modifying the FunctionQParser and adding LiteralValueSource [SOLR-1569](https://issues.apache.org/jira/browse/SOLR-1569) (gsingers)
- Added unicode collation support though Lucene's CollationKeyFilter [SOLR-1571](https://issues.apache.org/jira/browse/SOLR-1571) (Robert Muir) (shalin)
- Add many new functions from java Math (e.g. sin, cos) [SOLR-1574](https://issues.apache.org/jira/browse/SOLR-1574) (yonik)
- DIH Create DataSources that return InputStream [SOLR-1583](https://issues.apache.org/jira/browse/SOLR-1583) (noble)
- Add support for Geohash and Spatial Tile FieldType [SOLR-1586](https://issues.apache.org/jira/browse/SOLR-1586) (Chris Mattmann) (gsingers)
- Allow current single core deployments to be specified by solr.xml [SOLR-1621](https://issues.apache.org/jira/browse/SOLR-1621) [SOLR-1722](https://issues.apache.org/jira/browse/SOLR-1722) (Mark Miller) (noble)
- Add regexp support for TermsComponent [SOLR-1625](https://issues.apache.org/jira/browse/SOLR-1625) (Uri Boness) (noble)
- DIH VariableResolver should be fetched just in time [SOLR-1627](https://issues.apache.org/jira/browse/SOLR-1627) (noble)
- Add PatternReplaceCharFilter [SOLR-1653](https://issues.apache.org/jira/browse/SOLR-1653) (koji)
- TikaEntityProcessor example added DIHExample [SOLR-1654](https://issues.apache.org/jira/browse/SOLR-1654) (Akshay Ukey) (noble)
- Converted remaining TokenStreams to the Attributes-based API. All Solr TokenFilters now support custom Attributes, and some have improved performance: especially WordDelimiterFilter and CommonGramsFilter. [SOLR-1657](https://issues.apache.org/jira/browse/SOLR-1657) (rmuir) (cmale) (uschindler)
- Add support for choosing the Lucene Version for Lucene components within Solr. [SOLR-1677](https://issues.apache.org/jira/browse/SOLR-1677) (Uwe Schindler) (Mark Miller)
- Move onError handling to DIH framework [SOLR-1678](https://issues.apache.org/jira/browse/SOLR-1678) (noble)
- PluginInfo should load plugins w/o class attribute also [SOLR-1697](https://issues.apache.org/jira/browse/SOLR-1697) (noble)
- Add explicit option to run DataImportHandler in synchronous mode [SOLR-1721](https://issues.apache.org/jira/browse/SOLR-1721) (Alexey Serba) (noble)
- Added FieldStreamDataSource [SOLR-1737](https://issues.apache.org/jira/browse/SOLR-1737) (noble)
- ShingleFilterFactory supports the "minShingleSize" and "tokenSeparator" parameters for controlling the minimum shingle size produced by the filter, and the separator string that it uses, respectively. [SOLR-1740](https://issues.apache.org/jira/browse/SOLR-1740) (Steven Rowe) (rmuir)
- SolrInfoMBeanHandler added for simpler programmatic access to info currently available from registry.jsp and stats.jsp [SOLR-1750](https://issues.apache.org/jira/browse/SOLR-1750) (ehatcher) (hossman)
- Re-enabled clustering component on trunk, updated to latest version of Carrot2. No more LGPL run-time dependencies. This release of C2 also does not have a specific Lucene dependency. [SOLR-1804](https://issues.apache.org/jira/browse/SOLR-1804) (Stanislaw Osinski) (gsingers)
- SolrJ now preserves the order of facet queries. [SOLR-1815](https://issues.apache.org/jira/browse/SOLR-1815) (yonik)
- Synced Solr analysis with Lucene 3.1. Added KeywordMarkerFilterFactory and StemmerOverrideFilterFactory, which can be used to tune stemming algorithms. Added factories for Bulgarian, Czech, Hindi, Turkish, and Wikipedia analysis. Improved the performance of SnowballPorterFilterFactory. [SOLR-1857](https://issues.apache.org/jira/browse/SOLR-1857) (rmuir)
- PhoneticFilterFactory now has support for the Caverphone algorithm. [SOLR-1923](https://issues.apache.org/jira/browse/SOLR-1923) (rmuir)
- Add CSVResponseWriter (use wt=csv) that returns the list of documents in CSV format. [SOLR-1925](https://issues.apache.org/jira/browse/SOLR-1925) (Chris Mattmann) (yonik)
- The VelocityResponseWriter contrib moved to core. Example search UI now available at http://localhost:8983/solr/browse [SOLR-1957](https://issues.apache.org/jira/browse/SOLR-1957) (ehatcher)
- QueryElevationComponent can now return just the included results in the elevation file [SOLR-1966](https://issues.apache.org/jira/browse/SOLR-1966) (gsingers) (yonik)
- Add LimitTokenCountFilterFactory. [SOLR-1974](https://issues.apache.org/jira/browse/SOLR-1974) (koji)
- Add HyphenationCompoundWordTokenFilterFactory. [SOLR-1984](https://issues.apache.org/jira/browse/SOLR-1984) (PB) (rmuir)
- FastVectorHighlighter: add wrapper class for Lucene's SingleFragListBuilder [SOLR-1985](https://issues.apache.org/jira/browse/SOLR-1985) (koji)
- Added ability to verify that spell checking collations have actual results in the index. [SOLR-2010](https://issues.apache.org/jira/browse/SOLR-2010) (James Dyer) (gsingers)
- Add a boolean attribute autoGeneratePhraseQueries to TextField. autoGeneratePhraseQueries="true" (the default) causes the query parser to generate phrase queries if multiple tokens are generated from a single non-quoted analysis string. For example WordDelimiterFilter splitting text:pdp-11 will cause the parser to generate text:"pdp 11" rather than (text:PDP OR text:11). Note that autoGeneratePhraseQueries="true" tends to not work well for non whitespace delimited languages. [SOLR-2015](https://issues.apache.org/jira/browse/SOLR-2015) (yonik)
- Add SolrEncoder plugin to Highlighter. [SOLR-2021](https://issues.apache.org/jira/browse/SOLR-2021) (koji)
- Make FastVectorHighlighter use of SolrEncoder. [SOLR-2030](https://issues.apache.org/jira/browse/SOLR-2030) (koji)
- Add hl.multiValuedSeparatorChar for FastVectorHighlighter, per LUCENE-2603. [SOLR-2049](https://issues.apache.org/jira/browse/SOLR-2049) [LUCENE-2603](https://issues.apache.org/jira/browse/LUCENE-2603) (koji)
- Add support for custom comparators in Solr spellchecker, per LUCENE-2479 [SOLR-2053](https://issues.apache.org/jira/browse/SOLR-2053) [LUCENE-2479](https://issues.apache.org/jira/browse/LUCENE-2479) (gsingers)
- Add "types" attribute to WordDelimiterFilterFactory, which allows you to customize how WordDelimiterFilter tokenizes text with a configuration file. [SOLR-2059](https://issues.apache.org/jira/browse/SOLR-2059) (Peter Karich) (rmuir)
- Add ability to throttle rsync based replication using rsync option --bwlimit. [SOLR-2099](https://issues.apache.org/jira/browse/SOLR-2099) (Brandon Evans) (koji)
- Full parameter substitution for function queries. Example: q=add($v1,$v2)&v1=mul(popularity,5)&v2=20.0 [SOLR-2128](https://issues.apache.org/jira/browse/SOLR-2128) (yonik)
- Added a Solr module for dynamic metadata extraction/indexing with Apache UIMA. See contrib/uima/README.txt for more information. [SOLR-2129](https://issues.apache.org/jira/browse/SOLR-2129) (Tommaso Teofili) (rmuir)
- Function query parser can now parse multiple comma separated value sources. It also now fails if there is extra unexpected text after parsing the functions, instead of silently ignoring it. This allows expressions like q=dist(2,vector(1,2),$pt)&pt=3,4 [SOLR-2133](https://issues.apache.org/jira/browse/SOLR-2133) (yonik)
- Suggester should return alpha-sorted results when onlyMorePopular=false [SOLR-2157](https://issues.apache.org/jira/browse/SOLR-2157) (ab)
- Added "maxTokenLength" argument to the factories for ClassicTokenizer, StandardTokenizer, and UAX29URLEmailTokenizer. [SOLR-2188](https://issues.apache.org/jira/browse/SOLR-2188) (Steven Rowe)
- Add icu-based tokenizer and filters to contrib/analysis-extras [SOLR-2210](https://issues.apache.org/jira/browse/SOLR-2210) (rmuir)
- Added UAX29URLEmailTokenizerFactory, which implements UAX#29, a unicode algorithm with good results for most languages, as well as URL and E-mail tokenization according to the relevant RFCs. [SOLR-2211](https://issues.apache.org/jira/browse/SOLR-2211) [LUCENE-2763](https://issues.apache.org/jira/browse/LUCENE-2763) (Tom Burton-West) (rmuir)
- Added StempelPolishStemFilterFactory to contrib/analysis-extras [SOLR-2237](https://issues.apache.org/jira/browse/SOLR-2237) (rmuir)
- Add ability for RawResponseWriter to stream binary files as well as text files. [SOLR-2263](https://issues.apache.org/jira/browse/SOLR-2263) (Eric Pugh) (yonik)
- Add distributed search support for search result clustering. [SOLR-2282](https://issues.apache.org/jira/browse/SOLR-2282) (Brad Giaccio) (Dawid Weiss) (Stanislaw Osinski) (rmuir) (koji)
- Allow tagging and exclusion of main query for faceting. [SOLR-2325](https://issues.apache.org/jira/browse/SOLR-2325) (yonik)
- Add configurable IndexReaderFactory so that alternate IndexReader implementations can be specified via solrconfig.xml. Note that using a custom IndexReader may be incompatible with ReplicationHandler (see comments in SOLR-1366). This should be treated as an experimental feature. [SOLR-243](https://issues.apache.org/jira/browse/SOLR-243) [SOLR-1366](https://issues.apache.org/jira/browse/SOLR-1366) (Andrzej Bialecki) (hossman) (Mark Miller) (John Wang)
- Added support for extracting content from binary documents like MS Word and PDF using Apache Tika. See also contrib/extraction/CHANGES.txt [SOLR-284](https://issues.apache.org/jira/browse/SOLR-284) (Eric Pugh) (Chris Harris) (yonik) (gsingers)
- Date Faceting now supports a "facet.date.include" param for specifying when the upper & lower end points of computed date ranges should be included in the range. Legal values are: "all", "lower", "upper", "edge", and "outer". For backwards compatibility the default value is the set: [lower,upper,edge], so that all ranges between start and end are inclusive of their endpoints, but the "before" and "after" ranges are not. [SOLR-397](https://issues.apache.org/jira/browse/SOLR-397) 
- Add configurable DirectoryProvider so that alternate Directory implementations can be specified via solrconfig.xml. The default DirectoryProvider will use NIOFSDirectory for better concurrency on non Windows platforms. [SOLR-465](https://issues.apache.org/jira/browse/SOLR-465) (Mark Miller) (TJ Laurenzo) (yonik)
- Add maxChars attribute for copyField function so that the length limit for destination can be specified. [SOLR-538](https://issues.apache.org/jira/browse/SOLR-538) (Georgios Stamatis) (Lars Kotthoff) (Chris Harris) (koji)
- Add support for globbing in field names to highlight. For example, hl.fl=*_text will highlight all fieldnames ending with _text. [SOLR-540](https://issues.apache.org/jira/browse/SOLR-540) (Lars Kotthoff) (yonik)
- Use SLF4J logging API rather then JDK logging. The packaged .war file is shipped with a JDK logging implementation, so logging configuration for the .war should be identical to solr 1.3. However, if you are using the .jar file, you can select which logging implementation to use by dropping a different binding. See: http://www.slf4j.org/ [SOLR-560](https://issues.apache.org/jira/browse/SOLR-560) (ryan)
- Added Replication implemented in Java as a request handler. Supports index replication as well as configuration replication and exposes detailed statistics and progress information on the Admin page. Works on all platforms. [SOLR-561](https://issues.apache.org/jira/browse/SOLR-561) (Noble Paul) (yonik) (Akshay Ukey) (shalin)
- Allow configurable index deletion policy and provide a default implementation which allows deletion of commit points on various criteria such as number of commits, age of commit point and optimized status. See http://lucene.apache.org/java/2_3_2/api/org/apache/lucene/index/IndexDeletionPolicy.html [SOLR-617](https://issues.apache.org/jira/browse/SOLR-617) (yonik) (Noble Paul) (Akshay Ukey) (shalin)
- Added TermVectorComponent for serving up term vector information, plus IDF. See http://wiki.apache.org/solr/TermVectorComponent [SOLR-651](https://issues.apache.org/jira/browse/SOLR-651) (gsingers) (Vaijanath N. Rao) (Noble Paul)
- Allow Solr to load index from arbitrary directory in dataDir [SOLR-658](https://issues.apache.org/jira/browse/SOLR-658) (Noble Paul) (Akshay Ukey) (shalin)
- Adds shards.start and shards.rows to distributed search to allow more efficient bulk queries (those that retrieve many or all documents). [SOLR-659](https://issues.apache.org/jira/browse/SOLR-659) (Brian Whitman) (yonik)
- A LRU cache implementation based upon ConcurrentHashMap and other techniques to reduce contention and synchronization overhead, to utilize multiple CPU cores more effectively. [SOLR-667](https://issues.apache.org/jira/browse/SOLR-667) (Fuad Efendi) (Noble Paul) (yonik) (shalin)
- Add support for rollbacks in UpdateHandler. This allows user to rollback all changes since the last commit. [SOLR-670](https://issues.apache.org/jira/browse/SOLR-670) (Noble Paul) (koji) (shalin)
- Add StatsComponent. This gets simple statistics on matched numeric fields, including: min, max, mean, median, stddev. (koji, ryan) - SOLR-1380: Added support for multi-valued fields [SOLR-680](https://issues.apache.org/jira/browse/SOLR-680) [SOLR-1380](https://issues.apache.org/jira/browse/SOLR-1380) (Harish Agarwal) (gsingers)
- Add support for OmitTf [SOLR-739](https://issues.apache.org/jira/browse/SOLR-739) (Mark Miller) (yonik)
- ShingleFilterFactory supports the "outputUnigramsIfNoShingles" parameter, to output unigrams if the number of input tokens is fewer than minShingleSize, and no shingles can be generated. [SOLR-744](https://issues.apache.org/jira/browse/SOLR-744) (Chris Harris) (Steven Rowe)
- Added "omitHeader" request parameter to omit the header from the response. [SOLR-746](https://issues.apache.org/jira/browse/SOLR-746) (Noble Paul) (shalin)
- Add support for Lucene's PositionFilter [SOLR-763](https://issues.apache.org/jira/browse/SOLR-763) (Mck SembWever) (shalin)
- DIH: Set last_index_time variable in full-import command. [SOLR-768](https://issues.apache.org/jira/browse/SOLR-768) (Wojtek Piaseczny) (Noble Paul) (shalin)
- Added support for clustering in contrib/clustering. See http://wiki.apache.org/solr/ClusteringComponent for more info. [SOLR-769](https://issues.apache.org/jira/browse/SOLR-769) (gsingers) (Stanislaw Osinski)
- Distributed search ability to sort field.facet values lexicographically. facet.sort values "true" and "false" are also deprecated and replaced with "count" and "lex". [SOLR-781](https://issues.apache.org/jira/browse/SOLR-781) (Lars Kotthoff) (yonik)
- Distributed Search support for SpellCheckComponent [SOLR-785](https://issues.apache.org/jira/browse/SOLR-785) (Matthew Woytowitz) (shalin)
- Add 'commitWithin' argument to the update add command. This behaves similar to the global autoCommit maxTime argument except that it is set for each request. [SOLR-793](https://issues.apache.org/jira/browse/SOLR-793) (ryan)
- SpellCheckComponent supports building indices on optimize if configured in solrconfig.xml [SOLR-795](https://issues.apache.org/jira/browse/SOLR-795) (Jason Rennie) (shalin)
- Add support for hash based exact/near duplicate document handling. [SOLR-799](https://issues.apache.org/jira/browse/SOLR-799) (Mark Miller) (yonik)
- DIH: Add support for configurable pre-import and post-import delete query per root-entity. [SOLR-801](https://issues.apache.org/jira/browse/SOLR-801) (Noble Paul) (shalin)
- Allow a "deltaImportQuery" attribute in SqlEntityProcessor which is used for delta imports instead of DataImportHandler manipulating the SQL itself. [SOLR-811](https://issues.apache.org/jira/browse/SOLR-811) (Noble Paul) (shalin)
- Configurable JDBC settings in JdbcDataSource including optimized defaults for read only mode. [SOLR-812](https://issues.apache.org/jira/browse/SOLR-812) (David Smiley) (Glen Newton) (shalin)
- Adding DoubleMetaphone Filter and Factory. Similar to the PhoneticFilter, but this uses DoubleMetaphone specific calls (including alternate encoding) [SOLR-813](https://issues.apache.org/jira/browse/SOLR-813) (Todd Feak) (ryan)
- Added factories for Arabic support [SOLR-819](https://issues.apache.org/jira/browse/SOLR-819) (gsingers)
- Support replication on startup of master with new index. [SOLR-820](https://issues.apache.org/jira/browse/SOLR-820) (Noble Paul) (Akshay Ukey) (shalin)
- Add support for replication to copy conf file to slave with a different name. This allows replication of solrconfig.xml [SOLR-821](https://issues.apache.org/jira/browse/SOLR-821) (Noble Paul) (Akshay Ukey) (shalin)
- Add CharFilter so that characters can be filtered (e.g. character normalization) before Tokenizer/TokenFilters. [SOLR-822](https://issues.apache.org/jira/browse/SOLR-822) (koji)
- Allow slaves to request compressed files from master during replication [SOLR-829](https://issues.apache.org/jira/browse/SOLR-829) (Simon Collins) (Noble Paul) (Akshay Ukey) (shalin)
- DIH: A DataSource to read data from a field as a reader. This can be used, for example, to read XMLs residing as CLOBs or BLOBs in databases. [SOLR-833](https://issues.apache.org/jira/browse/SOLR-833) (Noble Paul) (shalin)
- Better error handling in DataImportHandler with options to abort, skip and continue imports. [SOLR-842](https://issues.apache.org/jira/browse/SOLR-842) (Noble Paul) (shalin)
- A SolrServer implementation to front-end multiple solr servers and provides load balancing and failover support [SOLR-844](https://issues.apache.org/jira/browse/SOLR-844) (Noble Paul) (Mark Miller) (hossman) (shalin)
- Enhance the snappull command in ReplicationHandler to accept masterUrl. [SOLR-847](https://issues.apache.org/jira/browse/SOLR-847) (Noble Paul) (Preetam Rao) (shalin)
- Addition of timeouts for distributed searching. Configurable through 'shard-socket-timeout' and 'shard-connection-timeout' parameters in SearchHandler. [SOLR-850](https://issues.apache.org/jira/browse/SOLR-850) (Patrick O'Leary) (shalin)
- Add debug output for MoreLikeThis. [SOLR-860](https://issues.apache.org/jira/browse/SOLR-860) (koji)
- Adding support for document updates in binary format and corresponding support in Solrj client. [SOLR-865](https://issues.apache.org/jira/browse/SOLR-865) (Noble Paul) (shalin)
- WordDelimiterFilter now supports a splitOnNumerics option, as well as a list of protected terms. [SOLR-876](https://issues.apache.org/jira/browse/SOLR-876) (Dan Rosher) (hossman)
- Added TermsComponent for accessing Lucene's TermEnum capabilities. Useful for auto suggest and possibly distributed search. Not distributed search compliant. (gsingers) - Added mincount and maxcount options [SOLR-877](https://issues.apache.org/jira/browse/SOLR-877) (Khee Chin) (gsingers)
- DataImportHandler should rollback when an import fails or it is aborted [SOLR-886](https://issues.apache.org/jira/browse/SOLR-886) (shalin)
- A DIH Transformer to strip HTML tags. [SOLR-887](https://issues.apache.org/jira/browse/SOLR-887) (Ahmed Hammad) (shalin)
- A DIH Transformer to read strings from Clob type. [SOLR-891](https://issues.apache.org/jira/browse/SOLR-891) (Noble Paul) (shalin)
- Adding a StreamingUpdateSolrServer that writes update commands to an open HTTP connection. If you are using solrj for bulk update requests you should consider switching to this implementaion. However, note that the error handling is not immediate as it is with the standard SolrServer. [SOLR-906](https://issues.apache.org/jira/browse/SOLR-906) (ryan)
- CommonGramsFilterFactory/CommonGramsQueryFilterFactory for speeding up phrase queries containing common words by indexing n-grams and using them at query time. [SOLR-908](https://issues.apache.org/jira/browse/SOLR-908) (Tom Burton-West) (Jason Rutherglen) (yonik)
- Add a few utility commands to the DIH admin page such as full import, delta import, status, reload config. [SOLR-910](https://issues.apache.org/jira/browse/SOLR-910) (Ahmed Hammad) (shalin)
- Add support for multi-select faceting by allowing filters to be tagged and facet commands to exclude certain filters. This patch also added the ability to change the output key for facets in the response, and optimized distributed faceting refinement by lowering parsing overhead and by making requests and responses smaller. [SOLR-911](https://issues.apache.org/jira/browse/SOLR-911) 
- SolrDocument and SolrInputDocument now implement the Map&lt;String,?&gt; interface. This should make plugging into other standard tools easier. [SOLR-928](https://issues.apache.org/jira/browse/SOLR-928) (ryan)
- Add event listener API for DIH import start and end. [SOLR-938](https://issues.apache.org/jira/browse/SOLR-938) (Kay Kay) (Noble Paul) (shalin)
- ValueSourceRangeFilter/Query - filter based on values in a FieldCache entry or on any arbitrary function of field values. [SOLR-939](https://issues.apache.org/jira/browse/SOLR-939) (yonik)
- Add support for Lucene's Trie Range Queries by providing new FieldTypes in schema for int, float, long, double and date. Single-valued Trie based fields with a precisionStep will index multiple precisions and enable faster range queries. [SOLR-940](https://issues.apache.org/jira/browse/SOLR-940) (Uwe Schindler) (yonik) (shalin)
- Make it possible to specify dataDir in solr.xml and accept the dataDir as a request parameter for the CoreAdmin create command. [SOLR-943](https://issues.apache.org/jira/browse/SOLR-943) (Noble Paul) (shalin)
- JSON update handler that accepts add, delete, commit commands in JSON format. [SOLR-945](https://issues.apache.org/jira/browse/SOLR-945) (Ryan McKinley) (yonik)
- Enhance the map() function query to take in an optional default value [SOLR-966](https://issues.apache.org/jira/browse/SOLR-966) (Noble Paul) (shalin)
- A PlainTextEntityProcessor which can read from any DataSource&lt;Reader&gt; and output a String. (Nathan Adams, Noble Paul via shalin) 100.SOLR-1003: XPathEntityprocessor must allow slurping all text from a given xml node and its children. (Noble Paul via shalin) 101.SOLR-1001: Allow variables in various attributes of RegexTransformer, HTMLStripTransformer and NumberFormatTransformer. (Fergus McMenemie, Noble Paul, shalin) 102.SOLR-989: DIH: Expose running statistics from the Context API. (Noble Paul, shalin) 103.SOLR-996: DIH: Expose Context to Evaluators. (Noble Paul, shalin) 104.SOLR-783: DIH: Enhance delta-imports by maintaining separate last_index_time for each entity. (Jon Baer, Noble Paul via shalin) 105.SOLR-1033: Current entity's namespace is made available to all DIH Transformers. This allows one to use an output field of TemplateTransformer in other transformers, among other things. (Fergus McMenemie, Noble Paul via shalin) 106.SOLR-1066: New methods in DIH Context to expose Script details. ScriptTransformer changed to read scripts through the new API methods. (Noble Paul via shalin) 107.SOLR-1062: A DIH LogTransformer which can log data in a given template format. (Jon Baer, Noble Paul via shalin) 108.SOLR-1065: A DIH ContentStreamDataSource which can accept HTTP POST data in a content stream. This can be used to push data to Solr instead of just pulling it from DB/Files/URLs. (Noble Paul via shalin) 109.SOLR-1061: Improve DIH RegexTransformer to create multiple columns from regex groups. (Noble Paul via shalin) 110.SOLR-1059: Special DIH flags introduced for deleting documents by query or id, skipping rows and stopping further transforms. Use $deleteDocById, $deleteDocByQuery for deleting by id and query respectively. Use $skipRow to skip the current row but continue with the document. Use $stopTransform to stop further transformers. New methods are introduced in Context for deleting by id and query. (Noble Paul, Fergus McMenemie, shalin) 111.SOLR-1076: JdbcDataSource should resolve DIH variables in all its configuration parameters. (shalin) 112.SOLR-1055: Make DIH JdbcDataSource easily extensible by making the createConnectionFactory method protected and return a Callable&lt;Connection&gt; object. (Noble Paul, shalin) 113.SOLR-1058: DIH: JdbcDataSource can lookup javax.sql.DataSource using JNDI. Use a jndiName attribute to specify the location of the data source. (Jason Shepherd, Noble Paul via shalin) 114.SOLR-1083: A DIH Evaluator for escaping query characters. (Noble Paul, shalin) 115.SOLR-934: A MailEntityProcessor to enable indexing mails from POP/IMAP sources into a solr index. (Preetam Rao, shalin) 116.SOLR-1060: A DIH LineEntityProcessor which can stream lines of text from a given file to be indexed directly or for processing with transformers and child entities. (Fergus McMenemie, Noble Paul, shalin) 117.SOLR-1127: Add support for DIH field name to be templatized. (Noble Paul, shalin) 118.SOLR-1092: Added a new DIH command named 'import' which does not automatically clean the index. This is useful and more appropriate when one needs to import only some of the entities. (Noble Paul via shalin) 119.SOLR-1153: DIH 'deltaImportQuery' is honored on child entities as well (noble) 120.SOLR-1230: Enhanced dataimport.jsp to work with all DataImportHandler request handler configurations, rather than just a hardcoded /dataimport handler. (ehatcher) 121.SOLR-1235: disallow period (.) in DIH entity names (noble) 122.SOLR-1234: Multiple DIH does not work because all of them write to dataimport.properties. Use the handler name as the properties file name (noble) 123.SOLR-1348: Support binary field type in convertType logic in DIH JdbcDataSource (shalin) 124.SOLR-1406: DIH: Make FileDataSource and FileListEntityProcessor to be more extensible (Luke Forehand, shalin) 125.SOLR-1437: DIH: XPathEntityProcessor can deal with xpath syntaxes such as //tagname , /root//tagname [SOLR-980](https://issues.apache.org/jira/browse/SOLR-980) [SOLR-1003](https://issues.apache.org/jira/browse/SOLR-1003) [SOLR-1001](https://issues.apache.org/jira/browse/SOLR-1001) [SOLR-989](https://issues.apache.org/jira/browse/SOLR-989) [SOLR-996](https://issues.apache.org/jira/browse/SOLR-996) [SOLR-783](https://issues.apache.org/jira/browse/SOLR-783) [SOLR-1033](https://issues.apache.org/jira/browse/SOLR-1033) [SOLR-1066](https://issues.apache.org/jira/browse/SOLR-1066) [SOLR-1062](https://issues.apache.org/jira/browse/SOLR-1062) [SOLR-1065](https://issues.apache.org/jira/browse/SOLR-1065) [SOLR-1061](https://issues.apache.org/jira/browse/SOLR-1061) [SOLR-1059](https://issues.apache.org/jira/browse/SOLR-1059) [SOLR-1076](https://issues.apache.org/jira/browse/SOLR-1076) [SOLR-1055](https://issues.apache.org/jira/browse/SOLR-1055) [SOLR-1058](https://issues.apache.org/jira/browse/SOLR-1058) [SOLR-1083](https://issues.apache.org/jira/browse/SOLR-1083) [SOLR-934](https://issues.apache.org/jira/browse/SOLR-934) [SOLR-1060](https://issues.apache.org/jira/browse/SOLR-1060) [SOLR-1127](https://issues.apache.org/jira/browse/SOLR-1127) [SOLR-1092](https://issues.apache.org/jira/browse/SOLR-1092) [SOLR-1153](https://issues.apache.org/jira/browse/SOLR-1153) [SOLR-1230](https://issues.apache.org/jira/browse/SOLR-1230) [SOLR-1235](https://issues.apache.org/jira/browse/SOLR-1235) [SOLR-1234](https://issues.apache.org/jira/browse/SOLR-1234) [SOLR-1348](https://issues.apache.org/jira/browse/SOLR-1348) [SOLR-1406](https://issues.apache.org/jira/browse/SOLR-1406) [SOLR-1437](https://issues.apache.org/jira/browse/SOLR-1437) (Fergus McMenemie) (noble)
- Add a new scope for session data stored in Context to store objects across imports. [SOLR-988](https://issues.apache.org/jira/browse/SOLR-988) (Noble Paul) (shalin)

### Changed (29 changes)

- Change SolrIndexSearcher to use insertWithOverflow with reusable priority queue entries to reduce the amount of generated garbage during searching. [SOLR-1002](https://issues.apache.org/jira/browse/SOLR-1002) (Mark Miller) (yonik)
- DIH: Check for abort more frequently during delta-imports. [SOLR-1004](https://issues.apache.org/jira/browse/SOLR-1004) (Marc Sturlese) (shalin)
- DIH DateFormatTransformer can cache the format objects. [SOLR-1098](https://issues.apache.org/jira/browse/SOLR-1098) (Noble Paul) (shalin)
- Remove un-needed synchronization in SolrCore constructor. [SOLR-1108](https://issues.apache.org/jira/browse/SOLR-1108) (Noble Paul) (shalin)
- Use per-segment sorting to share fieldcache elements across unchanged segments. This saves memory and reduces commit times for incremental updates to the index. [SOLR-1111](https://issues.apache.org/jira/browse/SOLR-1111) (yonik)
- Load Documents for Highlighting one at a time rather than all at once to avoid OOM with many large Documents. [SOLR-1150](https://issues.apache.org/jira/browse/SOLR-1150) (Siddharth Gargate) (Mark Miller)
- Use Lucene Filters and pass them down to the Lucene search methods to filter earlier and improve performance. [SOLR-1165](https://issues.apache.org/jira/browse/SOLR-1165) (yonik)
- Speed up docset/filter generation by avoiding top-level score() call and iterating over leaf readers with TermDocs. [SOLR-1166](https://issues.apache.org/jira/browse/SOLR-1166) (yonik)
- SortedIntDocSet - a new small set implementation that saves memory over HashDocSet, is faster to construct, is ordered for easier implementation of skipTo, and is faster in the general case. [SOLR-1169](https://issues.apache.org/jira/browse/SOLR-1169) (yonik)
- Minor efficiency improvement in TermVectorComponent related to ignoring positions or offsets [SOLR-1188](https://issues.apache.org/jira/browse/SOLR-1188) (gsingers)
- Enables setting IndexReader's termInfosIndexDivisor via a new attribute to StandardIndexReaderFactory. Enables setting termIndexInterval to IndexWriter via SolrIndexConfig. [SOLR-1296](https://issues.apache.org/jira/browse/SOLR-1296) (Jason Rutherglen) (hossman) (gsingers)
- Implement and use reusable token streams for analysis. [SOLR-1353](https://issues.apache.org/jira/browse/SOLR-1353) (Robert Muir) (yonik)
- Replaced string concatenations with StringBuilder append calls in DIH XPathRecordReader. [SOLR-1465](https://issues.apache.org/jira/browse/SOLR-1465) (Mark Miller) (shalin)
- Don't build up string messages in SolrCore.execute unless they are necessary for the current log level. [SOLR-1679](https://issues.apache.org/jira/browse/SOLR-1679) (Fuad Efendi and hossman)
- Switch clustering component to use the SolrIndexSearcher.doc(int, Set&lt;String&gt;) method b/c it can use the document cache [SOLR-1684](https://issues.apache.org/jira/browse/SOLR-1684) (gsingers)
- Optimize PatternReplaceFilter for better performance. [SOLR-1874](https://issues.apache.org/jira/browse/SOLR-1874) (rmuir) (uschindler)
- speed up initial filter cache population for facet.method=enum and also big terms for multi-valued facet.method=fc. The resulting speedup for the first facet request is anywhere from 30% to 32x, depending on how many terms are in the field and how many documents match per term. [SOLR-1968](https://issues.apache.org/jira/browse/SOLR-1968) (yonik)
- add common functions to scripts-util. [SOLR-2046](https://issues.apache.org/jira/browse/SOLR-2046) (koji)
- Speed up UnInvertedField faceting (facet.method=fc for multi-valued fields) when facet.limit is both high, and a high enough percentage of the number of unique terms in the field. Extreme cases yield speedups over 3x. [SOLR-2089](https://issues.apache.org/jira/browse/SOLR-2089) (yonik)
- Improve the performance of DataImportHandler for large delta-import updates. [SOLR-2200](https://issues.apache.org/jira/browse/SOLR-2200) (Mark Waddle) (rmuir)
- Use IndexReader.reopen to save resources by re-using parts of the index that haven't changed. [SOLR-374](https://issues.apache.org/jira/browse/SOLR-374) (Mark Miller) (yonik)
- New faceting method with better performance and smaller memory usage for multi-valued fields with many unique values but relatively few values per document. Controllable via the facet.method parameter - "fc" is the new default method and "enum" is the original method. [SOLR-475](https://issues.apache.org/jira/browse/SOLR-475) (yonik)
- Write string keys in Maps as extern strings in the javabin format. [SOLR-808](https://issues.apache.org/jira/browse/SOLR-808) (Noble Paul) (shalin)
- DIH: Reduce memory consumption during delta import by removing keys when used [SOLR-846](https://issues.apache.org/jira/browse/SOLR-846) (Ricky Leung) (Noble Paul) (shalin)
- SolrResourceLoader must cache short class name vs fully qualified classname [SOLR-921](https://issues.apache.org/jira/browse/SOLR-921) (Noble Paul) (hossman) (shalin)
- Use an ArrayList in SolrPluginUtils.parseQueryStrings since we know exactly how long the List will be in advance. [SOLR-970](https://issues.apache.org/jira/browse/SOLR-970) (Kay Kay) (hossman)
- Replace StringBuffer with StringBuilder for instances that do not require thread-safety. [SOLR-971](https://issues.apache.org/jira/browse/SOLR-971) (Kay Kay) (shalin)
- CommonsHttpSolrServer writes the xml directly to the server. [SOLR-973](https://issues.apache.org/jira/browse/SOLR-973) (Noble Paul) (shalin)
- DataImportHandler skips commit if no data has been updated. [SOLR-974](https://issues.apache.org/jira/browse/SOLR-974) (Wojtek Piaseczny) (shalin)

### Fixed (197 changes)

- DIH FileListEntityProcessor should not apply fileName filter to directory names. [SOLR-1000](https://issues.apache.org/jira/browse/SOLR-1000) (Fergus McMenemie) (shalin)
- Fix stats.jsp XML encoding for &lt;stat&gt; item entries with ampersands in their names. [SOLR-1008](https://issues.apache.org/jira/browse/SOLR-1008) (ehatcher)
- Repeated column names result in duplicate values. [SOLR-1009](https://issues.apache.org/jira/browse/SOLR-1009) (Fergus McMenemie) (Noble Paul) (shalin)
- Incomplete information in replication admin page and http command response when server is both master and slave i.e. when server is a repeater [SOLR-1015](https://issues.apache.org/jira/browse/SOLR-1015) (Akshay Ukey) (shalin)
- HTTP 503 error changes 500 in SolrCore [SOLR-1016](https://issues.apache.org/jira/browse/SOLR-1016) (koji)
- Fix DIH thread-safety issue with last_index_time for concurrent imports in multiple cores due to unsafe usage of SimpleDateFormat by multiple threads. [SOLR-1017](https://issues.apache.org/jira/browse/SOLR-1017) (Ryuuichi Kumai) (shalin)
- Slave is unable to replicate when server acts as repeater (as both master and slave) [SOLR-1018](https://issues.apache.org/jira/browse/SOLR-1018) (Akshay Ukey) (Noble Paul) (shalin)
- Calling abort on DataImportHandler import commits data instead of calling rollback. [SOLR-1024](https://issues.apache.org/jira/browse/SOLR-1024) (shalin)
- Fix XSS vulnerability in schema.jsp [SOLR-1031](https://issues.apache.org/jira/browse/SOLR-1031) (Paul Lovvik) (ehatcher)
- DIH should not add null values in a row returned by EntityProcessor to documents. [SOLR-1037](https://issues.apache.org/jira/browse/SOLR-1037) (shalin)
- DIH XPathEntityProcessor fails with an xpath like /feed/entry/link[@type='text/html']/@href [SOLR-1040](https://issues.apache.org/jira/browse/SOLR-1040) (Noble Paul) (shalin)
- Fix memory leak in DIH by making TemplateString non-static member in VariableResolverImpl [SOLR-1042](https://issues.apache.org/jira/browse/SOLR-1042) (Ryuuichi Kumai) (shalin)
- IndexOutOfBoundsException in DIH SolrWriter.getResourceAsString when size of data-config.xml is a multiple of 1024 bytes. [SOLR-1053](https://issues.apache.org/jira/browse/SOLR-1053) (Herb Jiang) (shalin)
- registry.jsp incorrectly displaying info for last core initialized regardless of what the current core is. [SOLR-1064](https://issues.apache.org/jira/browse/SOLR-1064) (hossman)
- spellcheck.extendedResults returns an invalid JSON response when count &gt; 1. To fix, the extendedResults format was changed. [SOLR-1071](https://issues.apache.org/jira/browse/SOLR-1071) (Uri Boness) (yonik)
- absolute paths used in sharedLib attribute were incorrectly treated as relative paths. [SOLR-1072](https://issues.apache.org/jira/browse/SOLR-1072) (hossman)
- IndexOutOfBoundsException with useSolrAddSchema in DIH XPathEntityProcessor. [SOLR-1077](https://issues.apache.org/jira/browse/SOLR-1077) (Sam Keen) (Noble Paul) (shalin)
- Fixes to WordDelimiterFilter to avoid splitting or dropping international non-letter characters such as non spacing marks. [SOLR-1078](https://issues.apache.org/jira/browse/SOLR-1078) (yonik)
- DIH RegexTransformer should not replace if regex is not matched. (Noble Paul, Fergus McMenemie via shalin) 100.SOLR-1090: DataImportHandler should load the data-config.xml using UTF-8 encoding. (Rui Pereira, shalin) 101.SOLR-1146: ConcurrentModificationException in DataImporter.getStatusMessages (Walter Ferrara, Noble Paul via shalin) 102.SOLR-1229: Fixes for DIH deletedPkQuery, particularly when using transformed Solr unique id's (Lance Norskog, Noble Paul via ehatcher) 103.SOLR-1286: Fix the IH commit parameter always defaulting to "true" even if "false" is explicitly passed in. (Jay Hill, Noble Paul via ehatcher) 104.SOLR-1323: Reset XPathEntityProcessor's $hasMore/$nextUrl when fetching next URL (noble, ehatcher) 105.SOLR-1450: DIH: Jdbc connection properties such as batchSize are not applied if the driver jar is placed in solr_home/lib. (Steve Sun via shalin) 106.SOLR-1474: DIH Delta-import should run even if last_index_time is not set. [SOLR-1080](https://issues.apache.org/jira/browse/SOLR-1080) [SOLR-1090](https://issues.apache.org/jira/browse/SOLR-1090) [SOLR-1146](https://issues.apache.org/jira/browse/SOLR-1146) [SOLR-1229](https://issues.apache.org/jira/browse/SOLR-1229) [SOLR-1286](https://issues.apache.org/jira/browse/SOLR-1286) [SOLR-1323](https://issues.apache.org/jira/browse/SOLR-1323) [SOLR-1450](https://issues.apache.org/jira/browse/SOLR-1450) [SOLR-1474](https://issues.apache.org/jira/browse/SOLR-1474) (shalin)
- Jetty's use of CESU-8 for code points outside the BMP resulted in invalid output from the serialized PHP writer. [SOLR-1091](https://issues.apache.org/jira/browse/SOLR-1091) (yonik)
- Incorrect value of correctlySpelled attribute in some cases [SOLR-1094](https://issues.apache.org/jira/browse/SOLR-1094) (David Smiley) (Mark Miller) (shalin)
- LukeRequestHandler (and schema.jsp) have been fixed to include the "1" (ie: 2**0) bucket in the term histogram data. [SOLR-1103](https://issues.apache.org/jira/browse/SOLR-1103) (hossman)
- Fix some rounding errors in LukeRequestHandler's histogram [SOLR-1104](https://issues.apache.org/jira/browse/SOLR-1104) (hossman)
- Use query analyzer rather than index analyzer for queryFieldType in QueryElevationComponent [SOLR-1125](https://issues.apache.org/jira/browse/SOLR-1125) (koji)
- Replicated files have incorrect timestamp [SOLR-1126](https://issues.apache.org/jira/browse/SOLR-1126) (Jian Han Guo) (Jeff Newburn) (Noble Paul) (shalin)
- Java replication creates Snapshot in the directory where Solr was launched [SOLR-1135](https://issues.apache.org/jira/browse/SOLR-1135) (Jianhan Guo) (shalin)
- Query Elevation Component now gracefully handles missing queries. [SOLR-1138](https://issues.apache.org/jira/browse/SOLR-1138) (gsingers)
- NullPointerException during snapshoot command in java based replication [SOLR-1141](https://issues.apache.org/jira/browse/SOLR-1141) (Jian Han Guo) (shalin)
- Fix LukeRequestHandler so it doesn't rely on SolrQueryParser and report incorrect stats when field names contain characters SolrQueryParser considers special. [SOLR-1171](https://issues.apache.org/jira/browse/SOLR-1171) (hossman)
- Fix Logging admin form submit url for multicore. [SOLR-1174](https://issues.apache.org/jira/browse/SOLR-1174) (Jacob Singh) (shalin)
- Fix bug in OrdFieldSource#equals which could cause a bug with OrdFieldSource caching on OrdFieldSource#hashcode collisions. [SOLR-1182](https://issues.apache.org/jira/browse/SOLR-1182) (Mark Miller)
- resolve DataImportHandler deltaQuery column against pk when pk has a prefix (e.g. pk="book.id" deltaQuery="select id from ..."). More useful error reporting when no match found (previously failed with a NullPointerException in log and no clear user feedback). [SOLR-1191](https://issues.apache.org/jira/browse/SOLR-1191) (gthb) (yonik)
- equals method should compare this and other of DocList in DocSetBase [SOLR-1207](https://issues.apache.org/jira/browse/SOLR-1207) (koji)
- Human readable JVM info from system handler does integer cutoff rounding, even when dealing with GB. Fixed to round to one decimal place. [SOLR-1242](https://issues.apache.org/jira/browse/SOLR-1242) (Jay Hill) (Mark Miller)
- Admin RequestHandlers should not be cached over HTTP. [SOLR-1243](https://issues.apache.org/jira/browse/SOLR-1243) (Mark Miller)
- Fix implementations of set operations for DocList subclasses and fix a bug in HashDocSet construction when offset != 0. These bugs never manifested in normal Solr use and only potentially affect custom code. [SOLR-1260](https://issues.apache.org/jira/browse/SOLR-1260) (yonik)
- HTMLStripCharFilter sometimes threw a "Mark Invalid" exception. [SOLR-1283](https://issues.apache.org/jira/browse/SOLR-1283) (Julien Coloos) (hossman) (yonik)
- Fix CapitalizationFilterFactory to work when keep parameter is not specified. [SOLR-1317](https://issues.apache.org/jira/browse/SOLR-1317) (ehatcher)
- CapitalizationFilterFactory uses incorrect term length calculations. [SOLR-1342](https://issues.apache.org/jira/browse/SOLR-1342) (Robert Muir) (Mark Miller)
- DoubleMetaphoneFilter didn't index original tokens if there was no alternative, and could incorrectly skip or reorder tokens. [SOLR-1359](https://issues.apache.org/jira/browse/SOLR-1359) (yonik)
- Prevent PhoneticFilter from producing duplicate tokens. [SOLR-1360](https://issues.apache.org/jira/browse/SOLR-1360) (yonik)
- WordDelimiterFilter had inconsistent behavior when setting the position increment of tokens following a token consisting of all delimiters, and could additionally lose big position increments. [SOLR-1362](https://issues.apache.org/jira/browse/SOLR-1362) (Robert Muir) (yonik)
- LukeRequestHandler/schema.jsp errored if schema had no uniqueKey field. The new test for this also (hopefully) adds some future proofing against similar bugs in the future. As a side effect QueryElevationComponentTest was refactored, and a bug in that test was found. [SOLR-1371](https://issues.apache.org/jira/browse/SOLR-1371) (hossman)
- Fixed improper handling of fields that have only term positions and not term offsets during Highlighting [SOLR-1381](https://issues.apache.org/jira/browse/SOLR-1381) (Thorsten Fischer) (gsingers)
- HTMLStripCharFilter split tokens that contained entities and often calculated offsets incorrectly for entities. [SOLR-1394](https://issues.apache.org/jira/browse/SOLR-1394) (Anders Melchiorsen) (yonik)
- Add offset corrections in PatternTokenizerFactory. [SOLR-1398](https://issues.apache.org/jira/browse/SOLR-1398) (Anders Melchiorsen) (koji)
- Properly handle zero-length tokens in TrimFilter. This was not a bug in any released version. [SOLR-1400](https://issues.apache.org/jira/browse/SOLR-1400) (Peter Wolanin) (gsingers)
- Fixed registry.jsp issue with MBeans [SOLR-1427](https://issues.apache.org/jira/browse/SOLR-1427) (gsingers)
- Make the new ValueSource.getValues(context,reader) delegate to the original ValueSource.getValues(reader) so custom sources will work. [SOLR-1432](https://issues.apache.org/jira/browse/SOLR-1432) (yonik)
- Add weblogic.xml to solr webapp to enable correct operation in WebLogic. [SOLR-1448](https://issues.apache.org/jira/browse/SOLR-1448) (Ilan Rabinovitch) (yonik)
- SolrJ's XML response parsing threw an exception for null names, such as those produced when facet.missing=true [SOLR-1468](https://issues.apache.org/jira/browse/SOLR-1468) (yonik)
- Fixed issue with calculating missing values for facets in single valued cases in Stats Component. This is not correctly calculated for the multivalued case. [SOLR-1471](https://issues.apache.org/jira/browse/SOLR-1471) (James Miller) (gsingers)
- Fixed omitHeader parameter for PHP ResponseWriter. [SOLR-1481](https://issues.apache.org/jira/browse/SOLR-1481) (Jun Ohtani) (billa)
- empty char mapping can cause ArrayIndexOutOfBoundsException in analysis.jsp and co. [SOLR-1504](https://issues.apache.org/jira/browse/SOLR-1504) (koji)
- Admin pages could stall waiting for localhost name resolution if reverse DNS wasn't configured; this was changed so the DNS resolution is attempted only once the first time an admin page is loaded. [SOLR-1517](https://issues.apache.org/jira/browse/SOLR-1517) (hossman)
- Show proper message if &lt;script&gt; tag is missing for DIH ScriptTransformer [SOLR-1522](https://issues.apache.org/jira/browse/SOLR-1522) (noble)
- More than 8 deleteByQuery commands in a single request caused an error to be returned, although the deletes were still executed. [SOLR-1529](https://issues.apache.org/jira/browse/SOLR-1529) (asmodean) (yonik)
- Reordering of object allocations in ConcurrentLRUCache to eliminate (an extremely small) potential for deadlock. [SOLR-1538](https://issues.apache.org/jira/browse/SOLR-1538) (gabriele renzi) (hossman)
- QueryElevationComponent only works if the uniqueKey field is implemented using StrField. In previous versions of Solr no warning or error would be generated if you attempted to use QueryElevationComponent, it would just fail in unexpected ways. This has been changed so that it will fail with a clear error message on initialization. [SOLR-1558](https://issues.apache.org/jira/browse/SOLR-1558) (hossman)
- Binary fields, including trie-based numeric fields, caused null pointer exceptions in the luke request handler. [SOLR-1563](https://issues.apache.org/jira/browse/SOLR-1563) (yonik)
- FastLRUCache correctly implemented the LRU policy only for the first 2B accesses. [SOLR-1572](https://issues.apache.org/jira/browse/SOLR-1572) (yonik)
- The example solrconfig.xml defaulted to a solr data dir relative to the current working directory, even if a different solr home was being used. The new behavior changes the default to a zero length string, which is treated the same as if no dataDir had been specified, hence the "data" directory under the solr home will be used. [SOLR-1577](https://issues.apache.org/jira/browse/SOLR-1577) (yonik)
- Fixes to XML escaping in stats.jsp [SOLR-1579](https://issues.apache.org/jira/browse/SOLR-1579) (David Bowen and hossman)
- Solr Configuration ignores 'mergeFactor' parameter, always uses Lucene default. [SOLR-1580](https://issues.apache.org/jira/browse/SOLR-1580) (Lance Norskog) (Mark Miller)
- copyField was ignored for BinaryField types [SOLR-1582](https://issues.apache.org/jira/browse/SOLR-1582) (gsingers)
- SolrJ - SolrQuery.setIncludeScore() incorrectly added fl=score to the parameter list instead of appending score to the existing field list. [SOLR-1584](https://issues.apache.org/jira/browse/SOLR-1584) (yonik)
- A distributed search request with fl=score, didn't match the behavior of a non-distributed request since it only returned the id,score fields instead of all fields in addition to score. [SOLR-1587](https://issues.apache.org/jira/browse/SOLR-1587) (yonik)
- ReverseWildcardFilter didn't work for surrogate pairs (i.e. code points outside of the BMP), resulting in incorrect matching. This change requires reindexing for any content with such characters. [SOLR-1593](https://issues.apache.org/jira/browse/SOLR-1593) (Robert Muir) (yonik)
- StreamingUpdateSolrServer used the platform default character set when streaming updates, rather than using UTF-8 as the HTTP headers indicated, leading to an encoding mismatch. [SOLR-1595](https://issues.apache.org/jira/browse/SOLR-1595) (hossman) (yonik)
- A rollback operation followed by the shutdown of Solr or the close of a core resulted in a warning: "SEVERE: SolrIndexWriter was not closed prior to finalize()" although there were no other consequences. [SOLR-1596](https://issues.apache.org/jira/browse/SOLR-1596) (yonik)
- DIH: Reader used in PlainTextEntityProcessor is not explicitly closed [SOLR-1598](https://issues.apache.org/jira/browse/SOLR-1598) (Sascha Szott) (noble)
- Schema browser does not indicate presence of charFilter. [SOLR-1601](https://issues.apache.org/jira/browse/SOLR-1601) (koji)
- Backslash escaping did not work in quoted strings for local param arguments. [SOLR-1615](https://issues.apache.org/jira/browse/SOLR-1615) (Wojtek Piaseczny) (yonik)
- Highlighter only highlights values from the first field value in a multivalued field when term positions (term vectors) are stored. [SOLR-1624](https://issues.apache.org/jira/browse/SOLR-1624) (Chris Harris) (yonik)
- log contains incorrect number of adds and deletes. [SOLR-1628](https://issues.apache.org/jira/browse/SOLR-1628) (Thijs Vonk) (yonik)
- Fix spell checking collation issue related to token positions [SOLR-1630](https://issues.apache.org/jira/browse/SOLR-1630) (rmuir) (gsingers)
- Fixed error message when numeric values can't be parsed by DOMUtils - notably for plugin init params in solrconfig.xml. [SOLR-1635](https://issues.apache.org/jira/browse/SOLR-1635) (hossman)
- Fixed NullPointerException during DIH import if uniqueKey is not specified in schema [SOLR-1638](https://issues.apache.org/jira/browse/SOLR-1638) (Akshay Ukey) (shalin)
- Fixed misleading error message when dataimport.properties is not writable [SOLR-1639](https://issues.apache.org/jira/browse/SOLR-1639) (shalin)
- Fixed Incorrect dataimport handler package name in SolrResourceLoader [SOLR-1651](https://issues.apache.org/jira/browse/SOLR-1651) (Akshay Ukey) (shalin)
- XIncludes and other HREFs in XML files loaded by ResourceLoader are fixed to be resolved using the URI standard (RFC 2396). The system identifier is no longer a plain filename with path, it gets initialized using a custom URI scheme "solrres:". This scheme is resolved using a EntityResolver that utilizes ResourceLoader (org.apache.solr.common.util.SystemIdResolver). This makes all relative pathes in Solr's config files behave like expected. This change introduces some backwards breaks in the API: Some config classes (Config, SolrConfig, IndexSchema) were changed to take org.xml.sax.InputSource instead of InputStream. There may also be some backwards breaks in existing config files, it is recommended to check your config files / XSLTs and replace all XIncludes/HREFs that were hacked to use absolute paths to use relative ones. [SOLR-1656](https://issues.apache.org/jira/browse/SOLR-1656) (uschindler)
- CapitalizationFilter crashes if you use the maxWordCountOption [SOLR-1660](https://issues.apache.org/jira/browse/SOLR-1660) (Robert Muir) (shalin)
- Added Javadocs in BufferedTokenStream and fixed incorrect cloning in TestBufferedTokenStream [SOLR-1662](https://issues.apache.org/jira/browse/SOLR-1662) (Robert Muir) (Uwe Schindler) (shalin)
- PatternTokenizer does not reset attributes such as positionIncrementGap [SOLR-1667](https://issues.apache.org/jira/browse/SOLR-1667) (Robert Muir) (shalin)
- Fix bug in clustering component relating to carrot.produceSummary option [SOLR-1692](https://issues.apache.org/jira/browse/SOLR-1692) (gsingers)
- fixed WordDelimiterFilter for certain combinations of options where it would output incorrect tokens. [SOLR-1706](https://issues.apache.org/jira/browse/SOLR-1706) (Robert Muir) (Chris Male)
- SolrJ - StreamingUpdateSolrServer had a race condition that could halt the streaming of documents. The original patch to fix this (never officially released) introduced another hanging bug due to connections not being released. [SOLR-1711](https://issues.apache.org/jira/browse/SOLR-1711) (Attila Babo) (Erik Hetzner) (yonik)
- In the slave , If 'mov'ing file does not succeed , copy the file [SOLR-1736](https://issues.apache.org/jira/browse/SOLR-1736) (noble)
- Streams and Readers retrieved from ContentStreams are not closed in various places, resulting in file descriptor leaks. [SOLR-1748](https://issues.apache.org/jira/browse/SOLR-1748) [SOLR-1747](https://issues.apache.org/jira/browse/SOLR-1747) [SOLR-1746](https://issues.apache.org/jira/browse/SOLR-1746) [SOLR-1745](https://issues.apache.org/jira/browse/SOLR-1745) [SOLR-1744](https://issues.apache.org/jira/browse/SOLR-1744) (Christoff Brill) (Mark Miller)
- StatsComponent throws NPE when getting statistics for facets in distributed search [SOLR-1753](https://issues.apache.org/jira/browse/SOLR-1753) (Janne Majaranta) (koji)
- The date.format setting for extraction request handler causes ClassCastException when enabled and the config code that parses this setting does not properly use the same iterator instance. [SOLR-1756](https://issues.apache.org/jira/browse/SOLR-1756) (Christoph Brill) (Mark Miller)
- DIH multithreading sometimes throws NPE [SOLR-1757](https://issues.apache.org/jira/browse/SOLR-1757) (noble)
- DIH: $skipDoc was not working correctly [SOLR-1759](https://issues.apache.org/jira/browse/SOLR-1759) (Gian Marco Tagliani) (noble)
- DIH: DateFormatTransformer does not work correctly with non-default locale dates [SOLR-1762](https://issues.apache.org/jira/browse/SOLR-1762) (tommy chheng) (noble)
- DIH with threads enabled doesn't respond to the abort command [SOLR-1766](https://issues.apache.org/jira/browse/SOLR-1766) (Michael Henson) (noble)
- dataimporter.functions.escapeSql() does not escape backslash character [SOLR-1767](https://issues.apache.org/jira/browse/SOLR-1767) (Sean Timm) (noble)
- Solr 1.4 Replication - Repeater throwing NullPointerException (noble) ================== Release 1.4.0 ================== Release Date: See http://lucene.apache.org/solr for the official release date. Upgrading from Solr 1.3 ----------------------- There is a new default faceting algorithm for multiVaued fields that should be faster for most cases. One can revert to the previous algorithm (which has also been improved somewhat) by adding facet.method=enum to the request. Searching and sorting is now done on a per-segment basis, meaning that the FieldCache entries used for sorting and for function queries are created and used per-segment and can be reused for segments that don't change between index updates. While generally beneficial, this can lead to increased memory usage over 1.3 in certain scenarios: 1) A single valued field that was used for both sorting and faceting in 1.3 would have used the same top level FieldCache entry. In 1.4, sorting will use entries at the segment level while faceting will still use entries at the top reader level, leading to increased memory usage. 2) Certain function queries such as ord() and rord() require a top level FieldCache instance and can thus lead to increased memory usage. Consider replacing ord() and rord() with alternatives, such as function queries based on ms() for date boosting. If you use custom Tokenizer or TokenFilter components in a chain specified in schema.xml, they must support reusability. If your Tokenizer or TokenFilter maintains state, it should implement reset(). If your TokenFilteFactory does not return a subclass of TokenFilter, then it should implement reset() and call reset() on its input TokenStream. TokenizerFactory implementations must now return a Tokenizer rather than a TokenStream. New users of Solr 1.4 will have omitTermFreqAndPositions enabled for non-text indexed fields by default, which avoids indexing term frequency, positions, and payloads, making the index smaller and faster. If you are upgrading from an earlier Solr release and want to enable omitTermFreqAndPositions by default, change the schema version from 1.1 to 1.2 in schema.xml. Remove any existing index and restart Solr to ensure that omitTermFreqAndPositions completely takes affect. The default QParserPlugin used by the QueryComponent for parsing the "q" param has been changed, to remove support for the deprecated use of ";" as a separator between the query string and the sort options when no "sort" param was used. Users who wish to continue using the semi-colon based method of specifying the sort options should explicitly set the defType param to "lucenePlusSort" on all requests. [SOLR-1769](https://issues.apache.org/jira/browse/SOLR-1769) (The simplest way to do this is by specifying it as a default param
for your request handlers in solrconfig.xml) (see the example solrconfig.xml for
sample syntax.)
- fieldTypes with sortMissingLast=true or sortMissingFirst=true can result in incorrectly sorted results. [SOLR-1777](https://issues.apache.org/jira/browse/SOLR-1777) (yonik)
- Fix messed up core names on admin gui [SOLR-1791](https://issues.apache.org/jira/browse/SOLR-1791) (yonik) (koji)
- Dataimport of CLOB fields fails when getCharacterStream() is defined in a superclass. [SOLR-1794](https://issues.apache.org/jira/browse/SOLR-1794) (Gunnar Gauslaa Bergem) (rmuir)
- fix ConcurrentModificationException and potential memory leaks in ResourceLoader. [SOLR-1797](https://issues.apache.org/jira/browse/SOLR-1797) (yonik)
- Small memory leak (~100 bytes) in fastLRUCache for every commit. [SOLR-1798](https://issues.apache.org/jira/browse/SOLR-1798) (yonik)
- formatDate should use the current NOW value always [SOLR-1811](https://issues.apache.org/jira/browse/SOLR-1811) (Sean Timm) (noble)
- Fixed XMLResponseWriter (via XMLWriter) so it no longer throws a ClassCastException when a Map containing a non-String key is used. [SOLR-1823](https://issues.apache.org/jira/browse/SOLR-1823) (Frank Wesemann) (hossman)
- change KeepWordFilter so a new word set is not created for each instance [SOLR-1850](https://issues.apache.org/jira/browse/SOLR-1850) (John Wang) (yonik)
- Fix WordDelimiterFilterFactory bug where position increments were not being applied properly to subwords. [SOLR-1852](https://issues.apache.org/jira/browse/SOLR-1852) (Peter Wolanin) (Robert Muir)
- Indexing documents using the 'javabin' format no longer fails with a ClassCastException whenSolrInputDocuments contain field values which are Collections or other classes that implement Iterable. [SOLR-1870](https://issues.apache.org/jira/browse/SOLR-1870) (noble) (hossman)
- Change the JSON response format to output float/double values of NaN,Infinity,-Infinity as strings. [SOLR-1914](https://issues.apache.org/jira/browse/SOLR-1914) (yonik)
- Upgrade to Apache Lucene 2.9.3 to obtain several bug fixes from the previous 2.9.1. See the Lucene 2.9.3 release notes for details. [SOLR-1934](https://issues.apache.org/jira/browse/SOLR-1934) (hossman) (Mark Miller)
- The JSON response format needed to escape unicode code point U+2028 - 'LINE SEPARATOR' [SOLR-1936](https://issues.apache.org/jira/browse/SOLR-1936) (Robert Hofstra) (yonik)
- Fix SolrDispatchFilter behavior when Content-Type is unknown [SOLR-1940](https://issues.apache.org/jira/browse/SOLR-1940) (Lance Norskog and hossman)
- PatternTokenizerFactory should use parent's args [SOLR-1948](https://issues.apache.org/jira/browse/SOLR-1948) (koji)
- Empty fields in XML update messages confuse DataImportHandler. [SOLR-1973](https://issues.apache.org/jira/browse/SOLR-1973) (koji)
- Solr will now fail correctly if solr.xml attempts to specify multiple cores that have the same name [SOLR-1981](https://issues.apache.org/jira/browse/SOLR-1981) (hossman)
- snappuller fails when modifiedConfFiles is not empty and full copy of index is needed. [SOLR-1983](https://issues.apache.org/jira/browse/SOLR-1983) (Alexander Kanarsky) (yonik)
- fix String cast assumption in JavaBinCodec - specific addresses "commitWithin" option on Update requests. [SOLR-1993](https://issues.apache.org/jira/browse/SOLR-1993) (noble) (hossman) (and Maxim Valyanskiy)
- Change date format from "hour in am/pm" to "hour in day" in CoreContainer and SnapShooter. [SOLR-1995](https://issues.apache.org/jira/browse/SOLR-1995) (Hayato Ito) (koji)
- avoid possible RejectedExecutionException w/autoCommit by making SolreCore close the UpdateHandler before closing the SearchExecutor. [SOLR-2008](https://issues.apache.org/jira/browse/SOLR-2008) (NarasimhaRaju) (hossman)
- Avoid expensive fieldCache ram estimation for the admin stats page. [SOLR-2036](https://issues.apache.org/jira/browse/SOLR-2036) (yonik)
- ReplicationHandler should accept bool type for enable flag. [SOLR-2047](https://issues.apache.org/jira/browse/SOLR-2047) (koji)
- DataImportHandler never calls UpdateRequestProcessor.finish() [SOLR-2057](https://issues.apache.org/jira/browse/SOLR-2057) (Drew Farris) (koji)
- BaseResponseWriter.isStreamingDocs causes SingleResponseWriter.end to be called 2x [SOLR-2081](https://issues.apache.org/jira/browse/SOLR-2081) (Chris A. Mattmann) (hossman)
- SpellCheckComponent misreports suggestions when distributed [SOLR-2083](https://issues.apache.org/jira/browse/SOLR-2083) (James Dyer) (gsingers)
- Improve SolrJ behavior when FacetComponent comes before QueryComponent [SOLR-2085](https://issues.apache.org/jira/browse/SOLR-2085) (Tomas Salfischberger) (hossman)
- The replication handler backup command didn't save the commit point and hence could fail when a newer commit caused the older commit point to be removed before it was finished being copied. This did not affect normal master/slave replication. [SOLR-2100](https://issues.apache.org/jira/browse/SOLR-2100) (Peter Sturge) (yonik)
- Remove the restriction on names for local params substitution/dereferencing. Properly encode local params in distributed faceting. [SOLR-2110](https://issues.apache.org/jira/browse/SOLR-2110) (yonik)
- Change exception handling in distributed faceting to work more like non-distributed faceting, change facet_counts/exception from a String to a List&lt;String&gt; to enable listing all exceptions that happened, and prevent an exception in one facet command from affecting another facet command. [SOLR-2111](https://issues.apache.org/jira/browse/SOLR-2111) (yonik)
- Fixed parsing error in hsin function. The function signature has changed slightly. [SOLR-2114](https://issues.apache.org/jira/browse/SOLR-2114) (gsingers)
- Fix TikaConfig classloader bug in TikaEntityProcessor [SOLR-2116](https://issues.apache.org/jira/browse/SOLR-2116) (Martijn van Groningen) (hossman)
- Fixed serialization of default core and indentation of solr.xml when serializing. [SOLR-2127](https://issues.apache.org/jira/browse/SOLR-2127) (Ephraim Ofir) (Mark Miller)
- Fix behavior of ConcurrentLRUCache when asking for getLatestAccessedItems(0) or getOldestAccessedItems(0). [SOLR-2135](https://issues.apache.org/jira/browse/SOLR-2135) (David Smiley) (hossman)
- Highlighter doesn't support q.alt. [SOLR-2148](https://issues.apache.org/jira/browse/SOLR-2148) (koji)
- SnapPuller fails to clean Old Index Directories on Full Copy [SOLR-2156](https://issues.apache.org/jira/browse/SOLR-2156) (Jayendra Patil) (yonik)
- Suggester should always rebuild Lookup data if Lookup.load fails. [SOLR-2173](https://issues.apache.org/jira/browse/SOLR-2173) (ab)
- It was possible for EmbeddedSolrServer to leave searchers open if a request threw an exception. [SOLR-2180](https://issues.apache.org/jira/browse/SOLR-2180) (yonik)
- StreamingUpdateSolrServer.blockUntilFinished was not thread safe and could throw an exception. [SOLR-2192](https://issues.apache.org/jira/browse/SOLR-2192) (yonik)
- The init() method of every SolrRequestHandler was being called twice. [SOLR-2219](https://issues.apache.org/jira/browse/SOLR-2219) (ambikeshwar singh and hossman)
- Use StrUtils.parseBool() to get values of boolean options in DIH. true/on/yes (for TRUE) and false/off/no (for FALSE) can be used for sub-options (debug, verbose, synchronous, commit, clean, optimize) for full/delta-import commands. [SOLR-2221](https://issues.apache.org/jira/browse/SOLR-2221) (koji)
- DIH: When a child entity in nested entities is rootEntity="true", delta-import doesn't work. [SOLR-2252](https://issues.apache.org/jira/browse/SOLR-2252) (koji)
- fix velocity template layout.vm that referred to an older version of jquery. [SOLR-2261](https://issues.apache.org/jira/browse/SOLR-2261) (Eric Pugh) (rmuir)
- duplicate SolrEventListeners no longer created [SOLR-2285](https://issues.apache.org/jira/browse/SOLR-2285) (hossman)
- fix bug in PHPSerializedResponseWriter (wt=phps) when dealing with SolrDocumentList objects -- ie: sharded queries. [SOLR-2307](https://issues.apache.org/jira/browse/SOLR-2307) (Antonio Verni) (hossman)
- DIH: getTimeElapsedSince() returns incorrect hour value when the elapse is over 60 hours [SOLR-2310](https://issues.apache.org/jira/browse/SOLR-2310) (tom liu) (koji)
- Fixed ReplicationHandler detail reporting for masters [SOLR-2320](https://issues.apache.org/jira/browse/SOLR-2320) (hossman)
- solrconfig.xml files in example-DIH are broken. [SOLR-2330](https://issues.apache.org/jira/browse/SOLR-2330) (Matt Parker) (koji)
- Fix sorting to explicitly generate an error if you attempt to sort on a multiValued field. [SOLR-2339](https://issues.apache.org/jira/browse/SOLR-2339) (hossman)
- Fix field types to explicitly generate an error if you attempt to get a ValueSource for a multiValued field. [SOLR-2348](https://issues.apache.org/jira/browse/SOLR-2348) (hossman)
- Distributed faceting could miss values when facet.sort=index and when facet.offset was greater than 0. [SOLR-2380](https://issues.apache.org/jira/browse/SOLR-2380) (yonik)
- Fix FieldType so setting an analyzer on a FieldType that doesn't expect it will generate an error. Practically speaking this means that Solr will now correctly generate an error on initialization if the schema.xml contains an analyzer configuration for a fieldType that does not use TextField. [SOLR-309](https://issues.apache.org/jira/browse/SOLR-309) (hossman)
- Date faceting now respects facet.mincount limiting [SOLR-343](https://issues.apache.org/jira/browse/SOLR-343) (Uri Boness) (Raiko Eckstein) (hossman)
- Use perl regex to improve accuracy of finding latest snapshot in snapinstaller [SOLR-346](https://issues.apache.org/jira/browse/SOLR-346) (billa)
- Provide more exception handling in CSVLoader [SOLR-482](https://issues.apache.org/jira/browse/SOLR-482) (gsingers)
- WordDelimiterFilter now respects payloads and other attributes of the original Token by using Token.clone() [SOLR-532](https://issues.apache.org/jira/browse/SOLR-532) (Tricia Williams) (gsingers)
- Add synchronization to avoid race condition of multiple DIH imports working concurrently [SOLR-728](https://issues.apache.org/jira/browse/SOLR-728) (Walter Ferrara) (shalin)
- Add ability to create dynamic fields with custom DataImportHandler transformers [SOLR-742](https://issues.apache.org/jira/browse/SOLR-742) (Wojtek Piaseczny) (Noble Paul) (shalin)
- WordDelimiterFilter didn't adjust the start offset of single tokens that started with delimiters, leading to incorrect highlighting. [SOLR-751](https://issues.apache.org/jira/browse/SOLR-751) (Stefan Oestreicher) (yonik)
- CoreAdminHandler STATUS should display 'normalized' paths [SOLR-771](https://issues.apache.org/jira/browse/SOLR-771) (koji) (hossman) (shalin)
- Fixed logging level display [SOLR-774](https://issues.apache.org/jira/browse/SOLR-774) (Sean Timm) (Otis Gospodnetic)
- Deep copy collections to avoid ConcurrentModificationException in XPathEntityprocessor while streaming [SOLR-800](https://issues.apache.org/jira/browse/SOLR-800) (Kyle Morrison) (Noble Paul) (shalin)
- Fix a potential null pointer error in the distributed FacetComponent [SOLR-802](https://issues.apache.org/jira/browse/SOLR-802) (David Bowen) (ryan)
- CoreAdminRequest.createCore fails because name parameter isn't set [SOLR-803](https://issues.apache.org/jira/browse/SOLR-803) (Sean Colombo) (ryan)
- DisMax queries are not being cached in QueryResultCache [SOLR-805](https://issues.apache.org/jira/browse/SOLR-805) (Todd Feak) (koji)
- BinaryResponseWriter writes fieldType.toExternal if it is not a supported type, otherwise it writes fieldType.toObject. This fixes the bug with encoding/decoding UUIDField. [SOLR-807](https://issues.apache.org/jira/browse/SOLR-807) (koji) (Noble Paul) (shalin)
- Request parameter variables ${dataimporter.request.xxx} are not resolved in DIH [SOLR-823](https://issues.apache.org/jira/browse/SOLR-823) (Mck SembWever) (Noble Paul) (shalin)
- Enables highlighting for range/wildcard/fuzzy/prefix queries if using hl.usePhraseHighlighter=true and hl.highlightMultiTerm=true. Also make both options default to true. [SOLR-825](https://issues.apache.org/jira/browse/SOLR-825) [SOLR-1221](https://issues.apache.org/jira/browse/SOLR-1221) (Mark Miller) (yonik)
- Use perl regex to improve accuracy of finding latest snapshot in snappuller [SOLR-830](https://issues.apache.org/jira/browse/SOLR-830) (billa)
- Rows parameter is not honored in DIH non-debug mode and can abort a running import in debug mode. [SOLR-832](https://issues.apache.org/jira/browse/SOLR-832) (Akshay Ukey) (shalin)
- Add missing "a" to the example stopwords.txt [SOLR-836](https://issues.apache.org/jira/browse/SOLR-836) (yonik)
- The DIH VariableResolver obtained from a DataSource's context does not have current data. [SOLR-838](https://issues.apache.org/jira/browse/SOLR-838) (Noble Paul) (shalin)
- BinaryResponseWriter does not handle incompatible data in fields [SOLR-840](https://issues.apache.org/jira/browse/SOLR-840) (Noble Paul) (shalin)
- DataImportHandler should throw exception if a field does not have column attribute [SOLR-841](https://issues.apache.org/jira/browse/SOLR-841) (Michael Henson) (shalin)
- SynonymFilterFactory cannot handle multiple synonym files correctly [SOLR-843](https://issues.apache.org/jira/browse/SOLR-843) (koji)
- SolrCore.initIndex should close the directory it gets for clearing the lock and use the DirectoryFactory. [SOLR-863](https://issues.apache.org/jira/browse/SOLR-863) (Mark Miller) (shalin)
- DataImportHandler does not catch and log Errors [SOLR-864](https://issues.apache.org/jira/browse/SOLR-864) (shalin)
- Fix file descriptor leak in SolrResourceLoader#getLines [SOLR-869](https://issues.apache.org/jira/browse/SOLR-869) (Mark Miller) (shalin)
- Better error message for incorrect copyField destination [SOLR-872](https://issues.apache.org/jira/browse/SOLR-872) (Noble Paul) (shalin)
- Fix case-sensitive field names and columns [SOLR-873](https://issues.apache.org/jira/browse/SOLR-873) (Jon Baer) (shalin)
- Enable position increments in the query parser and fix the example schema to enable position increments for the stop filter in both the index and query analyzers to fix the bug with phrase queries with stopwords. [SOLR-879](https://issues.apache.org/jira/browse/SOLR-879) (yonik)
- Implicit properties are not set for Cores created through CoreAdmin [SOLR-883](https://issues.apache.org/jira/browse/SOLR-883) (Noble Paul) (shalin)
- CachedSqlEntityProcessor should check if the cache key is present in the query results [SOLR-884](https://issues.apache.org/jira/browse/SOLR-884) (Noble Paul) (shalin)
- DIH DateFormatTransformer cannot convert non-string type [SOLR-888](https://issues.apache.org/jira/browse/SOLR-888) (Amit Nithian) (shalin)
- Fix serialization of booleans for PHPSerializedResponseWriter [SOLR-892](https://issues.apache.org/jira/browse/SOLR-892) (yonik)
- Unable to delete documents via SQL and deletedPkQuery with deltaimport [SOLR-893](https://issues.apache.org/jira/browse/SOLR-893) (Dan Rosher) (shalin)
- Fixed Argument list too long error when there are lots of snapshots/backups [SOLR-897](https://issues.apache.org/jira/browse/SOLR-897) (Dan Rosher) (billa)
- Fix null pointer exception for the JSON response writer based formats when nl.json=arrarr with null keys. [SOLR-898](https://issues.apache.org/jira/browse/SOLR-898) (yonik)
- FastOutputStream ignores write(byte[]) call. [SOLR-901](https://issues.apache.org/jira/browse/SOLR-901) (Noble Paul) (shalin)
- FastInputStream#read(byte b[], int off, int len) gives incorrect results when amount left to read is less than buffer size [SOLR-902](https://issues.apache.org/jira/browse/SOLR-902) (Noble Paul) (shalin)
- General finalize() improvements. No finalizer delegates to the respective close/destroy method w/o first checking if it's already been closed/destroyed; if it hasn't a, SEVERE error is logged first. [SOLR-914](https://issues.apache.org/jira/browse/SOLR-914) (noble) (hossman)
- Fixed highlighting on fields with multiValued="true" and termOffsets="true" [SOLR-925](https://issues.apache.org/jira/browse/SOLR-925) (koji)
- LukeRequestHandler should return "dynamicBase" only if the field is dynamic. [SOLR-929](https://issues.apache.org/jira/browse/SOLR-929) (Peter Wolanin) (koji)
- Fix XML parsing in XMLUpdateRequestHandler and DocumentAnalysisRequestHandler to respect charset from XML file and only use HTTP header's "Content-Type" as a "hint". [SOLR-96](https://issues.apache.org/jira/browse/SOLR-96) (uschindler)
- Better error message when &lt;pingQuery&gt; is not configured. [SOLR-965](https://issues.apache.org/jira/browse/SOLR-965) (Mark Miller) (hossman)
- deleteByQuery is ignored when deleteById is placed prior to deleteByQuery in a &lt;delete&gt;. Now both delete by id and delete by query can be specified at the same time as follows. &lt;delete&gt; &lt;id&gt;05991&lt;/id&gt;&lt;id&gt;06000&lt;/id&gt; &lt;query&gt;office:Bridgewater&lt;/query&gt;&lt;query&gt;office:Osaka&lt;/query&gt; &lt;/delete&gt; [SOLR-976](https://issues.apache.org/jira/browse/SOLR-976) (koji)
- Old files are not removed from slaves after replication [SOLR-978](https://issues.apache.org/jira/browse/SOLR-978) (Jaco) (Noble Paul) (shalin)
- Fix thread-safety issue with DIH TemplateString for concurrent imports with multiple cores. [SOLR-985](https://issues.apache.org/jira/browse/SOLR-985) (Ryuuichi Kumai) (shalin)
- Better error message when parsing solrconfig.xml fails due to malformed XML. Error message notes the name of the file being parsed. [SOLR-991](https://issues.apache.org/jira/browse/SOLR-991) (Michael Henson) (shalin)
- DIH XPathRecordReader fails on XMLs with nodes mixed with CDATA content. [SOLR-999](https://issues.apache.org/jira/browse/SOLR-999) (Fergus McMenemie) (Noble Paul) (shalin)

### Other (121 changes)

- Upgraded to Lucene 2.9-dev r794238. Other changes include: - LUCENE-1614 - Use Lucene's DocIdSetIterator.NO_MORE_DOCS as the sentinel value. - LUCENE-1630 - Add acceptsDocsOutOfOrder method to Collector implementations. - LUCENE-1673, LUCENE-1701 - Trie has moved to Lucene core and renamed to NumericRangeQuery. - LUCENE-1662, LUCENE-1687 - Replace usage of ExtendedFieldCache by FieldCache. [LUCENE-1614](https://issues.apache.org/jira/browse/LUCENE-1614) [LUCENE-1630](https://issues.apache.org/jira/browse/LUCENE-1630) [LUCENE-1673](https://issues.apache.org/jira/browse/LUCENE-1673) [LUCENE-1701](https://issues.apache.org/jira/browse/LUCENE-1701) [LUCENE-1662](https://issues.apache.org/jira/browse/LUCENE-1662) [LUCENE-1687](https://issues.apache.org/jira/browse/LUCENE-1687) (shalin)
- Commons-Codec was upgraded from 1.3 to 1.4. [LUCENE-2466](https://issues.apache.org/jira/browse/LUCENE-2466) (rmuir)
- Switch from using Maven POM templates to full POMs when generating Maven artifacts [LUCENE-2657](https://issues.apache.org/jira/browse/LUCENE-2657) (Steven Rowe)
- Better "ignored" field in example schema.xml [SOLR-1022](https://issues.apache.org/jira/browse/SOLR-1022) (Peter Wolanin) (hossman)
- DIH: Alias the 'dataimporter' namespace to a shorter name 'dih'. [SOLR-1027](https://issues.apache.org/jira/browse/SOLR-1027) (Noble Paul) (shalin)
- DIH: Standardize Evaluator parameter parsing and added helper functions for parsing all evaluator parameters in a standard way. [SOLR-1029](https://issues.apache.org/jira/browse/SOLR-1029) (Noble Paul) (shalin)
- Change default QParser from "lucenePlusSort" to "lucene" to reduce confusion of semicolon splitting behavior when no sort param is specified [SOLR-1036](https://issues.apache.org/jira/browse/SOLR-1036) (hossman)
- Fix dist-src target for DataImportHandler [SOLR-1054](https://issues.apache.org/jira/browse/SOLR-1054) (Ryuuichi Kumai) (shalin)
- Use fsync on replicated index and configuration files [SOLR-1068](https://issues.apache.org/jira/browse/SOLR-1068) (yonik) (Noble Paul) (shalin)
- Upgrade to Tika 0.3. See http://www.apache.org/dist/lucene/tika/CHANGES-0.3.txt [SOLR-1075](https://issues.apache.org/jira/browse/SOLR-1075) (gsingers)
- Rename omitTf to omitTermFreqAndPositions [SOLR-1079](https://issues.apache.org/jira/browse/SOLR-1079) (shalin)
- Change DIH EventListener to be an interface so that components such as an EntityProcessor or a Transformer can act as an event listener. [SOLR-1081](https://issues.apache.org/jira/browse/SOLR-1081) (Noble Paul) (shalin)
- Better error reporting when DIH entity name is a reserved word and data-config.xml root node is not &lt;dataConfig&gt;. [SOLR-1084](https://issues.apache.org/jira/browse/SOLR-1084) (Noble Paul) (shalin)
- Deprecate 'where' attribute in CachedSqlEntityProcessor in favor of cacheKey and cacheLookup. [SOLR-1087](https://issues.apache.org/jira/browse/SOLR-1087) (Noble Paul) (shalin)
- Simplified DIH EntityProcessor API by moving logic for applying transformers and handling multi-row outputs from Transformers into an EntityProcessorWrapper class. The behavior of the method EntityProcessor#destroy has been modified to be called once per parent-row at the end of row. A new method EntityProcessor#close is added which is called at the end of import. A new method Context#getResolvedEntityAttribute is added which returns the resolved value of an entity's attribute. Introduced a DocWrapper which takes care of maintaining document level session variables. [SOLR-1120](https://issues.apache.org/jira/browse/SOLR-1120) (Noble Paul) (shalin)
- Made QParserPlugin and related classes extendible as an experimental API. [SOLR-1149](https://issues.apache.org/jira/browse/SOLR-1149) (Kaktu Chakarabati) (shalin)
- add dynamic copy field and maxChars example to example schema.xml. [SOLR-1151](https://issues.apache.org/jira/browse/SOLR-1151) (Peter Wolanin) (Mark Miller)
- Add option in solrconfig to open a new IndexReader rather than using reopen. Done mainly as a fail-safe in the case that a user runs into a reopen bug/issue. [SOLR-1184](https://issues.apache.org/jira/browse/SOLR-1184) (Mark Miller)
- use double quotes to enclose attributes in solr.xml [SOLR-1215](https://issues.apache.org/jira/browse/SOLR-1215) (noble)
- Added proxy.setup target [SOLR-1219](https://issues.apache.org/jira/browse/SOLR-1219) (koji)
- remove /select?qt=/whatever restriction on /-prefixed request handlers. [SOLR-1233](https://issues.apache.org/jira/browse/SOLR-1233) (ehatcher)
- Solr's CharFilter has been moved to Lucene. Remove CharFilter and related classes from Solr and use Lucene's corresponding code [SOLR-1241](https://issues.apache.org/jira/browse/SOLR-1241) (koji) (shalin)
- logging.jsp has been removed and now passes through to the hierarchical log level tool added in Solr 1.3. Users still hitting "/admin/logging.jsp" should switch to "/admin/logging". [SOLR-1257](https://issues.apache.org/jira/browse/SOLR-1257) (hossman)
- Lucene trunk renamed RangeQuery & Co to TermRangeQuery [SOLR-1261](https://issues.apache.org/jira/browse/SOLR-1261) (Uwe Schindler) (shalin)
- Add DIH variable resolving for URLDataSource properties like baseUrl. [SOLR-1265](https://issues.apache.org/jira/browse/SOLR-1265) (Chris Eldredge) (ehatcher)
- Add Lucene 2.9-dev r888785 FastVectorHighlighter contrib jar to lib. [SOLR-1268](https://issues.apache.org/jira/browse/SOLR-1268) (koji)
- Better error messages from DIH JdbcDataSource when JDBC Driver name or SQL is incorrect. [SOLR-1269](https://issues.apache.org/jira/browse/SOLR-1269) (ehatcher) (shalin)
- Added StatsComponentTest [SOLR-1276](https://issues.apache.org/jira/browse/SOLR-1276) (Rafał Kuć) (gsingers)
- Upgrade to Tika 0.4. Note there are some differences in detecting Languages now in extracting request handler. See http://www.lucidimagination.com/search/document/d6f1899a85b2a45c/vote_apache_tika_0_4_release_candidate_2#d6f1899a85b2a45c for discussion on language detection. See http://www.apache.org/dist/lucene/tika/CHANGES-0.4.txt. [SOLR-1310](https://issues.apache.org/jira/browse/SOLR-1310) (gsingers)
- Upgrade Solr Highlighter classes to new Lucene Highlighter API. This upgrade has resulted in a back compat break in the DefaultSolrHighlighter class - getQueryScorer is no longer protected. If you happened to be overriding that method in custom code, overide getHighlighter instead. Also, HighlightingUtils#getQueryScorer has been removed as it was deprecated and backcompat has been broken with it anyway. [SOLR-1319](https://issues.apache.org/jira/browse/SOLR-1319) [SOLR-1345](https://issues.apache.org/jira/browse/SOLR-1345) (Mark Miller)
- SolrInputDocument cannot process dynamic fields [SOLR-1357](https://issues.apache.org/jira/browse/SOLR-1357) (Lars Grote) (noble)
- Add HSQLDB Jar to example-DIH, unzip database and update instructions. ================== Release 1.3.0 ================== Upgrading from Solr 1.2 ----------------------- IMPORTANT UPGRADE NOTE: In a master/slave configuration, all searchers/slaves should be upgraded before the master! If the master were to be updated first, the older searchers would not be able to read the new index format. The Porter snowball based stemmers in Lucene were updated (LUCENE-1142), and are not guaranteed to be backward compatible at the index level (the stem of certain words may have changed). Re-indexing is recommended. Older Apache Solr installations can be upgraded by replacing the relevant war file with the new version. No changes to configuration files should be needed. This version of Solr contains a new version of Lucene implementing an updated index format. This version of Solr/Lucene can still read and update indexes in the older formats, and will convert them to the new format on the first index change. Be sure to backup your index before upgrading in case you need to downgrade. Solr now recognizes HTTP Request headers related to HTTP Caching (see RFC 2616 sec13) and will by default respond with "304 Not Modified" when appropriate. This should only affect users who access Solr via an HTTP Cache, or via a Web-browser that has an internal cache, but if you wish to suppress this behavior an '&lt;httpCaching never304="true"/&gt;' option can be added to your solrconfig.xml. See the wiki (or the example solrconfig.xml) for more details... http://wiki.apache.org/solr/SolrConfigXml#HTTPCaching In Solr 1.2, DateField did not enforce the canonical representation of the ISO 8601 format when parsing incoming data, and did not generation the canonical format when generating dates from "Date Math" strings (particularly as it pertains to milliseconds ending in trailing zeros). As a result equivalent dates could not always be compared properly. This problem is corrected in Solr 1.3, but DateField users that might have been affected by indexing inconsistent formats of equivalent dates (ie: 1995-12-31T23:59:59Z vs 1995-12-31T23:59:59.000Z) may want to consider reindexing to correct these inconsistencies. Users who depend on some of the "broken" behavior of DateField in Solr 1.2 (specificly: accepting any input that ends in a 'Z') should consider using the LegacyDateField class as a possible alternative. Users that desire 100% backwards compatibility should consider using the Solr 1.2 version of DateField. Due to some changes in the lifecycle of TokenFilterFactories, users of Solr 1.2 who have written Java code which constructs new instances of StopFilterFactory, SynonymFilterFactory, or EnglishProterFilterFactory will need to modify their code by adding a line like the following prior to using the factory object... factory.inform(SolrCore.getSolrCore().getSolrConfig().getResourceLoader()); These lifecycle changes do not affect people who use Solr "out of the box" or who have developed their own TokenFilterFactory plugins. More info can be found in SOLR-594. The python client that used to ship with Solr is no longer included in the distribution [SOLR-1369](https://issues.apache.org/jira/browse/SOLR-1369) [LUCENE-1142](https://issues.apache.org/jira/browse/LUCENE-1142) [SOLR-594](https://issues.apache.org/jira/browse/SOLR-594) (see client) (python) (README.txt)
- The TokenizerFactory API has changed to explicitly return a Tokenizer rather then a TokenStream (that may be or may not be a Tokenizer). This change is required to take advantage of the Token reuse improvements in lucene 2.9. [SOLR-1377](https://issues.apache.org/jira/browse/SOLR-1377) (ryan)
- In build.xml, use longfile="gnu" in tar task to avoid warnings about long file names [SOLR-1386](https://issues.apache.org/jira/browse/SOLR-1386) (Mark Miller) (shalin)
- Added Solr Powered By Logos [SOLR-1409](https://issues.apache.org/jira/browse/SOLR-1409) 
- Errors and Exceptions are formated by ResponseWriter. [SOLR-141](https://issues.apache.org/jira/browse/SOLR-141) (Mike Sokolov) (Rich Cariens) (Daniel Naber) (ryan)
- Log a warning if the deprecated charset option is used on GreekLowerCaseFilterFactory, RussianStemFilterFactory, RussianLowerCaseFilterFactory or RussianLetterTokenizerFactory. [SOLR-1410](https://issues.apache.org/jira/browse/SOLR-1410) (Robert Muir) (hossman)
- Due to LUCENE-1906, Solr's tokenizer should use Tokenizer.correctOffset() instead of CharStream.correctOffset(). [SOLR-1423](https://issues.apache.org/jira/browse/SOLR-1423) [LUCENE-1906](https://issues.apache.org/jira/browse/LUCENE-1906) (Uwe Schindler) (koji)
- Make it possible to run all tests in a package [SOLR-1441](https://issues.apache.org/jira/browse/SOLR-1441) (shalin)
- Addition of an abstract BaseResponseWriter class to simplify the development of QueryResponseWriter implementations. [SOLR-1516](https://issues.apache.org/jira/browse/SOLR-1516) (Chris A. Mattmann) (noble)
- Automated release signing process. [SOLR-1522](https://issues.apache.org/jira/browse/SOLR-1522) (gsingers)
- Added Lucene 2.9.1 spatial contrib jar to lib. [SOLR-1561](https://issues.apache.org/jira/browse/SOLR-1561) (gsingers)
- Log warnings if uniqueKey is multi-valued or not stored [SOLR-1570](https://issues.apache.org/jira/browse/SOLR-1570) (hossman) (shalin)
- Removed some very old dead code. [SOLR-1588](https://issues.apache.org/jira/browse/SOLR-1588) (Chris A. Mattmann) (hossman)
- Javadoc for XMLWriter#startTag [SOLR-1590](https://issues.apache.org/jira/browse/SOLR-1590) (Chris A. Mattmann) (hossman)
- Refactor XMLWriter startTag to allow arbitrary attributes to be written [SOLR-1592](https://issues.apache.org/jira/browse/SOLR-1592) (Chris A. Mattmann) (noble)
- Refactor SOLR package structure to include o.a.solr.response and move QueryResponseWriters in there [SOLR-1602](https://issues.apache.org/jira/browse/SOLR-1602) (Chris A. Mattmann) (ryan) (hoss)
- Extract base class from TestDistributedSearch to make it easy to write test cases for other distributed components. [SOLR-1608](https://issues.apache.org/jira/browse/SOLR-1608) (shalin)
- Generify SolrCache [SOLR-1610](https://issues.apache.org/jira/browse/SOLR-1610) (Jason Rutherglen) (shalin)
- Added Lucene 2.9.1 collation contrib jar to lib [SOLR-1611](https://issues.apache.org/jira/browse/SOLR-1611) (shalin)
- Remove ALIAS command [SOLR-1637](https://issues.apache.org/jira/browse/SOLR-1637) 
- Remove adminCore from CoreContainer . removed deprecated methods setAdminCore(), getAdminCore() [SOLR-1661](https://issues.apache.org/jira/browse/SOLR-1661) (noble)
- Improve analysis tests and cut over to new TokenStream API. [SOLR-1674](https://issues.apache.org/jira/browse/SOLR-1674) (Robert Muir) (Mark Miller)
- Improved error messages when adding a document that does not contain exactly one value for the uniqueKey field [SOLR-1695](https://issues.apache.org/jira/browse/SOLR-1695) (hossman)
- Deprecate old &lt;highlighting&gt; syntax and move configuration to HighlightComponent [SOLR-1696](https://issues.apache.org/jira/browse/SOLR-1696) (noble)
- Google collections moved from clustering to core [SOLR-1704](https://issues.apache.org/jira/browse/SOLR-1704) (noble)
- SolrEventListener should extend NamedListInitializedPlugin [SOLR-1727](https://issues.apache.org/jira/browse/SOLR-1727) (noble)
- Improved error message when StringIndex cannot be initialized for a function query [SOLR-1771](https://issues.apache.org/jira/browse/SOLR-1771) (hossman)
- DismaxQParser and ExtendedDismaxQParser now use the schema.xml "defaultSearchField" as the default value for the "qf" param instead of failing with an error when "qf" is not specified. [SOLR-1776](https://issues.apache.org/jira/browse/SOLR-1776) (hossman)
- Documented peculiar behavior of TestHarness.LocalRequestFactory [SOLR-1792](https://issues.apache.org/jira/browse/SOLR-1792) (hossman)
- Google collections updated to Google Guava (which is a superset of collections and contains bug fixes) [SOLR-1804](https://issues.apache.org/jira/browse/SOLR-1804) (gsingers)
- Add ICU4j to contrib/extraction libs and add tests for Arabic extraction [SOLR-1813](https://issues.apache.org/jira/browse/SOLR-1813) (Robert Muir) (gsingers)
- Fix TimeZone-dependent test failure in TestEvaluatorBag. [SOLR-1821](https://issues.apache.org/jira/browse/SOLR-1821) (Chris Male) (rmuir)
- Add unit tests for highlighting with termOffsets=true and overlapping tokens. [SOLR-1826](https://issues.apache.org/jira/browse/SOLR-1826) (Stefan Oestreicher) (rmuir)
- luceneAutoCommit no longer has any effect - it has been remove [SOLR-1851](https://issues.apache.org/jira/browse/SOLR-1851) (Mark Miller)
- SolrResourceLoader.getLines ignores Byte Order Markers (BOMs) at the beginning of input files, these are often created by editors such as Windows Notepad. [SOLR-1865](https://issues.apache.org/jira/browse/SOLR-1865) (rmuir) (hossman)
- Make lucene-jars-to-solr fail if copying any of the jars fails, and update clean to remove the jars in that directory [SOLR-1891](https://issues.apache.org/jira/browse/SOLR-1891) (Mark Miller)
- Upgraded to Tika 0.8 and changed deprecated parse call [SOLR-1902](https://issues.apache.org/jira/browse/SOLR-1902) 
- ElisionFilterFactory will use a default set of French contractions if you do not supply a custom articles file. [SOLR-1938](https://issues.apache.org/jira/browse/SOLR-1938) (rmuir)
- SolrResourceLoader will report any encoding errors, rather than silently using replacement characters for invalid inputs [SOLR-2003](https://issues.apache.org/jira/browse/SOLR-2003) (blargy) (rmuir)
- Add mapping-FoldToASCII.txt to example conf directory. [SOLR-2013](https://issues.apache.org/jira/browse/SOLR-2013) (Steven Rowe) (koji)
- Switch to JavaBin codec version 2. Strings are now serialized as the number of UTF-8 bytes, followed by the bytes in UTF-8. Previously Strings were serialized as the number of UTF-16 chars, followed by the bytes in Modified UTF-8. [SOLR-2034](https://issues.apache.org/jira/browse/SOLR-2034) (hossman) (yonik) (rmuir)
- Fixed some Maven deps [SOLR-2042](https://issues.apache.org/jira/browse/SOLR-2042) (Drew Farris) (gsingers)
- Upgrade to jQuery 1.4.3 [SOLR-2213](https://issues.apache.org/jira/browse/SOLR-2213) (Erick Erickson) (ryan)
- Add version infos to message in JavaBinCodec when throwing exception. [SOLR-2340](https://issues.apache.org/jira/browse/SOLR-2340) (koji)
- Since Solr no longer requires XML files to be in UTF-8 (see SOLR-96) SimplePostTool (aka: post.jar) has been improved to work with files of any mime-type or charset. [SOLR-2350](https://issues.apache.org/jira/browse/SOLR-2350) [SOLR-96](https://issues.apache.org/jira/browse/SOLR-96) (hossman)
- Move DIH jars out of solr.war [SOLR-2365](https://issues.apache.org/jira/browse/SOLR-2365) (David Smiley) (yonik)
- Reduced noise in test output by ensuring the properties file can be written. [SOLR-2367](https://issues.apache.org/jira/browse/SOLR-2367) (Gunnlaugur Thor Briem) (rmuir)
- Include a patched version of Jetty (6.1.26 + JETTY-1340) to fix problematic UTF-8 handling for supplementary characters. [SOLR-2381](https://issues.apache.org/jira/browse/SOLR-2381) (Bernd Fehling) (uschindler) (yonik) (rmuir)
- The preferred Content-Type for XML was changed to application/xml. XMLResponseWriter now only delivers using this type; updating documents and analyzing documents is still supported using text/xml as Content-Type, too. If you have clients that are hardcoded on text/xml as Content-Type, you have to change them. [SOLR-2391](https://issues.apache.org/jira/browse/SOLR-2391) (uschindler) (rmuir)
- All ResponseWriters now use only ServletOutputStreams and wrap their own Writer around it when serializing. This fixes the bug in PHPSerializedResponseWriter that produced wrong string length if the servlet container had a broken UTF-8 encoding that was in fact CESU-8 (see SOLR-1091). The system property to enable the CESU-8 byte counting in PHPSerializesResponseWriters for broken servlet containers was therefore removed and is now ignored if set. Output is always UTF-8. [SOLR-2414](https://issues.apache.org/jira/browse/SOLR-2414) [SOLR-1091](https://issues.apache.org/jira/browse/SOLR-1091) (uschindler) (yonik) (rmuir)
- Add equals and hashCode methods to NamedList [SOLR-458](https://issues.apache.org/jira/browse/SOLR-458) (Stefan Rinner) (shalin)
- Upgraded to Lucene 2.9-dev (r719351) [SOLR-465](https://issues.apache.org/jira/browse/SOLR-465) (shalin)
- FacetComponent helper classes are made public as an experimental API. [SOLR-748](https://issues.apache.org/jira/browse/SOLR-748) (Wojtek Piaseczny) (shalin)
- Added in ability to sign artifacts via Ant for releases [SOLR-776](https://issues.apache.org/jira/browse/SOLR-776) (gsingers)
- DIH: Refactored SolrWriter to make it a concrete class and removed wrappers over SolrInputDocument. Refactored to load Evaluators lazily. Removed multiple document nodes in the configuration xml. Removed support for 'default' variables, they are automatically available as request parameters. [SOLR-782](https://issues.apache.org/jira/browse/SOLR-782) (Noble Paul) (shalin)
- Refactor DisMaxQParser to allow overriding certain features of DisMaxQParser [SOLR-786](https://issues.apache.org/jira/browse/SOLR-786) (Wojciech Biela) (shalin)
- The javadoc of RandomSortField is not readable [SOLR-789](https://issues.apache.org/jira/browse/SOLR-789) (Nicolas Lalevée) (koji)
- Added Lucene's misc contrib JAR (rev 764281). [SOLR-804](https://issues.apache.org/jira/browse/SOLR-804) (gsingers)
- Upgraded to Lucene 2.9-dev (r707499) [SOLR-805](https://issues.apache.org/jira/browse/SOLR-805) (koji)
- Upgraded to Lucene 2.9-dev (r724059) to get access to Arabic public constructors [SOLR-819](https://issues.apache.org/jira/browse/SOLR-819) (gsingers)
- Use new Solr logo in admin [SOLR-84](https://issues.apache.org/jira/browse/SOLR-84) (Michiel) (koji)
- Refactored common code in CSVRequestHandler and XMLUpdateRequestHandler [SOLR-852](https://issues.apache.org/jira/browse/SOLR-852) (gsingers) (ehatcher)
- Added run-example target [SOLR-854](https://issues.apache.org/jira/browse/SOLR-854) (Mark Miller) (ehatcher)
- Removed dependency on stax-utils.jar. If you using solr.jar and running java 6, you can also remove woodstox and geronimo. [SOLR-871](https://issues.apache.org/jira/browse/SOLR-871) (ryan)
- Upgraded to Lucene 2.9-dev (r723985) and consolidated the BitSet implementations [SOLR-875](https://issues.apache.org/jira/browse/SOLR-875) (Michael Busch) (gsingers)
- NamedListCodec is renamed to JavaBinCodec and returns Object instead of NamedList. [SOLR-885](https://issues.apache.org/jira/browse/SOLR-885) (Noble Paul) (yonik) (shalin)
- Upgraded to commons-io-1.4.jar and commons-fileupload-1.2.1.jar [SOLR-889](https://issues.apache.org/jira/browse/SOLR-889) (ryan)
- Moved solrj into /src/solrj. The contents of solr-common.jar is now included in the solr-solrj.jar. [SOLR-900](https://issues.apache.org/jira/browse/SOLR-900) (ryan)
- Code cleanup: make all existing finalize() methods call super.finalize() in a finally block. All current instances extend Object, so this doesn't fix any bugs, but helps protect against future changes. [SOLR-924](https://issues.apache.org/jira/browse/SOLR-924) (Kay Kay) (hossman)
- Cleanup duplicated code in deprecated HighlightingUtils [SOLR-952](https://issues.apache.org/jira/browse/SOLR-952) (hossman)
- Refactored TestReplicationHandler to remove hardcoded port numbers [SOLR-959](https://issues.apache.org/jira/browse/SOLR-959) (hossman) (Akshay Ukey) (shalin)
- Note about null handling in ModifiableSolrParams.add javadoc [SOLR-962](https://issues.apache.org/jira/browse/SOLR-962) (Kay Kay) (hossman)
- DIH: XPathEntityProcessor now ignores DTD validations [SOLR-964](https://issues.apache.org/jira/browse/SOLR-964) (Fergus McMenemie) (Noble Paul) (shalin)
- New type-safe constructor for NamedList [SOLR-967](https://issues.apache.org/jira/browse/SOLR-967) (Kay Kay) (hossman)
- Change the FULL_DUMP, DELTA_DUMP, FIND_DELTA constants in DIH Context to String. Change Context.currentProcess() to return a string instead of an integer. [SOLR-969](https://issues.apache.org/jira/browse/SOLR-969) (Kay Kay) (Noble Paul) (shalin)
- groupId for Woodstox dependency in maven solrj changed to org.codehaus.woodstox [SOLR-981](https://issues.apache.org/jira/browse/SOLR-981) (Tim Taranov) (shalin)
- Wait for a longer time for slave to complete replication in TestReplicationHandler [SOLR-997](https://issues.apache.org/jira/browse/SOLR-997) (Mark Miller) (shalin)
- Upgraded to Lucene 2.9-dev r888785 (shalin)
- Upgraded to Lucene 2.4.0 (yonik)
- DumpRequestHandler (/debug/dump): changed 'fieldName' to 'sourceInfo'. (ehatcher)
- Upgraded to Lucene 2.9-dev r738218 (yonik)
- Upgraded to Lucene 2.9-dev r742220 (yonik)
- Upgraded to Lucene 2.9-dev r752164 (shalin)
- Upgraded to Lucene 2.9-dev r764281 (shalin)
- Upgraded to Lucene 2.9-dev r768228 (shalin)
- Upgraded to Lucene 2.9-dev r768336 (shalin)
- Upgraded to Lucene 2.9-dev 773862 (Mark Miller)
- Upgraded to Lucene 2.9-dev r776177 (shalin)
- Upgraded to Lucene 2.9-dev r779312 (yonik)
- Upgraded to Lucene 2.9-dev r801856 (Mark Miller)


[1.4.1] - 2010-06-25
--------------------

### Fixed (26 changes)

- Make the new ValueSource.getValues(context,reader) delegate to the original ValueSource.getValues(reader) so custom sources will work. [SOLR-1432](https://issues.apache.org/jira/browse/SOLR-1432) (yonik)
- Show proper message if &lt;script&gt; tag is missing for DIH ScriptTransformer [SOLR-1522](https://issues.apache.org/jira/browse/SOLR-1522) (noble)
- Reordering of object allocations in ConcurrentLRUCache to eliminate (an extremely small) potential for deadlock. [SOLR-1538](https://issues.apache.org/jira/browse/SOLR-1538) (gabriele renzi) (hossman)
- QueryElevationComponent only works if the uniqueKey field is implemented using StrField. In previous versions of Solr no warning or error would be generated if you attempted to use QueryElevationComponent, it would just fail in unexpected ways. This has been changed so that it will fail with a clear error message on initialization. [SOLR-1558](https://issues.apache.org/jira/browse/SOLR-1558) (hossman)
- Binary fields, including trie-based numeric fields, caused null pointer exceptions in the luke request handler. [SOLR-1563](https://issues.apache.org/jira/browse/SOLR-1563) (yonik)
- FastLRUCache correctly implemented the LRU policy only for the first 2B accesses. [SOLR-1572](https://issues.apache.org/jira/browse/SOLR-1572) (yonik)
- Fixes to XML escaping in stats.jsp [SOLR-1579](https://issues.apache.org/jira/browse/SOLR-1579) (David Bowen and hossman)
- Solr Configuration ignores 'mergeFactor' parameter, always uses Lucene default. [SOLR-1580](https://issues.apache.org/jira/browse/SOLR-1580) (Lance Norskog) (Mark Miller)
- copyField was ignored for BinaryField types [SOLR-1582](https://issues.apache.org/jira/browse/SOLR-1582) (gsingers)
- StreamingUpdateSolrServer used the platform default character set when streaming updates, rather than using UTF-8 as the HTTP headers indicated, leading to an encoding mismatch. [SOLR-1595](https://issues.apache.org/jira/browse/SOLR-1595) (hossman) (yonik)
- A rollback operation followed by the shutdown of Solr or the close of a core resulted in a warning: "SEVERE: SolrIndexWriter was not closed prior to finalize()" although there were no other consequences. [SOLR-1596](https://issues.apache.org/jira/browse/SOLR-1596) (yonik)
- Fixed Incorrect dataimport handler package name in SolrResourceLoader [SOLR-1651](https://issues.apache.org/jira/browse/SOLR-1651) (Akshay Ukey) (shalin)
- CapitalizationFilter crashes if you use the maxWordCountOption [SOLR-1660](https://issues.apache.org/jira/browse/SOLR-1660) (Robert Muir) (shalin)
- Added Javadocs in BufferedTokenStream and fixed incorrect cloning in TestBufferedTokenStream [SOLR-1662](https://issues.apache.org/jira/browse/SOLR-1662) (Robert Muir) (Uwe Schindler) (shalin)
- fixed WordDelimiterFilter for certain combinations of options where it would output incorrect tokens. [SOLR-1706](https://issues.apache.org/jira/browse/SOLR-1706) (Robert Muir) (Chris Male)
- SolrJ - StreamingUpdateSolrServer had a race condition that could halt the streaming of documents. The original patch to fix this (never officially released) introduced another hanging bug due to connections not being released. [SOLR-1711](https://issues.apache.org/jira/browse/SOLR-1711) (Attila Babo) (Erik Hetzner) (yonik)
- Streams and Readers retrieved from ContentStreams are not closed in various places, resulting in file descriptor leaks. [SOLR-1748](https://issues.apache.org/jira/browse/SOLR-1748) [SOLR-1747](https://issues.apache.org/jira/browse/SOLR-1747) [SOLR-1746](https://issues.apache.org/jira/browse/SOLR-1746) [SOLR-1745](https://issues.apache.org/jira/browse/SOLR-1745) [SOLR-1744](https://issues.apache.org/jira/browse/SOLR-1744) (Christoff Brill) (Mark Miller)
- Solr 1.4 Replication - Repeater throwing NullPointerException [SOLR-1769](https://issues.apache.org/jira/browse/SOLR-1769) (noble)
- fieldTypes with sortMissingLast=true or sortMissingFirst=true can result in incorrectly sorted results. [SOLR-1777](https://issues.apache.org/jira/browse/SOLR-1777) (yonik)
- fix ConcurrentModificationException and potential memory leaks in ResourceLoader. [SOLR-1797](https://issues.apache.org/jira/browse/SOLR-1797) (yonik)
- Small memory leak (~100 bytes) in fastLRUCache for every commit. [SOLR-1798](https://issues.apache.org/jira/browse/SOLR-1798) (yonik)
- Fix WordDelimiterFilterFactory bug where position increments were not being applied properly to subwords. [SOLR-1852](https://issues.apache.org/jira/browse/SOLR-1852) (Peter Wolanin) (Robert Muir)
- Indexing documents using the 'javabin' format no longer fails with a ClassCastException whenSolrInputDocuments contain field values which are Collections or other classes that implement Iterable. [SOLR-1870](https://issues.apache.org/jira/browse/SOLR-1870) (noble) (hossman)
- Upgrade to Apache Lucene 2.9.3 to obtain several bug fixes from the previous 2.9.1. See the Lucene 2.9.3 release notes for details. [SOLR-1934](https://issues.apache.org/jira/browse/SOLR-1934) (hossman) (Mark Miller)
- The JSON response format needed to escape unicode code point U+2028 - 'LINE SEPARATOR' [SOLR-1936](https://issues.apache.org/jira/browse/SOLR-1936) (Robert Hofstra) (yonik)
- PatternTokenizerFactory should use parent's args [SOLR-1948](https://issues.apache.org/jira/browse/SOLR-1948) (koji)


[1.4.0] - 2009-11-10
--------------------

### Added (98 changes)

- Add protected words support to SnowballPorterFilterFactory [SOLR-1026](https://issues.apache.org/jira/browse/SOLR-1026) (ehatcher)
- Enhance CommonsHttpSolrServer to add docs in batch using an iterator API [SOLR-1038](https://issues.apache.org/jira/browse/SOLR-1038) (Noble Paul) (shalin)
- Nested query support for the function query parser and lucene query parser (the latter existed as an undocumented feature in 1.3) [SOLR-1046](https://issues.apache.org/jira/browse/SOLR-1046) (yonik)
- Support the merge of multiple indexes as a CoreAdmin and an update command [SOLR-1051](https://issues.apache.org/jira/browse/SOLR-1051) (Ning Li) (shalin)
- Fixed performance problem in the StopFilterFactory and simplified code. Added tests as well. [SOLR-1095](https://issues.apache.org/jira/browse/SOLR-1095) (gsingers)
- Introduced httpConnTimeout and httpReadTimeout in replication slave configuration to avoid stalled replication. [SOLR-1096](https://issues.apache.org/jira/browse/SOLR-1096) (Jeff Newburn) (Noble Paul) (shalin)
- A FieldAnalysisRequestHandler which provides the analysis functionality of the web admin page as a service. The AnalysisRequestHandler is renamed to DocumentAnalysisRequestHandler which is enhanced with query analysis and showMatch support. AnalysisRequestHandler is now deprecated. Support for both FieldAnalysisRequestHandler and DocumentAnalysisRequestHandler is also provided in the Solrj client. [SOLR-1099](https://issues.apache.org/jira/browse/SOLR-1099) (Uri Boness) (shalin)
- Made CoreAdminHandler Actions pluggable so that additional actions may be plugged in or the existing ones can be overridden if needed. [SOLR-1106](https://issues.apache.org/jira/browse/SOLR-1106) (Kay Kay) (Noble Paul) (shalin)
- Support sorting on trie fields with Distributed Search. [SOLR-1110](https://issues.apache.org/jira/browse/SOLR-1110) (Mark Miller) (Uwe Schindler) (shalin)
- &lt;bool&gt;on&lt;/bool&gt; and &lt;bool&gt;yes&lt;/bool&gt; work as expected in solrconfig.xml. [SOLR-1115](https://issues.apache.org/jira/browse/SOLR-1115) (koji)
- Add a Binary FieldType [SOLR-1116](https://issues.apache.org/jira/browse/SOLR-1116) (noble)
- CoreAdminhandler should not need a core . This makes it possible to start a Solr server w/o a core .(noble) [SOLR-1121](https://issues.apache.org/jira/browse/SOLR-1121) 
- Add a top() function query that causes its argument to have its values derived from the top level IndexReader, even when invoked from a sub-reader. top() is implicitly used for the ord() and rord() functions. [SOLR-1124](https://issues.apache.org/jira/browse/SOLR-1124) (yonik)
- Added metadata output to extraction request handler "extract only" option. [SOLR-1128](https://issues.apache.org/jira/browse/SOLR-1128) (gsingers)
- Add capability to specify an infoStream log file for the underlying Lucene IndexWriter in solrconfig.xml. This is an advanced debug log file that can be used to aid developers in fixing IndexWriter bugs. See the commented out example in the example solrconfig.xml under the indexDefaults section. [SOLR-1145](https://issues.apache.org/jira/browse/SOLR-1145) (Chris Harris) (Mark Miller)
- Snapshoot on ReplicationHandler should accept location as a request parameter [SOLR-1152](https://issues.apache.org/jira/browse/SOLR-1152) (shalin)
- Sort TermsComponent results by frequency [SOLR-1156](https://issues.apache.org/jira/browse/SOLR-1156) (Matt Weber) (yonik)
- Solr Config now supports XInclude for XML engines that can support it. [SOLR-1167](https://issues.apache.org/jira/browse/SOLR-1167) (Bryan Talbot) (gsingers)
- disable/enable replication on master side. added two commands 'enableReplication' and 'disableReplication' [SOLR-1175](https://issues.apache.org/jira/browse/SOLR-1175) (noble)
- DocSets can now be used as Lucene Filters via DocSet.getTopFilter() [SOLR-1179](https://issues.apache.org/jira/browse/SOLR-1179) (yonik)
- Support providing username and password for basic HTTP authentication in Java replication [SOLR-1189](https://issues.apache.org/jira/browse/SOLR-1189) (Matthew Gregg) (shalin)
- Enhance SpellingQueryConverter to handle UTF-8 instead of ASCII only. Use the NMTOKEN syntax for matching field names. [SOLR-1204](https://issues.apache.org/jira/browse/SOLR-1204) (Michael Ludwig) (shalin)
- differentiate between solr home and instanceDir .deprecates the method SolrResourceLoader#locateInstanceDir() and it is renamed to locateSolrHome [SOLR-1214](https://issues.apache.org/jira/browse/SOLR-1214) (noble)
- disambiguate the replication command names. 'snappull' becomes 'fetchindex' 'abortsnappull' becomes 'abortfetch' [SOLR-1216](https://issues.apache.org/jira/browse/SOLR-1216) (noble)
- firstSearcher and newSearcher can now be identified via the CommonParams.EVENT (evt) parameter in a request. This allows a RequestHandler or SearchComponent to know when a newSearcher or firstSearcher event happened. QuerySenderListender is the only implementation in Solr that implements this, but outside implementations may wish to. See the AbstractSolrEventListener for a helper method. [SOLR-1237](https://issues.apache.org/jira/browse/SOLR-1237) (gsingers)
- Show the output of CharFilters in analysis.jsp. [SOLR-1256](https://issues.apache.org/jira/browse/SOLR-1256) (koji)
- Added stemEnglishPossessive option (default=true) to WordDelimiterFilter that allows disabling of english possessive stemming (removal of trailing 's from tokens) [SOLR-1266](https://issues.apache.org/jira/browse/SOLR-1266) (Robert Muir) (yonik)
- Added text serialization output for extractOnly [SOLR-1274](https://issues.apache.org/jira/browse/SOLR-1274) (Peter Wolanin) (gsingers)
- Add expungeDeletes to DirectUpdateHandler2 [SOLR-1275](https://issues.apache.org/jira/browse/SOLR-1275) (noble)
- Add FieldCache introspection to stats.jsp and JMX Monitoring via a new SolrFieldCacheMBean. [SOLR-1292](https://issues.apache.org/jira/browse/SOLR-1292) (hossman)
- Add better support for efficient wildcard handling [SOLR-1321](https://issues.apache.org/jira/browse/SOLR-1321) (Andrzej Bialecki) (Robert Muir) (gsingers)
- New interface PluginInfoInitialized for all types of plugin [SOLR-1326](https://issues.apache.org/jira/browse/SOLR-1326) (noble)
- load core properties from a properties file [SOLR-1335](https://issues.apache.org/jira/browse/SOLR-1335) (noble)
- Added HTMLStripCharFilter and marked HTMLStripReader, HTMLStripWhitespaceTokenizerFactory and HTMLStripStandardTokenizerFactory deprecated. To strip HTML tags, HTMLStripCharFilter can be used with an arbitrary Tokenizer. [SOLR-1343](https://issues.apache.org/jira/browse/SOLR-1343) (koji)
- Add ms() function query for getting milliseconds from dates and for high precision date subtraction, add sub() for subtracting other arguments. [SOLR-1368](https://issues.apache.org/jira/browse/SOLR-1368) (yonik)
- Show the output of CharFilters in FieldAnalysisRequestHandler [SOLR-1370](https://issues.apache.org/jira/browse/SOLR-1370) (koji)
- Enhance FieldAnalysisRequestHandler to accept field value from content stream [SOLR-1372](https://issues.apache.org/jira/browse/SOLR-1372) (ehatcher)
- Add Filter query to admin/form.jsp [SOLR-1373](https://issues.apache.org/jira/browse/SOLR-1373) (Jason Rutherglen) (hossman)
- Add an 'enable' attribute to all plugins [SOLR-1385](https://issues.apache.org/jira/browse/SOLR-1385) (noble)
- implicit core properties are not set for single core [SOLR-1414](https://issues.apache.org/jira/browse/SOLR-1414) (noble)
- Simple property injection. &lt;mergePolicy&gt; & &lt;mergeScheduler&gt; syntaxes are now deprecated [SOLR-1447](https://issues.apache.org/jira/browse/SOLR-1447) (Jason Rutherglen) (noble)
- Add &lt;lib&gt; elements to solrconfig.xml to specifying additional classpath directories and regular expressions. [SOLR-1449](https://issues.apache.org/jira/browse/SOLR-1449) (hossman) (yonik)
- Enable sort by Lucene docid. [SOLR-1478](https://issues.apache.org/jira/browse/SOLR-1478) (ehatcher)
- Add configurable IndexReaderFactory so that alternate IndexReader implementations can be specified via solrconfig.xml. Note that using a custom IndexReader may be incompatible with ReplicationHandler (see comments in SOLR-1366). This should be treated as an experimental feature. [SOLR-243](https://issues.apache.org/jira/browse/SOLR-243) [SOLR-1366](https://issues.apache.org/jira/browse/SOLR-1366) (Andrzej Bialecki) (hossman) (Mark Miller) (John Wang)
- Added support for extracting content from binary documents like MS Word and PDF using Apache Tika. See also contrib/extraction/CHANGES.txt [SOLR-284](https://issues.apache.org/jira/browse/SOLR-284) (Eric Pugh) (Chris Harris) (yonik) (gsingers)
- Add configurable DirectoryProvider so that alternate Directory implementations can be specified via solrconfig.xml. The default DirectoryProvider will use NIOFSDirectory for better concurrency on non Windows platforms. [SOLR-465](https://issues.apache.org/jira/browse/SOLR-465) (Mark Miller) (TJ Laurenzo) (yonik)
- Add maxChars attribute for copyField function so that the length limit for destination can be specified. [SOLR-538](https://issues.apache.org/jira/browse/SOLR-538) (Georgios Stamatis) (Lars Kotthoff) (Chris Harris) (koji)
- Add support for globbing in field names to highlight. For example, hl.fl=*_text will highlight all fieldnames ending with _text. [SOLR-540](https://issues.apache.org/jira/browse/SOLR-540) (Lars Kotthoff) (yonik)
- Use SLF4J logging API rather then JDK logging. The packaged .war file is shipped with a JDK logging implementation, so logging configuration for the .war should be identical to solr 1.3. However, if you are using the .jar file, you can select which logging implementation to use by dropping a different binding. See: http://www.slf4j.org/ [SOLR-560](https://issues.apache.org/jira/browse/SOLR-560) (ryan)
- Added Replication implemented in Java as a request handler. Supports index replication as well as configuration replication and exposes detailed statistics and progress information on the Admin page. Works on all platforms. [SOLR-561](https://issues.apache.org/jira/browse/SOLR-561) (Noble Paul) (yonik) (Akshay Ukey) (shalin)
- Allow configurable index deletion policy and provide a default implementation which allows deletion of commit points on various criteria such as number of commits, age of commit point and optimized status. See http://lucene.apache.org/java/2_3_2/api/org/apache/lucene/index/IndexDeletionPolicy.html [SOLR-617](https://issues.apache.org/jira/browse/SOLR-617) (yonik) (Noble Paul) (Akshay Ukey) (shalin)
- Added TermVectorComponent for serving up term vector information, plus IDF. See http://wiki.apache.org/solr/TermVectorComponent [SOLR-651](https://issues.apache.org/jira/browse/SOLR-651) (gsingers) (Vaijanath N. Rao) (Noble Paul)
- Allow Solr to load index from arbitrary directory in dataDir [SOLR-658](https://issues.apache.org/jira/browse/SOLR-658) (Noble Paul) (Akshay Ukey) (shalin)
- Adds shards.start and shards.rows to distributed search to allow more efficient bulk queries (those that retrieve many or all documents). [SOLR-659](https://issues.apache.org/jira/browse/SOLR-659) (Brian Whitman) (yonik)
- A LRU cache implementation based upon ConcurrentHashMap and other techniques to reduce contention and synchronization overhead, to utilize multiple CPU cores more effectively. [SOLR-667](https://issues.apache.org/jira/browse/SOLR-667) (Fuad Efendi) (Noble Paul) (yonik) (shalin)
- Add support for rollbacks in UpdateHandler. This allows user to rollback all changes since the last commit. [SOLR-670](https://issues.apache.org/jira/browse/SOLR-670) (Noble Paul) (koji) (shalin)
- Add StatsComponent. This gets simple statistics on matched numeric fields, including: min, max, mean, median, stddev. (koji, ryan) - SOLR-1380: Added support for multi-valued fields [SOLR-680](https://issues.apache.org/jira/browse/SOLR-680) [SOLR-1380](https://issues.apache.org/jira/browse/SOLR-1380) (Harish Agarwal) (gsingers)
- Add support for OmitTf [SOLR-739](https://issues.apache.org/jira/browse/SOLR-739) (Mark Miller) (yonik)
- Added "omitHeader" request parameter to omit the header from the response. [SOLR-746](https://issues.apache.org/jira/browse/SOLR-746) (Noble Paul) (shalin)
- Add support for Lucene's PositionFilter [SOLR-763](https://issues.apache.org/jira/browse/SOLR-763) (Mck SembWever) (shalin)
- DIH: Set last_index_time variable in full-import command. [SOLR-768](https://issues.apache.org/jira/browse/SOLR-768) (Wojtek Piaseczny) (Noble Paul) (shalin)
- Added support for clustering in contrib/clustering. See http://wiki.apache.org/solr/ClusteringComponent for more info. [SOLR-769](https://issues.apache.org/jira/browse/SOLR-769) (gsingers) (Stanislaw Osinski)
- Distributed search ability to sort field.facet values lexicographically. facet.sort values "true" and "false" are also deprecated and replaced with "count" and "lex". [SOLR-781](https://issues.apache.org/jira/browse/SOLR-781) (Lars Kotthoff) (yonik)
- Add 'commitWithin' argument to the update add command. This behaves similar to the global autoCommit maxTime argument except that it is set for each request. [SOLR-793](https://issues.apache.org/jira/browse/SOLR-793) (ryan)
- SpellCheckComponent supports building indices on optimize if configured in solrconfig.xml [SOLR-795](https://issues.apache.org/jira/browse/SOLR-795) (Jason Rennie) (shalin)
- Add support for hash based exact/near duplicate document handling. [SOLR-799](https://issues.apache.org/jira/browse/SOLR-799) (Mark Miller) (yonik)
- DIH: Add support for configurable pre-import and post-import delete query per root-entity. [SOLR-801](https://issues.apache.org/jira/browse/SOLR-801) (Noble Paul) (shalin)
- Allow a "deltaImportQuery" attribute in SqlEntityProcessor which is used for delta imports instead of DataImportHandler manipulating the SQL itself. [SOLR-811](https://issues.apache.org/jira/browse/SOLR-811) (Noble Paul) (shalin)
- Configurable JDBC settings in JdbcDataSource including optimized defaults for read only mode. [SOLR-812](https://issues.apache.org/jira/browse/SOLR-812) (David Smiley) (Glen Newton) (shalin)
- Adding DoubleMetaphone Filter and Factory. Similar to the PhoneticFilter, but this uses DoubleMetaphone specific calls (including alternate encoding) [SOLR-813](https://issues.apache.org/jira/browse/SOLR-813) (Todd Feak) (ryan)
- Added factories for Arabic support [SOLR-819](https://issues.apache.org/jira/browse/SOLR-819) (gsingers)
- Support replication on startup of master with new index. [SOLR-820](https://issues.apache.org/jira/browse/SOLR-820) (Noble Paul) (Akshay Ukey) (shalin)
- Add support for replication to copy conf file to slave with a different name. This allows replication of solrconfig.xml [SOLR-821](https://issues.apache.org/jira/browse/SOLR-821) (Noble Paul) (Akshay Ukey) (shalin)
- Add CharFilter so that characters can be filtered (e.g. character normalization) before Tokenizer/TokenFilters. [SOLR-822](https://issues.apache.org/jira/browse/SOLR-822) (koji)
- Allow slaves to request compressed files from master during replication [SOLR-829](https://issues.apache.org/jira/browse/SOLR-829) (Simon Collins) (Noble Paul) (Akshay Ukey) (shalin)
- DIH: A DataSource to read data from a field as a reader. This can be used, for example, to read XMLs residing as CLOBs or BLOBs in databases. [SOLR-833](https://issues.apache.org/jira/browse/SOLR-833) (Noble Paul) (shalin)
- Better error handling in DataImportHandler with options to abort, skip and continue imports. [SOLR-842](https://issues.apache.org/jira/browse/SOLR-842) (Noble Paul) (shalin)
- A SolrServer implementation to front-end multiple solr servers and provides load balancing and failover support [SOLR-844](https://issues.apache.org/jira/browse/SOLR-844) (Noble Paul) (Mark Miller) (hossman) (shalin)
- Enhance the snappull command in ReplicationHandler to accept masterUrl. [SOLR-847](https://issues.apache.org/jira/browse/SOLR-847) (Noble Paul) (Preetam Rao) (shalin)
- Addition of timeouts for distributed searching. Configurable through 'shard-socket-timeout' and 'shard-connection-timeout' parameters in SearchHandler. [SOLR-850](https://issues.apache.org/jira/browse/SOLR-850) (Patrick O'Leary) (shalin)
- Adding support for document updates in binary format and corresponding support in Solrj client. [SOLR-865](https://issues.apache.org/jira/browse/SOLR-865) (Noble Paul) (shalin)
- WordDelimiterFilter now supports a splitOnNumerics option, as well as a list of protected terms. [SOLR-876](https://issues.apache.org/jira/browse/SOLR-876) (Dan Rosher) (hossman)
- Added TermsComponent for accessing Lucene's TermEnum capabilities. Useful for auto suggest and possibly distributed search. Not distributed search compliant. (gsingers) - Added mincount and maxcount options [SOLR-877](https://issues.apache.org/jira/browse/SOLR-877) (Khee Chin) (gsingers)
- DataImportHandler should rollback when an import fails or it is aborted [SOLR-886](https://issues.apache.org/jira/browse/SOLR-886) (shalin)
- A DIH Transformer to strip HTML tags. [SOLR-887](https://issues.apache.org/jira/browse/SOLR-887) (Ahmed Hammad) (shalin)
- A DIH Transformer to read strings from Clob type. [SOLR-891](https://issues.apache.org/jira/browse/SOLR-891) (Noble Paul) (shalin)
- Adding a StreamingUpdateSolrServer that writes update commands to an open HTTP connection. If you are using solrj for bulk update requests you should consider switching to this implementaion. However, note that the error handling is not immediate as it is with the standard SolrServer. [SOLR-906](https://issues.apache.org/jira/browse/SOLR-906) (ryan)
- CommonGramsFilterFactory/CommonGramsQueryFilterFactory for speeding up phrase queries containing common words by indexing n-grams and using them at query time. [SOLR-908](https://issues.apache.org/jira/browse/SOLR-908) (Tom Burton-West) (Jason Rutherglen) (yonik)
- Add a few utility commands to the DIH admin page such as full import, delta import, status, reload config. [SOLR-910](https://issues.apache.org/jira/browse/SOLR-910) (Ahmed Hammad) (shalin)
- Add support for multi-select faceting by allowing filters to be tagged and facet commands to exclude certain filters. This patch also added the ability to change the output key for facets in the response, and optimized distributed faceting refinement by lowering parsing overhead and by making requests and responses smaller. [SOLR-911](https://issues.apache.org/jira/browse/SOLR-911) 
- SolrDocument and SolrInputDocument now implement the Map&lt;String,?&gt; interface. This should make plugging into other standard tools easier. [SOLR-928](https://issues.apache.org/jira/browse/SOLR-928) (ryan)
- Add event listener API for DIH import start and end. [SOLR-938](https://issues.apache.org/jira/browse/SOLR-938) (Kay Kay) (Noble Paul) (shalin)
- ValueSourceRangeFilter/Query - filter based on values in a FieldCache entry or on any arbitrary function of field values. [SOLR-939](https://issues.apache.org/jira/browse/SOLR-939) (yonik)
- Add support for Lucene's Trie Range Queries by providing new FieldTypes in schema for int, float, long, double and date. Single-valued Trie based fields with a precisionStep will index multiple precisions and enable faster range queries. [SOLR-940](https://issues.apache.org/jira/browse/SOLR-940) (Uwe Schindler) (yonik) (shalin)
- Make it possible to specify dataDir in solr.xml and accept the dataDir as a request parameter for the CoreAdmin create command. [SOLR-943](https://issues.apache.org/jira/browse/SOLR-943) (Noble Paul) (shalin)
- Enhance the map() function query to take in an optional default value [SOLR-966](https://issues.apache.org/jira/browse/SOLR-966) (Noble Paul) (shalin)
- A PlainTextEntityProcessor which can read from any DataSource&lt;Reader&gt; and output a String. (Nathan Adams, Noble Paul via shalin) 100.SOLR-1003: XPathEntityprocessor must allow slurping all text from a given xml node and its children. (Noble Paul via shalin) 101.SOLR-1001: Allow variables in various attributes of RegexTransformer, HTMLStripTransformer and NumberFormatTransformer. (Fergus McMenemie, Noble Paul, shalin) 102.SOLR-989: DIH: Expose running statistics from the Context API. (Noble Paul, shalin) 103.SOLR-996: DIH: Expose Context to Evaluators. (Noble Paul, shalin) 104.SOLR-783: DIH: Enhance delta-imports by maintaining separate last_index_time for each entity. (Jon Baer, Noble Paul via shalin) 105.SOLR-1033: Current entity's namespace is made available to all DIH Transformers. This allows one to use an output field of TemplateTransformer in other transformers, among other things. (Fergus McMenemie, Noble Paul via shalin) 106.SOLR-1066: New methods in DIH Context to expose Script details. ScriptTransformer changed to read scripts through the new API methods. (Noble Paul via shalin) 107.SOLR-1062: A DIH LogTransformer which can log data in a given template format. (Jon Baer, Noble Paul via shalin) 108.SOLR-1065: A DIH ContentStreamDataSource which can accept HTTP POST data in a content stream. This can be used to push data to Solr instead of just pulling it from DB/Files/URLs. (Noble Paul via shalin) 109.SOLR-1061: Improve DIH RegexTransformer to create multiple columns from regex groups. (Noble Paul via shalin) 110.SOLR-1059: Special DIH flags introduced for deleting documents by query or id, skipping rows and stopping further transforms. Use $deleteDocById, $deleteDocByQuery for deleting by id and query respectively. Use $skipRow to skip the current row but continue with the document. Use $stopTransform to stop further transformers. New methods are introduced in Context for deleting by id and query. (Noble Paul, Fergus McMenemie, shalin) 111.SOLR-1076: JdbcDataSource should resolve DIH variables in all its configuration parameters. (shalin) 112.SOLR-1055: Make DIH JdbcDataSource easily extensible by making the createConnectionFactory method protected and return a Callable&lt;Connection&gt; object. (Noble Paul, shalin) 113.SOLR-1058: DIH: JdbcDataSource can lookup javax.sql.DataSource using JNDI. Use a jndiName attribute to specify the location of the data source. (Jason Shepherd, Noble Paul via shalin) 114.SOLR-1083: A DIH Evaluator for escaping query characters. (Noble Paul, shalin) 115.SOLR-934: A MailEntityProcessor to enable indexing mails from POP/IMAP sources into a solr index. (Preetam Rao, shalin) 116.SOLR-1060: A DIH LineEntityProcessor which can stream lines of text from a given file to be indexed directly or for processing with transformers and child entities. (Fergus McMenemie, Noble Paul, shalin) 117.SOLR-1127: Add support for DIH field name to be templatized. (Noble Paul, shalin) 118.SOLR-1092: Added a new DIH command named 'import' which does not automatically clean the index. This is useful and more appropriate when one needs to import only some of the entities. (Noble Paul via shalin) 119.SOLR-1153: DIH 'deltaImportQuery' is honored on child entities as well (noble) 120.SOLR-1230: Enhanced dataimport.jsp to work with all DataImportHandler request handler configurations, rather than just a hardcoded /dataimport handler. (ehatcher) 121.SOLR-1235: disallow period (.) in DIH entity names (noble) 122.SOLR-1234: Multiple DIH does not work because all of them write to dataimport.properties. Use the handler name as the properties file name (noble) 123.SOLR-1348: Support binary field type in convertType logic in DIH JdbcDataSource (shalin) 124.SOLR-1406: DIH: Make FileDataSource and FileListEntityProcessor to be more extensible (Luke Forehand, shalin) 125.SOLR-1437: DIH: XPathEntityProcessor can deal with xpath syntaxes such as //tagname , /root//tagname [SOLR-980](https://issues.apache.org/jira/browse/SOLR-980) [SOLR-1003](https://issues.apache.org/jira/browse/SOLR-1003) [SOLR-1001](https://issues.apache.org/jira/browse/SOLR-1001) [SOLR-989](https://issues.apache.org/jira/browse/SOLR-989) [SOLR-996](https://issues.apache.org/jira/browse/SOLR-996) [SOLR-783](https://issues.apache.org/jira/browse/SOLR-783) [SOLR-1033](https://issues.apache.org/jira/browse/SOLR-1033) [SOLR-1066](https://issues.apache.org/jira/browse/SOLR-1066) [SOLR-1062](https://issues.apache.org/jira/browse/SOLR-1062) [SOLR-1065](https://issues.apache.org/jira/browse/SOLR-1065) [SOLR-1061](https://issues.apache.org/jira/browse/SOLR-1061) [SOLR-1059](https://issues.apache.org/jira/browse/SOLR-1059) [SOLR-1076](https://issues.apache.org/jira/browse/SOLR-1076) [SOLR-1055](https://issues.apache.org/jira/browse/SOLR-1055) [SOLR-1058](https://issues.apache.org/jira/browse/SOLR-1058) [SOLR-1083](https://issues.apache.org/jira/browse/SOLR-1083) [SOLR-934](https://issues.apache.org/jira/browse/SOLR-934) [SOLR-1060](https://issues.apache.org/jira/browse/SOLR-1060) [SOLR-1127](https://issues.apache.org/jira/browse/SOLR-1127) [SOLR-1092](https://issues.apache.org/jira/browse/SOLR-1092) [SOLR-1153](https://issues.apache.org/jira/browse/SOLR-1153) [SOLR-1230](https://issues.apache.org/jira/browse/SOLR-1230) [SOLR-1235](https://issues.apache.org/jira/browse/SOLR-1235) [SOLR-1234](https://issues.apache.org/jira/browse/SOLR-1234) [SOLR-1348](https://issues.apache.org/jira/browse/SOLR-1348) [SOLR-1406](https://issues.apache.org/jira/browse/SOLR-1406) [SOLR-1437](https://issues.apache.org/jira/browse/SOLR-1437) (Fergus McMenemie) (noble)
- Add a new scope for session data stored in Context to store objects across imports. [SOLR-988](https://issues.apache.org/jira/browse/SOLR-988) (Noble Paul) (shalin)

### Changed (22 changes)

- Change SolrIndexSearcher to use insertWithOverflow with reusable priority queue entries to reduce the amount of generated garbage during searching. [SOLR-1002](https://issues.apache.org/jira/browse/SOLR-1002) (Mark Miller) (yonik)
- DIH: Check for abort more frequently during delta-imports. [SOLR-1004](https://issues.apache.org/jira/browse/SOLR-1004) (Marc Sturlese) (shalin)
- DIH DateFormatTransformer can cache the format objects. [SOLR-1098](https://issues.apache.org/jira/browse/SOLR-1098) (Noble Paul) (shalin)
- Remove un-needed synchronization in SolrCore constructor. [SOLR-1108](https://issues.apache.org/jira/browse/SOLR-1108) (Noble Paul) (shalin)
- Use per-segment sorting to share fieldcache elements across unchanged segments. This saves memory and reduces commit times for incremental updates to the index. [SOLR-1111](https://issues.apache.org/jira/browse/SOLR-1111) (yonik)
- Load Documents for Highlighting one at a time rather than all at once to avoid OOM with many large Documents. [SOLR-1150](https://issues.apache.org/jira/browse/SOLR-1150) (Siddharth Gargate) (Mark Miller)
- Use Lucene Filters and pass them down to the Lucene search methods to filter earlier and improve performance. [SOLR-1165](https://issues.apache.org/jira/browse/SOLR-1165) (yonik)
- Speed up docset/filter generation by avoiding top-level score() call and iterating over leaf readers with TermDocs. [SOLR-1166](https://issues.apache.org/jira/browse/SOLR-1166) (yonik)
- SortedIntDocSet - a new small set implementation that saves memory over HashDocSet, is faster to construct, is ordered for easier implementation of skipTo, and is faster in the general case. [SOLR-1169](https://issues.apache.org/jira/browse/SOLR-1169) (yonik)
- Minor efficiency improvement in TermVectorComponent related to ignoring positions or offsets [SOLR-1188](https://issues.apache.org/jira/browse/SOLR-1188) (gsingers)
- Enables setting IndexReader's termInfosIndexDivisor via a new attribute to StandardIndexReaderFactory. Enables setting termIndexInterval to IndexWriter via SolrIndexConfig. [SOLR-1296](https://issues.apache.org/jira/browse/SOLR-1296) (Jason Rutherglen) (hossman) (gsingers)
- Implement and use reusable token streams for analysis. [SOLR-1353](https://issues.apache.org/jira/browse/SOLR-1353) (Robert Muir) (yonik)
- Replaced string concatenations with StringBuilder append calls in DIH XPathRecordReader. [SOLR-1465](https://issues.apache.org/jira/browse/SOLR-1465) (Mark Miller) (shalin)
- Use IndexReader.reopen to save resources by re-using parts of the index that haven't changed. [SOLR-374](https://issues.apache.org/jira/browse/SOLR-374) (Mark Miller) (yonik)
- New faceting method with better performance and smaller memory usage for multi-valued fields with many unique values but relatively few values per document. Controllable via the facet.method parameter - "fc" is the new default method and "enum" is the original method. [SOLR-475](https://issues.apache.org/jira/browse/SOLR-475) (yonik)
- Write string keys in Maps as extern strings in the javabin format. [SOLR-808](https://issues.apache.org/jira/browse/SOLR-808) (Noble Paul) (shalin)
- DIH: Reduce memory consumption during delta import by removing keys when used [SOLR-846](https://issues.apache.org/jira/browse/SOLR-846) (Ricky Leung) (Noble Paul) (shalin)
- SolrResourceLoader must cache short class name vs fully qualified classname [SOLR-921](https://issues.apache.org/jira/browse/SOLR-921) (Noble Paul) (hossman) (shalin)
- Use an ArrayList in SolrPluginUtils.parseQueryStrings since we know exactly how long the List will be in advance. [SOLR-970](https://issues.apache.org/jira/browse/SOLR-970) (Kay Kay) (hossman)
- Replace StringBuffer with StringBuilder for instances that do not require thread-safety. [SOLR-971](https://issues.apache.org/jira/browse/SOLR-971) (Kay Kay) (shalin)
- CommonsHttpSolrServer writes the xml directly to the server. [SOLR-973](https://issues.apache.org/jira/browse/SOLR-973) (Noble Paul) (shalin)
- DataImportHandler skips commit if no data has been updated. [SOLR-974](https://issues.apache.org/jira/browse/SOLR-974) (Wojtek Piaseczny) (shalin)

### Fixed (98 changes)

- DIH FileListEntityProcessor should not apply fileName filter to directory names. [SOLR-1000](https://issues.apache.org/jira/browse/SOLR-1000) (Fergus McMenemie) (shalin)
- Fix stats.jsp XML encoding for &lt;stat&gt; item entries with ampersands in their names. [SOLR-1008](https://issues.apache.org/jira/browse/SOLR-1008) (ehatcher)
- Repeated column names result in duplicate values. [SOLR-1009](https://issues.apache.org/jira/browse/SOLR-1009) (Fergus McMenemie) (Noble Paul) (shalin)
- Incomplete information in replication admin page and http command response when server is both master and slave i.e. when server is a repeater [SOLR-1015](https://issues.apache.org/jira/browse/SOLR-1015) (Akshay Ukey) (shalin)
- HTTP 503 error changes 500 in SolrCore [SOLR-1016](https://issues.apache.org/jira/browse/SOLR-1016) (koji)
- Fix DIH thread-safety issue with last_index_time for concurrent imports in multiple cores due to unsafe usage of SimpleDateFormat by multiple threads. [SOLR-1017](https://issues.apache.org/jira/browse/SOLR-1017) (Ryuuichi Kumai) (shalin)
- Slave is unable to replicate when server acts as repeater (as both master and slave) [SOLR-1018](https://issues.apache.org/jira/browse/SOLR-1018) (Akshay Ukey) (Noble Paul) (shalin)
- Calling abort on DataImportHandler import commits data instead of calling rollback. [SOLR-1024](https://issues.apache.org/jira/browse/SOLR-1024) (shalin)
- Fix XSS vulnerability in schema.jsp [SOLR-1031](https://issues.apache.org/jira/browse/SOLR-1031) (Paul Lovvik) (ehatcher)
- DIH should not add null values in a row returned by EntityProcessor to documents. [SOLR-1037](https://issues.apache.org/jira/browse/SOLR-1037) (shalin)
- DIH XPathEntityProcessor fails with an xpath like /feed/entry/link[@type='text/html']/@href [SOLR-1040](https://issues.apache.org/jira/browse/SOLR-1040) (Noble Paul) (shalin)
- Fix memory leak in DIH by making TemplateString non-static member in VariableResolverImpl [SOLR-1042](https://issues.apache.org/jira/browse/SOLR-1042) (Ryuuichi Kumai) (shalin)
- IndexOutOfBoundsException in DIH SolrWriter.getResourceAsString when size of data-config.xml is a multiple of 1024 bytes. [SOLR-1053](https://issues.apache.org/jira/browse/SOLR-1053) (Herb Jiang) (shalin)
- registry.jsp incorrectly displaying info for last core initialized regardless of what the current core is. [SOLR-1064](https://issues.apache.org/jira/browse/SOLR-1064) (hossman)
- spellcheck.extendedResults returns an invalid JSON response when count &gt; 1. To fix, the extendedResults format was changed. [SOLR-1071](https://issues.apache.org/jira/browse/SOLR-1071) (Uri Boness) (yonik)
- absolute paths used in sharedLib attribute were incorrectly treated as relative paths. [SOLR-1072](https://issues.apache.org/jira/browse/SOLR-1072) (hossman)
- IndexOutOfBoundsException with useSolrAddSchema in DIH XPathEntityProcessor. [SOLR-1077](https://issues.apache.org/jira/browse/SOLR-1077) (Sam Keen) (Noble Paul) (shalin)
- Fixes to WordDelimiterFilter to avoid splitting or dropping international non-letter characters such as non spacing marks. [SOLR-1078](https://issues.apache.org/jira/browse/SOLR-1078) (yonik)
- DIH RegexTransformer should not replace if regex is not matched. (Noble Paul, Fergus McMenemie via shalin) 100.SOLR-1090: DataImportHandler should load the data-config.xml using UTF-8 encoding. (Rui Pereira, shalin) 101.SOLR-1146: ConcurrentModificationException in DataImporter.getStatusMessages (Walter Ferrara, Noble Paul via shalin) 102.SOLR-1229: Fixes for DIH deletedPkQuery, particularly when using transformed Solr unique id's (Lance Norskog, Noble Paul via ehatcher) 103.SOLR-1286: Fix the IH commit parameter always defaulting to "true" even if "false" is explicitly passed in. (Jay Hill, Noble Paul via ehatcher) 104.SOLR-1323: Reset XPathEntityProcessor's $hasMore/$nextUrl when fetching next URL (noble, ehatcher) 105.SOLR-1450: DIH: Jdbc connection properties such as batchSize are not applied if the driver jar is placed in solr_home/lib. (Steve Sun via shalin) 106.SOLR-1474: DIH Delta-import should run even if last_index_time is not set. [SOLR-1080](https://issues.apache.org/jira/browse/SOLR-1080) [SOLR-1090](https://issues.apache.org/jira/browse/SOLR-1090) [SOLR-1146](https://issues.apache.org/jira/browse/SOLR-1146) [SOLR-1229](https://issues.apache.org/jira/browse/SOLR-1229) [SOLR-1286](https://issues.apache.org/jira/browse/SOLR-1286) [SOLR-1323](https://issues.apache.org/jira/browse/SOLR-1323) [SOLR-1450](https://issues.apache.org/jira/browse/SOLR-1450) [SOLR-1474](https://issues.apache.org/jira/browse/SOLR-1474) (shalin)
- Jetty's use of CESU-8 for code points outside the BMP resulted in invalid output from the serialized PHP writer. [SOLR-1091](https://issues.apache.org/jira/browse/SOLR-1091) (yonik)
- Incorrect value of correctlySpelled attribute in some cases [SOLR-1094](https://issues.apache.org/jira/browse/SOLR-1094) (David Smiley) (Mark Miller) (shalin)
- LukeRequestHandler (and schema.jsp) have been fixed to include the "1" (ie: 2**0) bucket in the term histogram data. [SOLR-1103](https://issues.apache.org/jira/browse/SOLR-1103) (hossman)
- Fix some rounding errors in LukeRequestHandler's histogram [SOLR-1104](https://issues.apache.org/jira/browse/SOLR-1104) (hossman)
- Use query analyzer rather than index analyzer for queryFieldType in QueryElevationComponent [SOLR-1125](https://issues.apache.org/jira/browse/SOLR-1125) (koji)
- Replicated files have incorrect timestamp [SOLR-1126](https://issues.apache.org/jira/browse/SOLR-1126) (Jian Han Guo) (Jeff Newburn) (Noble Paul) (shalin)
- Java replication creates Snapshot in the directory where Solr was launched [SOLR-1135](https://issues.apache.org/jira/browse/SOLR-1135) (Jianhan Guo) (shalin)
- Query Elevation Component now gracefully handles missing queries. [SOLR-1138](https://issues.apache.org/jira/browse/SOLR-1138) (gsingers)
- NullPointerException during snapshoot command in java based replication [SOLR-1141](https://issues.apache.org/jira/browse/SOLR-1141) (Jian Han Guo) (shalin)
- Fix LukeRequestHandler so it doesn't rely on SolrQueryParser and report incorrect stats when field names contain characters SolrQueryParser considers special. [SOLR-1171](https://issues.apache.org/jira/browse/SOLR-1171) (hossman)
- Fix Logging admin form submit url for multicore. [SOLR-1174](https://issues.apache.org/jira/browse/SOLR-1174) (Jacob Singh) (shalin)
- Fix bug in OrdFieldSource#equals which could cause a bug with OrdFieldSource caching on OrdFieldSource#hashcode collisions. [SOLR-1182](https://issues.apache.org/jira/browse/SOLR-1182) (Mark Miller)
- equals method should compare this and other of DocList in DocSetBase [SOLR-1207](https://issues.apache.org/jira/browse/SOLR-1207) (koji)
- Human readable JVM info from system handler does integer cutoff rounding, even when dealing with GB. Fixed to round to one decimal place. [SOLR-1242](https://issues.apache.org/jira/browse/SOLR-1242) (Jay Hill) (Mark Miller)
- Admin RequestHandlers should not be cached over HTTP. [SOLR-1243](https://issues.apache.org/jira/browse/SOLR-1243) (Mark Miller)
- Fix implementations of set operations for DocList subclasses and fix a bug in HashDocSet construction when offset != 0. These bugs never manifested in normal Solr use and only potentially affect custom code. [SOLR-1260](https://issues.apache.org/jira/browse/SOLR-1260) (yonik)
- Fix CapitalizationFilterFactory to work when keep parameter is not specified. [SOLR-1317](https://issues.apache.org/jira/browse/SOLR-1317) (ehatcher)
- CapitalizationFilterFactory uses incorrect term length calculations. [SOLR-1342](https://issues.apache.org/jira/browse/SOLR-1342) (Robert Muir) (Mark Miller)
- DoubleMetaphoneFilter didn't index original tokens if there was no alternative, and could incorrectly skip or reorder tokens. [SOLR-1359](https://issues.apache.org/jira/browse/SOLR-1359) (yonik)
- Prevent PhoneticFilter from producing duplicate tokens. [SOLR-1360](https://issues.apache.org/jira/browse/SOLR-1360) (yonik)
- WordDelimiterFilter had inconsistent behavior when setting the position increment of tokens following a token consisting of all delimiters, and could additionally lose big position increments. [SOLR-1362](https://issues.apache.org/jira/browse/SOLR-1362) (Robert Muir) (yonik)
- LukeRequestHandler/schema.jsp errored if schema had no uniqueKey field. The new test for this also (hopefully) adds some future proofing against similar bugs in the future. As a side effect QueryElevationComponentTest was refactored, and a bug in that test was found. [SOLR-1371](https://issues.apache.org/jira/browse/SOLR-1371) (hossman)
- Fixed improper handling of fields that have only term positions and not term offsets during Highlighting [SOLR-1381](https://issues.apache.org/jira/browse/SOLR-1381) (Thorsten Fischer) (gsingers)
- HTMLStripCharFilter split tokens that contained entities and often calculated offsets incorrectly for entities. [SOLR-1394](https://issues.apache.org/jira/browse/SOLR-1394) (Anders Melchiorsen) (yonik)
- Add offset corrections in PatternTokenizerFactory. [SOLR-1398](https://issues.apache.org/jira/browse/SOLR-1398) (Anders Melchiorsen) (koji)
- Properly handle zero-length tokens in TrimFilter. This was not a bug in any released version. [SOLR-1400](https://issues.apache.org/jira/browse/SOLR-1400) (Peter Wolanin) (gsingers)
- Fixed registry.jsp issue with MBeans [SOLR-1427](https://issues.apache.org/jira/browse/SOLR-1427) (gsingers)
- Add weblogic.xml to solr webapp to enable correct operation in WebLogic. [SOLR-1448](https://issues.apache.org/jira/browse/SOLR-1448) (Ilan Rabinovitch) (yonik)
- SolrJ's XML response parsing threw an exception for null names, such as those produced when facet.missing=true [SOLR-1468](https://issues.apache.org/jira/browse/SOLR-1468) (yonik)
- Fixed issue with calculating missing values for facets in single valued cases in Stats Component. This is not correctly calculated for the multivalued case. [SOLR-1471](https://issues.apache.org/jira/browse/SOLR-1471) (James Miller) (gsingers)
- Fixed omitHeader parameter for PHP ResponseWriter. [SOLR-1481](https://issues.apache.org/jira/browse/SOLR-1481) (Jun Ohtani) (billa)
- empty char mapping can cause ArrayIndexOutOfBoundsException in analysis.jsp and co. [SOLR-1504](https://issues.apache.org/jira/browse/SOLR-1504) (koji)
- Admin pages could stall waiting for localhost name resolution if reverse DNS wasn't configured; this was changed so the DNS resolution is attempted only once the first time an admin page is loaded. [SOLR-1517](https://issues.apache.org/jira/browse/SOLR-1517) (hossman)
- More than 8 deleteByQuery commands in a single request caused an error to be returned, although the deletes were still executed. [SOLR-1529](https://issues.apache.org/jira/browse/SOLR-1529) (asmodean) (yonik)
- Use perl regex to improve accuracy of finding latest snapshot in snapinstaller [SOLR-346](https://issues.apache.org/jira/browse/SOLR-346) (billa)
- WordDelimiterFilter now respects payloads and other attributes of the original Token by using Token.clone() [SOLR-532](https://issues.apache.org/jira/browse/SOLR-532) (Tricia Williams) (gsingers)
- Add synchronization to avoid race condition of multiple DIH imports working concurrently [SOLR-728](https://issues.apache.org/jira/browse/SOLR-728) (Walter Ferrara) (shalin)
- Add ability to create dynamic fields with custom DataImportHandler transformers [SOLR-742](https://issues.apache.org/jira/browse/SOLR-742) (Wojtek Piaseczny) (Noble Paul) (shalin)
- WordDelimiterFilter didn't adjust the start offset of single tokens that started with delimiters, leading to incorrect highlighting. [SOLR-751](https://issues.apache.org/jira/browse/SOLR-751) (Stefan Oestreicher) (yonik)
- CoreAdminHandler STATUS should display 'normalized' paths [SOLR-771](https://issues.apache.org/jira/browse/SOLR-771) (koji) (hossman) (shalin)
- Fixed logging level display [SOLR-774](https://issues.apache.org/jira/browse/SOLR-774) (Sean Timm) (Otis Gospodnetic)
- Deep copy collections to avoid ConcurrentModificationException in XPathEntityprocessor while streaming [SOLR-800](https://issues.apache.org/jira/browse/SOLR-800) (Kyle Morrison) (Noble Paul) (shalin)
- Fix a potential null pointer error in the distributed FacetComponent [SOLR-802](https://issues.apache.org/jira/browse/SOLR-802) (David Bowen) (ryan)
- CoreAdminRequest.createCore fails because name parameter isn't set [SOLR-803](https://issues.apache.org/jira/browse/SOLR-803) (Sean Colombo) (ryan)
- DisMax queries are not being cached in QueryResultCache [SOLR-805](https://issues.apache.org/jira/browse/SOLR-805) (Todd Feak) (koji)
- BinaryResponseWriter writes fieldType.toExternal if it is not a supported type, otherwise it writes fieldType.toObject. This fixes the bug with encoding/decoding UUIDField. [SOLR-807](https://issues.apache.org/jira/browse/SOLR-807) (koji) (Noble Paul) (shalin)
- Request parameter variables ${dataimporter.request.xxx} are not resolved in DIH [SOLR-823](https://issues.apache.org/jira/browse/SOLR-823) (Mck SembWever) (Noble Paul) (shalin)
- Enables highlighting for range/wildcard/fuzzy/prefix queries if using hl.usePhraseHighlighter=true and hl.highlightMultiTerm=true. Also make both options default to true. [SOLR-825](https://issues.apache.org/jira/browse/SOLR-825) [SOLR-1221](https://issues.apache.org/jira/browse/SOLR-1221) (Mark Miller) (yonik)
- Use perl regex to improve accuracy of finding latest snapshot in snappuller [SOLR-830](https://issues.apache.org/jira/browse/SOLR-830) (billa)
- Rows parameter is not honored in DIH non-debug mode and can abort a running import in debug mode. [SOLR-832](https://issues.apache.org/jira/browse/SOLR-832) (Akshay Ukey) (shalin)
- Add missing "a" to the example stopwords.txt [SOLR-836](https://issues.apache.org/jira/browse/SOLR-836) (yonik)
- The DIH VariableResolver obtained from a DataSource's context does not have current data. [SOLR-838](https://issues.apache.org/jira/browse/SOLR-838) (Noble Paul) (shalin)
- BinaryResponseWriter does not handle incompatible data in fields [SOLR-840](https://issues.apache.org/jira/browse/SOLR-840) (Noble Paul) (shalin)
- DataImportHandler should throw exception if a field does not have column attribute [SOLR-841](https://issues.apache.org/jira/browse/SOLR-841) (Michael Henson) (shalin)
- SynonymFilterFactory cannot handle multiple synonym files correctly [SOLR-843](https://issues.apache.org/jira/browse/SOLR-843) (koji)
- SolrCore.initIndex should close the directory it gets for clearing the lock and use the DirectoryFactory. [SOLR-863](https://issues.apache.org/jira/browse/SOLR-863) (Mark Miller) (shalin)
- DataImportHandler does not catch and log Errors [SOLR-864](https://issues.apache.org/jira/browse/SOLR-864) (shalin)
- Fix file descriptor leak in SolrResourceLoader#getLines [SOLR-869](https://issues.apache.org/jira/browse/SOLR-869) (Mark Miller) (shalin)
- Better error message for incorrect copyField destination [SOLR-872](https://issues.apache.org/jira/browse/SOLR-872) (Noble Paul) (shalin)
- Fix case-sensitive field names and columns [SOLR-873](https://issues.apache.org/jira/browse/SOLR-873) (Jon Baer) (shalin)
- Enable position increments in the query parser and fix the example schema to enable position increments for the stop filter in both the index and query analyzers to fix the bug with phrase queries with stopwords. [SOLR-879](https://issues.apache.org/jira/browse/SOLR-879) (yonik)
- Implicit properties are not set for Cores created through CoreAdmin [SOLR-883](https://issues.apache.org/jira/browse/SOLR-883) (Noble Paul) (shalin)
- CachedSqlEntityProcessor should check if the cache key is present in the query results [SOLR-884](https://issues.apache.org/jira/browse/SOLR-884) (Noble Paul) (shalin)
- DIH DateFormatTransformer cannot convert non-string type [SOLR-888](https://issues.apache.org/jira/browse/SOLR-888) (Amit Nithian) (shalin)
- Fix serialization of booleans for PHPSerializedResponseWriter [SOLR-892](https://issues.apache.org/jira/browse/SOLR-892) (yonik)
- Unable to delete documents via SQL and deletedPkQuery with deltaimport [SOLR-893](https://issues.apache.org/jira/browse/SOLR-893) (Dan Rosher) (shalin)
- Fixed Argument list too long error when there are lots of snapshots/backups [SOLR-897](https://issues.apache.org/jira/browse/SOLR-897) (Dan Rosher) (billa)
- Fix null pointer exception for the JSON response writer based formats when nl.json=arrarr with null keys. [SOLR-898](https://issues.apache.org/jira/browse/SOLR-898) (yonik)
- FastOutputStream ignores write(byte[]) call. [SOLR-901](https://issues.apache.org/jira/browse/SOLR-901) (Noble Paul) (shalin)
- FastInputStream#read(byte b[], int off, int len) gives incorrect results when amount left to read is less than buffer size [SOLR-902](https://issues.apache.org/jira/browse/SOLR-902) (Noble Paul) (shalin)
- General finalize() improvements. No finalizer delegates to the respective close/destroy method w/o first checking if it's already been closed/destroyed; if it hasn't a, SEVERE error is logged first. [SOLR-914](https://issues.apache.org/jira/browse/SOLR-914) (noble) (hossman)
- Fixed highlighting on fields with multiValued="true" and termOffsets="true" [SOLR-925](https://issues.apache.org/jira/browse/SOLR-925) (koji)
- LukeRequestHandler should return "dynamicBase" only if the field is dynamic. [SOLR-929](https://issues.apache.org/jira/browse/SOLR-929) (Peter Wolanin) (koji)
- Better error message when &lt;pingQuery&gt; is not configured. [SOLR-965](https://issues.apache.org/jira/browse/SOLR-965) (Mark Miller) (hossman)
- deleteByQuery is ignored when deleteById is placed prior to deleteByQuery in a &lt;delete&gt;. Now both delete by id and delete by query can be specified at the same time as follows. &lt;delete&gt; &lt;id&gt;05991&lt;/id&gt;&lt;id&gt;06000&lt;/id&gt; &lt;query&gt;office:Bridgewater&lt;/query&gt;&lt;query&gt;office:Osaka&lt;/query&gt; &lt;/delete&gt; [SOLR-976](https://issues.apache.org/jira/browse/SOLR-976) (koji)
- Old files are not removed from slaves after replication [SOLR-978](https://issues.apache.org/jira/browse/SOLR-978) (Jaco) (Noble Paul) (shalin)
- Fix thread-safety issue with DIH TemplateString for concurrent imports with multiple cores. [SOLR-985](https://issues.apache.org/jira/browse/SOLR-985) (Ryuuichi Kumai) (shalin)
- Better error message when parsing solrconfig.xml fails due to malformed XML. Error message notes the name of the file being parsed. [SOLR-991](https://issues.apache.org/jira/browse/SOLR-991) (Michael Henson) (shalin)
- DIH XPathRecordReader fails on XMLs with nodes mixed with CDATA content. [SOLR-999](https://issues.apache.org/jira/browse/SOLR-999) (Fergus McMenemie) (Noble Paul) (shalin)

### Other (74 changes)

- Upgraded to Lucene 2.9-dev r794238. Other changes include: - LUCENE-1614 - Use Lucene's DocIdSetIterator.NO_MORE_DOCS as the sentinel value. - LUCENE-1630 - Add acceptsDocsOutOfOrder method to Collector implementations. - LUCENE-1673, LUCENE-1701 - Trie has moved to Lucene core and renamed to NumericRangeQuery. - LUCENE-1662, LUCENE-1687 - Replace usage of ExtendedFieldCache by FieldCache. [LUCENE-1614](https://issues.apache.org/jira/browse/LUCENE-1614) [LUCENE-1630](https://issues.apache.org/jira/browse/LUCENE-1630) [LUCENE-1673](https://issues.apache.org/jira/browse/LUCENE-1673) [LUCENE-1701](https://issues.apache.org/jira/browse/LUCENE-1701) [LUCENE-1662](https://issues.apache.org/jira/browse/LUCENE-1662) [LUCENE-1687](https://issues.apache.org/jira/browse/LUCENE-1687) (shalin)
- Better "ignored" field in example schema.xml [SOLR-1022](https://issues.apache.org/jira/browse/SOLR-1022) (Peter Wolanin) (hossman)
- DIH: Alias the 'dataimporter' namespace to a shorter name 'dih'. [SOLR-1027](https://issues.apache.org/jira/browse/SOLR-1027) (Noble Paul) (shalin)
- DIH: Standardize Evaluator parameter parsing and added helper functions for parsing all evaluator parameters in a standard way. [SOLR-1029](https://issues.apache.org/jira/browse/SOLR-1029) (Noble Paul) (shalin)
- Change default QParser from "lucenePlusSort" to "lucene" to reduce confusion of semicolon splitting behavior when no sort param is specified [SOLR-1036](https://issues.apache.org/jira/browse/SOLR-1036) (hossman)
- Fix dist-src target for DataImportHandler [SOLR-1054](https://issues.apache.org/jira/browse/SOLR-1054) (Ryuuichi Kumai) (shalin)
- Use fsync on replicated index and configuration files [SOLR-1068](https://issues.apache.org/jira/browse/SOLR-1068) (yonik) (Noble Paul) (shalin)
- Upgrade to Tika 0.3. See http://www.apache.org/dist/lucene/tika/CHANGES-0.3.txt [SOLR-1075](https://issues.apache.org/jira/browse/SOLR-1075) (gsingers)
- Rename omitTf to omitTermFreqAndPositions [SOLR-1079](https://issues.apache.org/jira/browse/SOLR-1079) (shalin)
- Change DIH EventListener to be an interface so that components such as an EntityProcessor or a Transformer can act as an event listener. [SOLR-1081](https://issues.apache.org/jira/browse/SOLR-1081) (Noble Paul) (shalin)
- Better error reporting when DIH entity name is a reserved word and data-config.xml root node is not &lt;dataConfig&gt;. [SOLR-1084](https://issues.apache.org/jira/browse/SOLR-1084) (Noble Paul) (shalin)
- Deprecate 'where' attribute in CachedSqlEntityProcessor in favor of cacheKey and cacheLookup. [SOLR-1087](https://issues.apache.org/jira/browse/SOLR-1087) (Noble Paul) (shalin)
- Simplified DIH EntityProcessor API by moving logic for applying transformers and handling multi-row outputs from Transformers into an EntityProcessorWrapper class. The behavior of the method EntityProcessor#destroy has been modified to be called once per parent-row at the end of row. A new method EntityProcessor#close is added which is called at the end of import. A new method Context#getResolvedEntityAttribute is added which returns the resolved value of an entity's attribute. Introduced a DocWrapper which takes care of maintaining document level session variables. [SOLR-1120](https://issues.apache.org/jira/browse/SOLR-1120) (Noble Paul) (shalin)
- Made QParserPlugin and related classes extendible as an experimental API. [SOLR-1149](https://issues.apache.org/jira/browse/SOLR-1149) (Kaktu Chakarabati) (shalin)
- add dynamic copy field and maxChars example to example schema.xml. [SOLR-1151](https://issues.apache.org/jira/browse/SOLR-1151) (Peter Wolanin) (Mark Miller)
- Add option in solrconfig to open a new IndexReader rather than using reopen. Done mainly as a fail-safe in the case that a user runs into a reopen bug/issue. [SOLR-1184](https://issues.apache.org/jira/browse/SOLR-1184) (Mark Miller)
- use double quotes to enclose attributes in solr.xml [SOLR-1215](https://issues.apache.org/jira/browse/SOLR-1215) (noble)
- Added proxy.setup target [SOLR-1219](https://issues.apache.org/jira/browse/SOLR-1219) (koji)
- remove /select?qt=/whatever restriction on /-prefixed request handlers. [SOLR-1233](https://issues.apache.org/jira/browse/SOLR-1233) (ehatcher)
- Solr's CharFilter has been moved to Lucene. Remove CharFilter and related classes from Solr and use Lucene's corresponding code [SOLR-1241](https://issues.apache.org/jira/browse/SOLR-1241) (koji) (shalin)
- logging.jsp has been removed and now passes through to the hierarchical log level tool added in Solr 1.3. Users still hitting "/admin/logging.jsp" should switch to "/admin/logging". [SOLR-1257](https://issues.apache.org/jira/browse/SOLR-1257) (hossman)
- Lucene trunk renamed RangeQuery & Co to TermRangeQuery [SOLR-1261](https://issues.apache.org/jira/browse/SOLR-1261) (Uwe Schindler) (shalin)
- Add DIH variable resolving for URLDataSource properties like baseUrl. [SOLR-1265](https://issues.apache.org/jira/browse/SOLR-1265) (Chris Eldredge) (ehatcher)
- Better error messages from DIH JdbcDataSource when JDBC Driver name or SQL is incorrect. [SOLR-1269](https://issues.apache.org/jira/browse/SOLR-1269) (ehatcher) (shalin)
- Added StatsComponentTest [SOLR-1276](https://issues.apache.org/jira/browse/SOLR-1276) (Rafał Kuć) (gsingers)
- Upgrade to Tika 0.4. Note there are some differences in detecting Languages now in extracting request handler. See http://www.lucidimagination.com/search/document/d6f1899a85b2a45c/vote_apache_tika_0_4_release_candidate_2#d6f1899a85b2a45c for discussion on language detection. See http://www.apache.org/dist/lucene/tika/CHANGES-0.4.txt. [SOLR-1310](https://issues.apache.org/jira/browse/SOLR-1310) (gsingers)
- Upgrade Solr Highlighter classes to new Lucene Highlighter API. This upgrade has resulted in a back compat break in the DefaultSolrHighlighter class - getQueryScorer is no longer protected. If you happened to be overriding that method in custom code, overide getHighlighter instead. Also, HighlightingUtils#getQueryScorer has been removed as it was deprecated and backcompat has been broken with it anyway. [SOLR-1319](https://issues.apache.org/jira/browse/SOLR-1319) [SOLR-1345](https://issues.apache.org/jira/browse/SOLR-1345) (Mark Miller)
- SolrInputDocument cannot process dynamic fields [SOLR-1357](https://issues.apache.org/jira/browse/SOLR-1357) (Lars Grote) (noble)
- Add HSQLDB Jar to example-DIH, unzip database and update instructions. [SOLR-1369](https://issues.apache.org/jira/browse/SOLR-1369) 
- The TokenizerFactory API has changed to explicitly return a Tokenizer rather then a TokenStream (that may be or may not be a Tokenizer). This change is required to take advantage of the Token reuse improvements in lucene 2.9. [SOLR-1377](https://issues.apache.org/jira/browse/SOLR-1377) (ryan)
- In build.xml, use longfile="gnu" in tar task to avoid warnings about long file names [SOLR-1386](https://issues.apache.org/jira/browse/SOLR-1386) (Mark Miller) (shalin)
- Added Solr Powered By Logos [SOLR-1409](https://issues.apache.org/jira/browse/SOLR-1409) 
- Log a warning if the deprecated charset option is used on GreekLowerCaseFilterFactory, RussianStemFilterFactory, RussianLowerCaseFilterFactory or RussianLetterTokenizerFactory. [SOLR-1410](https://issues.apache.org/jira/browse/SOLR-1410) (Robert Muir) (hossman)
- Due to LUCENE-1906, Solr's tokenizer should use Tokenizer.correctOffset() instead of CharStream.correctOffset(). [SOLR-1423](https://issues.apache.org/jira/browse/SOLR-1423) [LUCENE-1906](https://issues.apache.org/jira/browse/LUCENE-1906) (Uwe Schindler) (koji)
- Make it possible to run all tests in a package [SOLR-1441](https://issues.apache.org/jira/browse/SOLR-1441) (shalin)
- Add equals and hashCode methods to NamedList [SOLR-458](https://issues.apache.org/jira/browse/SOLR-458) (Stefan Rinner) (shalin)
- Upgraded to Lucene 2.9-dev (r719351) [SOLR-465](https://issues.apache.org/jira/browse/SOLR-465) (shalin)
- FacetComponent helper classes are made public as an experimental API. [SOLR-748](https://issues.apache.org/jira/browse/SOLR-748) (Wojtek Piaseczny) (shalin)
- Added in ability to sign artifacts via Ant for releases [SOLR-776](https://issues.apache.org/jira/browse/SOLR-776) (gsingers)
- DIH: Refactored SolrWriter to make it a concrete class and removed wrappers over SolrInputDocument. Refactored to load Evaluators lazily. Removed multiple document nodes in the configuration xml. Removed support for 'default' variables, they are automatically available as request parameters. [SOLR-782](https://issues.apache.org/jira/browse/SOLR-782) (Noble Paul) (shalin)
- Refactor DisMaxQParser to allow overriding certain features of DisMaxQParser [SOLR-786](https://issues.apache.org/jira/browse/SOLR-786) (Wojciech Biela) (shalin)
- The javadoc of RandomSortField is not readable [SOLR-789](https://issues.apache.org/jira/browse/SOLR-789) (Nicolas Lalevée) (koji)
- Added Lucene's misc contrib JAR (rev 764281). [SOLR-804](https://issues.apache.org/jira/browse/SOLR-804) (gsingers)
- Upgraded to Lucene 2.9-dev (r707499) [SOLR-805](https://issues.apache.org/jira/browse/SOLR-805) (koji)
- Upgraded to Lucene 2.9-dev (r724059) to get access to Arabic public constructors [SOLR-819](https://issues.apache.org/jira/browse/SOLR-819) (gsingers)
- Use new Solr logo in admin [SOLR-84](https://issues.apache.org/jira/browse/SOLR-84) (Michiel) (koji)
- Refactored common code in CSVRequestHandler and XMLUpdateRequestHandler [SOLR-852](https://issues.apache.org/jira/browse/SOLR-852) (gsingers) (ehatcher)
- Added run-example target [SOLR-854](https://issues.apache.org/jira/browse/SOLR-854) (Mark Miller) (ehatcher)
- Removed dependency on stax-utils.jar. If you using solr.jar and running java 6, you can also remove woodstox and geronimo. [SOLR-871](https://issues.apache.org/jira/browse/SOLR-871) (ryan)
- Upgraded to Lucene 2.9-dev (r723985) and consolidated the BitSet implementations [SOLR-875](https://issues.apache.org/jira/browse/SOLR-875) (Michael Busch) (gsingers)
- NamedListCodec is renamed to JavaBinCodec and returns Object instead of NamedList. [SOLR-885](https://issues.apache.org/jira/browse/SOLR-885) (Noble Paul) (yonik) (shalin)
- Upgraded to commons-io-1.4.jar and commons-fileupload-1.2.1.jar [SOLR-889](https://issues.apache.org/jira/browse/SOLR-889) (ryan)
- Moved solrj into /src/solrj. The contents of solr-common.jar is now included in the solr-solrj.jar. [SOLR-900](https://issues.apache.org/jira/browse/SOLR-900) (ryan)
- Code cleanup: make all existing finalize() methods call super.finalize() in a finally block. All current instances extend Object, so this doesn't fix any bugs, but helps protect against future changes. [SOLR-924](https://issues.apache.org/jira/browse/SOLR-924) (Kay Kay) (hossman)
- Cleanup duplicated code in deprecated HighlightingUtils [SOLR-952](https://issues.apache.org/jira/browse/SOLR-952) (hossman)
- Refactored TestReplicationHandler to remove hardcoded port numbers [SOLR-959](https://issues.apache.org/jira/browse/SOLR-959) (hossman) (Akshay Ukey) (shalin)
- Note about null handling in ModifiableSolrParams.add javadoc [SOLR-962](https://issues.apache.org/jira/browse/SOLR-962) (Kay Kay) (hossman)
- DIH: XPathEntityProcessor now ignores DTD validations [SOLR-964](https://issues.apache.org/jira/browse/SOLR-964) (Fergus McMenemie) (Noble Paul) (shalin)
- New type-safe constructor for NamedList [SOLR-967](https://issues.apache.org/jira/browse/SOLR-967) (Kay Kay) (hossman)
- Change the FULL_DUMP, DELTA_DUMP, FIND_DELTA constants in DIH Context to String. Change Context.currentProcess() to return a string instead of an integer. [SOLR-969](https://issues.apache.org/jira/browse/SOLR-969) (Kay Kay) (Noble Paul) (shalin)
- groupId for Woodstox dependency in maven solrj changed to org.codehaus.woodstox [SOLR-981](https://issues.apache.org/jira/browse/SOLR-981) (Tim Taranov) (shalin)
- Wait for a longer time for slave to complete replication in TestReplicationHandler [SOLR-997](https://issues.apache.org/jira/browse/SOLR-997) (Mark Miller) (shalin)
- Upgraded to Lucene 2.4.0 (yonik)
- DumpRequestHandler (/debug/dump): changed 'fieldName' to 'sourceInfo'. (ehatcher)
- Upgraded to Lucene 2.9-dev r738218 (yonik)
- Upgraded to Lucene 2.9-dev r742220 (yonik)
- Upgraded to Lucene 2.9-dev r752164 (shalin)
- Upgraded to Lucene 2.9-dev r764281 (shalin)
- Upgraded to Lucene 2.9-dev r768228 (shalin)
- Upgraded to Lucene 2.9-dev r768336 (shalin)
- Upgraded to Lucene 2.9-dev 773862 (Mark Miller)
- Upgraded to Lucene 2.9-dev r776177 (shalin)
- Upgraded to Lucene 2.9-dev r779312 (yonik)
- Upgraded to Lucene 2.9-dev r801856 (Mark Miller)


[1.3.0] - 2008-09-16
--------------------

### Added (73 changes)

- Added RegexFragmenter, which splits text for highlighting based on a given pattern. [SOLR-102](https://issues.apache.org/jira/browse/SOLR-102) (klaas)
- Support binding dynamic fields to beans in SolrJ [SOLR-1129](https://issues.apache.org/jira/browse/SOLR-1129) (Avlesh Singh) (noble)
- HTTP Caching awareness. Solr now recognizes HTTP Request headers related to HTTP Caching (see RFC 2616 sec13) and will respond with "304 Not Modified" when appropriate. New options have been added to solrconfig.xml to influence this behavior. [SOLR-127](https://issues.apache.org/jira/browse/SOLR-127) (Thomas Peuss) (hossman)
- Added StaxUpdateRequestHandler that uses StAX for XML parsing. This implementation has much better error checking and lets you configure a custom UpdateRequestProcessor that can selectively process update requests depending on the request attributes. This class will likely replace XmlUpdateRequestHandler. [SOLR-133](https://issues.apache.org/jira/browse/SOLR-133) (Thorsten Scherler) (ryan)
- The UpdateRequestHandler now accepts multiple delete options within a single request. For example, sending: &lt;delete&gt;&lt;id&gt;1&lt;/id&gt;&lt;id&gt;2&lt;/id&gt;&lt;/delete&gt; will delete both 1 and 2. [SOLR-133](https://issues.apache.org/jira/browse/SOLR-133) (ryan)
- Add preserveOriginal flag to WordDelimiterFilter [SOLR-14](https://issues.apache.org/jira/browse/SOLR-14) (Geoffrey Young) (Trey Hyde) (Ankur Madnani) (yonik)
- Added RawResponseWriter and ShowFileRequestHandler. This returns config files directly. If AdminHandlers are configured, this will be added automatically. The jsp files /admin/get-file.jsp and /admin/raw-schema.jsp have been deprecated. The deprecated &lt;admin&gt;&lt;gettableFiles&gt; will be automatically registered with a ShowFileRequestHandler instance for backwards compatibility. [SOLR-142](https://issues.apache.org/jira/browse/SOLR-142) (ryan)
- Add detailed timing data to query response output. The SearchHandler interface now returns how long each section takes. [SOLR-176](https://issues.apache.org/jira/browse/SOLR-176) (klaas)
- Adding SolrDocument and SolrInputDocument to represent documents outside of the lucene Document infrastructure. This class will be used by clients and for processing documents. [SOLR-193](https://issues.apache.org/jira/browse/SOLR-193) (ryan)
- A PHP serialized "phps" response writer that returns a serialized array that can be used with the PHP function unserialize, and a PHP response writer "php" that may be used by eval. [SOLR-196](https://issues.apache.org/jira/browse/SOLR-196) (Nick Jenkin) (Paul Borgermans) (Pieter Berkel) (yonik)
- Added a java client interface with two implementations. One implementation uses commons httpclient to connect to solr via HTTP. The other connects to solr directly. Check client/java/solrj. This addition also includes tests that start jetty and test a connection using the full HTTP request cycle. [SOLR-20](https://issues.apache.org/jira/browse/SOLR-20) (Darren Erik Vengroff) (Will Johnson) (ryan)
- Enable pluggable highlighting classes. Allow configurable highlighting formatters and Fragmenters. [SOLR-225](https://issues.apache.org/jira/browse/SOLR-225) (ryan)
- New &lt;lockType&gt; configuration setting in &lt;mainIndex&gt; and &lt;indexDefaults&gt; blocks supports all Lucene builtin LockFactories. 'single' is recommended setting, but 'simple' is default for total backwards compatibility. [SOLR-240](https://issues.apache.org/jira/browse/SOLR-240) (Will Johnson) (hossman)
- Added ModifiableSolrParams - a SolrParams implementation that help you change values after initialization. [SOLR-244](https://issues.apache.org/jira/browse/SOLR-244) (ryan)
- Added CapitalizationFilterFactory that creates tokens with normalized capitalization. This filter is useful for facet display, but will not work with a prefix query. (ryan) SOLR-468: Change to the semantics to keep the original token, not the token in the Map. Also switched to use Lucene's new reusable token capabilities. [SOLR-248](https://issues.apache.org/jira/browse/SOLR-248) [SOLR-468](https://issues.apache.org/jira/browse/SOLR-468) (gsingers)
- Adding KeepWordFilter and KeepWordFilterFactory. A TokenFilter that keeps tokens with text in the registered keeplist. This behaves like the inverse of StopFilter. [SOLR-253](https://issues.apache.org/jira/browse/SOLR-253) (ryan)
- Support exposing Solr statistics through JMX [SOLR-256](https://issues.apache.org/jira/browse/SOLR-256) (Sharad Agrawal) (shalin)
- WordDelimiterFilter has a new parameter splitOnCaseChange, which can be set to 0 to disable splitting "PowerShot" =&gt; "Power" "Shot". [SOLR-257](https://issues.apache.org/jira/browse/SOLR-257) (klaas)
- Date Faceting added to SimpleFacets. Facet counts computed for ranges of size facet.date.gap (a DateMath expression) between facet.date.start and facet.date.end. [SOLR-258](https://issues.apache.org/jira/browse/SOLR-258) (hossman)
- Converting to a standard PluginLoader framework. This reworks RequestHandlers, FieldTypes, and QueryResponseWriters to share the same base code for loading and initializing plugins. This adds a new configuration option to define the default RequestHandler and QueryResponseWriter in XML using default="true". [SOLR-260](https://issues.apache.org/jira/browse/SOLR-260) (ryan)
- Added RandomSortField, a utility field with a random sort order. The seed is based on a hash of the field name, so a dynamic field of this type is useful for generating different random sequences. This field type should only be used for sorting or as a value source in a FunctionQuery [SOLR-264](https://issues.apache.org/jira/browse/SOLR-264) (ryan) (hossman) (yonik)
- Adding show=schema to LukeRequestHandler to show the parsed schema fields and field types. [SOLR-266](https://issues.apache.org/jira/browse/SOLR-266) (ryan)
- Added UpdateRequestProcessor plugin framework. This provides a reasonable place to process documents after they are parsed and before they are committed to the index. This is a good place for custom document manipulation or document based authorization. [SOLR-269](https://issues.apache.org/jira/browse/SOLR-269) (yonik) (ryan)
- /376/452/516: Added hl.maxAnalyzedChars highlighting parameter, defaulting to 50k, hl.alternateField, which allows the specification of a backup field to use as summary if no keywords are matched, and hl.mergeContiguous, which combines fragments if they are adjacent in the source document. [SOLR-273](https://issues.apache.org/jira/browse/SOLR-273) (klaas) (Grant Ingersoll) (Koji Sekiguchi) (klaas)
- Added a 'Search Component' interface and converted StandardRequestHandler and DisMaxRequestHandler to use this framework. [SOLR-281](https://issues.apache.org/jira/browse/SOLR-281) (Sharad Agarwal) (Henri Biestro) (yonik) (ryan)
- Control maximum number of documents to cache for any entry in the queryResultCache via queryResultMaxDocsCached solrconfig.xml entry. [SOLR-291](https://issues.apache.org/jira/browse/SOLR-291) (Koji Sekiguchi) (yonik)
- Distributed Search over HTTP. Specification of shards argument causes Solr to query those shards and merge the results into a single response. Querying, field faceting (sorted only), query faceting, highlighting, and debug information are supported in distributed mode. [SOLR-303](https://issues.apache.org/jira/browse/SOLR-303) (Sharad Agarwal) (Patrick O'Leary) (Sabyasachi Dalal) (Stu Hood) (Jayson Minard) (Lars Kotthoff) (ryan) (yonik)
- analysis.jsp can be given a fieldtype instead of a field name. [SOLR-305](https://issues.apache.org/jira/browse/SOLR-305) (hossman)
- Added NGramFilterFactory and EdgeNGramFilterFactory. [SOLR-307](https://issues.apache.org/jira/browse/SOLR-307) (Thomas Peuss) (Otis Gospodnetic)
- A new UUIDField class which accepts UUID string values, as well as the special value of "NEW" which triggers generation of a new random UUID. [SOLR-308](https://issues.apache.org/jira/browse/SOLR-308) (Thomas Peuss) (hossman)
- Changed SynonymFilterFactory to "tokenize" synonyms file. To use a tokenizer, specify "tokenizerFactory" attribute in &lt;filter&gt;. For example: &lt;tokenizer class="solr.CJKTokenizerFactory"/&gt; &lt;filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" expand="true" ignoreCase="true" tokenizerFactory="solr.CJKTokenizerFactory"/&gt; [SOLR-319](https://issues.apache.org/jira/browse/SOLR-319) (koji)
- Pluggable query parsers. Allows specification of query type and arguments as a prefix on a query string. [SOLR-334](https://issues.apache.org/jira/browse/SOLR-334) (yonik)
- New FunctionQuery functions: sum, product, div, pow, log, sqrt, abs, scale, map. Constants may now be used as a value source. [SOLR-349](https://issues.apache.org/jira/browse/SOLR-349) (yonik)
- Support multiple SolrCores running in the same solr instance and allows runtime runtime management for any running SolrCore. If a solr.xml file exists in solr.home, this file is used to instanciate multiple cores and enables runtime core manipulation. For more informaion see: http://wiki.apache.org/solr/CoreAdmin [SOLR-350](https://issues.apache.org/jira/browse/SOLR-350) (Henri Biestro) (ryan)
- External Value Source. An external file may be used to specify the values of a field, currently usable as a ValueSource in a FunctionQuery. [SOLR-351](https://issues.apache.org/jira/browse/SOLR-351) (yonik)
- Pluggable functions (value sources) that allow registration of new functions via solrconfig.xml [SOLR-356](https://issues.apache.org/jira/browse/SOLR-356) (Doug Daniels) (yonik)
- Add field type className to Luke response, and enabled access to the detailed field information from the solrj client API. [SOLR-359](https://issues.apache.org/jira/browse/SOLR-359) (Grant Ingersoll) (ehatcher)
- Many new features for the spell checker implementation, including an extended response mode with much richer output, multi-word spell checking, and a bevy of new and renamed options (see the wiki). [SOLR-395](https://issues.apache.org/jira/browse/SOLR-395) (Mike Krimerman) (Scott Taber) (klaas)
- Added PingRequestHandler and deprecated SolrCore.getPingQueryRequest(). Ping requests should be configured using standard RequestHandler syntax in solrconfig.xml rather then using the &lt;pingQuery&gt;&lt;/pingQuery&gt; syntax. [SOLR-408](https://issues.apache.org/jira/browse/SOLR-408) (Karsten Sperling) (ryan)
- Plugin initialization now supports SolrCore and ResourceLoader "Aware" plugins. Plugins that implement SolrCoreAware or ResourceLoaderAware are informed about the SolrCore/ResourceLoader. [SOLR-414](https://issues.apache.org/jira/browse/SOLR-414) (Henri Biestro) (ryan)
- Adding a query elevation component. This is an optional component to elevate some documents to the top positions (or exclude them) for a given query. [SOLR-418](https://issues.apache.org/jira/browse/SOLR-418) (ryan)
- Added Request Handler close hook notification so that RequestHandlers can be notified when a core is closing. [SOLR-423](https://issues.apache.org/jira/browse/SOLR-423) (gsingers) (ryan)
- TextResponseWriter can write SolrDocuments and SolrDocumentLists the same way it writes Document and DocList. [SOLR-446](https://issues.apache.org/jira/browse/SOLR-446) (yonik) (ryan)
- Added an single request handler that will automatically register all standard admin request handlers. This replaces the need to register (and maintain) the set of admin request handlers. Assuming solrconfig.xml includes: &lt;requestHandler name="/admin/" class="org.apache.solr.handler.admin.AdminHandlers" /&gt; This will register: Luke/SystemInfo/PluginInfo/ThreadDump/PropertiesRequestHandler. [SOLR-447](https://issues.apache.org/jira/browse/SOLR-447) (ryan)
- Added DataImportHandler as a contrib project which makes indexing data from Databases, XML files and HTTP data sources into Solr quick and easy. Includes API and implementations for supporting multiple data sources, processors and transformers for importing data. Supports full data imports as well as incremental (delta) indexing. See http://wiki.apache.org/solr/DataImportHandler for more details. [SOLR-469](https://issues.apache.org/jira/browse/SOLR-469) (Noble Paul) (shalin)
- Added ability to get back unique key information from the LukeRequestHandler. [SOLR-478](https://issues.apache.org/jira/browse/SOLR-478) (gsingers)
- Add byte/short sorting support [SOLR-483](https://issues.apache.org/jira/browse/SOLR-483) (gsingers)
- Binary response format, faster and smaller than XML and JSON response formats (use wt=javabin). BinaryResponseParser for utilizing the binary format via SolrJ and is now the default. [SOLR-486](https://issues.apache.org/jira/browse/SOLR-486) (Noble Paul) (yonik)
- Added cool admin Ajaxed schema explorer. [SOLR-494](https://issues.apache.org/jira/browse/SOLR-494) (Greg Ludington) (ehatcher)
- Added date faceting to the QueryResponse in SolrJ and QueryResponseTest [SOLR-497](https://issues.apache.org/jira/browse/SOLR-497) (Shalin Shekhar Mangar) (gsingers)
- Add search timeout support. [SOLR-502](https://issues.apache.org/jira/browse/SOLR-502) (Sean Timm) (yonik)
- Emitting HTTP Cache headers can be enabled or disabled through configuration on a per-handler basis [SOLR-506](https://issues.apache.org/jira/browse/SOLR-506) (shalin)
- Added SimilarityFactory capability to schema.xml, making config file parameters usable in the construction of the global Lucene Similarity implementation. [SOLR-515](https://issues.apache.org/jira/browse/SOLR-515) (ehatcher)
- Added hl.maxAlternateFieldLength parameter, to set max length for hl.alternateField [SOLR-516](https://issues.apache.org/jira/browse/SOLR-516) (Koji Sekiguchi) (klaas)
- StopFilterFactory support for "enablePositionIncrements" [SOLR-521](https://issues.apache.org/jira/browse/SOLR-521) (Walter Ferrara) (hossman)
- Make analysis.jsp show payloads. [SOLR-522](https://issues.apache.org/jira/browse/SOLR-522) (Tricia Williams) (yonik)
- Add a DocumentObjectBinder to solrj that converts Objects to and from SolrDocuments. [SOLR-536](https://issues.apache.org/jira/browse/SOLR-536) (Noble Paul) (ryan)
- Hierarchical JDK log level selector for SOLR Admin replaces logging.jsp [SOLR-554](https://issues.apache.org/jira/browse/SOLR-554) (Sean Timm) (shalin)
- Added SolrCore.getSearchComponents() to return an unmodifiable Map. [SOLR-557](https://issues.apache.org/jira/browse/SOLR-557) (gsingers)
- Added SpellCheckComponent and org.apache.solr.spelling package to support more spell checking functionality. Also includes ability to add your own SolrSpellChecker implementation that plugs in. See http://wiki.apache.org/solr/SpellCheckComponent for more details [SOLR-572](https://issues.apache.org/jira/browse/SOLR-572) (Shalin Shekhar Mangar) (Bojan Smid) (gsingers)
- Add support for Field level boosting in the MoreLikeThis Handler. [SOLR-595](https://issues.apache.org/jira/browse/SOLR-595) (Tom Morton) (gsingers)
- Added ability to partially optimize. [SOLR-603](https://issues.apache.org/jira/browse/SOLR-603) (gsingers)
- Add the ability to register callbacks programatically [SOLR-605](https://issues.apache.org/jira/browse/SOLR-605) (ryan) (Noble Paul)
- hl.maxAnalyzedChars can be -1 to highlight everything [SOLR-610](https://issues.apache.org/jira/browse/SOLR-610) (Lars Kotthoff) (klaas)
- Expose sort_values returned by QueryComponent in SolrJ's QueryResponse [SOLR-611](https://issues.apache.org/jira/browse/SOLR-611) (Dan Rosher) (shalin)
- SpellCheckComponent supports auto-loading indices on startup and optionally, (re)builds indices on newSearcher event, if configured in solrconfig.xml [SOLR-622](https://issues.apache.org/jira/browse/SOLR-622) (shalin)
- Allow multiple files for stopwords, keepwords, protwords and synonyms [SOLR-663](https://issues.apache.org/jira/browse/SOLR-663) (Otis Gospodnetic) (shalin)
- Expose warmup time in statistics for SolrIndexSearcher and LRUCache [SOLR-666](https://issues.apache.org/jira/browse/SOLR-666) (shalin)
- Added accessor methods to Lucene based spell checkers [SOLR-679](https://issues.apache.org/jira/browse/SOLR-679) (gsingers)
- Adding MoreLikeThisHandler to search for similar documents using lucene contrib/queries MoreLikeThis. MoreLikeThis is also available from the StandardRequestHandler using ?mlt=true. [SOLR-69](https://issues.apache.org/jira/browse/SOLR-69) (bdelacretaz) (ryan)
- DIH: Allow configurable locales through a locale attribute in fields for NumberFormatTransformer. [SOLR-700](https://issues.apache.org/jira/browse/SOLR-700) (Stefan Oestreicher) (shalin)
- Added support for properties in configuration files. Properties can be specified in solr.xml and can be used in solrconfig.xml and schema.xml [SOLR-716](https://issues.apache.org/jira/browse/SOLR-716) (Henri Biestro) (hossman) (ryan) (shalin)
- Cache and reuse IndexSchema . A new attribute added in solr.xml called 'shareSchema' [SOLR-920](https://issues.apache.org/jira/browse/SOLR-920) (noble)

### Changed (10 changes)

- improve JSON writer speed. [SOLR-276](https://issues.apache.org/jira/browse/SOLR-276) (yonik)
- bound and reduce memory usage by providing &lt;maxBufferedDeletes&gt; parameter, which flushes deleted without forcing the user to use &lt;commit/&gt; for this purpose. [SOLR-310](https://issues.apache.org/jira/browse/SOLR-310) (klaas)
- Converted TokenStreams to use Lucene's new char array based capabilities. [SOLR-330](https://issues.apache.org/jira/browse/SOLR-330) (gsingers)
- Added support into the SolrIndexWriter for using several new features of the new LuceneIndexWriter, including: setRAMBufferSizeMB(), setMergePolicy(), setMergeScheduler. Also, added support to specify Lucene's autoCommit functionality (not to be confused with Solr's similarily named autoCommit functionality) via the &lt;luceneAutoCommit&gt; config. item. See the test and example solrconfig.xml &lt;indexDefaults&gt; section for usage. Performance during indexing should be significantly increased by moving up to 2.3 due to Lucene's new indexing capabilities. Furthermore, the setRAMBufferSizeMB makes it more logical to decide on tuning factors related to indexing. For best performance, leave the mergePolicy and mergeScheduler as the defaults and set ramBufferSizeMB instead of maxBufferedDocs. The best value for this depends on the types of documents in use. 32 should be a good starting point, but reports have shown up to 48 MB provides good results. Note, it is acceptable to set both ramBufferSizeMB and maxBufferedDocs, and Lucene will flush based on whichever limit is reached first. [SOLR-342](https://issues.apache.org/jira/browse/SOLR-342) (gsingers)
- short-circuit faceting if less than mincount docs match. [SOLR-348](https://issues.apache.org/jira/browse/SOLR-348) (yonik)
- Optimize removing all documents. Now when a delete by query of *:* is issued, the current index is removed. [SOLR-354](https://issues.apache.org/jira/browse/SOLR-354) (yonik)
- Speed up response writers. [SOLR-377](https://issues.apache.org/jira/browse/SOLR-377) (yonik)
- Delete by Query performance greatly improved by using new underlying Lucene IndexWriter implementation. [SOLR-587](https://issues.apache.org/jira/browse/SOLR-587) (yonik)
- Only take snapshots if there are differences to the index [SOLR-624](https://issues.apache.org/jira/browse/SOLR-624) (Richard Trey Hyde) (gsingers)
- Use read-only IndexReaders that don't synchronize isDeleted(). This will speed up function queries and *:* queries as well as improve their scalability on multi-CPU systems. [SOLR-730](https://issues.apache.org/jira/browse/SOLR-730) (Mark Miller) (yonik)

### Fixed (53 changes)

- Snappuller - "date -d" and locales don't mix. [SOLR-136](https://issues.apache.org/jira/browse/SOLR-136) (Jürgen Hermann) (bill)
- Changed logging to report number of hits, and also provide a mechanism to add log messages to be output by the SolrCore via a NamedList toLog member variable. (Will Johnson, yseeley, gsingers) - SOLR-267: Removed adding values to the HTTP headers in SolrDispatchFilter [SOLR-267](https://issues.apache.org/jira/browse/SOLR-267) (gsingers)
- Snapshooter does not work on Solaris and OS X since the cp command there does not have the -l option. Also updated commit/optimize related scripts to handle both old and new response format. [SOLR-282](https://issues.apache.org/jira/browse/SOLR-282) (bill)
- autoCommit was not working after delete. [SOLR-283](https://issues.apache.org/jira/browse/SOLR-283) (ryan)
- ContentStreamBase was not using default encoding for getBytes() [SOLR-286](https://issues.apache.org/jira/browse/SOLR-286) (Toru Matsuzawa) (ryan)
- Fix MoreLikeThis facet counting. [SOLR-292](https://issues.apache.org/jira/browse/SOLR-292) (Pieter Berkel) (ryan)
- Logging of elapsed time broken on Solaris because the date command there does not support the %s output format. [SOLR-294](https://issues.apache.org/jira/browse/SOLR-294) (bill)
- Fix bug in RequiredSolrParams where requiring a field specific param would fail if a general default value had been supplied. [SOLR-297](https://issues.apache.org/jira/browse/SOLR-297) (hossman)
- Add proper support for Long and Doubles in sorting, etc. [SOLR-324](https://issues.apache.org/jira/browse/SOLR-324) (gsingers)
- Fix WordDelimiterFilter handling of offsets for synonyms or other injected tokens that can break highlighting. [SOLR-331](https://issues.apache.org/jira/browse/SOLR-331) (yonik)
- Changed distributiondump.jsp to use Solr HOME instead of CWD to set path. [SOLR-333](https://issues.apache.org/jira/browse/SOLR-333) 
- Removed duplicate contentType from raw-schema.jsp. [SOLR-393](https://issues.apache.org/jira/browse/SOLR-393) (bill)
- SolrExceptionTest should now handle using OpenDNS as a DNS provider [SOLR-400](https://issues.apache.org/jira/browse/SOLR-400) (gsingers)
- Requesting a large numbers of documents to be returned (limit) can result in an out-of-memory exception, even for a small index. [SOLR-413](https://issues.apache.org/jira/browse/SOLR-413) (yonik)
- HTMLStripReader tokenizers now preserve correct source offsets for highlighting. [SOLR-42](https://issues.apache.org/jira/browse/SOLR-42) (Grant Ingersoll) (yonik)
- SolrJ: Declare UTF-8 charset on POSTed parameters to avoid problems with servlet containers that default to latin-1 and allow switching of the exact POST mechanism for parameters via useMultiPartPost in CommonsHttpSolrServer. [SOLR-443](https://issues.apache.org/jira/browse/SOLR-443) (Lars Kotthoff) (Andrew Schurman) (ryan) (yonik)
- the python and ruby response writers are now able to correctly output NaN and Infinity in their respective languages. [SOLR-449](https://issues.apache.org/jira/browse/SOLR-449) (klaas)
- Multiple fixes to DateField regarding lenient parsing of optional milliseconds, and correct formating using the canonical representation. LegacyDateField has been added for people who have come to depend on the existing broken behavior. [SOLR-470](https://issues.apache.org/jira/browse/SOLR-470) [SOLR-552](https://issues.apache.org/jira/browse/SOLR-552) [SOLR-544](https://issues.apache.org/jira/browse/SOLR-544) [SOLR-701](https://issues.apache.org/jira/browse/SOLR-701) (hossman) (Stefan Oestreicher)
- Handle UnknownHostException in _info.jsp [SOLR-481](https://issues.apache.org/jira/browse/SOLR-481) (gsingers)
- Cache-Control max-age changed to Long so Expires calculation won't cause overflow. [SOLR-496](https://issues.apache.org/jira/browse/SOLR-496) (Thomas Peuss) (hossman)
- Fix admin/analysis.jsp UTF-8 input for some other servlet containers such as Tomcat. [SOLR-501](https://issues.apache.org/jira/browse/SOLR-501) (Hiroaki Kawai) (Lars Kotthoff) (yonik)
- Give RequestHandlers the possiblity to suppress the generation of HTTP caching headers. [SOLR-505](https://issues.apache.org/jira/browse/SOLR-505) (Thomas Peuss) (Otis Gospodnetic)
- Moved firstSearcher event notification to the end of the SolrCore constructor [SOLR-509](https://issues.apache.org/jira/browse/SOLR-509) (Koji Sekiguchi) (gsingers)
- Added explicit media-type with UTF* charset to *.xsl files that don't already have one. [SOLR-514](https://issues.apache.org/jira/browse/SOLR-514) (hossman)
- Better error message when defaultSearchField is bogus or not indexed. [SOLR-528](https://issues.apache.org/jira/browse/SOLR-528) (Lars Kotthoff) (hossman)
- Better error messages from SolrQueryParser when field isn't specified and there is no defaultSearchField in schema.xml [SOLR-529](https://issues.apache.org/jira/browse/SOLR-529) (Lars Kotthoff) (hossman)
- Better error messages/warnings when parsing schema.xml: field using bogus fieldtype and multiple copyFields to a non-multiValue field. [SOLR-530](https://issues.apache.org/jira/browse/SOLR-530) (Shalin Shekhar Mangar) (hossman)
- Fixed tests so they don't use hardcoded port numbers. [SOLR-533](https://issues.apache.org/jira/browse/SOLR-533) (hossman)
- Fixed typo (Tokenzied -&gt; Tokenized) in schema.jsp [SOLR-535](https://issues.apache.org/jira/browse/SOLR-535) (Thomas Peuss) (billa)
- Fix for non-atomic long counters and a cast fix to avoid divide by zero. [SOLR-539](https://issues.apache.org/jira/browse/SOLR-539) (Sean Timm) (Otis Gospodnetic)
- Legacy XML update support (provided by SolrUpdateServlet when no RequestHandler is mapped to "/update") now logs error correctly. [SOLR-541](https://issues.apache.org/jira/browse/SOLR-541) (hossman)
- Handle highlighting of phrase terms better when hl.usePhraseHighligher=true URL param is used. [SOLR-553](https://issues.apache.org/jira/browse/SOLR-553) (Bojan Smid) (Otis Gospodnetic)
- multi-valued fields always highlighted in disparate snippets [SOLR-556](https://issues.apache.org/jira/browse/SOLR-556) (Lars Kotthoff) (klaas)
- Make stats.jsp and stats.xsl more robust. [SOLR-584](https://issues.apache.org/jira/browse/SOLR-584) (Yousef Ourabi and hossman)
- Now sets the QParser on the ResponseBuilder [SOLR-585](https://issues.apache.org/jira/browse/SOLR-585) (gsingers)
- Improved handling of badly formated query strings [SOLR-589](https://issues.apache.org/jira/browse/SOLR-589) (Sean Timm) (Otis Gospodnetic)
- Limitation in pgrep on Linux platform breaks script-utils fixUser. [SOLR-590](https://issues.apache.org/jira/browse/SOLR-590) (Hannes Schmidt) (billa)
- SolrServlet no longer "caches" SolrCore. This was causing problems in Resin, and could potentially cause problems for customized usages of SolrServlet. [SOLR-597](https://issues.apache.org/jira/browse/SOLR-597) 
- DebugComponent now always occurs last in the SearchHandler list unless the components are explicitly declared. [SOLR-598](https://issues.apache.org/jira/browse/SOLR-598) (gsingers)
- If the spellchecking path is relative, make it relative to the Solr Data Directory. [SOLR-604](https://issues.apache.org/jira/browse/SOLR-604) (Shalin Shekhar Mangar) (gsingers)
- Fixed spell check collation offset issue. [SOLR-606](https://issues.apache.org/jira/browse/SOLR-606) (Stefan Oestreicher) (Geoffrey Young) (gsingers)
- SpellChecker accuracy configuration is not applied for FileBasedSpellChecker. Apply it for FileBasedSpellChecker and IndexBasedSpellChecker both. [SOLR-616](https://issues.apache.org/jira/browse/SOLR-616) (shalin)
- SpellCheckComponent throws NullPointerException on using spellcheck.q request parameter after restarting Solr, if reload is called but build is not called. [SOLR-648](https://issues.apache.org/jira/browse/SOLR-648) (Jonathan Lee) (shalin)
- snappuler fix for FreeBSD/Darwin [SOLR-669](https://issues.apache.org/jira/browse/SOLR-669) (Richard "Trey" Hyde) (Otis Gospodnetic)
- DataImportHandler should use UpdateRequestProcessor API instead of directly using UpdateHandler. [SOLR-676](https://issues.apache.org/jira/browse/SOLR-676) (shalin)
- Fixed bug in NamedListCodec in regards to serializing Iterable objects. [SOLR-696](https://issues.apache.org/jira/browse/SOLR-696) (gsingers)
- DIH NumberFormatTransformer can silently ignore part of the string while parsing. Now it tries to use the complete string for parsing. Failure to do so will result in an exception. [SOLR-704](https://issues.apache.org/jira/browse/SOLR-704) (Stefan Oestreicher) (shalin)
- DIH: Jdbc Drivers and DataSources fail to load if placed in multicore sharedLib or core's lib directory. [SOLR-726](https://issues.apache.org/jira/browse/SOLR-726) (Walter Ferrara) (Noble Paul) (shalin)
- DIH Context.getDataSource(String) gives current entity's DataSource instance regardless of argument. [SOLR-729](https://issues.apache.org/jira/browse/SOLR-729) (Noble Paul) (shalin)
- Allow QParser and ValueSourceParsers to be extended with same name [SOLR-749](https://issues.apache.org/jira/browse/SOLR-749) (hossman) (gsingers)
- Make TextField respect sortMissingFirst and sortMissingLast fields. (J.J. Larrea) (yonik)
- autoCommit/maxDocs was not working properly when large autoCommit/maxTime was specified (klaas)
- The CSV loader incorrectly threw an exception when given header=true (the default). (ryan) (yonik)

### Other (38 changes)

- Moved common classes to org.apache.solr.common and altered the build scripts to make two jars: apache-solr-1.3.jar and apache-solr-1.3-common.jar. This common.jar can be used in client code; It does not have lucene or junit dependencies. The original classes have been replaced with a @Deprecated extended class and are scheduled to be removed in a later release. While this change does not affect API compatibility, it is recommended to update references to these deprecated classes. [SOLR-135](https://issues.apache.org/jira/browse/SOLR-135) (ryan)
- Static access to SolrCore.getSolrCore() and SolrConfig.config have been deprecated in order to support multiple loaded cores. [SOLR-215](https://issues.apache.org/jira/browse/SOLR-215) (Henri Biestro) (ryan)
- Tweaks to post.jar so it prints the error message from Solr. [SOLR-268](https://issues.apache.org/jira/browse/SOLR-268) (Brian Whitman) (hossman)
- The create method in all TokenFilter and Tokenizer Factories provided by Solr now declare their specific return types instead of just using "TokenStream" [SOLR-367](https://issues.apache.org/jira/browse/SOLR-367) (hossman)
- Hooks add to build system for automatic generation of (stub) Tokenizer and TokenFilter Factories. Also: new Factories for all Tokenizers and TokenFilters provided by the lucene-analyzers-2.2.0.jar -- includes support for German, Chinese, Russan, Dutch, Greek, Brazilian, Thai, and French. [SOLR-396](https://issues.apache.org/jira/browse/SOLR-396) (hossman)
- . Changed the names of the Solr JARs to use the defacto standard JAR names based on project-name-version.jar. This yields, for example: apache-solr-common-1.3-dev.jar apache-solr-solrj-1.3-dev.jar apache-solr-1.3-dev.jar [SOLR-411](https://issues.apache.org/jira/browse/SOLR-411) 
- Changed analysis.jsp to use POST instead of GET, also made the input area a bit bigger [SOLR-451](https://issues.apache.org/jira/browse/SOLR-451) (gsingers)
- Added clover code coverage targets for committers and the nightly build. Requires the Clover library, as licensed to Apache and only available privately. To run: ant -Drun.clover=true clean clover test generate-clover-reports [SOLR-479](https://issues.apache.org/jira/browse/SOLR-479) 
- Added in deprecation comments. [SOLR-489](https://issues.apache.org/jira/browse/SOLR-489) (Sean Timm) (Lars Kothoff) (gsingers)
- Nightly release includes client sources. [SOLR-510](https://issues.apache.org/jira/browse/SOLR-510) (koji)
- Changed luke.xsl to use divs w/css for generating histograms instead of SVG [SOLR-518](https://issues.apache.org/jira/browse/SOLR-518) (Thomas Peuss) (hossman)
- Deprecated unused LengthFilter since already core in Lucene-Java [SOLR-520](https://issues.apache.org/jira/browse/SOLR-520) (hossman)
- Different exit code for rsyncd-start and snappuller if disabled [SOLR-531](https://issues.apache.org/jira/browse/SOLR-531) (Thomas Peuss) (billa)
- Clarified DocumentBuilder addField javadocs [SOLR-550](https://issues.apache.org/jira/browse/SOLR-550) (gsingers)
- use Lucene updateDocument, deleteDocuments methods. This removes the maxBufferedDeletes parameter added by SOLR-310 as Lucene now manages the deletes. This provides slightly better indexing performance and makes overwrites atomic, eliminating the possibility of a crash causing duplicates. [SOLR-559](https://issues.apache.org/jira/browse/SOLR-559) [SOLR-310](https://issues.apache.org/jira/browse/SOLR-310) (yonik)
- Modified the build process to build contrib projects [SOLR-563](https://issues.apache.org/jira/browse/SOLR-563) (Shalin Shekhar Mangar) (Otis Gospodnetic)
- Upgraded to Lucene 2.4-dev (r669476) to support SOLR-572 [SOLR-572](https://issues.apache.org/jira/browse/SOLR-572) (gsingers)
- Added ant target and POM files for building maven artifacts of the Solr core, common, client and contrib. The target can publish artifacts with source and javadocs. [SOLR-586](https://issues.apache.org/jira/browse/SOLR-586) (Spencer Crissman) (Craig McClanahan) (shalin)
- Changed Solrj default value for facet.sort to true [SOLR-591](https://issues.apache.org/jira/browse/SOLR-591) (Lars Kotthoff) (Shalin)
- Added ShardParams interface and changed several string literals to references to constants in CommonParams. [SOLR-592](https://issues.apache.org/jira/browse/SOLR-592) (Lars Kotthoff) (Otis Gospodnetic)
- Improve/simplify example configs; and make index.jsp links more resilient to configs loaded via an InputStream [SOLR-636](https://issues.apache.org/jira/browse/SOLR-636) (Lars Kotthoff) (hossman)
- Refactored SimpleFacetsTest [SOLR-645](https://issues.apache.org/jira/browse/SOLR-645) (Lars Kotthoff) (hossman)
- reference count the SolrCore uses to prevent a premature close while a core is still in use. [SOLR-647](https://issues.apache.org/jira/browse/SOLR-647) (Henri Biestro) (Noble Paul) (yonik)
- Nightly release includes contrib sources. [SOLR-672](https://issues.apache.org/jira/browse/SOLR-672) (Jeremy Hinegardner) (shalin)
- Modify build file to create javadocs for core, solrj, contrib and "all inclusive" [SOLR-673](https://issues.apache.org/jira/browse/SOLR-673) (shalin)
- Scripts now support FreeBSD [SOLR-682](https://issues.apache.org/jira/browse/SOLR-682) (Richard Trey Hyde) (gsingers)
- / SOLR-695: If you have used "MultiCore" functionality in an unreleased version of 1.3-dev, many classes and configs have been renamed for the official 1.3 release. Speciffically, solr.xml has replaced multicore.xml, and uses a slightly different syntax. The solrj classes: MultiCore{Request/Response/Params} have been renamed: CoreAdmin{Request/Response/Params} [SOLR-689](https://issues.apache.org/jira/browse/SOLR-689) [SOLR-695](https://issues.apache.org/jira/browse/SOLR-695) (hossman) (ryan) (Henri Biestro)
- Migrated to stable released builds of StAX API 1.0.1 and StAX 1.2.0 [SOLR-692](https://issues.apache.org/jira/browse/SOLR-692) (shalin)
- SolrQueryParser now uses a ConstantScoreQuery for wildcard queries that prevent an exception from being thrown when the number of matching terms exceeds the BooleanQuery clause limit. [SOLR-737](https://issues.apache.org/jira/browse/SOLR-737) (yonik)
- Upgraded to Lucene 2.2.0; June 18, 2007. 
- Upgraded to commons-CSV r609327, which fixes escaping bugs and introduces new escaping and whitespace handling options to increase compatibility with different formats. (yonik)
- Upgraded to Lucene 2.3.0; Jan 23, 2008. 
- Upgrade to Lucene 2.3.1 
- Upgrade to Lucene 2.3.2 
- Upgraded to Lucene 2.4-dev (r686801) (yonik)
- Upgraded to Lucene 2.4-dev (r688745) 27-Aug-2008 (yonik)
- Upgraded to Lucene 2.4-dev (r691741) 03-Sep-2008 (yonik)
- Replaced the StAX reference implementation with the geronimo StAX API jar, and the Woodstox StAX implementation. (yonik)


[1.2.0] - 2007-06-06
--------------------

### Added (36 changes)

- Support for "Update Plugins" -- RequestHandlers that want access to streams of data for doing updates. ContentStreams can come from the raw POST body, multi-part form data, or remote URLs. Included in this change is a new SolrDispatchFilter that allows RequestHandlers registered with names that begin with a "/" to be accessed using a URL structure based on that name. [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (Ryan McKinley) (hossman)
- New faceting parameters that allow specification of a minimum count for returned facets (facet.mincount), paging through facets (facet.offset, facet.limit), and explicit sorting (facet.sort). facet.zeros is now deprecated. [SOLR-106](https://issues.apache.org/jira/browse/SOLR-106) (yonik)
- JAVA API: Change NamedList to use Java5 generics and implement Iterable&lt;Map.Entry&gt; [SOLR-107](https://issues.apache.org/jira/browse/SOLR-107) (Ryan McKinley) (yonik)
- IndexInfoRequestHandler added. [SOLR-116](https://issues.apache.org/jira/browse/SOLR-116) (Erik Hatcher)
- Limit a field faceting to constraints with a prefix specified by facet.prefix or f.&lt;field&gt;.facet.prefix. [SOLR-117](https://issues.apache.org/jira/browse/SOLR-117) (yonik)
- DirectUpdateHandler2 supports autocommitting after a specified time (in ms), using &lt;autoCommit&gt;&lt;maxTime&gt;10000&lt;/maxTime&gt;&lt;/autoCommit&gt;. [SOLR-126](https://issues.apache.org/jira/browse/SOLR-126) (Ryan McKinley) (klaas)
- Changes to make Solr more easily embeddable, in addition to logging which request handler handled each request. [SOLR-149](https://issues.apache.org/jira/browse/SOLR-149) (Ryan McKinley) (yonik)
- DisMaxRequestHandler now supports configurable alternate behavior when q is not specified. A "q.alt" param can be specified using SolrQueryParser syntax as a mechanism for specifying what query the dismax handler should execute if the main user query (q) is blank. [SOLR-152](https://issues.apache.org/jira/browse/SOLR-152) (Ryan McKinley) (hossman)
- new "qs" (Query Slop) param for DisMaxRequestHandler allows for specifying the amount of default slop to use when parsing explicit phrase queries from the user. [SOLR-158](https://issues.apache.org/jira/browse/SOLR-158) (Adam Hiatt) (hossman)
- Added a "Luke" request handler and other admin helpers. This exposes the system status through the standard requestHandler framework. [SOLR-162](https://issues.apache.org/jira/browse/SOLR-162) (ryan)
- StandardRequestHandler now supports a "sort" parameter. Using the ';' syntax is still supported, but it is recommended to transition to the new syntax. [SOLR-170](https://issues.apache.org/jira/browse/SOLR-170) (ryan)
- The index schema now supports "required" fields. Attempts to add a document without a required field will fail, returning a descriptive error message. By default, the uniqueKey field is a required field. This can be disabled by setting required=false in schema.xml. [SOLR-181](https://issues.apache.org/jira/browse/SOLR-181) (Greg Ludington) (ryan)
- allow lazy loading of request handlers on first request. [SOLR-182](https://issues.apache.org/jira/browse/SOLR-182) (Ryan McKinley) (yonik)
- add echoHandler=true to responseHeader, support echoParams=all [SOLR-184](https://issues.apache.org/jira/browse/SOLR-184) (Ryan McKinley) (ehatcher)
- New parameters for input: stream.contentType for specifying or overriding the content type of input, and stream.file for reading local files. [SOLR-197](https://issues.apache.org/jira/browse/SOLR-197) (Ryan McKinley) (yonik)
- new n-gram tokenizers available via NGramTokenizerFactory and EdgeNGramTokenizerFactory. [SOLR-199](https://issues.apache.org/jira/browse/SOLR-199) (Adam Hiatt) (yonik)
- The request dispatcher (added in SOLR-104) can handle calls to /select. This offers uniform error handling for /update and /select. To enable this behavior, you must add: &lt;requestDispatcher handleSelect="true" &gt; to your solrconfig.xml See the example solrconfig.xml for details. [SOLR-204](https://issues.apache.org/jira/browse/SOLR-204) [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (ryan)
- new example_rss.xsl and example_atom.xsl to provide more examples for people about the Solr XML response format and how they can transform it to suit different needs. [SOLR-208](https://issues.apache.org/jira/browse/SOLR-208) (Brian Whitman) (hossman)
- Added a regex PatternTokenizerFactory. This extracts tokens from the input string using a regex Pattern. [SOLR-211](https://issues.apache.org/jira/browse/SOLR-211) (Ryan McKinley)
- Added a DirectSolrConnection class. This lets you access solr using the standard request/response formats, but does not require an HTTP connection. It is designed for embedded applications. [SOLR-212](https://issues.apache.org/jira/browse/SOLR-212) (ryan)
- Fields configured in the schema to be neither indexed or stored will now be quietly ignored by Solr when Documents are added. The example schema has a comment explaining how this can be used to ignore any "unknown" fields. [SOLR-217](https://issues.apache.org/jira/browse/SOLR-217) (Will Johnson) (hossman)
- Adding a PhoneticFilterFactory that uses apache commons codec language encoders to build phonetically similar tokens. This currently supports: DoubleMetaphone, Metaphone, Soundex, and RefinedSoundex [SOLR-224](https://issues.apache.org/jira/browse/SOLR-224) (ryan)
- Added support for dynamic field as the destination of a copyField using glob (*) replacement. [SOLR-226](https://issues.apache.org/jira/browse/SOLR-226) (ryan)
- If schema.xml defines multiple fieldTypes, fields, or dynamicFields with the same name, a severe error will be logged rather then quietly continuing. Depending on the &lt;abortOnConfigurationError&gt; settings, this may halt the server. Likewise, if solrconfig.xml defines multiple RequestHandlers with the same name it will also add an error. [SOLR-227](https://issues.apache.org/jira/browse/SOLR-227) (ryan)
- TrimFilter can update the Token's startOffset and endOffset if updateOffsets="true". By default the Token offsets are unchanged. [SOLR-234](https://issues.apache.org/jira/browse/SOLR-234) (ryan)
- Deprecated SolrException( int, ... ) constructors in favor of constructors that takes an ErrorCode enum. This will ensure that all SolrExceptions use a valid HTTP status code. [SOLR-249](https://issues.apache.org/jira/browse/SOLR-249) (ryan)
- Abstracted SolrHighlighter and moved existing implementation to DefaultSolrHighlighter. Adjusted SolrCore and solrconfig.xml so that highlighter is configurable via a class attribute. Allows users to use their own highlighter implementation. [SOLR-386](https://issues.apache.org/jira/browse/SOLR-386) (Tricia Williams) (klaas)
- CSV data format for document additions and updates. [SOLR-66](https://issues.apache.org/jira/browse/SOLR-66) (yonik)
- Add system property ${&lt;sys.prop&gt;[:&lt;default&gt;]} substitution for configuration files loaded, including schema.xml and solrconfig.xml. [SOLR-79](https://issues.apache.org/jira/browse/SOLR-79) (Erik Hatcher with inspiration from Andrew Saar)
- Negative queries are now allowed everywhere. Negative queries are generated and cached as their positive counterpart, speeding generation and generally resulting in smaller sets to cache. Set intersections in SolrIndexSearcher are more efficient, starting with the smallest positive set, subtracting all negative sets, then intersecting with all other positive sets. [SOLR-80](https://issues.apache.org/jira/browse/SOLR-80) (yonik)
- More SpellCheckerRequestHandler enhancements, inlcluding support for relative or absolute directory path configurations, as well as RAM based directory. [SOLR-81](https://issues.apache.org/jira/browse/SOLR-81) (hossman)
- SpellCheckerRequestHandler that uses the SpellChecker from the Lucene contrib. [SOLR-81](https://issues.apache.org/jira/browse/SOLR-81) (Otis Gospodnetic and Adam Hiatt)
- Default field values can be specified in the schema.xml. [SOLR-82](https://issues.apache.org/jira/browse/SOLR-82) (Ryan McKinley) (hossman)
- Added standalone Java-based command-line updater. [SOLR-86](https://issues.apache.org/jira/browse/SOLR-86) (Erik Hatcher) (Bertrand Delecretaz)
- Two new TokenFilters with corresponding Factories... * TrimFilter - Trims leading and trailing whitespace from Tokens * PatternReplaceFilter - applies a Pattern to each token in the stream, replacing match occurances with a specified replacement. [SOLR-89](https://issues.apache.org/jira/browse/SOLR-89) (hossman)
- allow configuration of a limit of the number of searchers that can be warming in the background. This can be used to avoid out-of-memory errors, or contention caused by more and more searchers warming in the background. An error is thrown if the limit specified by maxWarmingSearchers in solrconfig.xml is exceeded. [SOLR-91](https://issues.apache.org/jira/browse/SOLR-91) (yonik)

### Changed (4 changes)

- HashDocSet specific implementations of union() and andNot() for a 20x performance improvement for those set operations, and a new hash algorithm speeds up exists() by 10% and intersectionSize() by 8%. [SOLR-114](https://issues.apache.org/jira/browse/SOLR-114) (yonik)
- Solr now uses BooleanQuery.clauses() instead of BooleanQuery.getClauses() in any situation where there is no risk of modifying the original query. [SOLR-115](https://issues.apache.org/jira/browse/SOLR-115) (hossman)
- Added a facet.enum.cache.minDf parameter which avoids using the filterCache for terms that match few documents, trading decreased memory usage for increased query time. [SOLR-221](https://issues.apache.org/jira/browse/SOLR-221) (yonik)
- Speed up sorted faceting on multivalued fields by ~60% when the base set consists of a relatively large portion of the index. [SOLR-221](https://issues.apache.org/jira/browse/SOLR-221) (yonik)

### Fixed (15 changes)

- Changed the SOLR-104 RequestDispatcher so that /select?qt=xxx can not access handlers that start with "/". This makes path based authentication possible for path based request handlers. [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (ryan)
- Fix for bug introduced in SOLR-104 where some Exceptions were being ignored by all "out of the box" RequestHandlers. [SOLR-145](https://issues.apache.org/jira/browse/SOLR-145) [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (hossman)
- JNDI solr.home code refactoring. SOLR-104 moved some JNDI related code to the init method of a Servlet Filter - according to the Servlet Spec, all Filter's should be initialized prior to initializing any Servlets, but this is not the case in at least one Servlet Container (Resin). This "bug fix" refactors this JNDI code so that it should be executed the first time any attempt is made to use the solr.home dir. [SOLR-166](https://issues.apache.org/jira/browse/SOLR-166) [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (Ryan McKinley) (hossman)
- The SynonymFilter sometimes generated incorrect offsets when multi token synonyms were mached in the source text. [SOLR-167](https://issues.apache.org/jira/browse/SOLR-167) (yonik)
- Fix display positioning of multiple tokens at the same position in analysis.jsp [SOLR-168](https://issues.apache.org/jira/browse/SOLR-168) (yonik)
- Bug fix to SolrDispatchFilter to reduce "too many open files" problem was that SolrDispatchFilter was not closing requests when finished. Also modified ResponseWriters to only fetch a Searcher reference if necessary for writing out DocLists. [SOLR-173](https://issues.apache.org/jira/browse/SOLR-173) (Ryan McKinley) (hossman)
- bin scripts do not support non-default webapp names. Added "-U" option to specify a full path to the update url, overriding the "-h" (hostname), "-p" (port) and "-w" (webapp name) parameters. [SOLR-188](https://issues.apache.org/jira/browse/SOLR-188) (Jeff Rodenburg) (billa)
- RunExecutableListener always waited for the process to finish, even when wait="false" was set. [SOLR-198](https://issues.apache.org/jira/browse/SOLR-198) (Koji Sekiguchi) (yonik)
- Changed distribution scripts to remove recursive find and avoid use of "find -maxdepth" on platforms where it is not supported. [SOLR-207](https://issues.apache.org/jira/browse/SOLR-207) (yonik)
- Some servlet containers (including Tomcat and Resin) do not obey the specified charset. Rather than letting the container handle it solr now uses the charset from the header contentType to decode posted content. Using the contentType: "text/xml; charset=utf-8" will force utf-8 encoding. If you do not specify a contentType, it will use the platform default. [SOLR-214](https://issues.apache.org/jira/browse/SOLR-214) (Koji Sekiguchi) (ryan)
- Changing writeLockTimeout in solrconfig.xml did not change the effective timeout. [SOLR-222](https://issues.apache.org/jira/browse/SOLR-222) (Koji Sekiguchi) (yonik)
- Undefined system properties used in configuration files now cause a clear message to be logged rather than an obscure exception thrown. [SOLR-241](https://issues.apache.org/jira/browse/SOLR-241) (Koji Sekiguchi) (ehatcher)
- Parsing of synonym files did not correctly handle escaped whitespace such as \r\n\t\b\f. [SOLR-87](https://issues.apache.org/jira/browse/SOLR-87) (yonik)
- Tighten up sort specification error checking, throw exceptions for missing sort specifications or a sort on a non-indexed field. [SOLR-9](https://issues.apache.org/jira/browse/SOLR-9) [SOLR-99](https://issues.apache.org/jira/browse/SOLR-99) (Ryan McKinley) (yonik)
- DOMUtils.getText (used when parsing config files) did not work properly with many DOM implementations when dealing with "Attributes". [SOLR-92](https://issues.apache.org/jira/browse/SOLR-92) (Ryan McKinley) (hossman)

### Other (14 changes)

- The example solrconfig.xml maps /update to XmlUpdateRequestHandler using the new request dispatcher (SOLR-104). This requires posted content to have a valid contentType: curl -H 'Content-type:text/xml; charset=utf-8' The response format matches that of /select and returns standard error codes. To enable solr1.1 style /update, do not map "/update" to any handler in solrconfig.xml [SOLR-104](https://issues.apache.org/jira/browse/SOLR-104) (ryan)
- Change default of json.nl to flat, change so that json.nl only affects items where order matters (facet constraint listings). Fix JSON output bug for null values. Internal JAVA API: change most uses of NamedList to SimpleOrderedMap. [SOLR-125](https://issues.apache.org/jira/browse/SOLR-125) (yonik)
- Upgraded Jetty to the latest stable release 6.1.3 [SOLR-128](https://issues.apache.org/jira/browse/SOLR-128) (ryan)
- By default, solr will abort after any severe initialization errors. This behavior can be disabled by setting: &lt;abortOnConfigurationError&gt;false&lt;/abortOnConfigurationError&gt; in solrconfig.xml [SOLR-179](https://issues.apache.org/jira/browse/SOLR-179) (ryan)
- Exceptions with error code 400 are raised when numeric argument parsing fails. RequiredSolrParams class added to facilitate checking for parameters that must be present. [SOLR-183](https://issues.apache.org/jira/browse/SOLR-183) (Ryan McKinley) (J.J. Larrea) (yonik)
- More options for post.jar to support stdin, xml on the commandline, and defering commits. Tutorial modified to take advantage of these options so there is no need for curl. [SOLR-230](https://issues.apache.org/jira/browse/SOLR-230) (hossman)
- If a charset is not specified in the contentType, ContentStream.getReader() will use UTF-8 encoding. [SOLR-231](https://issues.apache.org/jira/browse/SOLR-231) (ryan)
- Highlighting using DisMax will only pick up terms from the main user query, not boost or filter queries (klaas)
- A new method "getSolrQueryParser" has been added to the IndexSchema class for retrieving a new SolrQueryParser instance with all options specified in the schema.xml's &lt;solrQueryParser&gt; block set. The documentation for the SolrQueryParser constructor and its use of IndexSchema have also been clarified. (Erik Hatcher and hossman)
- DisMaxRequestHandler's bq, bf, qf, and pf parameters can now accept multiple values (klaas)
- Query are re-written before highlighting is performed. This enables proper highlighting of prefix and wildcard queries (klaas)
- A meaningful exception is raised when attempting to add a doc missing a unique id if it is declared in the schema and allowDups=false. (ryan) (klaas)
- Updated to Lucene 2.1 
- Updated to Lucene 2007-05-20_00-04-53 


[1.1.0] - 2006-12-22
--------------------

### Added (33 changes)

- New abstract BufferedTokenStream for people who want to write Tokenizers or TokenFilters that require arbitrary buffering of the stream. SOLR-11 [SOLR-11](https://issues.apache.org/jira/browse/SOLR-11) (yonik) (hossman)
- New RemoveDuplicatesToken - useful in situations where synonyms, stemming, or word-deliminater-ing produce identical tokens at the same position. SOLR-11 [SOLR-11](https://issues.apache.org/jira/browse/SOLR-11) (yonik) (hossman)
- Support for customizing the QueryResponseWriter per request SOLR-16 [SOLR-16](https://issues.apache.org/jira/browse/SOLR-16) (Mike Baranczak) (hossman)
- copyField accepts dynamicfield-like names as the source. SOLR-21 [SOLR-21](https://issues.apache.org/jira/browse/SOLR-21) (Darren Erik Vengroff) (yonik)
- Ability to store term vectors for fields. SOLR-23 [SOLR-23](https://issues.apache.org/jira/browse/SOLR-23) (Mike Klaas) (yonik)
- Added highlighting to SolrPluginUtils and implemented in StandardRequestHandler and DisMaxRequestHandler SOLR-24 [SOLR-24](https://issues.apache.org/jira/browse/SOLR-24) (Mike Klaas) (hossman) (yonik)
- SnowballPorterFilterFactory language is configurable via the "language" attribute, with the default being "English". SOLR-27 [SOLR-27](https://issues.apache.org/jira/browse/SOLR-27) (Bertrand Delacretaz) (yonik)
- ISOLatin1AccentFilterFactory, instantiates ISOLatin1AccentFilter to remove accents. SOLR-28 [SOLR-28](https://issues.apache.org/jira/browse/SOLR-28) (Bertrand Delacretaz) (yonik)
- JSON, Python, Ruby QueryResponseWriters: use wt="json", "python" or "ruby" SOLR-31 [SOLR-31](https://issues.apache.org/jira/browse/SOLR-31) (yonik)
- Make web admin pages return UTF-8, change Content-type declaration to include a space between the mime-type and charset SOLR-35 [SOLR-35](https://issues.apache.org/jira/browse/SOLR-35) (Philip Jacob)
- JAVA API: new version of SolrIndexSearcher.getDocListAndSet() which takes flags SOLR-39 [SOLR-39](https://issues.apache.org/jira/browse/SOLR-39) (Greg Ludington) (yonik)
- A HyphenatedWordsFilter, a text analysis filter used during indexing to rejoin words that were hyphenated and split by a newline. SOLR-41 [SOLR-41](https://issues.apache.org/jira/browse/SOLR-41) (Boris Vitez) (yonik)
- Simple faceted search support for fields (enumerating terms) and arbitrary queries added to both StandardRequestHandler and DisMaxRequestHandler. SOLR-44 [SOLR-44](https://issues.apache.org/jira/browse/SOLR-44) (hossman)
- Added a CompressableField base class which allows fields of derived types to be compressed using the compress=true setting. The field type also gains the ability to specify a size threshold at which field data is compressed. SOLR-45 [SOLR-45](https://issues.apache.org/jira/browse/SOLR-45) (klaas)
- In addition to specifying default RequestHandler params in the solrconfig.xml, support has been added for configuring values to be appended to the multi-val request params, as well as for configuring invariant params that can not overridden in the query. SOLR-46 [SOLR-46](https://issues.apache.org/jira/browse/SOLR-46) (hossman)
- New XSLTResponseWriter does server side XSLT processing of XML Response. In the process, an init(NamedList) method was added to QueryResponseWriter which works the same way as SolrRequestHandler. SOLR-49 [SOLR-49](https://issues.apache.org/jira/browse/SOLR-49) (Bertrand Delacretaz) (hossman)
- json.wrf parameter adds a wrapper-function around the JSON response, useful in AJAX with dynamic script tags for specifying a JavaScript callback function. SOLR-56 [SOLR-56](https://issues.apache.org/jira/browse/SOLR-56) (Bertrand Delacretaz) (yonik)
- autoCommit can be specified every so many documents added SOLR-65 [SOLR-65](https://issues.apache.org/jira/browse/SOLR-65) (klaas)
- ${solr.home}/lib directory can now be used for specifying "plugin" jars SOLR-68 [SOLR-68](https://issues.apache.org/jira/browse/SOLR-68) (hossman)
- Support for "Date Math" relative "NOW" when specifying values of a DateField in a query -- or when adding a document. SOLR-71 [SOLR-71](https://issues.apache.org/jira/browse/SOLR-71) (hossman)
- useColdSearcher control in solrconfig.xml prevents the first searcher from being used before it's done warming. This can help prevent thrashing on startup when multiple requests hit a cold searcher. The default is "false", preventing use before warm. SOLR-77 [SOLR-77](https://issues.apache.org/jira/browse/SOLR-77) (yonik)
- added support for setting Lucene's positionIncrementGap 
- Admin: new statistics for SolrIndexSearcher 
- Admin: caches now show config params on stats page 
- max() function added to FunctionQuery suite 
- postOptimize hook, mirroring the functionallity of the postCommit hook, but only called on an index optimize. 
- Ability to HTTP POST query requests to /select in addition to HTTP-GET 
- The default search field may now be overridden by requests to the standard request handler using the df query parameter. (Erik Hatcher)
- Added DisMaxRequestHandler and SolrPluginUtils. (Chris Hostetter)
- Added KeywordTokenizerFactory (hossman)
- new DocSet.andNot(), DocSet.andNotSize() (yonik)
- Made query parser default operator configurable via schema.xml: &lt;solrQueryParser defaultOperator="AND|OR"/&gt; The default operator remains "OR". 
- Default operator for query parsing can now be specified with q.op=AND|OR from the client request, overriding the schema value. (ehatcher)

### Changed (6 changes)

- OpenBitSet completed, replaces BitSet as the implementation for BitDocSet. Iteration is faster, and BitDocSet.intersectionSize(BitDocSet) and unionSize is between 3 and 4 times faster. SOLR-15 [SOLR-15](https://issues.apache.org/jira/browse/SOLR-15) (yonik)
- getDocListAndSet can now generate both a DocList and a DocSet from a single lucene query. 
- BitDocSet.intersectionSize(HashDocSet) no longer generates an intermediate set 
- much faster unionSize when one of the sets is a HashDocSet: O(smaller_set_size) 
- Optimized getDocSet() for term queries resulting in a 36% speedup of facet.field queries where DocSets aren't cached (for example, if the number of terms in the field is larger than the filter cache.) (yonik)
- Optimized facet.field faceting by as much as 500 times when the field has a single token per document (not multiValued & not tokenized) by using the Lucene FieldCache entry for that field to tally term counts. The first request utilizing the FieldCache will take longer than subsequent ones. 

### Fixed (13 changes)

- Worked around a Jetty bug that caused invalid XML responses for fields containing non ASCII chars. SOLR-32 [SOLR-32](https://issues.apache.org/jira/browse/SOLR-32) (Bertrand Delacretaz) (yonik)
- WordDelimiterFilter can throw exceptions if configured with both generate and catenate off. SOLR-34 [SOLR-34](https://issues.apache.org/jira/browse/SOLR-34) (Mike Klaas) (yonik)
- Multiple-doc update generates well-formed xml SOLR-65 [SOLR-65](https://issues.apache.org/jira/browse/SOLR-65) (klaas)
- Better parsing of pingQuery from solrconfig.xml SOLR-70 [SOLR-70](https://issues.apache.org/jira/browse/SOLR-70) (hossman)
- Fixed HTML escaping issues with user input to analysis.jsp and action.jsp SOLR-74 [SOLR-74](https://issues.apache.org/jira/browse/SOLR-74) (hossman)
- Fixed delete-by-id for field types who's indexed form is different from the printable form (mainly sortable numeric types)
- Added escaping of attribute values in the XML response (Erik Hatcher)
- Added empty extractTerms() to FunctionQuery to enable use in a MultiSearcher (Yonik)
- WordDelimiterFilter sometimes lost token positionIncrement information 
- Fix reverse sorting for fields were sortMissingFirst=true (Rob Staveley) (yonik)
- Escape '&gt;' in XML output ([because ]]> is illegal in CharData]())
- field boosts weren't being applied and doc boosts were being applied to fields (klaas)
- Fixed bug with "Distribution" page introduced when Versions were added to "Info" page (hossman)

### Other (26 changes)

- Included unique key field name/value (if available) in log message of add SOLR-18 [SOLR-18](https://issues.apache.org/jira/browse/SOLR-18) (billa)
- FunctionQuery.explain now uses ComplexExplanation to provide more accurate score explanations when composed in a BooleanQuery. SOLR-25 [SOLR-25](https://issues.apache.org/jira/browse/SOLR-25) (hossman)
- Removed src/apps containing the legacy "SolrTest" app SOLR-3 [SOLR-3](https://issues.apache.org/jira/browse/SOLR-3) (hossman)
- Highlighter params changed to be prefixed with "hl."; allow fragmentsize customization and per-field overrides on many options SOLR-37 [SOLR-37](https://issues.apache.org/jira/browse/SOLR-37) (Andrew May) (klaas)
- Default param values for DisMaxRequestHandler should now be specified using a '&lt;lst name="defaults"&gt;...&lt;/lst&gt;' init param, for backwards compatability all init prams will be used as defaults if an init param with that name does not exist. SOLR-43 [SOLR-43](https://issues.apache.org/jira/browse/SOLR-43) (hossman)
- The DisMaxRequestHandler now supports multiple occurances of the "fq" param. SOLR-44 [SOLR-44](https://issues.apache.org/jira/browse/SOLR-44) (hossman)
- Added javascript to catch empty query in admin query forms (Tomislav Nakic-Alfirevic via billa, SOLR-48 [SOLR-48](https://issues.apache.org/jira/browse/SOLR-48) 
- Lazy field loading can be enabled via a solrconfig directive. This will be faster when not all stored fields are needed from a document SOLR-52 [SOLR-52](https://issues.apache.org/jira/browse/SOLR-52) (klaas)
- Made admin JSPs return XML and transform them with new XSL stylesheets SOLR-58 [SOLR-58](https://issues.apache.org/jira/browse/SOLR-58) (Otis Gospodnetic)
- If the "echoParams=explicit" request parameter is set, request parameters are copied to the output. In an XML output, they appear in new &lt;lst name="params"&gt; list inside the new &lt;lst name="responseHeader"&gt; element, which replaces the old &lt;responseHeader&gt;. Adding a version=2.1 parameter to the request produces the old format, for backwards compatibility SOLR-59 [SOLR-59](https://issues.apache.org/jira/browse/SOLR-59) (bdelacretaz and yonik)
- Modified admin styles to improve display in Internet Explorer SOLR-6 [SOLR-6](https://issues.apache.org/jira/browse/SOLR-6) (Greg Ludington) (billa)
- check solr return code in admin scripts, SOLR-62 [SOLR-62](https://issues.apache.org/jira/browse/SOLR-62) 
- blackslash escape * in ssh command used in snappuller for zsh compatibility, SOLR-63 [SOLR-63](https://issues.apache.org/jira/browse/SOLR-63) 
- Document update handling locking is much sparser, allowing performance gains through multiple threads. Large commits also might be faster SOLR-65 [SOLR-65](https://issues.apache.org/jira/browse/SOLR-65) (klaas)
- Config parsing should now work useing DOM Level 2 parsers -- Solr previously relied on getTextContent which is a DOM Level 3 addition SOLR-78 [SOLR-78](https://issues.apache.org/jira/browse/SOLR-78) (Alexander Saar) (hossman)
- classes reorganized into different packages, package names changed to Apache 
- force read of document stored fields in QuerySenderListener 
- Solr now looks in ./solr/conf for config, ./solr/data for data configurable via solr.solr.home system property 
- Upgrade to Lucene 2.0 nightly build 2006-06-22, lucene SVN revision 416224, http://svn.apache.org/viewvc/lucene/java/trunk/CHANGES.txt?view=markup&pathrev=416224 
- Upgrade to Lucene 2.0 nightly build 2006-07-15, lucene SVN revision 422302, 
- Updated to Lucene 2.0 nightly build 2006-09-07, SVN revision 462111 
- Updated to Lucene 2.0 nightly build 2006-11-15, SVN revision 475069 
- Simplified index.jsp and form.jsp, primarily by removing/hiding XML specific params, and adding an option to pick the output type. (hossman)
- Added new numeric build property "specversion" to allow clean MANIFEST.MF files (hossman)
- Added Solr/Lucene versions to "Info" page (hossman)
- Explicitly set mime-type of .xsl files in web.xml to application/xslt+xml (hossman)






