/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
    id 'com.github.johnrengelman.shadow' version '6.1.0'
    id 'net.nemerosa.versioning' version '2.6.1'
}

apply plugin: 'com.github.johnrengelman.shadow'

configurations.all {
    resolutionStrategy {
        cacheChangingModulesFor 0, 'seconds'
    }
}

repositories {
    mavenLocal()
    maven {
        url = uri('http://repository.apache.org/snapshots')
    }

    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
    maven {
        url 'https://repo.maven.apache.org/maven2'
        name 'Maven Central'
    }
}

dependencies {
    implementation ('org.slf4j:slf4j-api:1.7.32')
    implementation 'org.apache.commons:commons-exec:1.3'
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    implementation 'commons-io:commons-io:2.5'
    implementation 'commons-cli:commons-cli:20040117.000000'
    implementation 'org.jline:jline-reader:3.20.0'
    implementation 'org.apache.commons:commons-csv:1.8'
    implementation 'net.openhft:chronicle-map:3.21ea82' // TODO: remove
    implementation (group: 'org.apache.solr', name: 'solr-solrj', version: '8.9.0', {
        exclude group: "io.netty", module: "*"
        exclude group: "org.slf4j", module: "*"
        exclude group: "org.eclipse.jetty", module: "*"
    })
    implementation ('org.eclipse.jetty:jetty-server:11.0.6'
    , {
        exclude group: "org.slf4j", module: "*"
    })
    implementation ('org.eclipse.jetty:jetty-servlet:11.0.6'
    , {
        exclude group: "org.slf4j", module: "*"
    })
    implementation ('org.eclipse.jetty:jetty-http:11.0.6'
    , {
        exclude group: "org.slf4j", module: "*"
    })
    implementation ('org.eclipse.jetty.http2:http2-common:11.0.6'
    , {
        exclude group: "org.slf4j", module: "*"
    })

   // compileOnly 'javax.servlet:javax.servlet-api:3.1.0'

    testImplementation 'junit:junit:4.13.2'
    compileOnly 'org.apache.zeppelin:zeppelin-interpreter:0.10.1-SNAPSHOT'
    testImplementation 'org.apache.zeppelin:zeppelin-interpreter:0.10.1-SNAPSHOT'
    testImplementation 'org.apache.zeppelin:zeppelin-common:0.10.1-SNAPSHOT'
    testRuntime  'log4j:log4j:1.2.17'
}


group = 'jmh'
version = '0.1.0'
description = 'Zeppelin: JMH interpreter'
java.targetCompatibility = JavaVersion.VERSION_11

jar {
    manifest {
        attributes(
                'Built-By'       : System.properties['user.name'],
                'Build-Timestamp': new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").format(new Date()),
                'Build-Revision' : versioning.info.commit,
                'Created-By'     : "Gradle ${gradle.gradleVersion}",
                'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
                'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}"
        )
    }
}

shadowJar {
  outputs.upToDateWhen { false }
  archiveBaseName = 'jmh'
  relocate 'org.eclipse.jetty', 'shadow.jetty'
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
